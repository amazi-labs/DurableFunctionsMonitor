{"version":3,"sources":["../node_modules/moment-mini/locale sync /^/.*$","components/LoginIcon.tsx","DfmContext.ts","components/MainMenu.tsx","states/DurableOrchestrationStatus.ts","components/ErrorMessage.tsx","DateTimeHelpers.ts","states/ErrorMessageState.ts","CancelToken.ts","states/results-view/ResultsListTabState.ts","services/BackendClient.ts","states/LoginState.ts","states/MermaidDiagramStateBase.ts","states/results-view/ResultsGanttDiagramTabState.ts","states/results-view/ResultsHistogramTabState.ts","states/FunctionGraphStateBase.ts","states/az-func-as-a-graph/buildFunctionDiagramCode.ts","states/results-view/ResultsFunctionGraphTabState.ts","states/results-view/OrchestrationsState.ts","states/QueryString.ts","theme.ts","components/OrchestrationLink.tsx","components/dialogs/LongJsonDialog.tsx","components/results-view/OrchestrationsList.tsx","components/results-view/OrchestrationsHistogram.tsx","components/SaveAsSvgButton.tsx","components/results-view/OrchestrationsGanttChart.tsx","states/details-view/ICustomTabState.ts","components/results-view/OrchestrationsFunctionGraph.tsx","components/results-view/Orchestrations.tsx","components/details-view/DurableEntityButtons.tsx","components/details-view/DurableEntityFields.tsx","components/details-view/OrchestrationButtons.tsx","components/details-view/OrchestrationFields.tsx","states/MainState.ts","components/details-view/OrchestrationDetailsFunctionGraph.tsx","components/details-view/OrchestrationDetails.tsx","components/FunctionGraph.tsx","components/dialogs/PurgeHistoryDialog.tsx","components/dialogs/CleanEntityStorageDialog.tsx","components/dialogs/ConnectionParamsDialog.tsx","components/dialogs/StartNewInstanceDialog.tsx","components/Main.tsx","states/MainMenuState.ts","states/details-view/MermaidDiagramTabState.ts","states/details-view/SequenceDiagramTabState.ts","states/details-view/FunctionGraphTabState.ts","states/details-view/GanttDiagramTabState.ts","states/details-view/LiquidMarkupTabState.ts","states/details-view/OrchestrationDetailsState.ts","states/FunctionGraphState.ts","states/dialogs/PurgeHistoryDialogState.ts","states/dialogs/CleanEntityStorageDialogState.ts","states/dialogs/ConnectionParamsDialogState.ts","states/dialogs/StartNewInstanceDialogState.ts","states/TypedLocalStorage.ts","services/VsCodeBackendClient.ts","states/VsCodeTypedLocalStorage.ts","index.tsx"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","LoginIcon","observer","state","this","props","Button","color","isLoggedInAnonymously","onClick","evt","menuAnchorElement","currentTarget","AccountCircle","Box","width","Tooltip","title","Typography","userName","Menu","anchorEl","keepMounted","open","onClose","undefined","MenuItem","logout","Dialog","isLoggedIn","DialogContent","errorMessage","Container","className","fontSize","DialogContentText","allowedTaskHubNames","DialogTitle","List","hubName","ListItem","button","key","Link","href","locationPathName","CircularProgress","React","DfmContext","DfmClientConfig","showTimeAs","_showTimeAsLocal","localStorage","getItem","theme","val","setItem","t","isValid","local","utc","moment","toISOString","slice","utcString","length","dotPoint","lastIndexOf","milliseconds","substring","format","computed","observable","DfmContextType","dfmContextInstance","MainMenu","context","setWindowTitle","IconButton","RadioGroup","row","value","showTimeAsLocal","toString","onChange","target","doRefresh","FormControlLabel","control","Radio","label","showConnectionParamsDialog","showPurgeHistoryDialog","showCleanEntityStorageDialog","showStartNewInstanceDialog","contextType","HistoryEventFields","RuntimeStatuses","DurableOrchestrationStatus","instanceId","name","entityId","runtimeStatus","entityType","lastEvent","input","customStatus","output","createdTime","lastUpdatedTime","duration","tabTemplateNames","instance","DurableOrchestrationStatusFields","ErrorMessage","action","bound","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","handleClose","SnackbarContent","message","aria-label","DateTimeHelpers","isAfter","MinMoment","isBefore","MaxMoment","durationInMs","isNaN","days","Math","floor","c","result","toFixed","hours","minutes","seconds","ErrorMessageState","CancelToken","ResultsListTabState","_backendClient","_localStorage","_refresh","_noMorePagesToLoad","_pageSize","orderByString","_orderBy","orderByDirectionString","_orderByDirection","hiddenColumnsString","_hiddenColumns","split","_orchestrations","resetOrderBy","push","join","removeItem","filterClause","cancelToken","isAutoRefresh","Promise","setItems","fieldName","skip","orderByClause","orderByDirection","hiddenColumnsClause","uri","call","then","response","isCancelled","RoutePrefix","DfmRoutePrefix","BackendUri","process","BackendClient","_getTaskHubName","_getAuthorizationHeaderAsync","method","url","data","includes","toLowerCase","reject","headers","axios","request","r","OrchestrationsPathPrefix","LoginState","_aadApp","defaults","maxRedirects","login","_isLoggedIn","_userName","_taskHubName","_allowedTaskHubNames","window","location","pathname","pos","endsWith","tryGetTaskHubName","origin","substr","get","loginWithEasyAuthConfig","err","replace","authParams","scopes","getCurrentConfiguration","auth","clientId","acquireTokenSilent","authResponse","accessToken","console","log","idToken","rawIdToken","Authorization","acquireTokenRedirect","config","interceptors","use","reload","initializeTaskHubNameAndConfirmLogin","Msal","authority","redirectUri","rootUri","handleRedirectCallback","authErr","accountState","errorCode","account","getAccount","loginRedirect","getAuthorizationHeaderAsync","hubNames","pathParts","filter","p","MermaidDiagramStateBase","_mermaidInitialized","mermaid","initialize","startOnLoad","sequence","noteMargin","boxMargin","boxTextMargin","flowchart","curve","useMaxWidth","htmlLabels","formatDuration","ceil","ResultsGanttDiagramTabState","_instances","_diagramSvg","_diagramCode","initMermaidWhenNeeded","instances","renderDiagram","render","svg","oneBasedInstanceIndex","isVsCode","routePrefixAndTaskHubName","prevSectionName","sectionNr","nextLine","sectionName","getFunctionName","escapeTitle","Date","getTime","formatDateTime","formatDurationInSeconds","utcDateTimeString","ResultsHistogramTabState","_filterState","_counts","_originalTimeInterval","_applyingZoom","_timeRangeInMilliseconds","_numOfIntervals","_zoomedIn","_histograms","_numOfInstancesShown","timeFrom","timeTill","timeRange","startTime","valueOf","bucketLength","loadNextBatch","left","right","cancel","from","till","reloadOrchestrations","pageNumber","instanceTypeName","emptyHistogram","i","x0","x","y","instanceStartPos","FunctionGraphStateBase","_traversalResult","functionName","backendClient","functionOrProxy","startsWith","proxies","functions","filePath","iconsSvgElement","document","getElementById","innerHTML","space","getTriggerBindingText","binding","type","authLevel","methods","route","path","databaseName","collectionName","eventHubName","queueName","topicName","subscriptionName","schedule","getBindingText","tableName","buildFunctionDiagramCode","functionsMap","proxiesMap","settings","doNotRenderFunctions","func","triggerBinding","inputBindings","outputBindings","otherBindings","nodeCode","bindings","direction","getFunctionHash","f","hash","isCalledBy","sort","f1","f2","s1","s2","calledBy","inputBinding","outputBinding","otherBinding","isSignalledBy","signalledBy","signalName","isCalledByItself","doNotRenderProxies","proxyNodesColor","nodeTitle","notAddedToCsProjFile","proxy","proxyPurifiedName","warningNotAddedToCsProjFile","matchCondition","nodeName","backendUri","nextNodeName","getRequestOverridesArrowCode","requestOverrides","getResponseOverridesArrowCode","responseOverrides","nodeColor","maxSymbolsInTitle","arrowText","JSON","stringify","FilterOperatorEnum","ResultsTabEnum","TimeRangeEnum","MetricsItem","completed","running","failed","other","ResultsFunctionGraphTabState","TotalMetricsName","_metrics","_renderFunctions","_renderProxies","clonedMetrics","parse","metrics","funcName","diagramCode","applyIcons","QueryString","_values","pairs","search","pair","decodeURIComponent","queryString","encodeURIComponent","history","replaceState","OrchestrationsState","_isFunctionGraphAvailable","momentFrom","_tabStates","_refreshToken","_delayedRefreshDelay","_oldFilterValue","_oldTimeFrom","_oldTimeTill","timeFromString","subtract","_timeFrom","timeTillString","_timeTill","timeRangeString","values","_timeRange","filteredColumnString","_filteredColumn","filterOperatorString","_filterOperator","filterValueString","_filterValue","showStatusesString","_showStatuses","autoRefreshString","_autoRefresh","Number","tabIndexString","tabIndex","_tabIndex","_cancelToken","inProgress","loadOrchestrations","LastMinute","Last10Minutes","LastHour","Last24Hours","Last7Days","Last30Days","Last90Days","Custom","listState","status","checked","indexOf","splice","clearTimeout","setTimeout","isValidMoment","reset","s","encodedFilterValue","Equals","StartsWith","Contains","NotEquals","NotStartsWith","NotContains","selectedTabState","load","finally","colorTheme","REACT_APP_COLOR_THEME","Theme","createMuiTheme","palette","CustomTabStyle","backgroundColor","RuntimeStatusToStyle","hexToRGBA","error","light","success","warning","background","paper","hex","alpha","parseInt","RuntimeStatusToBadgeStyle","OrchestrationLink","onLinkClicked","orchestrationId","extraSanitizeHrefComponent","LongJsonDialog","fullWidth","maxWidth","jsonString","InputBase","multiline","readOnly","DialogActions","jsonObject","dialogTitle","dialogState","rowsMax","jsonFormattedString","component","variant","OrchestrationsList","FormHelperText","orchestrations","hiddenColumns","unhide","Paper","elevation","renderTable","longJsonDialogState","visibleColumns","showLastEventColumn","Table","size","TableHead","TableRow","col","onlyOneVisibleColumnLeft","TableCell","onMouseEnter","columnUnderMouse","onMouseLeave","TableSortLabel","active","orderBy","hideColumn","TableBody","orchestration","rowStyle","cellStyle","verticalAlign","style","formatDateTimeString","renderJson","OrchestrationsHistogram","typeNames","histograms","numOfInstancesShown","zoomedIn","resetZoom","innerWidth","height","innerHeight","xType","stackBy","margin","top","tickTotal","tickFormat","formatTimeTick","timeRangeInMilliseconds","typeName","stroke","getColorCodeForInstanceType","drag","enableY","onDragEnd","area","applyZoom","colors","items","counts","orientation","instanceType","hashCode","charCodeAt","m","second","millisecond","SaveAsSvgButton","disabled","fileName","URL","createObjectURL","Blob","download","getStyledSvg","CustomTabTypeEnum","OrchestrationsGanttChart","svgElement","mountClickEventToFunctionNodes","getElementsByClassName","rawHtml","dangerouslySetInnerHTML","__html","Toolbar","flex","navigator","clipboard","writeText","nodes","el","onclick","goto","cursor","OrchestrationsFunctionGraph","RunningStyle","CompletedStyle","FailedStyle","OtherStyle","addEventListener","repositionMetricHints","removeEventListener","functionsLoaded","FormGroup","Checkbox","renderFunctions","renderProxies","renderTotalMetric","renderMetrics","diagramSvg","totalMetric","Chip","metric","allMetricsHintNodes","visibility","onresize","instanceNodes","Array","concat","isHighlightedAttributeName","instanceNode","match","exec","metricsHintNode","setAttribute","instanceNodeRect","getBoundingClientRect","node","opacity","getAttribute","closuredFunctionName","gotoFunctionCode","Orchestrations","scrollingElement","scrollHeight","scrollTop","Histogram","ctrlKey","keyCode","histogramState","ganttChartState","functionGraphState","timeZone","AppBar","position","LinearProgress","Grid","container","item","xs","TextField","InputProps","InputLabelProps","shrink","timeRangeToString","ampm","autoOk","invalidDateMessage","getMoment","setMoment","onBlur","applyTimeFrom","onAccept","onKeyPress","handleKeyPress","FormControl","timeTillEnabled","applyTimeTill","placeholder","InputLabel","htmlFor","Select","filteredColumn","inputProps","filterOperator","filterValue","applyFilterValue","showStatuses","onScroll","rescheduleDelayedRefresh","isStatusChecked","setStatusChecked","autoRefresh","Tabs","ev","Tab","isFunctionGraphAvailable","Gantt","FunctionGraph","event","preventDefault","DurableEntityButtons","renderDialogs","purgeConfirmationOpen","raiseEventDialogOpen","autoFocus","purge","eventName","rows","eventData","raiseEvent","DurableEntityFields","details","runtimeStatusStyle","sm","md","zeroMinWidth","OrchestrationButtons","restartDialogOpen","rewindConfirmationOpen","terminateConfirmationOpen","setCustomStatusDialogOpen","rewind","terminate","newCustomStatus","setCustomStatus","isCustomStatusDirty","restartWithNewInstanceId","restart","DfmViewModeEnum","OrchestrationFields","loadHistory","totalItems","historyTotalCount","itemsShown","Name","FunctionName","SubOrchestrationId","functionNames","events","index","Timestamp","EventType","EventId","renderEventLink","ScheduledTime","Result","Details","OrchestrationDetailsFunctionGraph","DurationStyle","totalInstances","OrchestrationDetails","loadDetails","loadInProgress","tabStates","tabState","selectedTab","tabType","MermaidDiagram","description","saveAsJson","PurgeHistoryDialog","dialogOpen","instancesDeleted","FormLabel","purgeHistory","RuntimeStatusCheckbox","getStatusIncluded","setStatusIncluded","CleanEntityStorageDialog","removeEmptyEntities","releaseOrphanedLocks","clean","numberOfEmptyEntitiesRemoved","numberOfOrphanedLocksRemoved","ConnectionParamsDialog","isReadonly","connectionString","saveConnectionParams","isDirty","StartNewInstanceDialog","startedInstanceId","orchestratorFunctionName","startNewInstance","Main","utils","MomentUtils","Provider","loginState","mainMenuState","orchestrationsState","src","Breadcrumbs","taskHubName","orchestrationDetailsState","Autocomplete","freeSolo","options","isExactMatch","suggestions","typedInstanceId","newValue","renderInput","params","purgeHistoryDialogState","cleanEntityStorageDialogState","connectionParamsDialogState","startNewInstanceDialogState","MainMenuState","_purgeHistoryDialogState","_cleanEntityStorageDialogState","_connectionParamsDialogState","_startNewInstanceDialogState","accountName","version","MermaidDiagramTabState","_loadHistory","buildDiagram","SequenceDiagramTabState","all","getSequenceForOrchestration","sequenceLines","orchestrationName","parentOrchestrationName","isFailed","historyEvents","externalActor","results","maxDurationInMs","j","formatTimestamp","subOrchFailed","subOrchestrationId","subOrchestrationName","DurationInMs","timestamp","FunctionGraphTabState","traversalResult","updateMetricsForInstance","promises","subFuncName","subHistory","GanttDiagramTabState","renderOrchestration","arrayOfArrays","lines","flat","linesWithMetadata","l","injectFunctionNameAttributes","adjustIntervalsSmallerThanOneSecond","RegExp","tagName","taskIndex","oneBasedLineIndex","lineMetadata","activityWidth","activityMetadata","parentInstanceId","widthPercentage","orchIndex","findIndex","orchMatch","orchWidth","newActivityWidth","isParentOrchestration","startedEvent","find","completedEvent","needToAddAxisFormat","orchDuration","longerThanADay","lineName","formatLineName","eventTimestamp","LiquidMarkupTabState","_orchestrationId","RawHtml","_rawHtml","OrchestrationDetailsState","_autoRefreshToken","loadCustomTab","_history","_details","_historyTotalCount","_inProgress","_raiseEventDialogOpen","_setCustomStatusDialogOpen","_restartDialogOpen","_functionMap","requestBody","functionMapPromise","responses","setAutoRefresh","tabStateIndex","orchId","loadAllHistory","fn","templateName","totalCount","FunctionGraphState","PurgeHistoryDialogState","_dialogOpen","_instancesDeleted","_statuses","Set","statuses","has","included","add","delete","CleanEntityStorageDialogState","isOpen","_response","ConnectionParamsDialogState","_oldConnectionString","_oldHubName","_isReadOnly","isReadOnly","alert","StartNewInstanceDialogState","_startedInstanceId","inputObject","TypedLocalStorage","_prefix","apply","VsCodeBackendClient","_vsCodeApi","_handlers","_requests","requestHandler","requestPromise","requestId","random","postMessage","purgeHistoryHandler","cleanEntityStorageHandler","VsCodeTypedLocalStorage","_state","StateFromVsCode","save","MainState","vsCodeApi","acquireVsCodeApi","DfmViewMode","IsFunctionGraphAvailable","setCustomHandlers","_typedInstanceId","reloadSuggestions","_suggestions","OrchestrationIdFromVsCode","body","appState","ReactDOM","ThemeProvider"],"mappings":"6QAAA,IAAIA,EAAM,CACT,WAAY,IACZ,cAAe,KAIhB,SAASC,EAAeC,GACvB,IAAIC,EAAKC,EAAsBF,GAC/B,OAAOG,EAAoBF,GAE5B,SAASC,EAAsBF,GAC9B,IAAIG,EAAoBC,EAAEN,EAAKE,GAAM,CACpC,IAAIK,EAAI,IAAIC,MAAM,uBAAyBN,EAAM,KAEjD,MADAK,EAAEE,KAAO,mBACHF,EAEP,OAAOP,EAAIE,GAEZD,EAAeS,KAAO,WACrB,OAAOC,OAAOD,KAAKV,IAEpBC,EAAeW,QAAUR,EACzBS,EAAOC,QAAUb,EACjBA,EAAeE,GAAK,K,qfCNPY,G,OADZC,YACD,8JAEI,WACI,IAAMC,EAAQC,KAAKC,MAAMF,MAEzB,OACI,2BACI,gBAACG,EAAA,EAAD,CAAQC,MAAOJ,EAAMK,sBAAwB,YAAc,UACvDC,QAAS,SAAAC,GAAG,OAAIP,EAAMQ,kBAAoBD,EAAIE,gBAE9C,gBAACC,EAAA,EAAD,MACA,gBAACC,EAAA,EAAD,CAAKC,MAAO,IACZ,gBAACC,EAAA,EAAD,CAASC,MAAOd,EAAMK,sBAAwB,qDAAuD,IACjG,gBAACU,EAAA,EAAD,CAAYX,MAAOJ,EAAMK,sBAAwB,YAAc,WAC1DL,EAAMK,sBAAwB,YAAcL,EAAMgB,aAK7DhB,EAAMK,uBACJ,gBAACY,EAAA,EAAD,CACIC,SAAUlB,EAAMQ,kBAChBW,aAAW,EACXC,OAAQpB,EAAMQ,kBACda,QAAS,kBAAMrB,EAAMQ,uBAAoBc,IAEzC,gBAACC,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAMwB,WAA/B,iCAIR,gBAACC,EAAA,EAAD,CAAQL,MAAOpB,EAAM0B,YACjB,gBAACC,EAAA,EAAD,KAEM3B,EAAM4B,aAkBA,gCAEJ,gBAACC,EAAA,EAAD,CAAWC,UAAU,kBACjB,gBAAC,IAAD,CAAO1B,MAAM,YAAY2B,SAAS,WAEtC,gBAACC,EAAA,EAAD,CAAmB5B,MAAM,aAAzB,iBAAoDJ,EAAM4B,eAvBrC5B,EAAMiC,oBAOvB,gCAEJ,gBAACC,EAAA,EAAD,6BACA,gBAACC,EAAA,EAAD,CAAML,UAAU,iBACX9B,EAAMiC,oBAAoBlD,KAAI,SAAAqD,GAAO,OAClC,gBAACC,EAAA,EAAD,CAAUC,QAAM,EAACC,IAAKH,GAClB,gBAACI,EAAA,EAAD,CAAMC,KAAMzC,EAAM0C,iBAAmBN,GAAUA,SAbT,gCAElD,gBAACP,EAAA,EAAD,CAAWC,UAAU,kBACjB,gBAACa,EAAA,EAAD,OAEJ,gBAACX,EAAA,EAAD,qCAtC5B,GAA+BY,eAA/B,G,mHCNaC,IAAb,aAaI,aACiD,IAAD,GADjC,gEACwB,UAA/BC,gBAAgBC,YAChB9C,KAAK+C,iBAA2D,WAA5B,QAAZ,EAAAC,oBAAA,eAAcC,QAAQ,eAE9CjD,KAAK+C,kBAAmB,EAjBpC,uCAEI,WAAsB,OAAOF,gBAAgBK,QAFjD,2BAII,WAEI,OAAOlD,KAAK+C,kBANpB,IAQI,SAAoBI,GAAM,IAAD,EACT,QAAZ,EAAAH,oBAAA,SAAcI,QAAQ,aAAcD,EAAM,QAAU,OACpDnD,KAAK+C,iBAAmBI,IAVhC,uBAsBI,SAAiBE,GAEb,OAAKA,GAAMA,EAAEC,WAKRtD,KAAK+C,iBAGNM,EAAEE,QAFFF,EAAEG,MAKCH,GAVIA,IAzBnB,uBAuCI,SAAiBA,GAEb,OAAKA,GAAMA,EAAEC,YAAetD,KAAK+C,iBAK1BU,KAAOJ,EAAEK,aAAY,GAAMC,MAAM,EAAG,IAAM,KAJtCN,IA1CnB,kCAiDI,SAA4BO,GAExB,IAAK5D,KAAK+C,mBAAqBa,GAAaA,EAAUC,OAAS,GAC3D,OAAOD,EAIX,IAAME,EAAWF,EAAUG,YAAY,KACjCC,EAAgBF,GAAY,EAAK,IAAMF,EAAUK,UAAUH,EAAW,EAAGF,EAAUC,OAAS,GAAK,GAEvG,OAAOJ,KAAOG,GAAWM,OAAlB,uBAAkDF,MA3DjE,iDAIKG,MAJL,2HA8DKC,MA9DL,iEAkEaC,GAAiB1B,gBAAgC,IAAIC,IACrD0B,GAAqB,IAAI1B,GC7DzB2B,GADZzE,aACD,gNAGI0E,aAHJ,yDAKI,WAEIxE,KAAKC,MAAMF,MAAM0E,mBAPzB,oBAUI,WAAuB,IAAD,OACZ1E,EAAQC,KAAKC,MAAMF,MAEzB,OAAQ,gCACJ,gBAAC2E,EAAA,EAAD,CAAYvE,MAAM,UACdE,QAAS,SAAAC,GAAG,OAAIP,EAAMQ,kBAAoBD,EAAIE,gBAE9C,gBAAC,IAAD,OAGJ,gBAACQ,EAAA,EAAD,CACIC,SAAUlB,EAAMQ,kBAChBW,aAAW,EACXC,OAAQpB,EAAMQ,kBACda,QAAS,kBAAMrB,EAAMQ,uBAAoBc,IAEzC,gBAACsD,EAAA,EAAD,CAAYC,KAAG,EAACC,MAAO7E,KAAKwE,QAAQM,gBAAgBC,WAAYC,SAAU,SAAC1E,GACvE,EAAKkE,QAAQM,gBAA6D,SAA1CxE,EAAI2E,OAA4BJ,MAChE9E,EAAMQ,uBAAoBc,EAC1B,EAAKpB,MAAMiF,cAEX,gBAACpE,EAAA,EAAD,CAAYe,UAAU,2BAAtB,iBACA,gBAACsD,EAAA,EAAD,CAAkBC,QAAS,gBAACC,EAAA,EAAD,CAAOlF,MAAM,YAAamF,MAAM,MAAMT,MAAO,UACxE,gBAACM,EAAA,EAAD,CAAkBC,QAAS,gBAACC,EAAA,EAAD,CAAOlF,MAAM,YAAamF,MAAM,QAAQT,MAAO,UAG9E,gBAACvD,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAMwF,+BAA/B,yCACA,gBAACjE,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAMyF,2BAA/B,6BACA,gBAAClE,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAM0F,iCAA/B,2BACA,gBAACnE,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAM2F,+BAA/B,oCAvChB,GAA8B/C,aAA9B,EAEWgD,YAActB,GAFzB,S,mKCDauB,I,OAAqB,CAC9B,YACA,YACA,UACA,OACA,gBACA,SACA,YAGSC,GAAkB,CAAC,YAAa,UAAW,SAAU,UAAW,aAAc,WAAY,kBAW1FC,GAAb,iDACIC,gBADJ,OAEIC,UAFJ,OAGIC,cAHJ,OAIIC,mBAJJ,OAKIC,gBALJ,OAMIC,eANJ,OAOIC,WAPJ,OAQIC,kBARJ,OASIC,YATJ,OAUIC,iBAVJ,OAWIC,qBAXJ,OAYIC,cAZJ,OAaIC,sBAbJ,0DAeI,SAAuBC,GACnB,MAA+B,kBAAxBA,EAAST,WAAiCS,EAASX,SAASD,KAAOY,EAASZ,SAhB3F,KAqBaa,GAAmC,CAC5C,aACA,OACA,cACA,kBACA,WACA,gBACA,YACA,QACA,SACA,gB,8DCtDSC,I,OAAb,EAsCKC,KAAOC,MAvCXlH,aACD,8JAEI,WACI,IAAMC,EAAQC,KAAKC,MAAMF,MAEzB,OAEI,gBAACkH,GAAA,EAAD,CACIpF,UAAU,mBACVqF,aAAc,CAAEC,SAAU,MAAOC,WAAY,SAC7CjG,OAAQpB,EAAM4B,aACd0F,iBAAkB,IAClBjG,QAASpB,KAAKsH,aAEd,gBAACC,GAAA,EAAD,CACI1F,UAAU,yBACV2F,QACI,4BACI,gBAAC,KAAD,CAAW3F,UAAU,eACpB9B,EAAM4B,cAGfoF,OAAQ,CACJ,gBAACrC,EAAA,EAAD,CACIpC,IAAI,QACJmF,aAAW,QACXtH,MAAM,UACNE,QAASL,KAAKsH,aAEd,gBAAC,KAAD,aA7B5B,yBAsCI,WAEItH,KAAKC,MAAMF,MAAM4B,aAAe,OAxCxC,GAAkCgB,aAAlC,6H,kBCZa+E,GAAb,kGAMI,SAA4BrE,GACxB,QAASA,GAAKA,EAAEC,WAAaD,EAAEsE,QAAQD,EAAgBE,YAAcvE,EAAEwE,SAASH,EAAgBI,aAPxG,4BAUI,SAA6BC,GAEzB,GAAIC,MAAMD,IAAkBA,EAAe,EACvC,MAAO,GAGX,IAAME,EAAOC,KAAKC,MAAMJ,EAAe,OACnCK,EAAI,EACJC,EAAS,GAETJ,EAAO,IACPI,GAAUJ,EAAKK,QAAQ,GAAK,MAC1BF,EACFL,GAA8B,OAGlC,IAAMQ,EAAQL,KAAKC,MAAMJ,EAAe,MACxC,GAAIQ,EAAQ,EAAG,CAGX,GAFAF,GAAUE,EAAMD,QAAQ,GAAK,MAEvBF,EAAI,EACN,OAAOC,EAGXN,GAA8B,KAGlC,IAAMS,EAAUN,KAAKC,MAAMJ,EAAe,KAC1C,GAAIS,EAAU,EAAG,CAGb,GAFAH,GAAUG,EAAQF,QAAQ,GAAK,MAEzBF,EAAI,EACN,OAAOC,EAGXN,GAA8B,IAGlC,IAAMU,EAAUP,KAAKC,MAAMJ,EAAe,KAC1C,GAAIU,EAAU,EAAG,CAGb,GAFAJ,GAAUI,EAAQH,QAAQ,GAAK,MAEzBF,EAAI,EACN,OAAOC,EAGXN,GAA8B,IAWlC,OARIA,EAAe,IACfM,GAAUN,EAAaO,QAAQ,GAAK,MAGnCD,IACDA,EAAS,OAGNA,MAnEf,KAAaX,GAGME,UAAYnE,KAAO,cAHzBiE,GAIMI,UAAYrE,KAAO,cCH/B,I,0FAAMiF,IAAb,uHAEKtE,MAFL,wEAG2B,MAH3B,GCDauE,IAAb,+JACKvE,MADL,yEAE0B,KAF1B,4CAGKA,MAHL,yEAI2B,KAJ3B,I,UCcawE,IAAb,cAuCI,WAAoBC,EACRC,EAAgEC,GAAuB,yBAD/EF,iBAC8E,KAAtFC,gBAAsF,KAAtBC,WAAsB,4QAkG1FC,oBAA8B,EAlG4D,KAmGjFC,UAAY,GAjGzB,IAAMC,EAAgBlJ,KAAK8I,cAAc7F,QAAQ,WAC3CiG,IACFlJ,KAAKmJ,SAAWD,GAGpB,IAAME,EAAyBpJ,KAAK8I,cAAc7F,QAAQ,oBACpDmG,IACFpJ,KAAKqJ,kBAAoBD,GAG7B,IAAME,EAAsBtJ,KAAK8I,cAAc7F,QAAQ,iBACjDqG,IACFtJ,KAAKuJ,eAAiBD,EAAoBE,MAAM,MAtD5D,+CAQI,WACgC,OAAOxJ,KAAKuJ,iBAThD,0BAWI,WACqD,OAAOvJ,KAAKyJ,kBAZrE,4BAcI,WAC2C,OAAOzJ,KAAKqJ,oBAf3D,mBAiBI,WACwB,OAAOrJ,KAAKmJ,UAlBxC,IAmBI,SAAYhG,GAEJnD,KAAKmJ,WAAahG,GAElBnD,KAAKmJ,SAAWhG,EAChBnD,KAAKqJ,kBAAoB,OAES,SAA3BrJ,KAAKqJ,kBAEZrJ,KAAK0J,eAGL1J,KAAKqJ,kBAAoB,OAG7BrJ,KAAK+I,aAlCb,yBAqCI,WAAsC,OAAO/I,KAAK6I,iBArCtD,wBA0DI,SAAW7C,GACPhG,KAAKuJ,eAAeI,KAAK3D,GACzBhG,KAAK8I,cAAc1F,QAAQ,gBAAiBpD,KAAKuJ,eAAeK,KAAK,QA5D7E,oBA+DI,WACI5J,KAAKuJ,eAAiB,GACtBvJ,KAAK8I,cAAce,WAAW,iBAE9B7J,KAAK+I,aAnEb,0BAsEI,WACI/I,KAAKmJ,SAAW,GAChBnJ,KAAKqJ,kBAAoB,QAxEjC,mBA2EI,WAEIrJ,KAAKyJ,gBAAkB,GACvBzJ,KAAKgJ,oBAAqB,IA9ElC,kBAiFI,SAAKc,EAAsBC,GAA0E,IAAD,OAA/CC,EAA+C,wDAEhG,GAAIA,EAEAhK,KAAKgJ,oBAAqB,MAEvB,CAEH,GAAMhJ,KAAKgJ,mBACP,OAAOiB,QAAQvK,UAInBM,KAAK8I,cAAcoB,SAAS,CACxB,CAAEC,UAAW,UAAWtF,MAAO7E,KAAKmJ,UACpC,CAAEgB,UAAW,mBAAoBtF,MAAO7E,KAAKqJ,qBAKrD,IAAMe,EAAOJ,EAAgB,EAAIhK,KAAKyJ,gBAAgB5F,OAEhDwG,EAAkBrK,KAAKmJ,SAAP,oBAA+BnJ,KAAKmJ,SAApC,YAAgDnJ,KAAKsK,kBAAqB,GAC1FC,EAAuBvK,KAAKuJ,eAAe1F,OAArB,0BAAsD7D,KAAKuJ,eAAeK,KAAK,MAAjD,GAEpDY,EAAG,+BAA2BxK,KAAKiJ,UAAhC,kBAAmDmB,GAAnD,OAA0DN,GAA1D,OAAyEO,GAAzE,OAAyFE,GAElG,OAAOvK,KAAK6I,eAAe4B,KAAK,MAAOD,GAAKE,MAAK,SAAAC,GAE7C,IAAIZ,EAAYa,YAAhB,CAMQ,IAAD,EAFP,GAAIZ,EACA,EAAKP,gBAAkBkB,OAEvB,IAAKlB,iBAAgBE,KAArB,qBAA6BgB,IAG5BA,EAAS9G,SAGV,EAAKmF,oBAAqB,WA3H1C,yDAEK5E,MAFL,wEAG0B,MAH1B,iDAKKA,MALL,yGAQKD,MARL,wHAWKA,MAXL,2HAcKA,MAdL,oHAiBKA,MAjBL,sHAgIKC,MAhIL,wEAiI4D,MAjI5D,kDAkIKA,MAlIL,wEAmIkD,SAnIlD,yCAoIKA,MApIL,wEAqI+B,MArI/B,+CAuIKA,MAvIL,wEAwIuC,MAxIvC,I,mDCVMyG,GAA0DC,eAAD,WAA4BA,eAA5B,KAAkB,IACpEC,GAAaF,GAAcG,QAG3BC,GAAb,WAMI,WAAoBC,EAAuCC,GAAyE,yBAAhHD,kBAA+G,KAAxEC,+BAN/D,0CAEI,WAA0B,OAAO,IAFrC,qCAII,WAA0C,OAAON,GAAc7K,KAAKkL,oBAJxE,kBASI,SAAKE,EAAgBC,EAAaC,GAA2B,IAAD,OAGxD,MAAK,CAAC,MAAO,OAAQ,OAAOC,SAASH,EAAOI,eAIrC,IAAIvB,SAAa,SAACvK,EAAS+L,GAE9B,EAAKN,+BAA+BT,MAAK,SAAAgB,GAErCC,KAAMC,QAAQ,CACVP,IAAKN,GAAa,IAAM,EAAKG,kBAAoBG,EACjDD,SAAQE,OAAMI,YACfhB,MAAK,SAAAmB,GAAOnM,EAAQmM,EAAEP,QAAUG,SAVhCxB,QAAQwB,OAAO,IAAInM,MAAJ,iBAAoB8L,EAApB,wBAblC,KCAaU,GAAwB,mBAGxBC,IAAb,qDAyDI,aAAe,IAAD,6BACV,eADU,gQA8ENC,aA9EM,EAIVL,KAAMM,SAASC,aAAe,EAE9B,EAAKC,QANK,EAzDlB,4CAEI,WAC4B,OAAOnM,KAAKoM,cAH5C,iCAKI,WACuC,OAAQpM,KAAKqM,YANxD,oBAQI,WACyB,OAAOrM,KAAKqM,YATzC,uBAWI,WAC4B,OAAOrM,KAAKsM,eAZ5C,+BAcI,WACsC,OAAOtM,KAAKuM,uBAftD,4BAqBI,WAEI,IAAIlE,EAASmE,OAAOC,SAASC,SAEvBC,EAAMtE,EAAOtE,YAAY+H,IAS/B,OARIa,GAAO,IACPtE,EAASA,EAAOpE,UAAU,EAAG0I,IAG5BtE,EAAOuE,SAAS,OACjBvE,GAAU,KAGPA,IAlCf,mBAsCI,WAEI,IAAMlG,EAAUnC,KAAK6M,oBACrB,GAAM1K,EAAS,CAEX,IAAMwK,EAAMH,OAAOC,SAASjK,KAAKgJ,cAAczH,YAAY,IAAM5B,EAAQqJ,eACzE,GAAImB,GAAO,EACP,OAAOH,OAAOC,SAASjK,KAAKyB,UAAU,EAAG0I,GAIjD,OAAOH,OAAOC,SAASK,QAEfN,OAAOC,SAASC,SAASE,SAAS,KAC9BJ,OAAOC,SAASC,SAASK,OAAO,EAAGP,OAAOC,SAASC,SAAS7I,OAAS,GACrE2I,OAAOC,SAASC,YArDpC,mBAkEI,WAAS,IAAD,OACElC,EAAG,UAAMO,GAAN,oBACTY,KAAMqB,IAAIxC,GAAKE,MAAK,SAAAC,GAAQ,OAAI,EAAKsC,wBAAwBtC,EAASW,SAAO,SAAA4B,GACzE,EAAKvL,aAAL,UAAuBuL,EAAI1F,QAA3B,YAAyC0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,SArExF,oBAyEI,WACItL,KAAKO,uBAAoBc,EAEpBrB,KAAKgM,QAMNhM,KAAKgM,QAAQzK,SAJbiL,OAAOC,SAASU,QAAQ,mBA9EpC,yCAsFI,WAA+B,IAAD,OAG1B,OAAKnN,KAAKgM,QAIH,IAAI/B,SAAmC,SAACvK,EAAS+L,GAEpD,IAAM2B,EAA4C,CAC9CC,OAAQ,CAAC,EAAKrB,QAAQsB,0BAA0BC,KAAKC,WAGzD,EAAKxB,QAAQyB,mBAAmBL,GAC3B1C,MAAK,SAACgD,GAEH,IAAIC,EAAcD,EAAaC,YAC1BA,IAIDC,QAAQC,IAAI,iEACZF,EAAcD,EAAaI,QAAQC,YAGvCrO,EAAQ,CAAEsO,cAAc,UAAD,OAAYL,QAEpC,SAAAT,GAICU,QAAQC,IAAR,4CAAiDX,EAAjD,4CACA,EAAKlB,QAAQiC,qBAAqBb,SA5BnC,IAAInD,SAAmB,SAACvK,EAAS+L,GAAV,OAAqB/L,OAAQ2B,QA1FvE,qCAyII,SAAgC6M,GAE5B,IAAKA,EAAOV,SAkBR,OAdAxN,KAAKqM,UAAY6B,EAAOnN,SAGxB4K,KAAMwC,aAAaxD,SAASyD,KAAI,SAAAzD,GAAQ,OAAIA,KAAU,SAAAuC,GAOlD,MAJoB,kBAAhBA,EAAI1F,SACJgF,OAAOC,SAAS4B,QAAO,GAGpBpE,QAAQwB,OAAOyB,WAG1BlN,KAAKsO,uCAKTtO,KAAKgM,QAAU,IAAIuC,KAA0B,CACzChB,KAAM,CACFC,SAAUU,EAAOV,SACjBgB,UAAWN,EAAOM,UAClBC,YAAazO,KAAK0O,WAK1B1O,KAAKgM,QAAQ2C,wBAAuB,eAAW,SAACC,EAAyBC,GAErEjB,QAAQC,IAAR,iDAAsDe,EAAQ5I,KAA9D,sBAAgF4I,EAAQpH,QAAxF,wBAA+GoH,EAAQE,UAAvH,2BAAmJF,EAAQjN,aAA3J,2BAA0LkN,OAG9L,IAAME,EAAU/O,KAAKgM,QAAQgD,aAExBD,GAMD/O,KAAKqM,UAAY0C,EAAQhO,SACzBf,KAAKsO,wCALLtO,KAAKgM,QAAQiD,kBAnLzB,kDA4LI,WAAsD,IAAD,OAE3C9M,EAAUnC,KAAK6M,oBACrB,GAAM1K,EAIF,OAFAnC,KAAKsM,aAAenK,OACpBnC,KAAKoM,aAAc,GAKvBpM,KAAKkP,8BAA8BxE,MAAK,SAAAgB,GAEpC,IAAMlB,EAAG,UAAMO,GAAN,mBACTY,KAAMqB,IAAIxC,EAAK,CAAEkB,YAAWhB,MAAK,SAAAC,GAE7B,IAAMwE,EAAqBxE,EAASW,KAEZ,IAApB6D,EAAStL,OAGT2I,OAAOC,SAASC,SAAW,EAAKjK,iBAAmB0M,EAAS,GAI5D,EAAK5C,qBAAuB4C,KAGjC,SAAAjC,GACC,EAAKvL,aAAL,UAAuBuL,EAAI1F,QAA3B,YAAyC0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,YAzN5F,+BA+NI,WAEI,IAAM7I,EAAmBzC,KAAKyC,iBAG9B,GAAIA,EAAiB+I,cAAcoB,SAA/B,WAA4C9B,eAAeU,cAA3D,MACA,OAAO,KAGX,IAAM4D,EAAY3M,EAAiB+G,MAAM,KAAK6F,QAAO,SAAAC,GAAC,QAAMA,KAC5D,OAAIF,EAAUvL,OAAS,EACZ,KAKJuL,EAAUA,EAAUvL,OAAS,OA/O5C,GAAgC6E,IAAhC,wCAEKvE,MAFL,4HAKKA,MALL,0HAQKA,MARL,gHAWKA,MAXL,2HAcKA,MAdL,oIAiBKC,MAjBL,0GA2HKA,MA3HL,yEA4HmC,KA5HnC,0CA8HKA,MA9HL,2GAiIKA,MAjIL,mHAoIKA,MApIL,kECRsBmL,IAAtB,4LAOI,WAEQA,EAAwBC,sBAI5BC,KAAQC,WAAW,CACfC,aAAa,EAEbC,SAAU,CACNC,WAAY,EACZC,UAAW,EACXC,cAAe,GAGnBC,UAAW,CACPC,MAAO,QACPC,aAAa,EACbC,YAAY,KAIpBZ,EAAwBC,qBAAsB,KA7BtD,yBAgCI,SAAsBvQ,GAElB,OAAOA,EAAGkO,QAAQ,SAAU,OAlCpC,4BAqCI,SAAyBpF,GAErB,IAAMM,EAASX,GAAgB0I,eAAerI,GAC9C,OAAQM,EAAD,WAAmBA,EAAnB,KAAU,KAxCzB,qCA2CI,SAAkCN,GAE9B,OAAOG,KAAKmI,KAAKtI,EAAe,KAAMO,QAAQ,GAAK,QA7C3D,QAgDmBkH,qBAAsB,EAhDzC,mDAEKpL,MAFL,0GAIKA,MAJL,kECQakM,IAAb,qDAQI,WAAoBzH,GAAiC,IAAD,8BAChD,gBADgBA,iBAAgC,EAkE5C0H,WAA2C,GAlEC,EARxD,yCAEI,WACwB,OAAOvQ,KAAKwQ,cAHxC,uBAKI,WAC4B,OAAOxQ,KAAKyQ,eAN5C,mBAYI,WAEIzQ,KAAKyQ,aAAe,GACpBzQ,KAAKwQ,YAAc,GACnBxQ,KAAKuQ,WAAa,KAhB1B,kBAmBI,SAAKzG,EAAsBC,EAA0BC,GAAwC,IAAD,OAIxF,OAFAhK,KAAK0Q,wBAEE,IAAIzG,SAAc,SAACvK,EAAS+L,GAE/B,IAAMjB,EAAG,2DAAuDV,GAEhE,EAAKjB,eAAe4B,KAAK,MAAOD,GAAKE,MAAK,SAACiG,GAIvC,GAFA,EAAKJ,WAAaI,EAEd5G,EAAYa,YACZlL,QADJ,CAKA,EAAK+Q,aAAe,wCACME,EAAU9M,OADhB,wBAEhB,oCACA,EAAK+M,cAAcD,GAGvB,EAAKH,YAAc,GAEnB,IAEIf,KAAQoB,OAAO,eAAgB,EAAKJ,cAAc,SAACK,GAC/C,EAAKN,YAAcM,EACnBpR,OAGN,MAAOwN,GACLzB,EAAOyB,OAGZzB,QAvDf,kBA4DI,SAAKsF,GAED,GAAMA,GAAyBA,GAAyB/Q,KAAKuQ,WAAW1M,OAAQ,CAE5E,IAAMkC,EAAa/F,KAAKuQ,WAAWQ,EAAwB,GAAGhL,WAE1D/F,KAAK6I,eAAemI,SACpBhR,KAAK6I,eAAe4B,KAAK,kBAAmB1E,GAE5CyG,OAAOrL,KAAP,UAAenB,KAAK6I,eAAeoI,2BAAnC,OAA+DnF,IAA/D,OAA0F/F,OArE1G,2BA4EI,SAAsB4K,GAElB,IAFmE,EAE/DtI,EAAiB,GAEjB6I,EAAkB,GAClBC,EAAY,EALmD,eAM5CR,GAN4C,IAMnE,2BAAkC,CAAC,IAAxB/J,EAAuB,QAE1BwK,EAAW,GAGTC,EAAcvL,GAA2BwL,gBAAgB1K,GAC3DyK,IAAgBH,IAEhBE,EAAQ,oBAAgBD,EAAhB,aAA8BnR,KAAKuR,YAAYF,GAA/C,OACRH,EAAkBG,GAGtB,IAAMtL,EAAqC,kBAAxBa,EAAST,WAAiCS,EAASX,SAAS3D,IAAMsE,EAASb,WACxFgC,EAAe,IAAIyJ,KAAK5K,EAASH,iBAAiBgL,UAAY,IAAID,KAAK5K,EAASJ,aAAaiL,UAInGpJ,GAFA+I,GAAQ,UAAOpR,KAAKuR,YAAYxL,GAAxB,YAAuC/F,KAAKoQ,eAAerI,GAA3D,qBAAqF/H,KAAK0R,eAAe9K,EAASJ,aAAlH,aAAmIxG,KAAK2R,wBAAwB5J,GAAhK,QArBuD,8BA0BnE,OAAOM,IAtGf,4BAyGI,SAAuBuJ,GAEnB,OAAKtN,GAAmBQ,gBAIjBrB,KAAOmO,GAAmB1N,OAAO,uBAH7B0N,EAAkB7E,OAAO,EAAG,QA5G/C,GAAiDwC,IAAjD,qCAEKpL,MAFL,+GAKKA,MALL,8ECAa0N,IAAb,cAiBI,WAAoBhJ,EACRiJ,GACX,yBAFmBjJ,iBAEpB,KADYiJ,eACZ,6CA0EQC,QAA2C,GA1EnD,4FAkFQC,sBAAsC,KAlF9C,KAmFQC,eAAgB,EAnFxB,KAoFQC,yBAA2B,EApFnC,KAsFiBC,gBAAkB,IAtFnC,KAuFiBlJ,UAAY,IA1GjC,0CAEI,WACiB,OAAOjJ,KAAKoS,YAHjC,sBAKI,WACmB,OAAOpS,KAAKqS,cANnC,+BAQI,WAC4B,OAAOrS,KAAKsS,uBAT5C,kBAWI,WAAe,OAAOtS,KAAK+R,UAX/B,mCAaI,WACI,OAAO/R,KAAKkS,2BAdpB,mBAsBI,cAtBJ,kBAyBI,SAAKpI,EAAsBC,EAA0BC,GAE5ChK,KAAKiS,eAAkBjS,KAAKoS,YAE7BpS,KAAKgS,sBAAwB,CACzBO,SAAUvS,KAAK8R,aAAaS,SAC5BC,SAAUxS,KAAK8R,aAAaU,SAC5BC,UAAWzS,KAAK8R,aAAaW,YAIrCzS,KAAKsS,qBAAuB,EAC5BtS,KAAKqS,YAAc,GACnBrS,KAAK+R,QAAU,GAEf,IAAMW,EAAY1S,KAAK8R,aAAaS,SAASI,UACzCC,EAAe1K,KAAKmI,MAAMrQ,KAAK8R,aAAaU,SAASG,UAAYD,GAAa1S,KAAKmS,iBAQvF,OAPIS,GAAgB,IAChBA,EAAe,GAInB5S,KAAKkS,yBAA2BlS,KAAK8R,aAAaU,SAASG,UAAY3S,KAAK8R,aAAaS,SAASI,UAE3F3S,KAAK6S,cAAc/I,EAAc4I,EAAWE,EAAc,EAAG7I,KAjD5E,uBAoDI,SAAU+I,EAAYC,GAElB/S,KAAKsS,qBAAuB,EAE5BtS,KAAK8R,aAAakB,SAGlB,IAAMC,EAA2C,IAApC/K,KAAKC,MAAM2K,EAAKrB,UAAY,KACnCyB,EAA2C,IAApChL,KAAKmI,KAAK0C,EAAMtB,UAAY,KAEzCzR,KAAK8R,aAAaS,SAAW9O,KAAOwP,GACpCjT,KAAK8R,aAAaU,SAAW/O,KAAOyP,GAEpClT,KAAKiS,eAAgB,EACrB,IACIjS,KAAK8R,aAAaqB,uBADtB,QAGInT,KAAKiS,eAAgB,EAGzBjS,KAAKoS,WAAY,IAxEzB,uBA2EI,WAESpS,KAAKoS,WAAcpS,KAAKgS,wBAI7BhS,KAAKoS,WAAY,EAEjBpS,KAAK8R,aAAakB,SAElBhT,KAAK8R,aAAaS,SAAWvS,KAAKgS,sBAAsBO,SACxDvS,KAAK8R,aAAaU,SAAWxS,KAAKgS,sBAAsBQ,SACxDxS,KAAK8R,aAAaW,UAAYzS,KAAKgS,sBAAsBS,aAvFjE,2BA4GI,SAAsB3I,EAAsB4I,EAAmBE,EAAsBQ,EAAoBrJ,GAA0C,IAAD,OAExIS,EAAG,+BAA2BxK,KAAKiJ,UAAhC,kBAAmDjJ,KAAKsS,sBAAxD,OAA+ExI,GAExF,OAAO9J,KAAK6I,eAAe4B,KAAK,MAAOD,GAAKE,MAAK,SAACiG,GAE9C,GAAI5G,EAAYa,YACZ,OAAOX,QAAQvK,UAHuE,qBAMrEiR,GANqE,IAM1F,2BAAgC,CAAC,IAAxB/J,EAAuB,QAEtByM,EAAmBvN,GAA2BwL,gBAAgB1K,GAEpE,IAAK,EAAKyL,YAAYgB,GAAmB,CAGrC,IADA,IAAMC,EAAiB,GACdC,EAAI,EAAGA,EAAI,EAAKpB,gBAAiBoB,IACtCD,EAAeC,GAAK,CAAEC,GAAId,EAAYa,EAAIX,EAAca,EAAGf,GAAaa,EAAI,GAAKX,EAAcc,EAAG,GAEtG,EAAKrB,YAAYgB,GAAoBC,EAGzC,IAAMK,EAAmBzL,KAAKC,OAAO,IAAIqJ,KAAK5K,EAASJ,aAAaiL,UAAYiB,GAAaE,GACzFe,EAAmB,GAAKA,GAAoB,EAAKxB,kBAIrD,EAAKE,YAAYgB,GAAkBM,GAAkBD,GAAK,EAErD,EAAK3B,QAAQsB,GAGd,EAAKtB,QAAQsB,IAAqB,EAFlC,EAAKtB,QAAQsB,GAAoB,IA3BiD,8BAmC1F,OAFA,EAAKf,sBAAwB3B,EAAU9M,OAEnC8M,EAAU9M,SAAW,EAAKoF,UAEnB,EAAK4J,cAAc/I,EAAc4I,EAAWE,EAAcQ,EAAa,EAAGrJ,QAFrF,SAnJZ,2CAEK5F,MAFL,+GAKKA,MALL,0HAQKA,MARL,8HA0FKC,MA1FL,wEA2FsE,MA3FtE,qDA+FKA,MA/FL,yEAgG2C,KAhG3C,0CAkGKA,MAlGL,yEAmGwB,KAnGxB,ICGawP,IAAb,qDAaI,WAAsB/K,GAAiC,IAAD,8BAClD,gBADkBA,iBAAgC,+JAb1D,6CAEI,WAC4B,OAAO7I,KAAKyQ,eAH5C,sBAKI,WAC2B,OAAOzQ,KAAKwQ,cAN3C,2BAQI,WACiC,QAASxQ,KAAK6T,mBATnD,yBAWI,WAAsC,OAAO7T,KAAK6I,iBAXtD,8BAiBI,SAAiBiL,GAEb,GAAI9T,KAAK+T,cAAc/C,SAEnBhR,KAAK+T,cAActJ,KAAK,mBAAoBqJ,GAAcpJ,MAAK,eAAW,SAAAwC,GACtEU,QAAQC,IAAR,wCAA6CX,EAAI1F,iBAGlD,CAEH,IAAIwM,EAAkB,MAIlBA,EAFAF,EAAaG,WAAW,UAENjU,KAAK6T,iBAAiBK,QAAQJ,EAAa/G,OAAO,IAIlD/M,KAAK6T,iBAAiBM,UAAUL,KAG3BE,EAAgBI,UACvC5H,OAAOrL,KAAK6S,EAAgBI,aAvC5C,wBA4CI,WAEIpU,KAAK+T,cAActJ,KAAK,0BAA2B,IAAIC,MAAK,eAAW,SAAAwC,GACnEU,QAAQC,IAAR,wCAA6CX,EAAI1F,eA/C7D,wBA0DI,SAAqBsJ,GAEjB,IAAMuD,EAAkBC,SAASC,eA/DP,uBAgE1B,OAAKF,EAQLvD,GAHAA,EAAMA,EAAI3D,QAAJ,gCAAsCkH,EAAgBG,UAAtD,sBAGIrH,QAAQ,qHAAZ,0DAPK2D,MA9DnB,GAA4CvB,IAA5C,yCAEKpL,MAFL,kHAKKA,MALL,sHAQKA,MARL,+HAmDKC,MAnDL,yEAoD0C,KApD1C,+CAqDKA,MArDL,yEAsDwC,KAtDxC,iDAuDKA,MAvDL,kE,UCdMqQ,GAAQ,OAEd,SAASC,GAAsBC,GAAuB,IAAD,cAEjD,OAAQA,EAAQC,MACZ,IAAK,cACD,MAAM,GAAN,OAAgC,cAAtBD,EAAQE,UAA4B,WAAa,WAA3D,gBAA8EF,EAAQG,QAAe,KAAOH,EAAQG,QAAQlL,KAAK,KAAO,IAAxC,IAAhG,OAA+I+K,EAAQI,MAAa,IAAMJ,EAAQI,MAAnB,IACnK,IAAK,cACD,MAAM,GAAN,OAAUN,GAAV,0BAAuBE,EAAQK,YAA/B,QAAuC,IAC3C,IAAK,kBACD,MAAM,GAAN,OAAUP,GAAV,8BAA2BE,EAAQM,oBAAnC,QAAmD,GAAnD,sBAAyDN,EAAQO,sBAAjE,QAAmF,IACvF,IAAK,kBACD,MAAM,GAAN,OAAUT,GAAV,8BAA2BE,EAAQQ,oBAAnC,QAAmD,IACvD,IAAK,oBACD,MAAM,GAAN,OAAUV,GAAV,sBAA8BE,EAAQS,UAAwCT,EAAQS,UAAzD,UAAsBT,EAAQU,iBAA9B,QAA2C,IAAxE,OAAmGV,EAAQW,iBAAwB,IAAMX,EAAQW,iBAAnB,IAClI,IAAK,eACD,MAAM,GAAN,OAAUb,GAAV,2BAAwBE,EAAQS,iBAAhC,QAA6C,IACjD,IAAK,eACD,MAAM,GAAN,OAAUX,GAAV,2BAAwBE,EAAQY,gBAAhC,QAA4C,IAChD,QACI,MAAM,GAAN,OAAUd,IAAV,OAAkBE,EAAQC,OAItC,SAASY,GAAeb,GAAuB,IAAD,cAE1C,OAAQA,EAAQC,MACZ,IAAK,QACD,MAAM,GAAN,OAAUH,GAAV,2BAAwBE,EAAQc,iBAAhC,QAA6C,IACjD,IAAK,OACD,MAAM,GAAN,OAAUhB,GAAV,0BAAuBE,EAAQK,YAA/B,QAAuC,IAC3C,IAAK,WACD,MAAM,GAAN,OAAUP,GAAV,8BAA2BE,EAAQM,oBAAnC,QAAmD,GAAnD,sBAAyDN,EAAQO,sBAAjE,QAAmF,IACvF,IAAK,WACD,MAAM,GAAN,OAAUT,GAAV,8BAA2BE,EAAQQ,oBAAnC,QAAmD,IACvD,IAAK,aACD,MAAM,GAAN,OAAUV,GAAV,sBAA8BE,EAAQS,UAAwCT,EAAQS,UAAzD,UAAsBT,EAAQU,iBAA9B,QAA2C,IAAxE,OAAmGV,EAAQW,iBAAwB,IAAMX,EAAQW,iBAAnB,IAClI,IAAK,QACD,MAAM,GAAN,OAAUb,GAAV,2BAAwBE,EAAQS,iBAAhC,QAA6C,IACjD,QACI,MAAM,GAAN,OAAUX,IAAV,OAAkBE,EAAQC,OAU/B,SAASc,GAAyBC,EAA4BC,GAA+D,IAAvCC,EAAsC,uDAAZ,GAE/GtW,EAAO,GAEX,IAAKsW,EAASC,qBAAsB,CAEhC,IAAM3B,EAAY,GAGlB,IAAK,IAAMnO,KAAQ2P,EAAc,CAC7B,IAD6B,EACvBI,EAAOJ,EAAa3P,GAEtBgQ,OAAiB3U,EAAW4U,EAAgB,GAAIC,EAAiB,GAAIC,EAAgB,GACrFC,EAAQ,UAAMpQ,EAAN,cAAgByO,IAAhB,OAAwBzO,EAAxB,kBAJiB,eAMP+P,EAAKM,UANE,IAM7B,2BAAqC,CAAC,IAA3B1B,EAA0B,QAEZ,yBAAjBA,EAAQC,KACRwB,EAAQ,UAAMpQ,EAAN,cAAgByO,IAAhB,OAAwBzO,EAAxB,sBACgB,oBAAjB2O,EAAQC,KACfwB,EAAQ,UAAMpQ,EAAN,cAAgByO,IAAhB,OAAwBzO,EAAxB,kBACgB,kBAAjB2O,EAAQC,OACfwB,EAAQ,UAAMpQ,EAAN,cAAgByO,IAAhB,OAAwBzO,EAAxB,iBAGR2O,EAAQC,KAAKhI,SAAS,WACtBoJ,EAAiBrB,EACY,OAAtBA,EAAQ2B,UACfL,EAActM,KAAKgL,GACU,QAAtBA,EAAQ2B,UACfJ,EAAevM,KAAKgL,GAEpBwB,EAAcxM,KAAKgL,IAvBE,8BA2B7BR,EAAUxK,KAAV,cAAiB3D,OAAMoQ,WAAUJ,iBAAgBC,gBAAeC,iBAAgBC,iBAAkBJ,IAItG,IAAMQ,EAAkB,SAACC,GAAO,IAAD,EAEvBC,IAAS,UAACD,EAAEE,kBAAH,aAAC,EAAc7S,SAAW2S,EAAER,gBAAmBQ,EAAER,eAAepB,KAAa4B,EAAER,eAAepB,KAAtB,GAErF,OADA6B,GAAQ,IAAMD,EAAExQ,MAGpBmO,EAAUwC,MAAK,SAACC,EAAIC,GAEhB,IAAIC,EAAKP,EAAgBK,GACrBG,EAAKR,EAAgBM,GAEzB,OAAQC,EAAKC,EAAM,EAAMA,EAAKD,GAAO,EAAI,KAI7C,cAAmB3C,EAAnB,eAA8B,CAAC,IAAD,IAAnB4B,EAAI,KAMX,GAJAxW,GAAI,UAAOwW,EAAKK,SAAZ,MAEJ7W,GAAI,gBAAawW,EAAK/P,KAAlB,oCAEC,UAAC+P,EAAKW,kBAAN,aAAC,EAAiB7S,OAAQ,CAAC,IAAD,iBAEJkS,EAAKW,YAFD,IAE3B,2BAAwC,CAAC,IAA9BM,EAA6B,QACpCzX,GAAI,UAAOyX,EAAP,oBAAwBjB,EAAK/P,KAA7B,OAHmB,oCAMlB+P,EAAKC,iBAEdzW,GAAI,UAAOwW,EAAK/P,KAAZ,YAAoB+P,EAAKC,eAAepB,KAAxC,aAAiDF,GAAsBqB,EAAKC,gBAA5E,gBAAmGD,EAAKC,eAAepB,KAAvH,mBAAmImB,EAAK/P,KAAxI,OAGR,IAAK,IAAIuN,EAAI,EAAGA,EAAIwC,EAAKE,cAAcpS,OAAQ0P,IAAK,CAChD,IAAM0D,EAAelB,EAAKE,cAAc1C,GACxChU,GAAI,UAAOwW,EAAK/P,KAAZ,YAAoBuN,EAApB,YAAyB0D,EAAarC,KAAtC,cAAgDY,GAAeyB,GAA/D,iBAAqFA,EAAarC,KAAlG,iBAA+GmB,EAAK/P,KAApH,MAGR,IAASuN,EAAI,EAAGA,EAAIwC,EAAKG,eAAerS,OAAQ0P,IAAK,CACjD,IAAM2D,EAAgBnB,EAAKG,eAAe3C,GAC1ChU,GAAI,UAAOwW,EAAK/P,KAAZ,iBAAyB+P,EAAK/P,KAA9B,YAAsCuN,EAAtC,YAA2C2D,EAActC,KAAzD,cAAmEY,GAAe0B,GAAlF,iBAAyGA,EAActC,KAAvH,MAGR,IAASrB,EAAI,EAAGA,EAAIwC,EAAKI,cAActS,OAAQ0P,IAAK,CAChD,IAAM4D,EAAepB,EAAKI,cAAc5C,GACxChU,GAAI,UAAOwW,EAAK/P,KAAZ,gBAAwB+P,EAAK/P,KAA7B,YAAqCuN,EAArC,YAA0C4D,EAAavC,KAAvD,cAAiEY,GAAe2B,GAAhF,iBAAsGA,EAAavC,KAAnH,MAGR,GAAK,UAACmB,EAAKqB,qBAAN,aAAC,EAAoBvT,OAAQ,CAAC,IAAD,iBAEJkS,EAAKqB,eAFD,IAE9B,2BAA8C,CAAC,IAApCC,EAAmC,QAC1C9X,GAAI,UAAO8X,EAAYrR,KAAnB,uBAAsCqR,EAAYC,WAAlD,qBAAsEvB,EAAK/P,KAA3E,OAHsB,+BAO5B+P,EAAKwB,mBAEPhY,GAAI,UAAOwW,EAAK/P,KAAZ,wCAA6C+P,EAAK/P,KAAlD,QAMhB,IAAK6P,EAAS2B,oBAAuB/X,OAAOD,KAAKoW,GAAY/R,OAAS,EAAI,CAEtE,IAAM4T,EAAkB,UAEpBC,EAAS,GACTC,GAAuB,EAE3B,IAAK,IAAM3R,KAAQ4P,EAAY,CAC3B,IAAMgC,EAAQhC,EAAW5P,GACnB6R,EAAoB7R,EAAKmH,QAAQ,KAAM,IAE7CwK,EAAuBC,EAAME,4BAE7BJ,EAAY,GACNE,EAAMG,iBAEFH,EAAMG,eAAejD,SAAa8C,EAAMG,eAAejD,QAAQjR,SACjE6T,IAAgBA,EAAY,IAAM,IAArB,WAA+BE,EAAMG,eAAejD,QAAQlL,KAAK,KAAjE,MAGXgO,EAAMG,eAAehD,QACvB2C,IAAgBA,EAAY,IAAM,IAAME,EAAMG,eAAehD,QAGhE2C,IACDA,EAAY1R,GAGhB,IAAIgS,EAAQ,gBAAYH,GAKxB,GAHAtY,GAAI,2BAAwByG,EAAxB,iBAAqCgS,EAArC,cAAmDvD,IAAnD,OAA2DiD,EAA3D,iBACJnY,GAAI,gBAAayY,EAAb,iBAA8BP,EAA9B,MAEEG,EAAMK,WAAY,CAEpBP,EAAYE,EAAMK,WAAW9K,QAAQ,cAAzB,KAEZ,IAAM+K,EAAY,gBAAYL,EAAZ,eAElBtY,GAAI,UAAOyY,EAAP,YAAmBG,GAA6BP,EAAMQ,kBAAtD,YAA2EF,EAA3E,aAA4FzD,IAA5F,OAAoGiD,EAApG,eACJnY,GAAI,gBAAa2Y,EAAb,iBAAkCT,EAAlC,MAEJO,EAAWE,EAGf,IAAMA,EAAY,gBAAYL,EAAZ,aAElBtY,GAAI,UAAOyY,EAAP,YAAmBK,GAA8BT,EAAMU,mBAAvD,YAA6EJ,EAA7E,cAA+FzD,GAA/F,iBACJlV,GAAI,gBAAa2Y,EAAb,iBAAkCT,EAAlC,MAGRC,EAAS,eACT,IAAIa,EAAYd,EACZE,IACAD,GAAS,qCACTa,EAAS,WAGbhZ,GAAI,wBAAqBkV,IAArB,OAA6BiD,EAA7B,QACJnY,GAAI,kCAA+BgZ,EAA/B,MAGR,OAAOhZ,EAGX,I,MAAMiZ,GAAoB,IAE1B,SAASL,GAA6BC,GAElC,IAAKA,EACD,MAAM,SAGV,IAAIK,EAAYC,KAAKC,UAAUP,GAC1BjL,QAAQ,KADG,KAEXA,QAAQ,qBAFG,KAQhB,OAJIsL,EAAU5U,OAAS2U,KACnBC,EAAYA,EAAU1L,OAAO,EAAGyL,IAAqB,OAGnD,OAAN,OAAcC,GAAd,OAA0BhE,GAA1B,YAGJ,SAAS4D,GAA8BC,GAEnC,IAAKA,EACD,MAAM,SAGJA,EAAkB,mBACpBA,EAAkB,iBAAmB,OAGzC,IAAIG,EAAYC,KAAKC,UAAUL,GAC1BnL,QAAQ,KADG,KAEXA,QAAQ,cAFG,KAQhB,OAJIsL,EAAU5U,OAAS2U,KACnBC,EAAYA,EAAU1L,OAAO,EAAGyL,IAAqB,OAGnD,OAAN,OAAcC,GAAd,OAA0BhE,GAA1B,YCvPG,I,oCCMKmE,GASAC,GAOAC,GDtBCC,GAAb,sCACIC,UAAoB,EADxB,KAEIC,QAAkB,EAFtB,KAGIC,OAAiB,EAHrB,KAIIC,MAAgB,EAJpB,KAKIzS,SAAmB,GAMV0S,IAAb,+MAyBaC,iBAAmB,oEAzBhC,+CA8DY/G,qBAA+B,EA9D3C,EA+DqBrJ,UAAY,IA/DjC,2CAEI,WAC4B,OAAOjJ,KAAKsZ,WAH5C,sBAKI,WAC2B,OAAOtZ,KAAKwQ,cAN3C,uBAQI,WAC4B,OAAOxQ,KAAKyQ,eAT5C,2BAWI,WACiC,OAAOzQ,KAAKuZ,kBAZjD,IAaI,SAAoBpW,GAChBnD,KAAKuZ,iBAAmBpW,EACxBnD,KAAK6Q,WAfb,yBAkBI,WAC+B,OAAO7Q,KAAKwZ,gBAnB/C,IAoBI,SAAkBrW,GACdnD,KAAKwZ,eAAiBrW,EACtBnD,KAAK6Q,WAtBb,mBA2BI,WAEI7Q,KAAKyQ,aAAe,GACpBzQ,KAAKwQ,YAAc,GACnBxQ,KAAK6T,iBAAmB,KACxB7T,KAAKsZ,SAAW,GAChBtZ,KAAKsS,qBAAuB,IAjCpC,kBAoCI,SAAKxI,EAAsBC,EAA0BC,GAAwC,IAAD,OAExFhK,KAAK0Q,wBAEL1Q,KAAKsS,qBAAuB,EAE5B,IAAMmH,EAAiBzP,EAA4D,GAA5C0O,KAAKgB,MAAMhB,KAAKC,UAAU3Y,KAAKsZ,WAEtE,OAAOtZ,KAAK6I,eAAe4B,KAAK,MAAO,iBAAiBC,MAAK,SAAAC,GAIzD,OAFA,EAAKkJ,iBAAmBlJ,EAEjB,EAAKkG,SAASnG,MAAK,WAEtB,OAAO,EAAKmI,cAAc/I,EAAc,EAAG2P,EAAezP,EAAeD,GAAaW,MAAK,SAAAiP,GAGvF,EAAKL,SAAWK,aArDpC,2BAiEI,SAAsB7P,EAAsBsJ,EAAoBuG,EAAqB3P,EAAwBD,GAAgD,IAAD,OAElJS,EAAG,+BAA2BxK,KAAKiJ,UAAhC,kBAAmDjJ,KAAKsS,sBAAxD,OAA+ExI,GAExF,OAAO9J,KAAK6I,eAAe4B,KAAK,MAAOD,GAAKE,MAAK,SAACiG,GAE9C,GAAI5G,EAAYa,YACZ,OAAOX,QAAQvK,QAAQia,GAKtBA,EAAQ,EAAKN,oBACdM,EAAQ,EAAKN,kBAAoB,IAAIN,IATiD,qBAYrEpI,GAZqE,IAY1F,2BAAgC,CAAC,IAAxB/J,EAAuB,QAEtBgT,EAAW9T,GAA2BwL,gBAAgB1K,GAM5D,OAJK+S,EAAQC,KACTD,EAAQC,GAAY,IAAIb,IAGpBnS,EAASV,eACb,IAAK,YACDyT,EAAQC,GAAUZ,YAClBW,EAAQ,EAAKN,kBAAkBL,YAC/B,MACJ,IAAK,UACL,IAAK,UACL,IAAK,iBACDW,EAAQC,GAAUX,UAClBU,EAAQ,EAAKN,kBAAkBJ,UAC/B,MACJ,IAAK,SACDU,EAAQC,GAAUV,SAClBS,EAAQ,EAAKN,kBAAkBH,SAC/B,MACJ,QACIS,EAAQC,GAAUT,QAClBQ,EAAQ,EAAKN,kBAAkBF,UArC+C,8BAiD1F,OAPA,EAAK7G,sBAAwB3B,EAAU9M,OAGlCmG,IACD,EAAKsP,SAAWK,GAGhBhJ,EAAU9M,SAAW,EAAKoF,UACnB,EAAK4J,cAAc/I,EAAcsJ,EAAa,EAAGuG,EAAS3P,EAAeD,GAG7E4P,OA1HnB,oBA8HI,WAAiC,IAAD,OAK5B,OAHA3Z,KAAKyQ,aAAe,GACpBzQ,KAAKwQ,YAAc,GAEZ,IAAIvG,SAAc,SAACvK,EAAS+L,GAE/B,IACI,IAAMoO,EAAcnE,GAAyB,EAAK7B,iBAAiBM,UAAW,EAAKN,iBAAiBK,QAChG,CACI4B,sBAAuB,EAAKyD,iBAC5B/B,oBAAqB,EAAKgC,iBAGlC,IAAKK,EAED,YADAna,IAIJ,EAAK+Q,aAAL,oBAAiCoJ,GAEjCpK,KAAQoB,OAAO,eAAgB,EAAKJ,cAAc,SAACK,GAE/C,EAAKN,YAAc,EAAKsJ,WAAWhJ,GAEnCpR,OAGN,MAAOwN,GACLzB,EAAOyB,WA3JvB,GAAkD0G,IAAlD,qCAEKzP,MAFL,8GAKKA,MALL,kHAQKA,MARL,uHAWKA,MAXL,yHAkBKA,MAlBL,qHA2DKC,MA3DL,wEA4DmC,MA5DnC,IElBa2V,GAAb,WAEI,aAAe,yBA2BPC,QAAqC,GAzBzC,IAFU,EAEJC,EAAQzN,OAAOC,SAASyN,OAAOnN,OAAO,GAAGvD,MAAM,KAF3C,eAGayQ,GAHb,IAGV,2BAA8B,CAAC,IACrBE,EADoB,QACF3Q,MAAM,KAC1B2Q,EAAKtW,OAAS,IACd7D,KAAKga,QAAQG,EAAK,IAAMC,mBAAmBD,EAAK,MAN9C,+BAFlB,wCAaI,WAA0C,OAAOna,KAAKga,UAb1D,mBAeI,WAEI,IAAIK,EAAc,GAElB,IAAK,IAAI/X,KAAOtC,KAAKga,QACXK,IACFA,GAAe,KAEnBA,GAAe/X,EAAM,IAAMgY,mBAAmBta,KAAKga,QAAQ1X,IAG/DkK,OAAO+N,QAAQC,aAAa,KAAM,KAAOH,EAAmB,IAAMA,EAAX,QA1B/D,M,SDaYzB,O,mBAAAA,I,2BAAAA,I,uBAAAA,I,yBAAAA,I,iCAAAA,I,8BAAAA,Q,cASAC,O,eAAAA,I,yBAAAA,I,iBAAAA,I,kCAAAA,Q,cAOAC,O,mBAAAA,I,2BAAAA,I,iCAAAA,I,uBAAAA,I,6BAAAA,I,yBAAAA,I,2BAAAA,I,4BAAAA,Q,KAcL,I,SAAM2B,IAAb,qDAwMI,WAAoBC,EAA4C7R,EAAwCC,GAA+E,IAAD,EAa9K6R,EAb8K,qBAClL,gBADgBD,4BAAkK,EAAtH7R,iBAAsH,EAA9EC,gBAA8E,8hBA6OrK8R,gBA7OqK,IAiP9KC,mBAjP8K,IAkPrKC,qBAAuB,KAlP8I,EAoP9KC,gBAA0B,GApPoJ,EAsP9KC,kBAtP8K,IAuP9KC,kBAvP8K,EAGlL,EAAKL,WAAa,CACd,IAAIhS,GAAoB,EAAKC,eAAgB,EAAKC,eAAe,kBAAM,EAAKqK,0BAC5E,IAAItB,GAAyB,EAAKhJ,eAAlC,iBACA,IAAIyH,GAA4B,EAAKzH,iBAGnC,EAAK6R,2BACP,EAAKE,WAAWjR,KAAK,IAAIyP,GAA6B,EAAKvQ,iBAI/D,IAAMqS,EAAiB,EAAKpS,cAAc7F,QAAQ,YAE9C0X,EADEO,EACWzX,KAAOyX,GAGPzX,OAAS0X,SAAS,EAAG,QAGtC,EAAKC,UAAYT,EACjB,EAAKK,aAAeL,EAEpB,IAAMU,EAAiB,EAAKvS,cAAc7F,QAAQ,YAC5CoY,IACF,EAAKC,UAAY7X,KAAO4X,GACxB,EAAKJ,aAAe,EAAKK,WAG7B,IAAMC,EAAkB,EAAKzS,cAAc7F,QAAQ,aACnD,GAAMsY,EAAiB,CAInB,IAAMlB,EAAc,IAAIN,GACnBM,EAAYmB,OAAZ,UAAmCnB,EAAYmB,OAAZ,WACpC,EAAKC,WAAa3C,GAAcyC,IAIxC,IAAMG,EAAuB,EAAK5S,cAAc7F,QAAQ,kBAClDyY,IACF,EAAKC,gBAAkBD,GAG3B,IAAME,EAAuB,EAAK9S,cAAc7F,QAAQ,kBAClD2Y,IACF,EAAKC,gBAAkBjD,GAAmBgD,IAG9C,IAAME,EAAoB,EAAKhT,cAAc7F,QAAQ,eAC/C6Y,IACF,EAAKC,aAAeD,EACpB,EAAKf,gBAAkBe,GAG3B,IAAME,EAAqB,EAAKlT,cAAc7F,QAAQ,gBAChD+Y,IACF,EAAKC,cAAgBvD,KAAKgB,MAAMsC,IAGpC,IAAME,EAAoB,EAAKpT,cAAc7F,QAAQ,eAC/CiZ,IACF,EAAKC,aAAeC,OAAOF,IAG/B,IAAMG,EAAiB,EAAKvT,cAAc7F,QAAQ,YAClD,GAAMoZ,EAAgB,CAClB,IAAMC,EAAWF,OAAOC,GACpBC,GAAY,GAAKA,EAAW,EAAK1B,WAAW/W,SAC5C,EAAK0Y,UAAYD,GAxEyJ,SAxM1L,0CAGI,WACiC,OAAOtc,KAAKuc,WAJjD,IAKI,SAAapZ,GAELnD,KAAKuc,YAAcpZ,IAIvBnD,KAAKuc,UAAYpZ,EACjBnD,KAAK8I,cAAc1F,QAAQ,WAAYD,EAAI4B,YAE3C/E,KAAKmT,0BAdb,4BAiBI,WACI,OAAOnT,KAAK4a,WAAW5a,KAAKuc,aAlBpC,sBAqBI,WAC4B,OAAOvc,KAAKwc,aAAaC,aAAezc,KAAKwc,aAAa5R,cAtB1F,uBAwBI,WAC4B,OAAO5K,KAAKmc,cAzB5C,IA0BI,SAAgBhZ,GACZnD,KAAKmc,aAAehZ,EACpBnD,KAAK8I,cAAc1F,QAAQ,cAAepD,KAAKmc,aAAapX,YAC5D/E,KAAK0c,oBAAmB,KA7BhC,oBAgCI,WAGI,OAAQ1c,KAAKyb,YACT,KAAK3C,GAAc6D,WACf,OAAOlZ,OAAS0X,SAAS,EAAG,WAChC,KAAKrC,GAAc8D,cACf,OAAOnZ,OAAS0X,SAAS,GAAI,WACjC,KAAKrC,GAAc+D,SACf,OAAOpZ,OAAS0X,SAAS,EAAG,SAChC,KAAKrC,GAAcgE,YACf,OAAOrZ,OAAS0X,SAAS,EAAG,QAChC,KAAKrC,GAAciE,UACf,OAAOtZ,OAAS0X,SAAS,EAAG,QAChC,KAAKrC,GAAckE,WACf,OAAOvZ,OAAS0X,SAAS,GAAI,QACjC,KAAKrC,GAAcmE,WACf,OAAOxZ,OAAS0X,SAAS,GAAI,QACjC,QACI,OAAOnb,KAAKob,YAnD5B,IAsDI,SAAajY,GAETnD,KAAKob,UAAYjY,EACjBnD,KAAKyb,WAAa3C,GAAcoE,OAChCld,KAAKmd,UAAUzT,iBA1DvB,oBA6DI,WAEI,OAAU1J,KAAKyb,aAAezb,KAAKsb,UAAa7X,OAAWzD,KAAKsb,WA/DxE,IAiEI,SAAanY,GACTnD,KAAKsb,UAAYnY,EACjBnD,KAAKyb,WAAa3C,GAAcoE,OAChCld,KAAKmd,UAAUzT,iBApEvB,2BAuEI,WACiC,QAAS1J,KAAKsb,WAxEnD,IAyEI,SAAoBnY,GAEhBnD,KAAKsb,UAAYnY,EAAMM,OAAW,KAE7BN,IACDnD,KAAKmd,UAAUzT,eACf1J,KAAKmT,0BA/EjB,qBAmFI,WACiC,OAAOnT,KAAKyb,YApFjD,IAqFI,SAActY,GAEVnD,KAAKO,uBAAoBc,EAEzBrB,KAAKyb,WAAatY,EAElBnD,KAAKmd,UAAUzT,eACf1J,KAAKmT,yBA5Fb,uBAkGI,WAC4B,OAAOnT,KAAK+b,cAnG5C,IAoGI,SAAgB5Y,GAAenD,KAAK+b,aAAe5Y,IApGvD,0BAsGI,WAC2C,OAAOnD,KAAK6b,iBAvG3D,IAwGI,SAAmB1Y,GAEfnD,KAAK6b,gBAAkB1Y,EAEjBnD,KAAK+b,cAAyC,MAAzB/b,KAAK2b,iBAE5B3b,KAAKmT,yBA9GjB,0BAkHI,WAC+B,OAAOnT,KAAK2b,iBAnH/C,IAoHI,SAAmBxY,GAEfnD,KAAK2b,gBAAkBxY,EAElBnD,KAAK+b,eAImB,MAAzB/b,KAAK2b,kBACL3b,KAAK+b,aAAe,IAGxB/b,KAAKmT,0BAhIb,wBAmII,WACuD,OAAOnT,KAAKic,gBApIvE,6BAsII,SAAgBmB,GAEZ,OAAKA,GAIApd,KAAKic,iBAIDjc,KAAKic,cAAc1Q,SAAS6R,IAPzBpd,KAAKic,gBAzIzB,8BAmJI,SAAiBoB,EAAkBD,GAAgD,IAAD,OAE9E,GAAIC,EAEKD,GAGIpd,KAAKic,gBACNjc,KAAKic,cAAgB,IAEzBjc,KAAKic,cAActS,KAAKyT,IALxBpd,KAAKic,cAAgB,UAUzB,GAAKmB,EAEE,CACEpd,KAAKic,gBACNjc,KAAKic,cAAgB,IAGzB,IAAM1I,EAAIvT,KAAKic,cAAcqB,QAAQF,GACjC7J,GAAK,GACLvT,KAAKic,cAAcsB,OAAOhK,EAAG,QARjCvT,KAAKic,cAAgB,GAavBjc,KAAK6a,eACP2C,aAAaxd,KAAK6a,eAEtB7a,KAAK6a,cAAgB4C,YAAW,kBAAM,EAAKtK,yBAAwBnT,KAAK8a,wBAnLhF,sCAsLI,WAA4B,IAAD,OAEjB9a,KAAK6a,gBACP2C,aAAaxd,KAAK6a,eAClB7a,KAAK6a,cAAgB4C,YAAW,kBAAM,EAAKtK,yBAAwBnT,KAAK8a,yBA1LpF,+BA8LI,WAGI,MAAgC,cAAzB9a,KAAK2b,mBAAsC3b,KAAK+a,kBAjM/D,yBAoMI,WAAsC,OAAO/a,KAAK6I,iBApMtD,oCAsMI,WAA0C,OAAO7I,KAAK0a,4BAtM1D,2BAqRI,WACQhT,GAAgBgW,cAAc1d,KAAKob,YAAcpb,KAAKgb,eAAiBhb,KAAKob,WAC5Epb,KAAKmT,yBAvRjB,2BA2RI,WACQzL,GAAgBgW,cAAc1d,KAAKsb,YAActb,KAAKib,eAAiBjb,KAAKsb,WAC5Etb,KAAKmT,yBA7RjB,8BAiSI,WACQnT,KAAK+a,kBAAoB/a,KAAK+b,cAC9B/b,KAAKmT,yBAnSjB,kCAuSI,WAGUnT,KAAK6a,gBACP2C,aAAaxd,KAAK6a,eAClB7a,KAAK6a,cAAgB,MALN,qBAQO7a,KAAK4a,YARZ,IAQnB,2BAA2C,SAC3B+C,SATG,8BAadjW,GAAgBgW,cAAc1d,KAAKob,aACpCpb,KAAKob,UAAYpb,KAAKgb,cAEpBhb,KAAKsb,YAAc5T,GAAgBgW,cAAc1d,KAAKsb,aACxDtb,KAAKsb,UAAYtb,KAAKib,cAI1Bjb,KAAK8I,cAAcoB,SAAS,CACxB,CAAEC,UAAW,WAAYtF,MAAQ7E,KAAKyb,WAA2C,KAA9Bzb,KAAKob,UAAU1X,eAClE,CAAEyG,UAAW,WAAYtF,MAAU7E,KAAKsb,YAActb,KAAKyb,WAAczb,KAAKsb,UAAU5X,cAAgB,MACxG,CAAEyG,UAAW,YAAatF,MAAS7E,KAAKyb,WAAa3C,GAAc9Y,KAAKyb,YAAc,MACtF,CAAEtR,UAAW,iBAAkBtF,MAAO7E,KAAK2b,iBAC3C,CAAExR,UAAW,iBAAkBtF,MAAO+T,GAAmB5Y,KAAK6b,kBAC9D,CAAE1R,UAAW,cAAetF,MAAS7E,KAAK+b,aAAe/b,KAAK+b,aAAe,MAC7E,CAAE5R,UAAW,eAAgBtF,MAAS7E,KAAKic,cAAgBvD,KAAKC,UAAU3Y,KAAKic,eAAiB,QAGpGjc,KAAK0c,qBAEL1c,KAAK+a,gBAAkB/a,KAAK+b,aAC5B/b,KAAKgb,aAAehb,KAAKob,UACzBpb,KAAKib,aAAejb,KAAKsb,YA1UjC,oBA6UI,WACItb,KAAKwc,aAAa5R,aAAc,EAChC5K,KAAKwc,aAAe,IAAI7T,KA/UhC,gCAkVI,WAAoD,IAAD,OAAhCqB,EAAgC,wDAEzCD,EAAc/J,KAAKwc,aACzB,IAAMzS,EAAY0S,WAAlB,CAGA1S,EAAY0S,YAAa,EAEzB,IAAI3S,EAAY,mCAA+B9J,KAAKuS,SAAS7O,cAA7C,iCAAmF1D,KAAKwS,SAAS9O,cAAjG,KAOhB,GALM1D,KAAKic,gBAEPnS,GAAY,iCAA8B9J,KAAKic,cAAcnd,KAAI,SAAA8e,GAAC,iBAAQA,EAAR,QAAchU,KAAK,KAAzE,MAGV5J,KAAK+b,cAAyC,MAAzB/b,KAAK2b,gBAAyB,CAErD7R,GAAgB,QAEhB,IAAM+T,EAAqBvD,mBAAmBta,KAAK+b,cAEnD,OAAQ/b,KAAK6b,iBACT,KAAKjD,GAAmBkF,OACpBhU,GAAY,UAAO9J,KAAK2b,gBAAZ,gBAAmCkC,EAAnC,KAChB,MACA,KAAKjF,GAAmBmF,WACpBjU,GAAY,qBAAkB9J,KAAK2b,gBAAvB,cAA4CkC,EAA5C,MAChB,MACA,KAAKjF,GAAmBoF,SACpBlU,GAAY,mBAAgB9J,KAAK2b,gBAArB,cAA0CkC,EAA1C,MAChB,MACA,KAAKjF,GAAmBqF,UACpBnU,GAAY,UAAO9J,KAAK2b,gBAAZ,gBAAmCkC,EAAnC,KACZ,MACJ,KAAKjF,GAAmBsF,cACpBpU,GAAY,qBAAkB9J,KAAK2b,gBAAvB,cAA4CkC,EAA5C,eACZ,MACJ,KAAKjF,GAAmBuF,YACpBrU,GAAY,mBAAgB9J,KAAK2b,gBAArB,cAA0CkC,EAA1C,gBAKxB7d,KAAKoe,iBAAiBC,KAAKvU,EAAcC,EAAaC,GAAeU,MAAK,WAEhE,EAAKmQ,eACP2C,aAAa,EAAK3C,eAIhB,EAAKsB,eAEP,EAAKtB,cAAgB4C,YAAW,WAE5B,EAAKf,oBAAmB,KAEL,IAApB,EAAKP,kBAGb,SAAAjP,GAGC,EAAKiP,aAAe,EAEfpS,EAAYa,cACb,EAAKjJ,aAAL,uBAAoCuL,EAAI1F,QAAxC,YAAsD0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAzF,SAGLgT,SAAQ,WACPvU,EAAY0S,YAAa,QAvZrC,qBAubI,WAA+C,OAAOzc,KAAK4a,WAAW,OAvb1E,GAAyClS,IAAzC,sCAGKvE,MAHL,+GAqBKA,MArBL,kHAwBKA,MAxBL,gHAgCKA,MAhCL,6GA6DKA,MA7DL,oHAuEKA,MAvEL,qHAmFKA,MAnFL,0HA+FKC,MA/FL,uGAkGKD,MAlGL,sHAsGKA,MAtGL,yHAkHKA,MAlHL,uHAmIKA,MAnIL,4HA8LKA,MA9LL,4HA2ZKC,MA3ZL,yEA4ZwCyU,GAAe3W,QA5ZvD,6CA8ZKkC,MA9ZL,yEA+ZwC,IAAIuE,MA/Z5C,6CAiaKvE,MAjaL,yEAkamC,KAlanC,0CAoaKA,MApaL,wGAsaKA,MAtaL,yGAwaKA,MAxaL,yEAyawC0U,GAAcoE,UAzatD,6CA2aK9Y,MA3aL,wEA4amC,MA5anC,gDA6aKA,MA7aL,yEA8akDwU,GAAmBkF,UA9arE,gDA+aK1Z,MA/aL,wEAgbsC,OAhbtC,8CAkbKA,MAlbL,yEAmb8D,QAnb9D,I,0FExCMma,GAAcvT,gMAAYwT,sBAAmDxT,gMAAYwT,sBAAvCla,GAAmBpB,MAE9Dub,GAAQC,aAAe,CAChCC,QAAS,CAAE/J,KAAqB,SAAf2J,GAAwB,OAAS,WAGzCK,GAAwC,SAAvBH,GAAME,QAAQ/J,KAAkB,CAC1DiK,gBAAiB,QACjB,GAEG,SAASC,GAAqB1B,GAEjC,IAAIyB,EAA0B,KAE9B,OAAQzB,GACJ,IAAK,SACDyB,EAAkBE,GAAUN,GAAME,QAAQK,MAAMC,MAAO,IACvD,MACJ,IAAK,YACDJ,EAAkBE,GAAUN,GAAME,QAAQO,QAAQD,MAAO,IACzD,MACJ,IAAK,UACDJ,EAAkBE,GAAUN,GAAME,QAAQQ,QAAQF,MAAO,IACzD,MACJ,IAAK,aACDJ,EAAkBE,GAAUN,GAAME,QAAQS,WAAWC,MAAO,IAIpE,OAASR,EAAkB,CAAEA,mBAAoB,GAG9C,SAASE,GAAUO,EAAaC,GAEnC,OAAID,EAAIzb,OAAS,EACP,QAAN,OAAe2b,SAASF,EAAI3b,MAAM,EAAG,GAAI,IAAzC,aAAiD6b,SAASF,EAAI3b,MAAM,EAAG,GAAI,IAA3E,aAAmF6b,SAASF,EAAI3b,MAAM,EAAG,GAAI,IAA7G,aAAqH4b,EAAMjX,QAAQ,GAAnI,KAEM,QAAN,OAAekX,SAASF,EAAI3b,MAAM,EAAG,GAAI,IAAzC,aAAiD6b,SAASF,EAAI3b,MAAM,EAAG,GAAI,IAA3E,aAAmF6b,SAASF,EAAI3b,MAAM,EAAG,GAAI,IAA7G,aAAqH4b,EAAMjX,QAAQ,GAAnI,KAID,SAASmX,GAA0BrC,GAEtC,IAAIyB,EAA0B,KAE9B,GAA2B,SAAvBJ,GAAME,QAAQ/J,KAEd,OAAQwI,GACJ,IAAK,SACDyB,EAAkB,iBAClB,MACJ,IAAK,YACDA,EAAkB,gBAClB,MACJ,IAAK,UACDA,EAAkB,iBAClB,MACJ,IAAK,aACDA,EAAkB,gBAClB,MACJ,IAAK,WACDA,EAAkB,qBAK1B,OAAQzB,GACJ,IAAK,SACDyB,EAAkB,mBAClB,MACJ,IAAK,YACDA,EAAkB,mBAClB,MACJ,IAAK,UACDA,EAAkB,mBAClB,MACJ,IAAK,aACDA,EAAkB,mBAClB,MACJ,IAAK,WACDA,EAAkB,mBAK9B,OAASA,EAAkB,CAAEA,mBAAoB,GC9E9C,I,wBAAMa,IAAb,GAqBK3Y,KAAOC,MAtBXlH,aACD,+JAEI,WAE4C,IAAD,EAOhC,EAPP,OAAIE,KAAKC,MAAM8T,cAAc/C,SAGrB,gBAACzO,EAAA,EAAD,CAAMpC,MAA8B,SAAvBse,GAAME,QAAQ/J,KAAkB,UAAY,UAAW/S,UAAU,2BAA2BxB,QAASL,KAAK2f,eAAvH,UACK3f,KAAKC,MAAMY,aADhB,QACyBb,KAAKC,MAAM2f,iBAMpC,gBAACrd,EAAA,EAAD,CAAMpC,MAA8B,SAAvBse,GAAME,QAAQ/J,KAAkB,UAAY,UAAWpS,KAAI,UAAKxC,KAAKC,MAAM8T,cAAc9C,2BAA9B,OAA0DnF,IAA1D,OAAqF9L,KAAK6f,2BAA2B7f,KAAKC,MAAM2f,kBAAoB3a,OAAO,UAAnO,UACKjF,KAAKC,MAAMY,aADhB,QACyBb,KAAKC,MAAM2f,mBAfpD,2BAqBI,WAEI5f,KAAKC,MAAM8T,cAActJ,KAAK,kBAAmBzK,KAAKC,MAAM2f,mBAvBpE,wCA2BI,SAAmChC,GAC/B,OAAOA,EAAEzQ,QAAQ,gBAAiB,QA5B1C,GAAuCxK,aAAvC,wI,oBCEamd,GADZhgB,YACD,+JAwCI,WACI,IAAMC,EAAQC,KAAKC,MAAMF,MAEzB,OACI,gBAACyB,EAAA,EAAD,CAAQue,WAAW,EAAMC,SAAS,KAAK7e,OAAQpB,EAAMkgB,WAAY7e,QAAS,kBAAMrB,EAAMkgB,WAAa,KAE/F,gBAAChe,EAAA,EAAD,KAAclC,EAAMc,OAEpB,gBAACa,EAAA,EAAD,KACI,gBAACwe,GAAA,EAAD,CACIC,WAAS,EAACJ,WAAS,EAACK,UAAQ,EAC5Bvb,MAAO9E,EAAMkgB,cAIrB,gBAACI,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMkgB,WAAa,IAAI9f,MAAM,WAApD,cAxDpB,yBAEI,SAAyBmgB,EAAiBC,EAAqBC,GAE3D,IAAKF,EACD,OAAO,KAIX,GAA0B,kBAAfA,EACP,IACIA,EAAa5H,KAAKgB,MAAM4G,GAC1B,UAGN,IAAML,EAAoC,kBAAfK,EAA0BA,EAAa5H,KAAKC,UAAU2H,GAEjF,GAAIL,EAAWpc,QAxBK,IA0BhB,OAAQ,gBAACqc,GAAA,EAAD,CACJre,UAAU,uBACVse,WAAS,EAACJ,WAAS,EAACU,QAAS,EAAGL,UAAQ,EACxCvb,MAAOob,IAIf,IAAMS,EAA6C,kBAAfJ,EAA0BA,EAAa5H,KAAKC,UAAU2H,EAAY,KAAM,GAE5G,OAAQ,gBAAC/d,EAAA,EAAD,CACJoe,UAAU,SACVC,QAAQ,UACRvgB,QAAS,WACLmgB,EAAY3f,MAAQ0f,EACpBC,EAAYP,WAAaS,IAG5BT,EAAWlT,OAAO,EA1CG,IAkClB,WA5BhB,GAAoCpK,eAApC,GCOake,GADZ/gB,aACD,kNAGI0E,aAHJ,8CAKI,WAEI,IAAMzE,EAAQC,KAAKC,MAAMF,MAEzB,OAAQ,gCAEJ,gBAAC+gB,GAAA,EAAD,CAAgBjf,UAAU,uBACnB9B,EAAMghB,eAAeld,QAAW,0CAE3B9D,EAAMghB,eAAeld,OAFM,kBAI5B9D,EAAMihB,cAAcnd,QAAW,4CAExB9D,EAAMihB,cAAcnd,OAFI,wBAI7B,gBAACtB,EAAA,EAAD,CAAMV,UAAU,gBACb8e,UAAU,SACVC,QAAQ,UACRvgB,QAAS,kBAAMN,EAAMkhB,WAHxB,UAJ6B,OAiB1C,gBAACC,GAAA,EAAD,CAAOC,UAAW,GACbnhB,KAAKohB,YAAYrhB,IAGtB,gBAAC,GAAD,CAAgBA,MAAOA,EAAMshB,yBArCzC,yBA0CI,SAAoBthB,GAA0C,IAAD,OAEzD,IAAKA,EAAMghB,eAAeld,OACtB,OACI,gBAAC/C,EAAA,EAAD,CAAY8f,QAAQ,KAAK/e,UAAU,2BAAnC,sBAMR,IAAMyf,EAAiBza,GAElBwI,QAAO,SAAAmH,GAAC,QAAI,EAAKvW,MAAMshB,qBAAmC,cAAN/K,KAEzD,OACI,gBAACgL,GAAA,EAAD,CAAOC,KAAK,SACR,gBAACC,GAAA,EAAD,KACI,gBAACC,GAAA,EAAD,KACKL,EAAexiB,KAAI,SAAA8iB,GAEhB,IAAMC,EAA2BP,EAAezd,QAAU9D,EAAMihB,cAAcnd,OAAS,EAEvF,OAAQ9D,EAAMihB,cAAczV,SAASqW,IACjC,gBAACE,GAAA,EAAD,CAAWxf,IAAKsf,EACZG,aAAc,kBAAMhiB,EAAMiiB,iBAAmBJ,GAC7CK,aAAc,kBAAMliB,EAAMiiB,iBAAmB,KAE7C,gBAACE,GAAA,EAAD,CACIC,OAAQpiB,EAAMqiB,UAAYR,EAC1BtL,UAAWvW,EAAMuK,iBACjBjK,QAAS,kBAAMN,EAAMqiB,QAAUR,IAE9BA,GAGJ7hB,EAAMiiB,mBAAqBJ,IAAQC,GAChC,gBAACnd,EAAA,EAAD,CACIvE,MAAM,UACNshB,KAAK,QACL5f,UAAU,qBACVxB,QAAS,kBAAMN,EAAMsiB,WAAWT,KAEhC,gBAAC,KAAD,aAS5B,gBAACU,GAAA,EAAD,KACKviB,EAAMghB,eAAejiB,KAAI,SAAAyjB,GAEtB,IAAMC,EAAW1D,GAAqByD,EAAcrc,eAC9Cuc,EAAY,CAAEC,cAAe,OACnC,OACI,gBAACf,GAAA,EAAD,CACIrf,IAAKigB,EAAcxc,WACnB4c,MAAOH,IAELziB,EAAMihB,cAAczV,SAAS,eAC3B,gBAACuW,GAAA,EAAD,CAAWjgB,UAAU,mBAAmB8gB,MAAOF,GAC3C,gBAAC,GAAD,CAAmB7C,gBAAiB2C,EAAcxc,WAAYgO,cAAe,EAAK9T,MAAM8T,kBAG9FhU,EAAMihB,cAAczV,SAAS,SAC3B,gBAACuW,GAAA,EAAD,CAAWjgB,UAAU,YAAY8gB,MAAOF,GACnCF,EAAcvc,OAGrBjG,EAAMihB,cAAczV,SAAS,gBAC3B,gBAACuW,GAAA,EAAD,CAAWjgB,UAAU,gBAAgB8gB,MAAOF,GACvC,EAAKje,QAAQoe,qBAAqBL,EAAc/b,eAGvDzG,EAAMihB,cAAczV,SAAS,oBAC3B,gBAACuW,GAAA,EAAD,CAAWjgB,UAAU,gBAAgB8gB,MAAOF,GACvC,EAAKje,QAAQoe,qBAAqBL,EAAc9b,mBAGvD1G,EAAMihB,cAAczV,SAAS,aAC3B,gBAACuW,GAAA,EAAD,CAAWa,MAAOF,GACb/a,GAAgB0I,eAAemS,EAAc7b,YAGpD3G,EAAMihB,cAAczV,SAAS,kBAC3B,gBAACuW,GAAA,EAAD,CAAWa,MAAOF,GACbF,EAAcrc,gBAGrBnG,EAAMihB,cAAczV,SAAS,cAAgB,EAAKtL,MAAMshB,qBACtD,gBAACO,GAAA,EAAD,CAAWa,MAAOF,GACbF,EAAcnc,YAGrBrG,EAAMihB,cAAczV,SAAS,UAC3B,gBAACuW,GAAA,EAAD,CAAWjgB,UAAU,iBAAiB8gB,MAAOF,GACxC3C,GAAe+C,WAAWN,EAAclc,MAAxC,UAAkDkc,EAAcxc,WAAhE,YAAsFhG,EAAMshB,uBAGnGthB,EAAMihB,cAAczV,SAAS,WAC3B,gBAACuW,GAAA,EAAD,CAAWjgB,UAAU,cAAc8gB,MAAOF,GACrC3C,GAAe+C,WAAWN,EAAchc,OAAxC,UAAmDgc,EAAcxc,WAAjE,aAAwFhG,EAAMshB,uBAGrGthB,EAAMihB,cAAczV,SAAS,iBAC3B,gBAACuW,GAAA,EAAD,CAAWjgB,UAAU,cAAc8gB,MAAOF,GACrC3C,GAAe+C,WAAWN,EAAcjc,aAAxC,UAAyDic,EAAcxc,WAAvE,mBAAoGhG,EAAMshB,gCAtJnJ,GAAwC1e,aAAxC,GAEWgD,YAActB,GAFzB,Y,UCRaye,GADZhjB,aACD,kNAGI0E,aAHJ,8CAKI,WAAuB,IAAD,OAEZzE,EAAQC,KAAKC,MAAMF,MACnBgjB,EAAYtjB,OAAOD,KAAKO,EAAMijB,YAAYrM,OAEhD,OAAQ,gCAEJ,gBAACmK,GAAA,EAAD,CAAgBjf,UAAU,qBAA1B,UACQ9B,EAAMkjB,oBADd,gBAGKljB,EAAMmjB,UAAa,gCAEf,KACD,gBAAC3gB,EAAA,EAAD,CAAMV,UAAU,gBACZ8e,UAAU,SACVC,QAAQ,UACRvgB,QAAS,kBAAMN,EAAMojB,cAHzB,yBAWR,gBAAC,KAAD,CACIxiB,MAAO6L,OAAO4W,WAAa,GAAIC,OAAQ7W,OAAO8W,YAAc,IAC5DC,MAAM,OACNC,QAAQ,IACRC,OAAQ,CAAE3Q,KAAM,GAAIC,MAAO,GAAI2Q,IAAK,OAEjC3jB,EAAMkjB,qBACL,gBAAC,KAAD,CAAOU,UAAW,IAEtB,gBAAC,KAAD,CAAOA,UAAW,EAAGC,WAAY,SAAAvgB,GAAC,OAAI,EAAKwgB,eAAexgB,EAAGtD,EAAM+jB,4BAElEf,EAAUjkB,KAAI,SAAAilB,GAAQ,OAAK,gBAAC,KAAD,CACxBzhB,IAAKyhB,EACLC,OAAO,QACP7jB,MAAO,EAAK8jB,4BAA4BF,GACxCzY,KAAMvL,EAAMijB,WAAWe,UAGxBhkB,EAAMkjB,qBAEL,gBAAC,KAAD,CACI9iB,MAAM,UACN+jB,MAAI,EACJC,SAAS,EAETC,UAAW,SAACC,GACFA,GACFtkB,EAAMukB,UAAUD,EAAKvR,KAAMuR,EAAKtR,WAQpD,gBAAC,KAAD,CAAqBlR,UAAU,mBAC3B0iB,OAAQxB,EAAUjkB,KAAI,SAAAilB,GAAQ,OAAI,EAAKE,4BAA4BF,MACnES,MAAOzB,EAAUjkB,KAAI,SAAAilB,GAAQ,gBAAOA,EAAP,aAAoBhkB,EAAM0kB,OAAOV,GAAjC,QAC7BW,YAAY,kBAnE5B,yCAyEI,SAAoCC,GAIhC,IADA,IAAIC,EAAW,EACNrR,EAAIoR,EAAa9gB,OAAS,EAAG0P,GAAK,EAAGA,IAC1CqR,GAAaA,GAAY,GAAKA,EAAYD,EAAaE,WAAWtR,GAElEqR,GAAY,WAShB,OALAA,GAAY,QAKL,KAFPA,GAAY,UAEU7f,SAAS,MAzFvC,4BA4FI,SAAuB1B,EAASoP,GAE5B,IAAMqS,EAAIrhB,KAAOJ,GAMjB,OAJKrD,KAAKwE,QAAQM,iBACdggB,EAAEthB,MAGFiP,EAAY,MACLqS,EAAE5gB,OAAO,cAGhBuO,EAAY,MACLqS,EAAE5gB,OAAO,oBAGhBuO,EAAY,IAEU,IAAfqS,EAAEC,SAAiBD,EAAE5gB,OAAO,SAAW4gB,EAAE5gB,OAAO,YAG/B,IAApB4gB,EAAEE,cAAuBF,EAAE5gB,OAAO,YAAc4gB,EAAE5gB,OAAO,YAjHzE,GAA6CvB,aAA7C,GAEWgD,YAActB,GAFzB,Y,yCCJa4gB,GAAb,4JAEI,WAAuB,IAAD,OAElB,OAAIjlB,KAAKC,MAAM8T,cAAc/C,SAGrB,gBAAC9Q,EAAA,EAAD,CACI0gB,QAAQ,WACRzgB,MAAM,UACN+kB,SAAUllB,KAAKC,MAAMwc,WACrBpc,QAAS,kBAAM,EAAKJ,MAAM8T,cAActJ,KAAK,SAAU,EAAKxK,MAAMklB,SAAW,OAAQ,EAAKllB,MAAM6Q,OAEhG,gBAAC,KAAD,MACA,gBAACpQ,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACG,EAAA,EAAD,CAAYX,MAAM,WAAlB,iBAOJ,gBAACD,EAAA,EAAD,CACI0gB,QAAQ,WACRzgB,MAAM,UACN+kB,SAAUllB,KAAKC,MAAMwc,WACrBja,KAAM4iB,IAAIC,gBAAgB,IAAIC,KAAK,CAACtlB,KAAKC,MAAM6Q,KAAM,CAAE8D,KAAM,mBAC7D2Q,SAAUvlB,KAAKC,MAAMklB,SAAW,QAEhC,gBAAC,KAAD,MACA,gBAACzkB,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACG,EAAA,EAAD,CAAYX,MAAM,WAAlB,qBA/BpB,GAAqCwC,aAuC9B,SAAS6iB,GAAa1U,GAEzB,OAAOA,EAAI3D,QAAQ,WACf,+GClCD,I,2BCdKsY,G,SDcCC,GADZ5lB,YACD,2KAEI,WAGI,IAAM6lB,EAAarR,SAASC,eAAe,gBAErCoR,IAEF3lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,SACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,wBACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,4BAZlF,oBAgBI,WAEI,IAAM9lB,EAAQC,KAAKC,MAAMF,MAEzB,OAAKA,EAAM+lB,QAIH,gCAEJ,uBACIjkB,UAAU,eACV8gB,MAAO/D,GACPmH,wBAAyB,CAAEC,OAAQR,GAAazlB,EAAM+lB,YAG1D,gBAACG,EAAA,EAAD,CAASrF,QAAQ,SAEb,gBAAC9f,EAAA,EAAD,CAAY6hB,MAAO,CAAEuD,KAAM,KAE3B,gBAAChmB,EAAA,EAAD,CACI0gB,QAAQ,WACRzgB,MAAM,UACN+kB,SAAUllB,KAAKC,MAAMwc,WACrBpc,QAAS,kBAAMmM,OAAO2Z,UAAUC,UAAUC,UAAUtmB,EAAM8Z,eAE1D,gBAAC,KAAD,MACA,gBAACnZ,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACG,EAAA,EAAD,CAAYX,MAAM,WAAlB,mCAGJ,gBAACO,EAAA,EAAD,CAAKC,MAAO,KAEZ,gBAAC,GAAD,CACImQ,IAAK0U,GAAazlB,EAAM+lB,SACxBX,SAAUnlB,KAAKC,MAAMklB,SACrB1I,WAAYzc,KAAKC,MAAMwc,WACvB1I,cAAe/T,KAAKC,MAAM8T,gBAG9B,gBAACrT,EAAA,EAAD,CAAKC,MAAO,OAnCT,OArBnB,4CA6DI,SAAuC2lB,GAInC,IAFA,IAAMvmB,EAAQC,KAAKC,MAAMF,MAFuC,aAK5D,IAAMwmB,EAAKD,EAAM/S,GAEXxC,EAAwByO,SAAS+G,EAAGtnB,GAAG8N,OAAO,IACpDwZ,EAAGC,QAAU,kBAAMzmB,EAAM0mB,KAAK1V,IAC9BwV,EAAG5D,MAAM+D,OAAS,WALbnT,EAAI,EAAGA,EAAI+S,EAAMziB,OAAQ0P,IAAM,QAjEhD,GAA8C5Q,eAA9C,G,UEEagkB,I,OADZ7mB,YACD,+MA8GqB8mB,aAAenH,GAA0B,WA9G9D,EA+GqBoH,eAAiBpH,GAA0B,aA/GhE,EAgHqBqH,YAAcrH,GAA0B,UAhH7D,EAiHqBsH,WAAatH,GAA0B,cAjH5D,uDAEI,WAEIjT,OAAOwa,iBAAiB,SAAUhnB,KAAKinB,uBACvCjnB,KAAKinB,0BALb,kCAQI,WAEIza,OAAO0a,oBAAoB,SAAUlnB,KAAKinB,yBAVlD,gCAaI,WAEIjnB,KAAKinB,wBAEL,IAAMtB,EAAarR,SAASC,eAAe,gBACrCoR,IAEF3lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,iBACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,WACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aAxBlF,oBA4BI,WAEI,IAAM9lB,EAAQC,KAAKC,MAAMF,MAEzB,OAAQ,gCAEJ,gBAAC+gB,GAAA,EAAD,CAAgBjf,UAAU,8BAA1B,cACe,gBAACU,EAAA,EAAD,CACPqe,QAAQ,UACRpe,KAAK,oDAFE,yBAQZzC,EAAMonB,iBACL,gBAACC,GAAA,EAAD,CAAWxiB,KAAG,EAAC/C,UAAU,kBAErB,gBAACsD,EAAA,EAAD,CACIC,QAAS,gBAACiiB,GAAA,EAAD,CACLlnB,MAAM,UACN+kB,SAAUllB,KAAKC,MAAMwc,WACrBY,QAAStd,EAAMunB,gBACftiB,SAAU,SAAC1E,GAAD,OAASP,EAAMunB,gBAAkBhnB,EAAI2E,OAAOoY,WAE1D/X,MAAM,mBAGV,gBAACH,EAAA,EAAD,CACIC,QAAS,gBAACiiB,GAAA,EAAD,CACLlnB,MAAM,UACN+kB,SAAUllB,KAAKC,MAAMwc,WACrBY,QAAStd,EAAMwnB,cACfviB,SAAU,SAAC1E,GAAD,OAASP,EAAMwnB,cAAgBjnB,EAAI2E,OAAOoY,WAExD/X,MAAM,iBAGTtF,KAAKwnB,qBAKbxnB,KAAKynB,kBAEH1nB,EAAM2nB,YAAe,gCACpB,uBACI7lB,UAAU,cACV8gB,MAAO/D,GACPmH,wBAAyB,CAAEC,OAAQR,GAAazlB,EAAM2nB,eAG1D,gBAACzB,EAAA,EAAD,CAASrF,QAAQ,SAEb,gBAAC9f,EAAA,EAAD,CAAY6hB,MAAO,CAAEuD,KAAM,KAE3B,gBAAChmB,EAAA,EAAD,CACI0gB,QAAQ,WACRzgB,MAAM,UACN+kB,SAAUllB,KAAKC,MAAMwc,WACrBpc,QAAS,kBAAMmM,OAAO2Z,UAAUC,UAAUC,UAAUtmB,EAAM8Z,eAE1D,gBAAC,KAAD,MACA,gBAACnZ,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACG,EAAA,EAAD,CAAYX,MAAM,WAAlB,mCAGJ,gBAACO,EAAA,EAAD,CAAKC,MAAO,KAEZ,gBAAC,GAAD,CACImQ,IAAK0U,GAAazlB,EAAM2nB,YACxBvC,SAAUnlB,KAAKC,MAAMklB,SACrB1I,WAAYzc,KAAKC,MAAMwc,WACvB1I,cAAe/T,KAAKC,MAAM8T,gBAG9B,gBAACrT,EAAA,EAAD,CAAKC,MAAO,UAxGhC,+BAmHI,WAEI,IAAMZ,EAAQC,KAAKC,MAAMF,MACnB4nB,EAAc5nB,EAAM4Z,QAAQ5Z,EAAMsZ,kBAExC,QAAUsO,MAAkBA,EAAY3O,aAAe2O,EAAY1O,WAAa0O,EAAYzO,SACxF,wBAAMrX,UAAU,sBAEZ,gBAACf,EAAA,EAAD,CAAY8f,QAAQ,SAApB,oBAEA,gBAAClgB,EAAA,EAAD,CAAKC,MAAO,OAETgnB,EAAY3O,WACX,gBAAC4O,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO3iB,KAAK6mB,eAAgBjG,QAAQ,WAAWa,KAAK,QAAQnc,MAAK,UAAKqiB,EAAY3O,UAAjB,kBAEjG2O,EAAY1O,SACX,gBAAC2O,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO3iB,KAAK4mB,aAAchG,QAAQ,WAAWa,KAAK,QAAQnc,MAAK,UAAKqiB,EAAY1O,QAAjB,gBAE/F0O,EAAYzO,QACX,gBAAC0O,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO3iB,KAAK8mB,YAAalG,QAAQ,WAAWa,KAAK,QAAQnc,MAAK,UAAKqiB,EAAYzO,OAAjB,eAE9FyO,EAAYxO,OACX,gBAACyO,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO3iB,KAAK+mB,WAAYnG,QAAQ,WAAWa,KAAK,QAAQnc,MAAK,UAAKqiB,EAAYxO,MAAjB,eAzIhH,2BAgJI,WAAwC,IAAD,OAE7BpZ,EAAQC,KAAKC,MAAMF,MAEzB,OAAON,OAAOD,KAAKO,EAAM4Z,SAAS7a,KAAI,SAAAgV,GAElC,IAAM+T,EAAS9nB,EAAM4Z,QAAQ7F,GAE7B,OAAQ,wBAAM7U,GAAE,uBAAkB6U,EAAatI,eAAiBlJ,IAAG,uBAAkBwR,GAAgBjS,UAAU,kBAExGgmB,EAAO7O,WACN,gBAACpY,EAAA,EAAD,CAASC,MAAM,iCACX,gBAAC+mB,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO,EAAKkE,eAAgBjG,QAAQ,WAAWa,KAAK,QAAQnc,MAAK,UAAKuiB,EAAO7O,gBAGjH6O,EAAO5O,SACN,gBAACrY,EAAA,EAAD,CAASC,MAAM,+BACX,gBAAC+mB,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO,EAAKiE,aAAchG,QAAQ,WAAWa,KAAK,QAAQnc,MAAK,UAAKuiB,EAAO5O,cAG/G4O,EAAO3O,QACN,gBAACtY,EAAA,EAAD,CAASC,MAAM,8BACX,gBAAC+mB,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO,EAAKmE,YAAalG,QAAQ,WAAWa,KAAK,QAAQnc,MAAK,UAAKuiB,EAAO3O,aAG9G2O,EAAO1O,OACN,gBAACvY,EAAA,EAAD,CAASC,MAAM,4CACX,gBAAC+mB,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO,EAAKoE,WAAYnG,QAAQ,WAAWa,KAAK,QAAQnc,MAAK,UAAKuiB,EAAO1O,gBA3KhI,mCAmLI,WAGI,IAH6B,IAAD,OAEtB2O,EAAsBxT,SAASuR,uBAAuB,gBACnDtS,EAAI,EAAGA,EAAIuU,EAAoBjkB,OAAQ0P,IAAK,CACzBuU,EAAoBvU,GAC5BoP,MAAMoF,WAAa,SAGvC,IAAMpC,EAAarR,SAASC,eAAe,gBAC3C,GAAKoR,EAAL,CAIAA,EAAWqC,SAAW,WAClB,EAAKf,yBAGT,IAjB4B,EAiBtBgB,EAAgBC,MAAMjV,KAAK0S,EAAWE,uBAAuB,WAC9DsC,OAAOD,MAAMjV,KAAK0S,EAAWE,uBAAuB,kBAErDuC,EAA6B,GApBL,eAsBHH,GAtBG,IAsB5B,2BAAwC,CAAC,IAAhCI,EAA+B,QAE9BC,EAAQ,kBAAkBC,KAAKF,EAAappB,IAClD,GAAMqpB,EAAO,CAET,IAAMxU,EAAewU,EAAM,GACrBE,EAAkBlU,SAASC,eAAT,uBAAwCT,EAAatI,gBAC7E,GAAMgd,EAAiB,CAGnBJ,EAA6B,sBAC7BC,EAAaI,aAAaL,EAA4B,QAEtD,IAAMM,EAAmBL,EAAaM,wBAEtCH,EAAgB7F,MAAMoF,WAAa,UACnCS,EAAgB7F,MAAM7P,KAAtB,UAAgC4V,EAAiB5V,KAAO,EAAxD,MACA0V,EAAgB7F,MAAMe,IAAtB,UAA+BgF,EAAiBhF,IAAM,GAAtD,SAvCgB,8BA6C5B,GAAM0E,EACF,cAAiBF,MAAMjV,KAAK0S,EAAWE,uBAAuB,SAA9D,eAAwE,CAAnE,IAAI+C,EAAI,KAERA,EAAqBjG,MAAMkG,QAAWD,EAAKE,aAAaV,GAAsC,IAAR,UAnOvG,4CAwOI,SAAuC9B,GAInC,IAFA,IAAMvmB,EAAQC,KAAKC,MAAMF,MAEhBwT,EAAI,EAAGA,EAAI+S,EAAMziB,OAAQ0P,IAAK,CACnC,IAAMgT,EAAKD,EAAM/S,GAEX+U,EAAQ,kBAAkBC,KAAKhC,EAAGtnB,IAClCqpB,GAAQ,WAEV,IAAMS,EAAuBT,EAAM,GACnC/B,EAAGC,QAAU,kBAAMzmB,EAAMipB,iBAAiBD,IAC1CxC,EAAG5D,MAAM+D,OAAS,UAJR,QAhP1B,GAAiD/jB,eAAjD,ICaasmB,IAAb,GAiVKliB,KAAOC,MAlVXlH,aACD,kNAGI0E,aAHJ,yDAKI,WAAqB,IAAD,OAGhBxE,KAAKC,MAAMF,MAAM2c,qBAGjBpI,SAAS0S,iBAAiB,UAAU,SAAC1mB,GAEjC,IAAMP,EAAQ,EAAKE,MAAMF,MAEzB,GAAIA,EAAMuc,WAAazD,GAAe3W,KAAtC,CAIA,IAAMgnB,EAAoB5oB,EAAI2E,OAAoBikB,iBAClD,GAAKA,EAAL,CAIkBA,EAAiBC,aAAe3c,OAAO8W,YAAc4F,EAAiBE,UAC7D,KAGvBrpB,EAAM2c,0BAKdpI,SAAS0S,iBAAiB,WAAW,SAAC1mB,GAElC,IAAMP,EAAQ,EAAKE,MAAMF,MACrBA,EAAMuc,WAAazD,GAAewQ,WAAe/oB,EAAIgpB,SAA2B,KAAhBhpB,EAAIipB,SAE7CxpB,EAAMqe,iBACd+E,iBAvC/B,oBA4CI,WAAuB,IAAD,OAEZpjB,EAAQC,KAAKC,MAAMF,MACnBod,EAAYpd,EAAMqe,iBAClBoL,EAAiBzpB,EAAMqe,iBACvBqL,EAAkB1pB,EAAMqe,iBACxBsL,EAAqB3pB,EAAMqe,iBAE3BuL,EAAY3pB,KAAKwE,QAAQM,gBAA0B,QAAR,MAEjD,OAAQ,gCAEJ,gBAAC9D,EAAA,EAAD,CACIC,SAAUlB,EAAMQ,kBAChBW,aAAW,EACXC,OAAQpB,EAAMQ,kBACda,QAAS,kBAAMrB,EAAMQ,uBAAoBc,IAEzC,gBAACC,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAM0S,UAAYqG,GAAc6D,aAAzD,eACA,gBAACrb,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAM0S,UAAYqG,GAAc8D,gBAAzD,mBACA,gBAACtb,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAM0S,UAAYqG,GAAc+D,WAAzD,aACA,gBAACvb,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAM0S,UAAYqG,GAAcgE,cAAzD,iBACA,gBAACxb,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAM0S,UAAYqG,GAAciE,YAAzD,eACA,gBAACzb,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAM0S,UAAYqG,GAAckE,aAAzD,gBACA,gBAAC1b,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAM0S,UAAYqG,GAAcmE,aAAzD,gBACA,gBAAC3b,EAAA,EAAD,CAAUjB,QAAS,kBAAMN,EAAM0S,UAAYqG,GAAcoE,SAAzD,WAGJ,gBAAC0M,EAAA,EAAD,CAAQzpB,MAAM,UAAU0pB,SAAS,SAAShoB,UAAU,cAE/C9B,EAAM0c,WAAc,gBAACqN,GAAA,EAAD,MAAuB,gBAACppB,EAAA,EAAD,CAAK2iB,OAAQ,IAEzD,gBAAC4C,EAAA,EAAD,CAASrF,QAAQ,QAAQ/e,UAAU,eAE/B,gBAACkoB,GAAA,EAAD,CAAMC,WAAS,EAACnoB,UAAU,iBACtB,gBAACkoB,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,IAEX,gBAAChqB,EAAA,EAAD,CAAQuhB,KAAK,QAAQb,QAAQ,WAAW/e,UAAU,4BAC9CxB,QAAS,SAAAC,GAAG,OAAIP,EAAMQ,kBAAoBD,EAAIE,gBAE9C,gBAAC,KAAD,OAGDT,EAAM0S,UACL,gBAAC0X,EAAA,EAAD,CACItoB,UAAU,aACVyD,MAAM,aACN8kB,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1V,KAAK,OACL/P,MAAO7E,KAAKuqB,kBAAkBxqB,EAAM0S,aAGxC,gBAAC,KAAD,CACI5Q,UAAU,aACV2oB,MAAM,EACNC,QAAQ,EACRnlB,MAAK,gBAAWqkB,EAAX,KACLe,mBAAmB,GACnBxmB,OAAQ,sBACRghB,SAAUnlB,EAAM0c,WAChB5X,MAAO7E,KAAKwE,QAAQmmB,UAAU5qB,EAAMwS,UACpCvN,SAAU,SAAC3B,GAAD,OAAOtD,EAAMwS,SAAW,EAAK/N,QAAQomB,UAAUvnB,IACzDwnB,OAAQ,kBAAM9qB,EAAM+qB,iBACpBC,SAAU,kBAAMhrB,EAAM+qB,iBACtBE,WAAYhrB,KAAKirB,kBAK7B,gBAAClB,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIroB,UAAU,wBAEvB9B,EAAM0S,WAAc,gCAElB,gBAACyY,GAAA,EAAD,KACI,gBAAC7D,GAAA,EAAD,CACIpoB,GAAG,gBACH4C,UAAU,gBACVqjB,SAAUnlB,EAAM0c,WAChBY,QAAStd,EAAMorB,gBACfnmB,SAAU,SAAC1E,GAAD,OAASP,EAAMorB,gBAAkB7qB,EAAI2E,OAAOoY,YAI7Dtd,EAAMorB,gBACH,gBAAC,KAAD,CACItpB,UAAU,aACV2oB,MAAM,EACNC,QAAQ,EACRnlB,MAAK,gBAAWqkB,EAAX,KACLe,mBAAmB,GACnBxmB,OAAQ,sBACRghB,SAAUnlB,EAAM0c,WAChB5X,MAAO7E,KAAKwE,QAAQmmB,UAAU5qB,EAAMyS,UACpCxN,SAAU,SAAC3B,GAAD,OAAOtD,EAAMyS,SAAW,EAAKhO,QAAQomB,UAAUvnB,IACzDwnB,OAAQ,kBAAM9qB,EAAMqrB,iBACpBL,SAAU,kBAAMhrB,EAAMqrB,iBACtBJ,WAAYhrB,KAAKirB,iBAGrB,gBAACd,EAAA,EAAD,CACItoB,UAAU,aACVyD,MAAK,gBAAWqkB,EAAX,KACL0B,YAAY,QACZhB,gBAAiB,CAAEC,QAAQ,GAC3B1V,KAAK,OACLsQ,UAAU,OAS9B,gBAAC6E,GAAA,EAAD,CAAMC,WAAS,EAACnoB,UAAU,iBACtB,gBAACkoB,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,IACX,gBAACgB,GAAA,EAAD,KACI,gBAACI,GAAA,EAAD,CAAYC,QAAQ,0BAApB,mBACA,gBAACC,GAAA,EAAD,CACI3pB,UAAU,uCACVqjB,SAAUnlB,EAAM0c,WAChB5X,MAAO9E,EAAM0rB,eACbzmB,SAAU,SAAC1E,GAAD,OAASP,EAAM0rB,eAAiBnrB,EAAI2E,OAAOJ,OACrD6mB,WAAY,CAAEzsB,GAAI,2BAElB,gBAACqC,EAAA,EAAD,CAAUuD,MAAM,KAAhB,kBACCgC,GAAiC/H,KAAI,SAAA8iB,GAClC,OAAQ,gBAACtgB,EAAA,EAAD,CAAUgB,IAAKsf,EAAK/c,MAAO+c,GAAMA,QAKrD,gBAACsJ,GAAA,EAAD,CAAarpB,UAAU,8BACnB,gBAACypB,GAAA,EAAD,CAAYC,QAAQ,0BAApB,mBACA,gBAACC,GAAA,EAAD,CACI3pB,UAAU,iBACVqjB,SAAUnlB,EAAM0c,WAChB5X,MAAO9E,EAAM4rB,eACb3mB,SAAU,SAAC1E,GAAD,OAASP,EAAM4rB,eAAiBrrB,EAAI2E,OAAOJ,OACrD6mB,WAAY,CAAEzsB,GAAI,2BAClB,gBAACqC,EAAA,EAAD,CAAUuD,MAAO+T,GAAmBkF,QAApC,UACA,gBAACxc,EAAA,EAAD,CAAUuD,MAAO+T,GAAmBmF,YAApC,eACA,gBAACzc,EAAA,EAAD,CAAUuD,MAAO+T,GAAmBoF,UAApC,YACA,gBAAC1c,EAAA,EAAD,CAAUuD,MAAO+T,GAAmBqF,WAApC,cACA,gBAAC3c,EAAA,EAAD,CAAUuD,MAAO+T,GAAmBsF,eAApC,mBACA,gBAAC5c,EAAA,EAAD,CAAUuD,MAAO+T,GAAmBuF,aAApC,mBAIZ,gBAAC4L,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIroB,UAAU,uBACzB,gBAACsoB,EAAA,EAAD,CACItoB,UAAU,qBACVyD,MAAM,eACN+kB,gBAAiB,CAAEC,QAAQ,GAC3Be,YAAY,wBACZnG,SAAmC,MAAzBnlB,EAAM0rB,gBAA0B1rB,EAAM0c,WAChD5X,MAAO9E,EAAM6rB,YACb5mB,SAAU,SAAC1E,GAAD,OAASP,EAAM6rB,YAActrB,EAAI2E,OAAOJ,OAClDgmB,OAAQ,kBAAM9qB,EAAM8rB,oBACpBb,WAAYhrB,KAAKirB,mBAK7B,gBAAC7D,GAAA,EAAD,CAAWvlB,UAAU,gCAEjB,gBAACypB,GAAA,EAAD,CAAYzpB,UAAU,qCAAqCyoB,QAAQ,GAAnE,eAAuFvqB,EAAM+rB,aAAP,YAAgC/rB,EAAM+rB,aAAajoB,OAAnD,cAAsB,IAE5G,gBAACujB,GAAA,EAAD,CAAWvlB,UAAU,wCAAwCkqB,SAAU,kBAAMhsB,EAAMisB,6BAC/E,gBAAC7mB,EAAA,EAAD,CACIC,QAAS,gBAACiiB,GAAA,EAAD,CAAUxlB,UAAU,kBAAkBqjB,SAAUnlB,EAAM0c,WAAYY,QAAStd,EAAMksB,kBACtFjnB,SAAU,SAAC1E,GAAD,OAASP,EAAMmsB,iBAAiB5rB,EAAI2E,OAAOoY,YAEzD/X,MAAM,UAGTO,GAAgB/G,KAAI,SAAAse,GAAM,OAAK,gBAACjY,EAAA,EAAD,CAAkB7C,IAAK8a,EACnDhY,QAAS,gBAACiiB,GAAA,EAAD,CAAUxlB,UAAU,kBAAkBqjB,SAAUnlB,EAAM0c,WAAYY,QAAStd,EAAMksB,gBAAgB7O,GACtGpY,SAAU,SAAC1E,GAAD,OAASP,EAAMmsB,iBAAiB5rB,EAAI2E,OAAOoY,QAASD,MAElE9X,MAAO,iBAAmB8X,OAG9B,gBAACjY,EAAA,EAAD,CACIC,QAAS,gBAACiiB,GAAA,EAAD,CAAUxlB,UAAU,kBAAkBqjB,SAAUnlB,EAAM0c,WAAYY,QAAStd,EAAMksB,gBAAgB,mBACtGjnB,SAAU,SAAC1E,GAAD,OAASP,EAAMmsB,iBAAiB5rB,EAAI2E,OAAOoY,QAAS,sBAElE/X,MAAM,uBAMlB,gBAACxE,EAAA,EAAD,CAAY6hB,MAAO,CAAEuD,KAAM,KAE3B,gBAAC6D,GAAA,EAAD,CAAMC,WAAS,EAACnoB,UAAU,iBACtB,gBAACkoB,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,IACX,gBAACgB,GAAA,EAAD,CAAarpB,UAAU,4BACnB,gBAACypB,GAAA,EAAD,CAAYC,QAAQ,uBAApB,gBACA,gBAACC,GAAA,EAAD,CACI3pB,UAAU,qBACV6pB,WAAY,CAAEzsB,GAAI,uBAClB4F,MAAO9E,EAAMosB,YACbnnB,SAAU,SAAC1E,GAAD,OAASP,EAAMosB,YAAc7rB,EAAI2E,OAAOJ,QAElD,gBAACvD,EAAA,EAAD,CAAUuD,MAAO,GAAjB,SACA,gBAACvD,EAAA,EAAD,CAAUuD,MAAO,GAAjB,gBACA,gBAACvD,EAAA,EAAD,CAAUuD,MAAO,GAAjB,gBACA,gBAACvD,EAAA,EAAD,CAAUuD,MAAO,IAAjB,oBAIZ,gBAACklB,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIroB,UAAU,uBACzB,gBAAC3B,EAAA,EAAD,CACI2B,UAAU,0CACV+e,QAAQ,WACRzgB,MAAM,UACNshB,KAAK,QACLphB,QAAS,kBAAMN,EAAM0c,WAAa1c,EAAMiT,SAAWjT,EAAMoT,yBAExDpT,EAAM0c,WAAc,gBAAC,KAAD,MAA2B,gBAAC,KAAD,WAQpE,gBAACmN,EAAA,EAAD,CAAQzpB,MAAM,UAAU0pB,SAAS,UAC7B,gBAACuC,GAAA,EAAD,CAAMvqB,UAAU,cAAcgD,MAAO9E,EAAMuc,SAAUtX,SAAU,SAACqnB,EAA2BlpB,GAA5B,OAAoCpD,EAAMuc,SAAWnZ,IAEhH,gBAACmpB,GAAA,EAAD,CAAKzqB,UAAU,cAAcqjB,SAAUnlB,EAAM0c,WAAYnX,MAAO,gBAACxE,EAAA,EAAD,CAAYX,MAAM,cAAcygB,QAAQ,aAAxC,UAChE,gBAAC0L,GAAA,EAAD,CAAKzqB,UAAU,cAAcqjB,SAAUnlB,EAAM0c,WAAYnX,MAAO,gBAACxE,EAAA,EAAD,CAAYX,MAAM,cAAcygB,QAAQ,aAAxC,oBAChE,gBAAC0L,GAAA,EAAD,CAAKzqB,UAAU,cAAcqjB,SAAUnlB,EAAM0c,WAAYnX,MAAO,gBAACxE,EAAA,EAAD,CAAYX,MAAM,cAAcygB,QAAQ,aAAxC,mBAE7D7gB,EAAMwsB,0BACL,gBAACD,GAAA,EAAD,CAAKzqB,UAAU,cAAcqjB,SAAUnlB,EAAM0c,WAAYnX,MAAO,gBAACxE,EAAA,EAAD,CAAYX,MAAM,cAAcygB,QAAQ,aAAxC,uBAM3E7gB,EAAMuc,WAAazD,GAAe3W,MAAS,gCAExC,gBAAC,GAAD,CAAoBnC,MAAOod,EAAWoE,oBAAqBxhB,EAAMwhB,oBAAqBxN,cAAehU,EAAMgU,gBAE1GhU,EAAM0c,YAAgBU,EAAU4D,eAAeld,OAAU,gBAACimB,GAAA,EAAD,MAAuB,gBAACppB,EAAA,EAAD,CAAK2iB,OAAQ,KAIjGtjB,EAAMuc,WAAazD,GAAewQ,WAC9B,gBAAC,GAAD,CAAyBtpB,MAAOypB,IAGpCzpB,EAAMuc,WAAazD,GAAe2T,OAC9B,gBAAC,GAAD,CACGzsB,MAAO0pB,EACPhN,WAAY1c,EAAM0c,WAClB0I,SAAQ,sBAAiBplB,EAAMwS,SAASrO,OAAO,uBAAvC,YAAiEnE,EAAMyS,SAAStO,OAAO,wBAC/F6P,cAAehU,EAAMgU,gBAI5BhU,EAAMuc,WAAazD,GAAe4T,eAC9B,gBAAC,GAAD,CACG1sB,MAAO2pB,EACPjN,WAAY1c,EAAM0c,WAClB0I,SAAQ,yBAAoBplB,EAAMwS,SAASrO,OAAO,uBAA1C,YAAoEnE,EAAMyS,SAAStO,OAAO,wBAClG6P,cAAehU,EAAMgU,gBAI7B,gBAACkS,EAAA,EAAD,CAASrF,QAAQ,UAEjB,gBAAC,GAAD,CAAc7gB,MAAOC,KAAKC,MAAMF,WA/T5C,+BAoUI,SAA0B0S,GACtB,OAAQA,GACJ,KAAKqG,GAAc6D,WAAY,MAAO,cACtC,KAAK7D,GAAc8D,cAAe,MAAO,kBACzC,KAAK9D,GAAc+D,SAAU,MAAO,YACpC,KAAK/D,GAAcgE,YAAa,MAAO,gBACvC,KAAKhE,GAAciE,UAAW,MAAO,cACrC,KAAKjE,GAAckE,WAAY,MAAO,eACtC,KAAKlE,GAAcmE,WAAY,MAAO,eACtC,QAAS,MAAO,MA7U5B,4BAiVI,SACuByP,GACD,UAAdA,EAAMpqB,MAENoqB,EAAMC,iBAEN3sB,KAAKC,MAAMF,MAAMoT,4BAvV7B,GAAoCxQ,aAApC,GAEWgD,YAActB,GAFzB,gJCrBauoB,I,OADZ9sB,YACD,+JAEI,WACI,IAAMC,EAAQC,KAAKC,MAAMF,MAEzB,OAAQ,gCAEHC,KAAK6sB,cAAc9sB,GAEpB,gBAACG,EAAA,EAAD,CAAQ0gB,QAAQ,WAAWzgB,MAAM,UAAUshB,KAAK,SAASyD,SAAUllB,KAAKC,MAAMilB,SAAU7kB,QAAS,kBAAMN,EAAM+sB,uBAAwB,IAArI,SAGA,gBAACpsB,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACT,EAAA,EAAD,CAAQ0gB,QAAQ,WAAWzgB,MAAM,UAAUshB,KAAK,SAASyD,SAAUllB,KAAKC,MAAMilB,SAAU7kB,QAAS,kBAAMN,EAAMgtB,sBAAuB,IAApI,kBAbZ,2BAmBI,SAAsBhtB,GAClB,OAAQ,gCAEJ,gBAACyB,EAAA,EAAD,CACIL,KAAMpB,EAAM+sB,sBACZ1rB,QAAS,kBAAMrB,EAAM+sB,uBAAwB,IAE7C,gBAAC7qB,EAAA,EAAD,sBACA,gBAACP,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,sCACmChC,EAAM6f,gBADzC,yGAIJ,gBAACS,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM+sB,uBAAwB,GAAO3sB,MAAM,UAAU6sB,WAAS,GAArF,UAGA,gBAAC9sB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMktB,SAAS9sB,MAAM,aAA5C,gBAMR,gBAACqB,EAAA,EAAD,CACIue,WAAW,EACX5e,KAAMpB,EAAMgtB,qBACZ3rB,QAAS,kBAAMrB,EAAMgtB,sBAAuB,IAE5C,gBAAC9qB,EAAA,EAAD,oBACA,gBAACP,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,qDAIA,gBAACooB,EAAA,EAAD,CACI6C,WAAS,EACTvJ,OAAO,QACPne,MAAM,cACN+kB,gBAAiB,CAAEC,QAAQ,GAC3BvK,WAAS,EACTlb,MAAO9E,EAAMmtB,UACbloB,SAAU,SAAC1E,GAAD,OAASP,EAAMmtB,UAAY5sB,EAAI2E,OAAOJ,SAGpD,gBAACslB,EAAA,EAAD,CACI1G,OAAO,QACPne,MAAM,qBACN+kB,gBAAiB,CAAEC,QAAQ,GAC3BvK,WAAS,EACTI,WAAS,EACTgN,KAAM,EACNtoB,MAAO9E,EAAMqtB,UACbpoB,SAAU,SAAC1E,GAAD,OAASP,EAAMqtB,UAAY9sB,EAAI2E,OAAOJ,UAIxD,gBAACwb,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMgtB,sBAAuB,GAAO5sB,MAAM,WAAjE,UAGA,gBAACD,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMstB,cAAcnI,UAAWnlB,EAAMmtB,UAAW/sB,MAAM,aAA7E,eA/EpB,GAA0CwC,eAA1C,ICDa2qB,GADZxtB,YACD,+JAEI,WAAuB,IAAD,IACZytB,EAAUvtB,KAAKC,MAAMstB,QAErBC,EAAqB1O,GAAqByO,EAAQrnB,eAExD,OAAQ,gCACJ,gBAAC6jB,GAAA,EAAD,CAAMC,WAAS,EAACnoB,UAAU,kBACtB,gBAACkoB,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIuD,GAAI,GAAIC,GAAI,EAAGC,cAAY,EAAC9rB,UAAU,aACrD,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,gBACNT,MAAK,UAAE0oB,EAAQtnB,gBAAV,aAAE,EAAkBD,KACzByd,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,KAIjB,gBAACgK,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIuD,GAAI,EAAGC,GAAI,EAAGC,cAAY,EAAC9rB,UAAU,aACpD,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,eACNT,MAAK,UAAE0oB,EAAQtnB,gBAAV,aAAE,EAAkB3D,IACzBmhB,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,KAIjB,gBAACgK,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIuD,GAAI,EAAGC,GAAI,EAAGC,cAAY,EAAC9rB,UAAU,aACpD,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,cACNT,MAAO0oB,EAAQ/mB,YACfid,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,KAGjB,gBAACgK,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIuD,GAAI,EAAGC,GAAI,EAAGC,cAAY,EAAC9rB,UAAU,aACpD,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,kBACNT,MAAO0oB,EAAQ9mB,gBACfgd,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,KAGjB,gBAACgK,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIuD,GAAI,EAAGC,GAAI,EAAGC,cAAY,EAAC9rB,UAAU,aACpD,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,gBACNT,MAAO0oB,EAAQrnB,cACfud,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,EACT4C,MAAO6K,KAIf,gBAACzD,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIyD,cAAY,EAAC9rB,UAAU,aACtC,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,QACNT,MAAO6T,KAAKC,UAAU4U,EAAQlnB,MAAO,KAAM,GAC3Cod,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,EACTI,WAAS,EACTM,QAAS,MAGjB,gBAACsJ,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIyD,cAAY,EAAC9rB,UAAU,aACtC,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,eACNT,MAAO6T,KAAKC,UAAU4U,EAAQjnB,aAAc,KAAM,GAClDmd,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,EACTI,WAAS,EACTM,QAAS,YA3FjC,GAAyC9d,eAAzC,GCEairB,GADZ9tB,YACD,+JAEI,WACI,IAAMC,EAAQC,KAAKC,MAAMF,MAEzB,OAAQ,gCAEHC,KAAK6sB,cAAc9sB,GAEpB,gBAACG,EAAA,EAAD,CAAQ0gB,QAAQ,WAAWzgB,MAAM,UAAUshB,KAAK,SAASyD,SAAUllB,KAAKC,MAAMilB,SAAU7kB,QAAS,kBAAMN,EAAM8tB,mBAAoB,IAAjI,WAGA,gBAACntB,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACT,EAAA,EAAD,CAAQ0gB,QAAQ,WAAWzgB,MAAM,UAAUshB,KAAK,SAASyD,SAAUllB,KAAKC,MAAMilB,SAAU7kB,QAAS,kBAAMN,EAAM+tB,wBAAyB,IAAtI,UAGA,gBAACptB,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACT,EAAA,EAAD,CAAQ0gB,QAAQ,WAAWzgB,MAAM,UAAUshB,KAAK,SAASyD,SAAUllB,KAAKC,MAAMilB,SAAU7kB,QAAS,kBAAMN,EAAMguB,2BAA4B,IAAzI,aAGA,gBAACrtB,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACT,EAAA,EAAD,CAAQ0gB,QAAQ,WAAWzgB,MAAM,UAAUshB,KAAK,SAASyD,SAAUllB,KAAKC,MAAMilB,SAAU7kB,QAAS,kBAAMN,EAAMgtB,sBAAuB,IAApI,eAGA,gBAACrsB,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACT,EAAA,EAAD,CAAQ0gB,QAAQ,WAAWzgB,MAAM,UAAUshB,KAAK,SAASyD,SAAUllB,KAAKC,MAAMilB,SAAU7kB,QAAS,kBAAMN,EAAMiuB,2BAA4B,IAAzI,qBAGA,gBAACttB,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACT,EAAA,EAAD,CAAQ0gB,QAAQ,WAAWzgB,MAAM,UAAUshB,KAAK,SAASyD,SAAUllB,KAAKC,MAAMilB,SAAU7kB,QAAS,kBAAMN,EAAM+sB,uBAAwB,IAArI,YA7BZ,2BAoCI,SAAsB/sB,GAClB,OAAQ,gCAEJ,gBAACyB,EAAA,EAAD,CACIL,KAAMpB,EAAM+tB,uBACZ1sB,QAAS,kBAAMrB,EAAM+tB,wBAAyB,IAE9C,gBAAC7rB,EAAA,EAAD,uBACA,gBAACP,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,8CAC2ChC,EAAM6f,gBADjD,qBAIJ,gBAACS,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM+tB,wBAAyB,GAAO3tB,MAAM,UAAU6sB,WAAS,GAAtF,UAGA,gBAAC9sB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMkuB,UAAU9tB,MAAM,aAA7C,iBAMR,gBAACqB,EAAA,EAAD,CACIL,KAAMpB,EAAMguB,0BACZ3sB,QAAS,kBAAMrB,EAAMguB,2BAA4B,IAEjD,gBAAC9rB,EAAA,EAAD,0BACA,gBAACP,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,iDAC8ChC,EAAM6f,gBADpD,sDAIJ,gBAACS,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMguB,2BAA4B,GAAO5tB,MAAM,UAAU6sB,WAAS,GAAzF,UAGA,gBAAC9sB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMmuB,aAAa/tB,MAAM,aAAhD,oBAMR,gBAACqB,EAAA,EAAD,CACIue,WAAW,EACX5e,KAAMpB,EAAMgtB,qBACZ3rB,QAAS,kBAAMrB,EAAMgtB,sBAAuB,IAE5C,gBAAC9qB,EAAA,EAAD,oBACA,gBAACP,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,oDAIA,gBAACooB,EAAA,EAAD,CACI6C,WAAS,EACTvJ,OAAO,QACPne,MAAM,aACN+kB,gBAAiB,CAAEC,QAAQ,GAC3BvK,WAAS,EACTlb,MAAO9E,EAAMmtB,UACbloB,SAAU,SAAC1E,GAAD,OAASP,EAAMmtB,UAAY5sB,EAAI2E,OAAOJ,SAGpD,gBAACslB,EAAA,EAAD,CACI1G,OAAO,QACPne,MAAM,oBACN+kB,gBAAiB,CAAEC,QAAQ,GAC3BvK,WAAS,EACTI,WAAS,EACTgN,KAAM,EACNtoB,MAAO9E,EAAMqtB,UACbpoB,SAAU,SAAC1E,GAAD,OAASP,EAAMqtB,UAAY9sB,EAAI2E,OAAOJ,UAIxD,gBAACwb,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMgtB,sBAAuB,GAAO5sB,MAAM,WAAjE,UAGA,gBAACD,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMstB,cAAcnI,UAAWnlB,EAAMmtB,UAAW/sB,MAAM,aAA7E,WAMR,gBAACqB,EAAA,EAAD,CACIue,WAAW,EACX5e,KAAMpB,EAAMiuB,0BACZ5sB,QAAS,kBAAMrB,EAAMiuB,2BAA4B,IAEjD,gBAAC/rB,EAAA,EAAD,yBACA,gBAACP,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,iKAIA,gBAACooB,EAAA,EAAD,CACI1G,OAAO,QACP4G,gBAAiB,CAAEC,QAAQ,GAC3BhlB,MAAM,0BACNya,WAAS,EACTI,WAAS,EACTgN,KAAM,GACNtoB,MAAO9E,EAAMouB,gBACbnpB,SAAU,SAAC1E,GAAD,OAASP,EAAMouB,gBAAkB7tB,EAAI2E,OAAOJ,UAI9D,gBAACwb,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMiuB,2BAA4B,GAAO7tB,MAAM,WAAtE,UAGA,gBAACD,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMquB,mBAAmBlJ,UAAWnlB,EAAMsuB,oBAAqBluB,MAAM,aAA5F,WAMR,gBAACqB,EAAA,EAAD,CACIL,KAAMpB,EAAM+sB,sBACZ1rB,QAAS,kBAAMrB,EAAM+sB,uBAAwB,IAE7C,gBAAC7qB,EAAA,EAAD,sBACA,gBAACP,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,6CAC0ChC,EAAM6f,gBADhD,gHAIJ,gBAACS,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM+sB,uBAAwB,GAAO3sB,MAAM,UAAU6sB,WAAS,GAArF,UAGA,gBAAC9sB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMktB,SAAS9sB,MAAM,aAA5C,gBAMR,gBAACqB,EAAA,EAAD,CACIL,KAAMpB,EAAM8tB,kBACZzsB,QAAS,kBAAMrB,EAAM8tB,mBAAoB,IAEzC,gBAAC5rB,EAAA,EAAD,wBACA,gBAACP,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,+CAC4ChC,EAAM6f,gBADlD,oBAIA,gBAACza,EAAA,EAAD,CAAkBC,QAAS,gBAACiiB,GAAA,EAAD,CACvBhK,QAAStd,EAAMuuB,yBACftpB,SAAU,SAAC1E,GAAD,OAASP,EAAMuuB,yBAA2BhuB,EAAI2E,OAAOoY,WAC/D/X,MAAM,iCAId,gBAAC+a,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM8tB,mBAAoB,GAAO1tB,MAAM,UAAU6sB,WAAS,GAAjF,UAGA,gBAAC9sB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMwuB,WAAWpuB,MAAM,aAA9C,kBApMpB,GAA0CwC,eAA1C,I,SLTY8iB,O,qBAAAA,I,mCAAAA,I,kCAAAA,Q,KMcL,I,2NCQF+I,GDRQC,GADZ3uB,aACD,kNAGI0E,aAHJ,yDAKI,WAAqB,IAAD,OAGhB8P,SAAS0S,iBAAiB,UAAU,SAAC1mB,GAEjC,IAAM4oB,EAAoB5oB,EAAI2E,OAAoBikB,iBAClD,GAAKA,EAAL,CAIkBA,EAAiBC,aAAe3c,OAAO8W,YAAc4F,EAAiBE,UAC7D,IAGvB,EAAKnpB,MAAMF,MAAM2uB,oBAnBjC,oBAwBI,WAEI,IAAM3uB,EAAQC,KAAKC,MAAMF,MAEnB4uB,EAAa5uB,EAAM6uB,kBACnBrB,EAAUxtB,EAAMwtB,QAChBhT,EAAUxa,EAAMwa,QAChBsU,EAAatU,EAAQ1W,OAErB2pB,EAAqB1O,GAAqByO,EAAQrnB,eAExD,OAAQ,gCACJ,gBAAC6jB,GAAA,EAAD,CAAMC,WAAS,EAACnoB,UAAU,kBACtB,gBAACkoB,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIuD,GAAI,GAAIC,GAAI,EAAGC,cAAY,EAAC9rB,UAAU,aACrD,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,aACNT,MAAO0oB,EAAQxnB,WACf0d,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,KAGjB,gBAACgK,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIuD,GAAI,GAAIC,GAAI,EAAGC,cAAY,EAAC9rB,UAAU,aACrD,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,OACNT,MAAO0oB,EAAQvnB,KACfyd,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,KAGjB,gBAACgK,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIuD,GAAI,EAAGC,GAAI,EAAGC,cAAY,EAAC9rB,UAAU,aACpD,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,cACNT,MAAO7E,KAAKwE,QAAQoe,qBAAqB2K,EAAQ/mB,aACjDid,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,KAGjB,gBAACgK,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIuD,GAAI,EAAGC,GAAI,EAAGC,cAAY,EAAC9rB,UAAU,aACpD,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,kBACNT,MAAO7E,KAAKwE,QAAQoe,qBAAqB2K,EAAQ9mB,iBACjDgd,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,KAGjB,gBAACgK,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIuD,GAAI,EAAGC,GAAI,EAAGC,cAAY,EAAC9rB,UAAU,aACpD,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,gBACNT,MAAO0oB,EAAQrnB,cACfud,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,EACT4C,MAAO6K,KAGf,gBAACzD,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIyD,cAAY,EAAC9rB,UAAU,aACtC,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,QACNT,MAAO6T,KAAKC,UAAU4U,EAAQlnB,MAAO,KAAM,GAC3Cod,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,EACTI,WAAS,EACTM,QAAS,KAGjB,gBAACsJ,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIyD,cAAY,EAAC9rB,UAAU,aACtC,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,SACNT,MAAO6T,KAAKC,UAAU4U,EAAQhnB,OAAQ,KAAM,GAC5Ckd,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,EACTI,WAAS,EACTM,QAAS,KAGjB,gBAACsJ,GAAA,EAAD,CAAME,MAAI,EAACC,GAAI,GAAIyD,cAAY,EAAC9rB,UAAU,aACtC,gBAACsoB,EAAA,EAAD,CACI7kB,MAAM,eACNT,MAAO6T,KAAKC,UAAU4U,EAAQjnB,aAAc,KAAM,GAClDmd,OAAO,SACP2G,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3B1J,QAAQ,WACRb,WAAS,EACTI,WAAS,EACTM,QAAS,MAKrB,gBAACK,GAAA,EAAD,CAAgBjf,UAAU,8BAA1B,kBACuB8sB,GAAcA,IAAeE,EAA/B,UAAsGA,EAAtG,eAAuHF,EAAvH,0BAAgDE,EAAhD,iBAAoEF,EAAwB,GAAX,aAGnGpU,EAAQ1W,QAAU7D,KAAKohB,YAAY7G,GAEtC,gBAAC,GAAD,CAAgBxa,MAAOA,EAAMshB,yBA5IzC,6BAiJI,SAAwBqL,GAA8B,IAAD,EAEjD,OAAMA,EAAMoC,KACDpC,EAAMoC,KAGjB,UAAOpC,EAAMqC,oBAAb,QAA6B,KAvJrC,6BA0JI,SAAwBrC,GAEpB,IAAM3sB,EAAQC,KAAKC,MAAMF,MACnB+T,EAAe9T,KAAKsR,gBAAgBob,GAE1C,OAAMA,EAAMsC,mBACA,gBAAC,GAAD,CAAmBpP,gBAAiB8M,EAAMsC,mBAC9CnuB,MAAOiT,EACPC,cAAehU,EAAMgU,gBAIvBhU,EAAMkvB,cAAcnb,GAGd,gBAACvR,EAAA,EAAD,CAAMV,UAAU,2BACpB1B,MAA8B,SAAvBse,GAAME,QAAQ/J,KAAkB,UAAY,UACnDvU,QAAS,WAAQN,EAAMipB,iBAAiBlV,KAEvCA,GAIFA,IAjLf,yBAoLI,SAAoBob,GAAsC,IAAD,OAErD,OACI,gBAAC1N,GAAA,EAAD,CAAOC,KAAK,SACR,gBAACC,GAAA,EAAD,KACI,gBAACC,GAAA,EAAD,KACK/b,GAAmB9G,KAAI,SAAA8iB,GACpB,OAAO,gBAACE,GAAA,EAAD,CAAWxf,IAAKsf,GAAMA,QAIzC,gBAACU,GAAA,EAAD,KACK4M,EAAOpwB,KAAI,SAAC4tB,EAAqByC,GAE9B,IAAM1M,EAAY,CAAEC,cAAe,OACnC,OACI,gBAACf,GAAA,EAAD,CAAUrf,IAAK6sB,GACX,gBAACrN,GAAA,EAAD,CAAWa,MAAOF,GACb,EAAKje,QAAQoe,qBAAqB8J,EAAM0C,YAE7C,gBAACtN,GAAA,EAAD,CAAWa,MAAOF,GACbiK,EAAM2C,WAEX,gBAACvN,GAAA,EAAD,CAAWa,MAAOF,GACbiK,EAAM4C,SAEX,gBAACxN,GAAA,EAAD,CAAWjgB,UAAU,YAAY8gB,MAAOF,GACnC,EAAK8M,gBAAgB7C,IAE1B,gBAAC5K,GAAA,EAAD,CAAWa,MAAOF,GACb,EAAKje,QAAQoe,qBAAqB8J,EAAM8C,gBAE7C,gBAAC1N,GAAA,EAAD,CAAWjgB,UAAU,iBAAiB8gB,MAAOF,GACxC3C,GAAe+C,WAAW6J,EAAM+C,OAAhC,UAA2C/C,EAAM2C,UAAjD,cAAgE,EAAK/d,gBAAgBob,GAArF,cAAiG9mB,GAAmB,IAAM,EAAK3F,MAAMF,MAAMshB,sBAEhJ,gBAACS,GAAA,EAAD,CAAWjgB,UAAU,iBAAiB8gB,MAAOF,GACxC3C,GAAe+C,WAAW6J,EAAMgD,QAAhC,UAA4ChD,EAAM2C,UAAlD,cAAiE,EAAK/d,gBAAgBob,GAAtF,cAAkG9mB,GAAmB,IAAM,EAAK3F,MAAMF,MAAMshB,gCAxNjL,GAAyC1e,aAAzC,GAEWgD,YAActB,GAFzB,YECasrB,GADZ7vB,YACD,+MA6GqB8mB,aAAenH,GAA0B,WA7G9D,EA8GqBoH,eAAiBpH,GAA0B,aA9GhE,EA+GqBqH,YAAcrH,GAA0B,UA/G7D,EAgHqBsH,WAAatH,GAA0B,cAhH5D,EAiHqBmQ,cAAgBnQ,GAA0B,YAjH/D,uDAEI,WAEIjT,OAAOwa,iBAAiB,SAAUhnB,KAAKinB,uBACvCjnB,KAAKinB,0BALb,kCAQI,WAEIza,OAAO0a,oBAAoB,SAAUlnB,KAAKinB,yBAVlD,gCAaI,WAEIjnB,KAAKinB,wBAEL,IAAMtB,EAAarR,SAASC,eAAe,gBACrCoR,IAEF3lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,iBACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,WACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aAxBlF,oBA4BI,WAEI,IAAM9lB,EAAQC,KAAKC,MAAMF,MAEzB,OAAQ,gCAEJ,gBAAC+gB,GAAA,EAAD,CAAgBjf,UAAU,8BAA1B,cACe,gBAACU,EAAA,EAAD,CACPqe,QAAQ,UACRpe,KAAK,oDAFE,yBAQZzC,EAAMonB,iBACL,gBAACC,GAAA,EAAD,CAAWxiB,KAAG,EAAC/C,UAAU,kBAErB,gBAACsD,EAAA,EAAD,CACIC,QAAS,gBAACiiB,GAAA,EAAD,CACLlnB,MAAM,UACN+kB,SAAUllB,KAAKC,MAAMwc,WACrBY,QAAStd,EAAMunB,gBACftiB,SAAU,SAAC1E,GAAD,OAASP,EAAMunB,gBAAkBhnB,EAAI2E,OAAOoY,WAE1D/X,MAAM,mBAGV,gBAACH,EAAA,EAAD,CACIC,QAAS,gBAACiiB,GAAA,EAAD,CACLlnB,MAAM,UACN+kB,SAAUllB,KAAKC,MAAMwc,WACrBY,QAAStd,EAAMwnB,cACfviB,SAAU,SAAC1E,GAAD,OAASP,EAAMwnB,cAAgBjnB,EAAI2E,OAAOoY,WAExD/X,MAAM,kBAOjBtF,KAAKynB,kBAEH1nB,EAAM2nB,YAAe,gCACpB,uBACI7lB,UAAU,cACV8gB,MAAO/D,GACPmH,wBAAyB,CAAEC,OAAQR,GAAazlB,EAAM2nB,eAG1D,gBAACzB,EAAA,EAAD,CAASrF,QAAQ,SAEb,gBAAC9f,EAAA,EAAD,CAAY6hB,MAAO,CAAEuD,KAAM,KAE3B,gBAAChmB,EAAA,EAAD,CACI0gB,QAAQ,WACRzgB,MAAM,UACN+kB,SAAUllB,KAAKC,MAAMwc,WACrBpc,QAAS,kBAAMmM,OAAO2Z,UAAUC,UAAUC,UAAUtmB,EAAM8Z,eAE1D,gBAAC,KAAD,MACA,gBAACnZ,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACG,EAAA,EAAD,CAAYX,MAAM,WAAlB,mCAGJ,gBAACO,EAAA,EAAD,CAAKC,MAAO,KAEZ,gBAAC,GAAD,CACImQ,IAAK0U,GAAazlB,EAAM2nB,YACxBvC,SAAUnlB,KAAKC,MAAMklB,SACrB1I,WAAYzc,KAAKC,MAAMwc,WACvB1I,cAAe/T,KAAKC,MAAM8T,gBAG9B,gBAACrT,EAAA,EAAD,CAAKC,MAAO,UAvGhC,2BAmHI,WAAwC,IAAD,OAE7BZ,EAAQC,KAAKC,MAAMF,MAEzB,OAAON,OAAOD,KAAKO,EAAM4Z,SAAS7a,KAAI,SAAAgV,GAAiB,IAAD,QAE5C+T,EAAS9nB,EAAM4Z,QAAQ7F,GACvB+b,GAAiB,UAAChI,EAAO7O,iBAAR,QAAqB,IAArB,UAA2B6O,EAAO5O,eAAlC,QAA6C,IAA7C,UAAmD4O,EAAO3O,cAA1D,QAAoE,IAApE,UAA0E2O,EAAO1O,aAAjF,QAA0F,GAEjH,OAAQ,wBAAMla,GAAE,uBAAkB6U,EAAatI,eAAiBlJ,IAAG,uBAAkBwR,GAAgBjS,UAAU,kBAExGgmB,EAAO7O,WACN,gBAACpY,EAAA,EAAD,CAASC,MAA0B,IAAnBgvB,EAAA,iDACZ,gBAACjI,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO,EAAKkE,eAAgBjG,QAAQ,WAAWa,KAAK,QAC/Enc,MAA0B,IAAnBuqB,EAAA,sBAAwChI,EAAO7O,gBAI/D6O,EAAO5O,SACN,gBAACrY,EAAA,EAAD,CAASC,MAA0B,IAAnBgvB,EAAA,+CACZ,gBAACjI,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO,EAAKiE,aAAchG,QAAQ,WAAWa,KAAK,QAC7Enc,MAA0B,IAAnBuqB,EAAA,oBAAsChI,EAAO5O,cAI7D4O,EAAO3O,QACN,gBAACtY,EAAA,EAAD,CAASC,MAA0B,IAAnBgvB,EAAA,8CACZ,gBAACjI,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO,EAAKmE,YAAalG,QAAQ,WAAWa,KAAK,QAC5Enc,MAA0B,IAAnBuqB,EAAA,mBAAqChI,EAAO3O,aAI5D2O,EAAO1O,OACN,gBAACvY,EAAA,EAAD,CAASC,MAA0B,IAAnBgvB,EAAA,4DACZ,gBAACjI,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO,EAAKoE,WAAYnG,QAAQ,WAAWa,KAAK,QAC3Enc,MAA0B,IAAnBuqB,EAAA,gBAAkChI,EAAO1O,YAKzD0O,EAAOnhB,UACN,gBAAC9F,EAAA,EAAD,CAASC,MAA0B,IAAnBgvB,EAAA,2BACZ,gBAACjI,GAAA,EAAD,CAAM/lB,UAAU,eAAe8gB,MAAO,EAAKiN,cAAehP,QAAQ,WAAWa,KAAK,QAC9Enc,MAAOoC,GAAgB0I,eAAeyX,EAAOnhB,mBA9JzE,mCAuKI,WAGI,IAH6B,IAAD,OAEtBohB,EAAsBxT,SAASuR,uBAAuB,gBACnDtS,EAAI,EAAGA,EAAIuU,EAAoBjkB,OAAQ0P,IAAK,CACzBuU,EAAoBvU,GAC5BoP,MAAMoF,WAAa,SAGvC,IAAMpC,EAAarR,SAASC,eAAe,gBAC3C,GAAKoR,EAAL,CAIAA,EAAWqC,SAAW,WAClB,EAAKf,yBAGT,IAjB4B,EAiBtBgB,EAAgBC,MAAMjV,KAAK0S,EAAWE,uBAAuB,WAC9DsC,OAAOD,MAAMjV,KAAK0S,EAAWE,uBAAuB,kBACpDsC,OAAOD,MAAMjV,KAAK0S,EAAWE,uBAAuB,cAErDuC,EAA6B,GArBL,eAuBHH,GAvBG,IAuB5B,2BAAwC,CAAC,IAAhCI,EAA+B,QAE9BC,EAAQ,kBAAkBC,KAAKF,EAAappB,IAClD,GAAMqpB,EAAO,CAET,IAAMxU,EAAewU,EAAM,GACrBE,EAAkBlU,SAASC,eAAT,uBAAwCT,EAAatI,gBAC7E,GAAMgd,EAAiB,CAGnBJ,EAA6B,sBAC7BC,EAAaI,aAAaL,EAA4B,QAEtD,IAAMM,EAAmBL,EAAaM,wBAEtCH,EAAgB7F,MAAMoF,WAAa,UACnCS,EAAgB7F,MAAM7P,KAAtB,UAAgC4V,EAAiB5V,KAAO,EAAxD,MACA0V,EAAgB7F,MAAMe,IAAtB,UAA+BgF,EAAiBhF,IAAM,GAAtD,SAxCgB,8BA8C5B,GAAM0E,EACF,cAAiBF,MAAMjV,KAAK0S,EAAWE,uBAAuB,SAA9D,eAAwE,CAAnE,IAAI+C,EAAI,KAERA,EAAqBjG,MAAMkG,QAAWD,EAAKE,aAAaV,GAAsC,IAAR,UAxNvG,4CA6NI,SAAuC9B,GAInC,IAFA,IAAMvmB,EAAQC,KAAKC,MAAMF,MAEhBwT,EAAI,EAAGA,EAAI+S,EAAMziB,OAAQ0P,IAAK,CACnC,IAAMgT,EAAKD,EAAM/S,GAEX+U,EAAQ,kBAAkBC,KAAKhC,EAAGtnB,IAClCqpB,GAAQ,WAEV,IAAMS,EAAuBT,EAAM,GACnC/B,EAAGC,QAAU,kBAAMzmB,EAAMipB,iBAAiBD,IAC1CxC,EAAG5D,MAAM+D,OAAS,UAJR,QArO1B,GAAuD/jB,eAAvD,GCUamtB,GADZhwB,YACD,0KAEI,WAGIE,KAAKC,MAAMF,MAAMgwB,gBALzB,gCAQI,WAGI,IAAMpK,EAAarR,SAASC,eAAe,gBAErCoR,IAEF3lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,UACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,gBACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,SACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,wBACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,4BApBlF,oBAwBI,WACI,IAAM9lB,EAAQC,KAAKC,MAAMF,MAEzB,OAAQ,gCACJ,gBAAC6pB,EAAA,EAAD,CAAQzpB,MAAM,UAAU0pB,SAAS,SAAShoB,UAAU,cAE/C9B,EAAM0c,WAAc,gBAACqN,GAAA,EAAD,MAAuB,gBAACppB,EAAA,EAAD,CAAK2iB,OAAQ,IAEzD,gBAAC4C,EAAA,EAAD,CAASrF,QAAQ,QAAQ/e,UAAU,uBAED,kBAA7B9B,EAAMwtB,QAAQpnB,YACX,gBAAC,GAAD,CAAsBpG,MAAOA,EAAOmlB,SAAUnlB,EAAM0c,aAE1B,kBAA7B1c,EAAMwtB,QAAQpnB,YACX,gBAAC,GAAD,CAAsBpG,MAAOA,EAAOmlB,SAAUnlB,EAAM0c,aAGxD,gBAAC/b,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACG,EAAA,EAAD,CAAY6hB,MAAO,CAAEuD,KAAM,KAE3B,gBAACgF,GAAA,EAAD,KACI,gBAACI,GAAA,EAAD,CAAYC,QAAQ,uBAApB,gBACA,gBAACC,GAAA,EAAD,CACI3pB,UAAU,iBACVgD,MAAO9E,EAAMosB,YACbnnB,SAAU,SAAC1E,GAAD,OAASP,EAAMosB,YAAc7rB,EAAI2E,OAAOJ,OAClD6mB,WAAY,CAAEzsB,GAAI,wBAClB,gBAACqC,EAAA,EAAD,CAAUuD,MAAO,GAAjB,SACA,gBAACvD,EAAA,EAAD,CAAUuD,MAAO,GAAjB,gBACA,gBAACvD,EAAA,EAAD,CAAUuD,MAAO,GAAjB,gBACA,gBAACvD,EAAA,EAAD,CAAUuD,MAAO,IAAjB,mBAIR,gBAACnE,EAAA,EAAD,CAAKC,MAAO,KAEZ,gBAACT,EAAA,EAAD,CACI2B,UAAU,yBACV+e,QAAQ,WACRzgB,MAAM,UACNshB,KAAK,QACLyD,SAAUnlB,EAAM0c,aAAe1c,EAAMiwB,eACrC3vB,QAAS,kBAAMN,EAAMiwB,eAAiBjwB,EAAMiT,SAAWjT,EAAMgwB,gBAE5DhwB,EAAMiwB,eAAkB,gBAAC,KAAD,MAA2B,gBAAC,KAAD,WAM7DjwB,EAAMkwB,UAAUpsB,QAAW,gCAC1B,gBAAC+lB,EAAA,EAAD,CAAQzpB,MAAM,UAAU0pB,SAAS,UAC7B,gBAACuC,GAAA,EAAD,CAAMvqB,UAAU,cAAcgD,MAAO9E,EAAMuc,SACvCtX,SAAU,SAACqnB,EAA2BlpB,GAEtB,yBAARA,IACApD,EAAMuc,SAAWnZ,KAIzB,gBAACmpB,GAAA,EAAD,CAAKzqB,UAAU,cAAcqjB,SAAUnlB,EAAM0c,WACzCnX,MAAO,gBAACxE,EAAA,EAAD,CAAYX,MAAM,cAAcygB,QAAQ,aAAxC,aAGV7gB,EAAMkwB,UAAUnxB,KAAI,SAAAoxB,GAAQ,OACzB,gBAAC5D,GAAA,EAAD,CAAKzqB,UAAU,cAAcS,IAAK4tB,EAASlqB,KAAMkf,SAAUnlB,EAAM0c,WAC7DnX,MAAO,gBAACxE,EAAA,EAAD,CAAYX,MAAM,cAAcygB,QAAQ,aAAasP,EAASlqB,eAQvFjG,EAAMuc,UAAyC,kBAA7Bvc,EAAMwtB,QAAQpnB,YAAmC,gCACjE,gBAAC,GAAD,CAAqBpG,MAAOA,IAE3BA,EAAM0c,YAAgB1c,EAAMwa,QAAQ1W,OAAU,gBAACimB,GAAA,EAAD,MAAuB,gBAACppB,EAAA,EAAD,CAAK2iB,OAAQ,MAGrFtjB,EAAMuc,UAAyC,kBAA7Bvc,EAAMwtB,QAAQpnB,YAC9B,gBAAC,GAAD,CAAqBonB,QAASxtB,EAAMwtB,YAGrCxtB,EAAMowB,aAAepwB,EAAMowB,YAAYC,UAAY3K,GAAkBgH,eAEpE,gBAAC,GAAD,CACI1sB,MAAOA,EAAMowB,YACb1T,WAAY1c,EAAM0c,WAClB0I,SAAUplB,EAAM6f,gBAChB7L,cAAehU,EAAMgU,kBAI1BhU,EAAMowB,aAAepwB,EAAMowB,YAAYC,UAAY3K,GAAkBgH,iBAAmB1sB,EAAMowB,YAAYrK,SAAY,gCAErH,uBACIjkB,UAAU,eACV8gB,MAAO/D,GACPmH,wBAAyB,CAAEC,OAAQR,GAAazlB,EAAMowB,YAAYrK,YAGrE/lB,EAAMowB,YAAYC,UAAY3K,GAAkB4K,gBAE7C,gBAACpK,EAAA,EAAD,CAASrF,QAAQ,SACb,gBAAC9f,EAAA,EAAD,CAAY6hB,MAAO,CAAEuD,KAAM,KAE3B,gBAAChmB,EAAA,EAAD,CACI0gB,QAAQ,WACRzgB,MAAM,UACN+kB,SAAUnlB,EAAM0c,WAChBpc,QAAS,kBAAMmM,OAAO2Z,UAAUC,UAAUC,UAAUtmB,EAAMowB,YAAYG,eAEtE,gBAAC,KAAD,MACA,gBAAC5vB,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACG,EAAA,EAAD,CAAYX,MAAM,WAAlB,mCAGJ,gBAACO,EAAA,EAAD,CAAKC,MAAO,KAEZ,gBAAC,GAAD,CACImQ,IAAK0U,GAAazlB,EAAMowB,YAAYrK,SACpCX,SAAUplB,EAAM6f,gBAChBnD,WAAY1c,EAAM0c,WAClB1I,cAAehU,EAAMgU,gBAGzB,gBAACrT,EAAA,EAAD,CAAKC,MAAO,OAMxB,gBAAC,GAAD,CAAcZ,MAAOC,KAAKC,MAAMF,WA7J5C,4CAiKI,SAAuCumB,GAInC,IAFA,IAAMvmB,EAAQC,KAAKC,MAAMF,MAEhBwT,EAAI,EAAGA,EAAI+S,EAAMziB,OAAQ0P,IAAK,CACnC,IAAMgT,EAAKD,EAAM/S,GAEbO,EAAeyS,EAAGuC,aAAa,sBACnC,IAAKhV,EAAc,CAEfA,EAAeyS,EAAG/R,UAClB,IAAM8T,EAAQ,SAASC,KAAKzU,GACtBwU,IACFxU,EAAewU,EAAM,IAIvBvoB,EAAMkvB,cAAcnb,IAAgB,WAEtC,IAAMiV,EAAuBjV,EAC7ByS,EAAGC,QAAU,kBAAMzmB,EAAMipB,iBAAiBD,IAC1CxC,EAAG5D,MAAM+D,OAAS,UAJoB,QAlLtD,GAA0C/jB,eAA1C,G,8BCXa8pB,GADZ3sB,YACD,0KAEI,WAGIE,KAAKC,MAAMF,MAAMse,SALzB,gCAQI,WAGI,IAAMsH,EAAarR,SAASC,eAAe,gBAErCoR,IAEF3lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,iBACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,WACtE7lB,KAAK4lB,+BAA+BD,EAAWE,uBAAuB,aAnBlF,oBAuBI,WACI,IAAM9lB,EAAQC,KAAKC,MAAMF,MAEzB,OAAQ,gCACJ,gBAAC6pB,EAAA,EAAD,CAAQzpB,MAAM,UAAU0pB,SAAS,SAAShoB,UAAU,cAE/C9B,EAAM0c,WAAc,gBAACqN,GAAA,EAAD,MAAuB,gBAACppB,EAAA,EAAD,CAAK2iB,OAAQ,IAEzD,gBAAC4C,EAAA,EAAD,CAASrF,QAAQ,SACb,gBAAClgB,EAAA,EAAD,CAAKC,MAAO,KAEZ,gBAACwE,EAAA,EAAD,CACIC,QAAS,gBAACiiB,GAAA,EAAD,CACLlnB,MAAM,UACN+kB,SAAUnlB,EAAM0c,WAChBY,QAAStd,EAAMunB,gBACftiB,SAAU,SAAC1E,GAAD,OAASP,EAAMunB,gBAAkBhnB,EAAI2E,OAAOoY,WAE1D/X,MAAM,mBAEV,gBAAC5E,EAAA,EAAD,CAAKC,MAAO,KAEZ,gBAACwE,EAAA,EAAD,CACIC,QAAS,gBAACiiB,GAAA,EAAD,CACLlnB,MAAM,UACN+kB,SAAUnlB,EAAM0c,WAChBY,QAAStd,EAAMwnB,cACfviB,SAAU,SAAC1E,GAAD,OAASP,EAAMwnB,cAAgBjnB,EAAI2E,OAAOoY,WAExD/X,MAAM,iBAGV,gBAAC5E,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACG,EAAA,EAAD,CAAY6hB,MAAO,CAAEuD,KAAM,KAE3B,gBAAChmB,EAAA,EAAD,CACI2B,UAAU,yBACV+e,QAAQ,WACRzgB,MAAM,UACNshB,KAAK,QACLyD,SAAUnlB,EAAM0c,WAChBpc,QAAS,kBAAMN,EAAMse,SAErB,gBAAC,KAAD,SAMZ,gBAACyC,GAAA,EAAD,CAAgBjf,UAAU,8BAA1B,cACe,gBAACU,EAAA,EAAD,CACPqe,QAAQ,UACRpe,KAAK,oDAFE,yBAQZzC,EAAM2nB,YAAe,gCAEpB,uBACI7lB,UAAU,cACV8gB,MAAO/D,GACPmH,wBAAyB,CAAEC,OAAQR,GAAazlB,EAAM2nB,eAG1D,gBAACzB,EAAA,EAAD,CAASrF,QAAQ,SAEb,gBAAC1gB,EAAA,EAAD,CACI0gB,QAAQ,WACRzgB,MAAM,UACN+kB,SAAUnlB,EAAM0c,WAChBpc,QAAS,kBAAMmM,OAAO2Z,UAAUC,UAAUC,UAAUtmB,EAAM8Z,eAE1D,gBAAC,KAAD,MACA,gBAACnZ,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACG,EAAA,EAAD,CAAYX,MAAM,WAAlB,mCAGJ,gBAACO,EAAA,EAAD,CAAKC,MAAO,KAEZ,gBAAC,GAAD,CACImQ,IAAK0U,GAAazlB,EAAM2nB,YACxBvC,SAAS,gBACT1I,WAAY1c,EAAM0c,WAClB1I,cAAehU,EAAMgU,gBAGzB,gBAACrT,EAAA,EAAD,CAAKC,MAAO,KAEZ,gBAACT,EAAA,EAAD,CACI0gB,QAAQ,WACRzgB,MAAM,UACN+kB,SAAUnlB,EAAM0c,WAChBpc,QAAS,kBAAMN,EAAMwwB,eAErB,gBAAC,KAAD,MACA,gBAAC7vB,EAAA,EAAD,CAAKC,MAAO,KACZ,gBAACG,EAAA,EAAD,CAAYX,MAAM,WAAlB,mBAOZ,gBAAC,GAAD,CAAcJ,MAAOC,KAAKC,MAAMF,WAhI5C,4CAoII,SAAuCumB,GAInC,IAFA,IAAMvmB,EAAQC,KAAKC,MAAMF,MAEhBwT,EAAI,EAAGA,EAAI+S,EAAMziB,OAAQ0P,IAAK,CACnC,IAAMgT,EAAKD,EAAM/S,GAEX+U,EAAQ,kBAAkBC,KAAKhC,EAAGtnB,IAClCqpB,GAAQ,WAEV,IAAMS,EAAuBT,EAAM,GACnC/B,EAAGC,QAAU,kBAAMzmB,EAAMipB,iBAAiBD,IAC1CxC,EAAG5D,MAAM+D,OAAS,UAJR,QA5I1B,GAAmC/jB,eAAnC,G,UCEa6tB,I,OADZ1wB,aACD,kNAGI0E,aAHJ,8CAKI,WAAuB,IAAD,OACZzE,EAAQC,KAAKC,MAAMF,MAEnB4pB,EAAY3pB,KAAKwE,QAAQM,gBAA0B,QAAR,MAEjD,OACI,gBAACtD,EAAA,EAAD,CAAQL,KAAMpB,EAAM0wB,WAAYrvB,QAAS,WAAarB,EAAM0c,aAAY1c,EAAM0wB,YAAa,KAEvF,gBAACxuB,EAAA,EAAD,+BAE4B,OAA3BlC,EAAM2wB,kBAA8B,gCACjC,gBAAChvB,EAAA,EAAD,KAEK3B,EAAM0c,WAAc,gBAACqN,GAAA,EAAD,MAAuB,gBAACppB,EAAA,EAAD,CAAK2iB,OAAQ,IAEzD,gBAACthB,EAAA,EAAD,uGAG0B,kBAArBhC,EAAMoG,YACH,gBAACrF,EAAA,EAAD,CAAYX,MAAM,SAAlB,kMASR,gBAAC+qB,GAAA,EAAD,CAAarpB,UAAU,yBAAyBqjB,SAAUnlB,EAAM0c,WAAYsD,WAAS,GACjF,gBAAC4Q,GAAA,EAAD,kBACA,gBAAChsB,EAAA,EAAD,CAAYC,KAAG,EACXC,MAAO9E,EAAMoG,WACbnB,SAAU,SAAC1E,GAAD,OAASP,EAAMoG,WAAc7F,EAAI2E,OAA4BJ,QAEvE,gBAACM,EAAA,EAAD,CACI+f,SAAUnlB,EAAM0c,WAChB5X,MAAO,gBACPO,QAAS,gBAACC,EAAA,EAAD,MACTC,MAAM,mBAEV,gBAACH,EAAA,EAAD,CACI+f,SAAUnlB,EAAM0c,WAChB5X,MAAO,gBACPO,QAAS,gBAACC,EAAA,EAAD,MACTC,MAAM,uBAKlB,gBAAC,KAAD,CACIzD,UAAU,2BACV2oB,MAAM,EACNC,QAAQ,EACRnlB,MAA4B,kBAArBvF,EAAMoG,WAAN,6BAA6DwjB,EAA7D,qBAAoFA,EAApF,KACPzlB,OAAQ,sBACR0c,QAAQ,SACRsE,SAAUnlB,EAAM0c,WAChB5X,MAAO7E,KAAKwE,QAAQmmB,UAAU5qB,EAAMwS,UACpCvN,SAAU,SAAC3B,GAAD,OAAOtD,EAAMwS,SAAW,EAAK/N,QAAQomB,UAAUvnB,MAG7D,gBAAC,KAAD,CACIxB,UAAU,2BACV2oB,MAAM,EACNC,QAAQ,EACRnlB,MAA4B,kBAArBvF,EAAMoG,WAAN,6BAA6DwjB,EAA7D,qBAAoFA,EAApF,KACPzlB,OAAQ,sBACR0c,QAAQ,SACRsE,SAAUnlB,EAAM0c,WAChB5X,MAAO7E,KAAKwE,QAAQmmB,UAAU5qB,EAAMyS,UACpCxN,SAAU,SAAC3B,GAAD,OAAOtD,EAAMyS,SAAW,EAAKhO,QAAQomB,UAAUvnB,MAG7D,gBAAC6nB,GAAA,EAAD,CAAahG,SAAUnlB,EAAM0c,YACzB,gBAACkU,GAAA,EAAD,mCAEsB,kBAArB5wB,EAAMoG,YACH,gBAACihB,GAAA,EAAD,CAAWxiB,KAAG,GACV,gBAAC,GAAD,CAAuB7E,MAAOA,EAAOmG,cAAc,cACnD,gBAAC,GAAD,CAAuBnG,MAAOA,EAAOmG,cAAc,WACnD,gBAAC,GAAD,CAAuBnG,MAAOA,EAAOmG,cAAc,gBAIrC,kBAArBnG,EAAMoG,YACH,gBAACihB,GAAA,EAAD,CAAWxiB,KAAG,GACV,gBAAChE,EAAA,EAAD,CAASC,MAAM,kDACX,gBAACsE,EAAA,EAAD,CACIC,QAAS,gBAACiiB,GAAA,EAAD,CACLhK,SAAS,IACb/X,MAAM,UACN4f,UAAU,OAO9B,gBAAC,GAAD,CAAcnlB,MAAOA,KAGzB,gBAACsgB,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM0wB,YAAa,GAAOvL,SAAUnlB,EAAM0c,WAAYtc,MAAM,WAAnF,UAGA,gBAACD,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM6wB,gBAAgB1L,UAAWnlB,EAAMuD,SAAWvD,EAAM0c,WAAYtc,MAAM,aAAjG,WAOoB,OAA3BJ,EAAM2wB,kBAA8B,gCACjC,gBAAChvB,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,CAAmBF,UAAU,mBACxB9B,EAAM2wB,iBADX,6BAIJ,gBAACrQ,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM0wB,YAAa,GAAOtwB,MAAM,WAAvD,gBA5HxB,GAAwCwC,aAAxC,GAEWgD,YAActB,GAFzB,aAwIMwsB,GADL/wB,Y,+JAGG,WACI,IAAMC,EAAQC,KAAKC,MAAMF,MACnBmG,EAAgBlG,KAAKC,MAAMiG,cAEjC,OACI,gBAACf,EAAA,EAAD,CACIC,QAAS,gBAACiiB,GAAA,EAAD,CACLhK,QAAStd,EAAM+wB,kBAAkB5qB,GACjClB,SAAU,SAAC1E,GAAD,OAASP,EAAMgxB,kBAAkB7qB,EAAe5F,EAAI2E,OAAOoY,YACzE/X,MAAOY,Q,GAXavD,e,GC5IvBquB,I,OADZlxB,YACD,+JAEI,WACI,IAAMC,EAAQC,KAAKC,MAAMF,MAEzB,OACI,gBAACyB,EAAA,EAAD,CAAQL,KAAMpB,EAAM0wB,WAAYrvB,QAAS,WAAarB,EAAM0c,aAAY1c,EAAM0wB,YAAa,KAEvF,gBAACxuB,EAAA,EAAD,8BAEElC,EAAM4K,UAAa,gCACjB,gBAACjJ,EAAA,EAAD,KAEK3B,EAAM0c,WAAc,gBAACqN,GAAA,EAAD,MAAuB,gBAACppB,EAAA,EAAD,CAAK2iB,OAAQ,IAEzD,gBAACthB,EAAA,EAAD,0HACsH,qEADtH,qGAC4Q,yCAD5Q,WAIA,gBAACmpB,GAAA,EAAD,CAAarpB,UAAU,yBAAyBqjB,SAAUnlB,EAAM0c,YAC5D,gBAAC2K,GAAA,EAAD,CAAWxiB,KAAG,GAEV,gBAACO,EAAA,EAAD,CAAkBC,QAAS,gBAACiiB,GAAA,EAAD,CACvBhK,QAAStd,EAAMkxB,oBACfjsB,SAAU,SAAC1E,GAAD,OAASP,EAAMkxB,oBAAsB3wB,EAAI2E,OAAOoY,WAC1D/X,MAAM,0BAGV,gBAACH,EAAA,EAAD,CAAkBC,QAAS,gBAACiiB,GAAA,EAAD,CACvBhK,QAAStd,EAAMmxB,qBACflsB,SAAU,SAAC1E,GAAD,OAASP,EAAMmxB,qBAAuB5wB,EAAI2E,OAAOoY,WAC3D/X,MAAM,6BAMlB,gBAAC,GAAD,CAAcvF,MAAOA,KAIzB,gBAACsgB,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM0wB,YAAa,GAAOvL,SAAUnlB,EAAM0c,WAAYtc,MAAM,WAAnF,UAGA,gBAACD,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAMoxB,SAASjM,UAAWnlB,EAAMuD,SAAWvD,EAAM0c,WAAYtc,MAAM,aAA1F,aAMLJ,EAAM4K,UAAa,gCAClB,gBAACjJ,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,CAAmBF,UAAU,mBACxB9B,EAAM4K,SAASymB,6BADpB,4BAGA,gBAACrvB,EAAA,EAAD,CAAmBF,UAAU,mBACxB9B,EAAM4K,SAAS0mB,6BADpB,6BAIJ,gBAAChR,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM0wB,YAAa,GAAOtwB,MAAM,WAAvD,gBA7DxB,GAA8CwC,eAA9C,ICFa2uB,GADZxxB,YACD,+JAEI,WACI,IAAMC,EAAQC,KAAKC,MAAMF,MAEzB,OAAQ,gBAACyB,EAAA,EAAD,CAAQL,KAAMpB,EAAM0wB,WAAYrvB,QAAS,kBAAMrB,EAAM0wB,YAAa,IAEtE,gBAACxuB,EAAA,EAAD,2CACA,gBAACP,EAAA,EAAD,KAEK3B,EAAM0c,WAAc,gBAACqN,GAAA,EAAD,MAAuB,gBAACppB,EAAA,EAAD,CAAK2iB,OAAQ,IAEzD,gBAACthB,EAAA,EAAD,KAEQhC,EAAMwxB,WACF,gHACA,+DAIZ,gBAACpH,EAAA,EAAD,CACItoB,UAAU,oBACVmrB,WAAS,EACTvJ,OAAO,QACPne,MAAM,WACNya,WAAS,EACTmF,SAAUnlB,EAAM0c,WAChB2N,WAAY,CAAEhK,UAAU,GACxBiK,gBAAiB,CAAEC,QAAQ,GAC3BzlB,MAAO9E,EAAMoC,QACb6C,SAAU,SAAC1E,GAAD,OAASP,EAAMoC,QAAU7B,EAAI2E,OAAOJ,SAGlD,gBAACslB,EAAA,EAAD,CACI6C,WAAS,EACTvJ,OAAO,QACPne,MAAM,kCACNya,WAAS,EACTmF,SAAUnlB,EAAM0c,WAChB2N,WAAY,CAAEhK,SAAUrgB,EAAMwxB,YAC9BlH,gBAAiB,CAAEC,QAAQ,GAC3BzlB,MAAO9E,EAAMyxB,iBACbxsB,SAAU,SAAC1E,GAAD,OAASP,EAAMyxB,iBAAmBlxB,EAAI2E,OAAOJ,SAG3D,gBAAC,GAAD,CAAc9E,MAAOA,KAGzB,gBAACsgB,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM0wB,YAAa,GAAOtwB,MAAM,WAAvD,WAIGJ,EAAMwxB,YACL,gBAACrxB,EAAA,EAAD,CACIG,QAAS,kBAAMN,EAAM0xB,wBACrBvM,UAAWnlB,EAAM2xB,UAAY3xB,EAAMoC,UAAYpC,EAAMyxB,kBAAoBzxB,EAAM0c,WAC/Etc,MAAM,aAHV,cAtDpB,GAA4CwC,eAA5C,GCEagvB,I,OADZ7xB,YACD,+JAEI,WACI,IAAMC,EAAQC,KAAKC,MAAMF,MAEzB,OAAQ,gBAACyB,EAAA,EAAD,CAAQL,KAAMpB,EAAM0wB,WAAYrvB,QAAS,kBAAMrB,EAAM0wB,YAAa,IAEtE,gBAACxuB,EAAA,EAAD,0CAEElC,EAAM6xB,mBAAsB,gCAE1B,gBAAClwB,EAAA,EAAD,KAEK3B,EAAM0c,WAAc,gBAACqN,GAAA,EAAD,MAAuB,gBAACppB,EAAA,EAAD,CAAK2iB,OAAQ,IAEzD,gBAAC8G,EAAA,EAAD,CACItoB,UAAU,oBACV4hB,OAAO,QACPne,MAAM,wBACNya,WAAS,EACTmF,SAAUnlB,EAAM0c,WAChB4N,gBAAiB,CAAEC,QAAQ,GAC3BzlB,MAAO9E,EAAMgG,WACbf,SAAU,SAAC1E,GAAD,OAASP,EAAMgG,WAAazF,EAAI2E,OAAOJ,SAGrD,gBAACslB,EAAA,EAAD,CACItoB,UAAU,oBACVmrB,WAAS,EACTvJ,OAAO,QACPne,MAAM,6BACNya,WAAS,EACTmF,SAAUnlB,EAAM0c,WAChB4N,gBAAiB,CAAEC,QAAQ,GAC3BzlB,MAAO9E,EAAM8xB,yBACb7sB,SAAU,SAAC1E,GAAD,OAASP,EAAM8xB,yBAA2BvxB,EAAI2E,OAAOJ,SAGnE,gBAACslB,EAAA,EAAD,CACI1G,OAAO,QACPyB,SAAUnlB,EAAM0c,WAChB4N,gBAAiB,CAAEC,QAAQ,GAC3BhlB,MAAM,wBACNya,WAAS,EACTI,WAAS,EACTgN,KAAM,GACNtoB,MAAO9E,EAAMsG,MACbrB,SAAU,SAAC1E,GAAD,OAASP,EAAMsG,MAAQ/F,EAAI2E,OAAOJ,SAGhD,gBAAC,GAAD,CAAc9E,MAAOA,KAIzB,gBAACsgB,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM0wB,YAAa,GAAOtwB,MAAM,WAAvD,UAGA,gBAACD,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM+xB,oBAAoB5M,UAAWnlB,EAAM8xB,yBAA0B1xB,MAAM,aAAlG,aAOLJ,EAAM6xB,mBAAsB,gCAE3B,gBAAClwB,EAAA,EAAD,KACI,gBAACK,EAAA,EAAD,CAAmBF,UAAU,mBAA7B,YAEa,gBAAC,GAAD,CAAmB+d,gBAAiB7f,EAAM6xB,kBAAmB7d,cAAehU,EAAMgU,gBAF/F,sBAMJ,gBAACsM,GAAA,EAAD,KACI,gBAACngB,EAAA,EAAD,CAAQG,QAAS,kBAAMN,EAAM0wB,YAAa,GAAOtwB,MAAM,WAAvD,gBA3EpB,GAA4CwC,eAA5C,ICaaovB,GADZjyB,YACD,+JAEI,WAAuB,IAAD,OACZC,EAAQC,KAAKC,MAAMF,MAEzB,OACI,gBAAC,IAAD,CAAyBiyB,MAAOC,KAAa,gBAAC5tB,GAAe6tB,SAAhB,CAAyBrtB,MAAOP,KAEvEvE,EAAMoyB,YACJ,gBAACzxB,EAAA,EAAD,CAAK2iB,OAAQ,OAGdtjB,EAAMoyB,YACL,gBAACvI,EAAA,EAAD,CAAQC,SAAS,SAAS1pB,MAAM,UAAU0B,UAAU,WAChD,gBAACokB,EAAA,EAAD,KAEKlmB,EAAMoyB,WAAW1wB,cAAgB1B,EAAMqyB,eACpC,gBAAC,GAAD,CAAUryB,MAAOA,EAAMqyB,cAAeltB,UAAW,kBAAMnF,EAAMsyB,oBAAoBlf,0BAGrF,uBAAKmf,IAAG,UAAMxnB,eAAsB,IAAL,IAAvB,OAAkCA,eAAlC,aAA6DnK,MAAM,SAC3E,gBAACD,EAAA,EAAD,CAAKC,MAAO,IAEZ,gBAACG,EAAA,EAAD,CAAY8f,QAAQ,KAAKzgB,MAAM,UAAU0B,UAAU,oBAC/C,gBAACU,EAAA,EAAD,CAAMpC,MAAM,UAAUqC,KAAMzC,EAAMoyB,WAAWzjB,SAA7C,8BAKJ,gBAAC6jB,EAAA,EAAD,CAAapyB,MAAM,WACf,gBAACoC,EAAA,EAAD,CAAMpC,MAAM,UAAUqC,KAAMzC,EAAMoyB,WAAW1vB,kBAA7C,KACO1C,EAAMoyB,WAAWK,aAGtBzyB,EAAM0yB,0BA2BH,gBAAC3xB,EAAA,EAAD,CAAYX,MAAM,WACf,gBAACoC,EAAA,EAAD,CAAMpC,MAAM,UAAUqC,KAAMgK,OAAOC,SAASC,UACvC3M,EAAM0yB,0BAA0B7S,kBA3BrC,gBAAC8S,EAAA,EAAD,CACI7wB,UAAU,oBACV8wB,UAAQ,EACRC,QAAS7yB,EAAM8yB,aAAe,GAAK9yB,EAAM+yB,YACzCjuB,MAAO9E,EAAMgzB,gBACb/tB,SAAU,SAAC1E,EAAK0yB,GACZjzB,EAAMgzB,gBAAN,OAAwBC,QAAxB,IAAwBA,IAAY,GAC9BA,GACFjzB,EAAM0mB,QAGdwM,YAAa,SAACC,GAAD,OACT,gBAAC/I,EAAA,EAAD,iBACQ+I,EADR,CAEIrxB,UAAW9B,EAAM8yB,aAAe,oBAAsB,KACtDpR,KAAK,QACLnc,MAAM,yBACNsb,QAAQ,WACR5b,SAAU,SAAC1E,GAAD,OAASP,EAAMgzB,gBAAkBzyB,EAAI2E,OAAOJ,OACtDmmB,WAAY,SAAC1qB,GAAD,OAAS,EAAK2qB,eAAe3qB,WAejE,gBAACQ,EAAA,EAAD,CAAY6hB,MAAO,CAAEuD,KAAM,KAE3B,gBAAC,EAAD,CAAWnmB,MAAOA,EAAMoyB,iBAKjCpyB,EAAMsyB,uBAAyBtyB,EAAMoyB,YAAcpyB,EAAMoyB,WAAW1wB,aACnE,gBAAC,GAAD,CAAgB1B,MAAOA,EAAMsyB,wBAG9BtyB,EAAM0yB,6BAA+B1yB,EAAMoyB,YAAcpyB,EAAMoyB,WAAW1wB,aACzE,gBAAC,GAAD,CAAsB1B,MAAOA,EAAM0yB,8BAGpC1yB,EAAM2pB,sBAAwB3pB,EAAMoyB,YAAcpyB,EAAMoyB,WAAW1wB,aAClE,gBAAC,GAAD,CAAe1B,MAAOA,EAAM2pB,qBAGhC,gBAAC,GAAD,CAAoB3pB,MAAOA,EAAMozB,0BACjC,gBAAC,GAAD,CAA0BpzB,MAAOA,EAAMqzB,gCACvC,gBAAC,GAAD,CAAwBrzB,MAAOA,EAAMszB,8BACrC,gBAAC,GAAD,CAAwBtzB,MAAOA,EAAMuzB,kCA5FrD,4BAkGI,SAAuB5G,GACD,UAAdA,EAAMpqB,MAENoqB,EAAMC,iBAEN3sB,KAAKC,MAAMF,MAAM0mB,YAvG7B,GAA0B9jB,eAA1B,GCnBa4wB,IAAb,cAKI,WAAoB1qB,EACR2qB,EACAC,EACAC,EACAC,GAA4D,yBAJpD9qB,iBAImD,KAH3D2qB,2BAG2D,KAF3DC,iCAE2D,KAD3DC,+BAC2D,KAA3DC,+BAA2D,8CAT3E,8DAYI,WACI3zB,KAAKO,uBAAoBc,EAEzBrB,KAAK0zB,6BAA6BjD,YAAa,IAfvD,oCAkBI,WACIzwB,KAAKO,uBAAoBc,EAEzBrB,KAAKwzB,yBAAyB/C,YAAa,IArBnD,0CAwBI,WACIzwB,KAAKO,uBAAoBc,EAEzBrB,KAAKyzB,+BAA+BhD,YAAa,IA3BzD,wCA8BI,WACIzwB,KAAKO,uBAAoBc,EAEzBrB,KAAK2zB,6BAA6BlD,YAAa,IAjCvD,4BAoCI,WAEIzwB,KAAK6I,eAAe4B,KAAK,MAAO,UAAUC,MAAK,SAAAC,GAC3C2J,SAASzT,MAAT,qCAA+C8J,EAASipB,YAAxD,YAAuEjpB,EAASxI,QAAhF,cAA6FwI,EAASkpB,gBAvClH,uDAEKzvB,MAFL,kECDsB0vB,IAAtB,qDAWI,WAAsBC,GAAqE,IAAD,8BACtF,gBADkBA,eAAoE,EATjF/tB,KAAe,UASkE,EARjFoqB,QAAU3K,GAAkB4K,eAQqD,EAX9F,6CAKI,WAC4B,OAAOrwB,KAAKyQ,eAN5C,mBAQI,WACwB,OAAOzQ,KAAKwQ,cATxC,kBAeI,SAAK+c,EAAqCxjB,GAA0C,IAAD,OAK/E,OAFA/J,KAAK0Q,wBAEE1Q,KAAK+zB,aAAaxG,EAAQxnB,YAAY2E,MAAK,SAAA6P,GAE9C,GAAKA,EAAQ1W,SAAUkG,EAAYa,YAInC,OAAO,EAAKopB,aAAazG,EAAShT,EAASxQ,UA1BvD,GAAqDwF,IAArD,yCAKKpL,MALL,+GAQKA,MARL,0ECCa8vB,GAAb,4MAEajuB,KAAe,mBAF5B,kDAII,SAAuBunB,EAAqChT,EAAyBxQ,GAA2C,IAAD,OAE3H,OAAO,IAAIE,SAAc,SAACvK,EAAS+L,GAC/BxB,QAAQiqB,IAAI,EAAKC,4BAA4B5G,EAAQvnB,KAAM,IAA+B,WAA1BunB,EAAQrnB,cAA4BqU,IAAU7P,MAAK,SAAA0pB,GAE/G,GAAIrqB,EAAYa,YACZlL,QADJ,CAKA,EAAK+Q,aAAe,qBAAuB2jB,EAAcxqB,KAAK,IAE9D,IAGI,EAAK4G,YAAc,GAEnBf,KAAQoB,OAAO,eAAgB,EAAKJ,cAAc,SAACK,GAC/C,EAAKN,YAAcM,EAEnBpR,OAGN,MAAOwN,GACLzB,EAAOyB,OAGZzB,QA/Bf,yCAmCI,SAAoC4oB,EAA2BC,EAAiCC,EAAmBC,GAO/G,IAPkK,IAI9JpjB,EAJ6J,OAE3JqjB,EAAgB,IAChBC,EAA6B,GAG/BnhB,EAAI,EACDA,EAAIihB,EAAc3wB,QAAQ,CAC7B,IAyDY8wB,EACAC,EA1DNlI,EAAQ8H,EAAcjhB,IADC,WAG7B,OAAQmZ,EAAM2C,WACV,IAAK,mBAEDje,EACI,UAAGkjB,EAAH,eAAiCD,EAAjC,8CACaC,EADb,YACwCD,EADxC,aAC8D,EAAKQ,gBAAgBnI,EAAM0C,WADzF,OAGJsF,EAAQ/qB,KAAKM,QAAQvK,QAAQ0R,IAE7B,MACJ,IAAK,oCACL,IAAK,iCAED,IAAM0jB,EAAoC,mCAApBpI,EAAM2C,UAE5B,GAAM3C,EAAMsC,mBAAoB,CAE5B,IAAM+F,EAAqBrI,EAAMsC,mBAC3BgG,EAAuBtI,EAAMqC,aAEnC2F,EAAQ/qB,KAAK,IAAIM,SAAgB,SAACvK,EAAS+L,GACvC,EAAKsoB,aAAagB,GAAoBrqB,MAAK,SAAA6P,GAEvCtQ,QAAQiqB,IAAI,EAAKC,4BAA4Ba,EAAsBX,EAAmBS,EAAeva,IAAU7P,MAAK,SAAA0pB,GAEhH10B,EAAQ00B,EAAcxqB,KAAK,OAE5B6B,MAEJ,SAAAyB,GAECU,QAAQC,IAAR,yBAA8BmnB,EAA9B,aAAuD9nB,EAAI1F,UAC3D9H,EAAQ,GAAD,OAAI20B,EAAJ,aAA0BW,EAA1B,mCAINF,GAET1jB,EAAW,sCACRijB,EADQ,aACc3H,EAAMqC,aADpB,wCAEX,SAEA2F,EAAQ/qB,KAAKM,QAAQvK,QAAQ0R,MAI7BA,EAAQ,UAAMijB,EAAN,eAA8B3H,EAAMqC,aAApC,yCAER2F,EAAQ/qB,KAAKM,QAAQvK,QAAQ0R,KAGjC,MACJ,IAAK,gBAKD,IAFIujB,EAAkBjI,EAAMuI,aACxBL,EAAIrhB,EAAI,EACLqhB,EAAIJ,EAAc3wB,QACU,kBAA/B2wB,EAAcI,GAAGvF,WACjBmF,EAAcI,GAAG7F,eAAiBrC,EAAMqC,cACxCyF,EAAcI,GAAGpF,cAAcziB,OAAO,EAAG,MAAQ2f,EAAM8C,cAAcziB,OAAO,EAAG,IAC/E6nB,IAEID,EAAkBH,EAAcI,GAAGK,eACnCN,EAAkBH,EAAcI,GAAGK,cAI3C,GAAIL,IAAMrhB,EAAI,EAAG,CAEb,IAAMnC,EACF,UAAGijB,EAAH,cAA0BA,EAA1B,YAA+C3H,EAAMqC,aAArD,2BACasF,EADb,aACmC,EAAKjkB,eAAesc,EAAMuI,cAD7D,OAEJP,EAAQ/qB,KAAKM,QAAQvK,QAAQ0R,QAE1B,CAEH,IAAMA,EACF,cAAOwjB,EAAIrhB,EAAX,uBACG8gB,EADH,cAC0BA,EAD1B,YAC+C3H,EAAMqC,aADrD,2BAEasF,EAFb,aAEmC,EAAKjkB,eAAeukB,GAFvD,gBAIJD,EAAQ/qB,KAAKM,QAAQvK,QAAQ0R,IAE7BmC,EAAIqhB,EAAI,EAGZ,MACJ,IAAK,aAEDxjB,EAAW,sCACJijB,EADI,aACkBA,EADlB,YACuC3H,EAAMqC,aAD7C,OAEP,SAEJ2F,EAAQ/qB,KAAKM,QAAQvK,QAAQ0R,IAC7B,MACJ,IAAK,cAEDA,EACI,UAAGqjB,EAAH,cAAsBJ,EAAtB,YAA2C3H,EAAMoC,KAAjD,2BACa2F,EADb,YAC8BJ,EAD9B,aACoD,EAAKQ,gBAAgBnI,EAAM0C,WAD/E,OAEJsF,EAAQ/qB,KAAKM,QAAQvK,QAAQ0R,IAE7B,MACJ,IAAK,aAEDA,EACI,UAAGqjB,EAAH,cAAsBJ,EAAtB,wCACaI,EADb,YAC8BJ,EAD9B,aACoD,EAAKQ,gBAAgBnI,EAAM0C,WAD/E,OAEJsF,EAAQ/qB,KAAKM,QAAQvK,QAAQ0R,IAE7B,MACJ,IAAK,sBAEDA,EACI,UAAGqjB,EAAH,cAAsBJ,EAAtB,iDACaI,EADb,YAC8BJ,EAD9B,aACoD,EAAKQ,gBAAgBnI,EAAM0C,WAD/E,OAEJsF,EAAQ/qB,KAAKM,QAAQvK,QAAQ0R,IAE7B,MACJ,IAAK,qBAEDA,EACI,UAAGijB,EAAH,mBAA4BC,EAA5B,aAA0DC,EAAW,kBAAoB,qBAAzF,4BACaF,EADb,YACkCC,EADlC,aAC8D,EAAKlkB,eAAesc,EAAMuI,cADxF,OAGEV,IAEFnjB,EAAW,4BAA8BA,EAAW,UAGxDsjB,EAAQ/qB,KAAKM,QAAQvK,QAAQ0R,KAtIR,GA2I7BmC,IAGJ,OAAOmhB,IAxLf,6BA2LI,SAAwBQ,GAEpB,OAAIA,EAAUrxB,QAAU,GACbqxB,EAGL5wB,GAAmBQ,gBACdrB,KAAOyxB,GAAWhxB,OAAO,kBAG7B,IAAMgxB,EAAUnoB,OAAO,GAAI,IAAM,SArMhD,GAA6C+mB,ICGhCqB,IAAb,qDA4BI,WAAYphB,EAA+BqhB,EAA0CrB,GAAqE,IAAD,8BACrJ,cAAMhgB,IAD2EggB,eAAoE,EA1BhJ/tB,KAAO,kBA0ByI,EAzBhJoqB,QAAU3K,GAAkBgH,cAyBoH,6CAErJ,EAAK5Y,iBAAmBuhB,EAF6H,EA5B7J,6CAKI,WAC4B,OAAOp1B,KAAKyQ,eAN5C,mBAQI,WACwB,OAAOzQ,KAAKwQ,cATxC,2BAWI,WACiC,OAAOxQ,KAAKuZ,kBAZjD,IAaI,SAAoBpW,GAChBnD,KAAKuZ,iBAAmBpW,EACxBnD,KAAK6Q,WAfb,yBAkBI,WAC+B,OAAO7Q,KAAKwZ,gBAnB/C,IAoBI,SAAkBrW,GACdnD,KAAKwZ,eAAiBrW,EACtBnD,KAAK6Q,WAtBb,mBAyBI,WAC4B,OAAO7Q,KAAKsZ,WA1B5C,kBAiCI,SAAKiU,EAAqCxjB,GAA0C,IAAD,OAG/E/J,KAAK0Q,wBAEL,IAAMiJ,EAAsB,GAE5B,OAAO3Z,KAAK6Q,SAASnG,MAAK,WAEtB,OAAO,EAAKqpB,aAAaxG,EAAQxnB,YAAY2E,MAAK,SAAA6P,GAE9C,IAAIxQ,EAAYa,YAIhB,OAAO,EAAKyqB,yBAAyB1b,EAAS7T,GAA2BwL,gBAAgBic,GACjFA,EAAQrnB,cAAe,IAAIsL,KAAK+b,EAAQ9mB,iBAAiBgL,UAAY,IAAID,KAAK+b,EAAQ/mB,aAAaiL,UACnG8I,EAASxQ,GACZW,MAAK,WAEF,EAAK4O,SAAWK,aArDxC,sCA8DI,SAAiCA,EAC7BC,EACA1T,EACA6B,EACAwS,EACAxQ,GAA0C,IAAD,OAMzC,OAJK4P,EAAQC,KACTD,EAAQC,GAAY,IAAIb,IAGpB7S,GACJ,IAAK,YACDyT,EAAQC,GAAUZ,YAClB,MACJ,IAAK,UACL,IAAK,UACL,IAAK,iBACDW,EAAQC,GAAUX,UAClB,MACJ,IAAK,SACDU,EAAQC,GAAUV,SAClB,MACJ,QACIS,EAAQC,GAAUT,QAItBQ,EAAQC,GAAUlT,SAAWqB,IAC7B4R,EAAQC,GAAUlT,SAAWqB,GAGjC,IA3ByC,EA2BnCutB,EAA4B,GA3BO,eA6BvB/a,GA7BuB,2BA+B/Bgb,EAAW,WAFZ7I,EA7BgC,SA+BXqC,oBAAT,QAAyBrC,EAAMoC,KAEhD,OAAQpC,EAAM2C,WACV,IAAK,kCAEK3C,EAAMsC,oBAERsG,EAAS3rB,KAAK,EAAKoqB,aAAarH,EAAMsC,oBAAoBtkB,MAAK,SAAA8qB,GAE3D,IAAKzrB,EAAYa,YACb,OAAO,EAAKyqB,yBAAyB1b,EAAS4b,EAAa,UAAW,EAAGC,EAAYzrB,OAKjG,MACJ,IAAK,oCAED,GAAM2iB,EAAMsC,mBAAoB,CAE5B,IAAMjnB,EAAe,IAAIyJ,KAAKkb,EAAM0C,WAAW3d,UAAY,IAAID,KAAKkb,EAAM8C,eAAe/d,UAEzF6jB,EAAS3rB,KAAK,EAAKoqB,aAAarH,EAAMsC,oBAAoBtkB,MAAK,SAAA8qB,GAE3D,IAAKzrB,EAAYa,YACb,OAAO,EAAKyqB,yBAAyB1b,EAAS4b,EAAa,YAAaxtB,EAAcytB,EAAYzrB,OAK9G,MACJ,IAAK,iCAED,GAAM2iB,EAAMsC,mBAAoB,CAE5B,IAAMjnB,EAAe,IAAIyJ,KAAKkb,EAAM0C,WAAW3d,UAAY,IAAID,KAAKkb,EAAM8C,eAAe/d,UAEzF6jB,EAAS3rB,KAAK,EAAKoqB,aAAarH,EAAMsC,oBAAoBtkB,MAAK,SAAA8qB,GAE3D,IAAKzrB,EAAYa,YACb,OAAO,EAAKyqB,yBAAyB1b,EAAS4b,EAAa,SAAUxtB,EAAcytB,EAAYzrB,OAK3G,MACJ,IAAK,gBAEI4P,EAAQ4b,KACT5b,EAAQ4b,GAAe,IAAIxc,IAG/BY,EAAQ4b,GAAavc,YAEjBW,EAAQ4b,GAAa7uB,SAAWgmB,EAAMuI,eACtCtb,EAAQ+S,EAAMqC,cAAcroB,SAAWgmB,EAAMuI,cAGjD,MACJ,IAAK,aAEItb,EAAQ4b,KACT5b,EAAQ4b,GAAe,IAAIxc,IAG/BY,EAAQ4b,GAAarc,SAEjBS,EAAQ4b,GAAa7uB,SAAWgmB,EAAMuI,eACtCtb,EAAQ4b,GAAa7uB,SAAWgmB,EAAMuI,cAG1C,MACJ,IAAK,gBAEItb,EAAQ4b,KACT5b,EAAQ4b,GAAe,IAAIxc,IAG/BY,EAAQ4b,GAAatc,YAhFjC,2BAA2B,CAAC,IAAnByT,EAAkB,KA7Bc,8BAmHzC,OAAOziB,QAAQiqB,IAAIoB,KAtL3B,oBAyLI,WAAiC,IAAD,OAK5B,OAHAt1B,KAAKyQ,aAAe,GACpBzQ,KAAKwQ,YAAc,GAEZ,IAAIvG,SAAc,SAACvK,EAAS+L,GAE/B,IACI,IAAMoO,EAAcnE,GAAyB,EAAK7B,iBAAiBM,UAAW,EAAKN,iBAAiBK,QAChG,CACI4B,sBAAuB,EAAKyD,iBAC5B/B,oBAAqB,EAAKgC,iBAGlC,IAAKK,EAED,YADAna,IAIJ,EAAK+Q,aAAL,oBAAiCoJ,GAEjCpK,KAAQoB,OAAO,eAAgB,EAAKJ,cAAc,SAACK,GAE/C,EAAKN,YAAc,EAAKsJ,WAAWhJ,GAEnCpR,OAGN,MAAOwN,GACLzB,EAAOyB,WAtNvB,GAA2C0G,IAA3C,yCAKKzP,MALL,+GAQKA,MARL,mHAWKA,MAXL,yHAkBKA,MAlBL,iHAyBKA,MAzBL,+GA2DKC,MA3DL,wEA4DmC,MA5DnC,ICDaqxB,GAAb,4MAEazvB,KAAe,cAF5B,kDAII,SAAuBunB,EAAqChT,EAAyBxQ,GAA0C,IAAD,OAE1H,OAAO,IAAIE,SAAc,SAACvK,EAAS+L,GAC/BxB,QAAQiqB,IAAI,EAAKwB,oBAAoBnI,EAAQxnB,WAAYwnB,EAAQvnB,KAAMuU,GAAS,IAAO7P,MAAK,SAAAirB,GAExF,GAAI5rB,EAAYa,YAEZlL,QAFJ,CAMA,IAAMk2B,EAAQD,EAAcE,OACtBC,EAAoBF,EAAMvmB,QAAO,SAAA0mB,GAAC,QAAMA,EAAEjiB,gBAEhD,EAAKrD,aAAe,2BACP8c,EAAQvnB,KADD,YACSunB,EAAQxnB,WADjB,QAEhB,wCACA6vB,EAAM92B,KAAI,SAAAmrB,GAAI,OAAIA,EAAK7Y,YAAUxH,KAAK,IAG1C,EAAK4G,YAAc,GAEnB,IAEIf,KAAQoB,OAAO,eAAgB,EAAKJ,cAAc,SAACK,GAE/CA,EAAM,EAAKklB,6BAA6BllB,EAAKglB,GAC7ChlB,EAAM,EAAKmlB,oCAAoCnlB,EAAKglB,GAEpD,EAAKtlB,YAAcM,EAEnBpR,OAGN,MAAOwN,GACLzB,EAAOyB,OAGZzB,QA1Cf,0CA+CI,SAAqCqF,EAAaglB,GAE9C,OAAOhlB,EAAI3D,QAAQ,IAAI+oB,OAAJ,yCAAqD,OAAO,SAAC5N,EAAO6N,EAASC,GAE5F,IAAMC,EAAoB7W,SAAS4W,GAEnC,GAAIC,GAAqB,GAAKA,EAAoBP,EAAkBjyB,OAChE,OAAOykB,EAGX,IAAMgO,EAAeR,EAAkBO,EAAoB,GAC3D,OAAKC,EAAaxiB,aAIXwU,EAAK,+BAA2BgO,EAAaxiB,aAAxC,KAHDwU,OA3DvB,iDAmEI,SAA4CxX,EAAaglB,GAErD,OAAOhlB,EAAI3D,QAAQ,IAAI+oB,OAAJ,iDAA6D,OAAO,SAAC5N,EAAO8N,EAAWG,GAEtG,IAAMF,EAAoB7W,SAAS4W,GAEnC,GAAIC,GAAqB,GAAKA,EAAoBP,EAAkBjyB,OAChE,OAAOykB,EAGX,IAAMkO,EAAmBV,EAAkBO,EAAoB,GAC/D,IAAKG,EAAiBC,mBAAqBD,EAAiBE,iBAAoBF,EAAiB9vB,SAAW,IACxG,OAAO4hB,EAIX,IAAMqO,EAAYb,EAAkBc,WAAU,SAAAb,GAAC,OAAIA,EAAEhwB,aAAeywB,EAAiBC,oBACrF,GAAIE,EAAY,EACZ,OAAOrO,EAGX,IAAMuO,EAAY,IAAIX,OAAJ,wBAA4BS,EAAY,EAAxC,4BAAqE,KAAKpO,KAAKzX,GACjG,IAAK+lB,EACD,OAAOvO,EAGX,IAAMwO,EAAYtX,SAASqX,EAAU,IAC/BE,EAAmBP,EAAiBE,gBAAkB,EAAII,EAAY5uB,KAAKmI,KAAKymB,EAAYN,EAAiBE,iBAEnH,OAAOpO,EAAMnb,QAAN,iBAAwBopB,EAAxB,sBAAoDQ,EAAiBzuB,QAAQ,GAA7E,WAhGnB,iCAoGI,SAA4BsX,EAAyByU,EAA2BG,EAA+BwC,GACzE,IAQ9B5lB,EAR6B,OAE3BsjB,EAA4C,GAE5CuC,EAAezC,EAAc0C,MAAK,SAAAxK,GAAK,MAAwB,qBAApBA,EAAM2C,aACjD8H,EAAiB3C,EAAc0C,MAAK,SAAAxK,GAAK,MAAwB,uBAApBA,EAAM2C,aAErD+H,EAAsBJ,EAEtBK,EAAe,EAEnB,GAAMJ,GAAkBE,EAAgB,CAEpC,GAAIC,EAAqB,CAErB,IAAME,EAAiBH,EAAelC,aAAe,MACrD7jB,EAAWkmB,EAAiB,+BAAiC,yBAC7D5C,EAAQ/qB,KAAKM,QAAQvK,QAAQ,CAAC,CAAE0R,eAChCgmB,GAAsB,EAG1BhmB,EAAW4lB,EAAwB,GAAH,kBAAmB3C,EAAnB,YAAwCr0B,KAAKuR,YAAYqO,GAAzD,QAEhC,IAAI2X,EAAWv3B,KAAKoQ,eAAe+mB,EAAelC,cAC7CsC,IACDA,EAAWv3B,KAAKw3B,eAAenD,IAGnCjjB,GAAQ,UAAOmmB,EAAP,aAAoBP,EAAwB,GAAK,UAAjD,YAA8Dh3B,KAAK0R,eAAeulB,EAAa7H,WAA/F,aAA8GpvB,KAAK2R,wBAAwBwlB,EAAelC,cAA1J,OACRP,EAAQ/qB,KAAKM,QAAQvK,QAAQ,CAAC,CAAE0R,WAAU0C,aAAcugB,EAAmBtuB,WAAY6Z,MAEvFyX,EAAeF,EAAelC,aAG9BmC,IAEAhmB,EAAW,yBACXsjB,EAAQ/qB,KAAKM,QAAQvK,QAAQ,CAAC,CAAE0R,gBArCH,qBAwCfojB,GAxCe,IAwCjC,2BAAiC,CAAC,IAAzB9H,EAAwB,QAEzB+K,EAAiB/K,EAAM8C,cAQ3B,OAJMyH,GAAiBzlB,KAAKkI,MAAM+d,GAAkBjmB,KAAKkI,MAAMud,EAAa7H,aACxEqI,EAAiBR,EAAa7H,WAG1B1C,EAAM2C,WACV,IAAK,oCACL,IAAK,iCAEK3C,EAAMsC,oBAAqB,WAE7B,IAAM+F,EAAqBrI,EAAMsC,mBAC3BgG,EAAuBtI,EAAMqC,aAEnC2F,EAAQ/qB,KAAK,IAAIM,SAA+B,SAACvK,EAAS+L,GACtD,EAAKsoB,aAAagB,GAAoBrqB,MAAK,SAAA6P,GAEvCtQ,QAAQiqB,IAAI,EAAKwB,oBAAoBX,EAAoBC,EAAsBza,GAAS,IAAQ7P,MAAK,SAAA0pB,GAEjG10B,EAAQ00B,EAAcyB,UAEvBpqB,MAEJ,SAAAyB,GAECU,QAAQC,IAAR,yBAA8BmnB,EAA9B,aAAuD9nB,EAAI1F,UAC3D9H,EAAQ,CAAC,CAAE0R,SAAS,qBAAD,OAAuB,EAAKomB,eAAexC,GAA3C,aAAqE9nB,EAAI1F,QAAzE,iBAI3B4J,EAAQ,kBAAcijB,EAAd,YAAmC,EAAK9iB,YAAYqO,GAApD,QACR8U,EAAQ/qB,KAAKM,QAAQvK,QAAQ,CAAC,CAAE0R,eAtBH,GAyBjC,MACJ,IAAK,gBAEDA,EAAQ,UAAMpR,KAAKw3B,eAAe9K,EAAMqC,cAAhC,YAAiD/uB,KAAKoQ,eAAesc,EAAMuI,cAA3E,mBAAmGj1B,KAAK0R,eAAe+lB,GAAvH,aAA2Iz3B,KAAK2R,wBAAwB+a,EAAMuI,cAA9K,OACRP,EAAQ/qB,KAAKM,QAAQvK,QAAQ,CAAC,CAC1B0R,WACA0C,aAAc4Y,EAAMqC,aACpB0H,iBAAkB7W,EAClBlZ,SAAUgmB,EAAMuI,aAChByB,gBAAiBW,EAAe3K,EAAMuI,aAAeoC,EAAe,MAGxE,MACJ,IAAK,aAEDjmB,EAAQ,UAAMpR,KAAKw3B,eAAe9K,EAAMqC,cAAhC,YAAiD/uB,KAAKoQ,eAAesc,EAAMuI,cAA3E,mBAAmGj1B,KAAK0R,eAAe+lB,GAAvH,aAA2Iz3B,KAAK2R,wBAAwB+a,EAAMuI,cAA9K,OACRP,EAAQ/qB,KAAKM,QAAQvK,QAAQ,CAAC,CAC1B0R,WACA0C,aAAc4Y,EAAMqC,aACpB0H,iBAAkB7W,EAClBlZ,SAAUgmB,EAAMuI,aAChByB,gBAAiBW,EAAe3K,EAAMuI,aAAeoC,EAAe,MAGxE,MACA,IAAK,aAEDjmB,EAAQ,8BAA0BpR,KAAK0R,eAAegb,EAAM0C,WAApD,WACRsF,EAAQ/qB,KAAKM,QAAQvK,QAAQ,CAAC,CAC1B0R,WACA0C,aAAcugB,EACdoC,iBAAkB7W,EAClBlZ,SAAU,EACVgwB,gBAAiB,WAhHJ,8BAuHjC,OAAOhC,IA5Nf,4BA+NI,SAAuB9iB,GAEnB,OAAKtN,GAAmBQ,gBAIjBrB,KAAOmO,GAAmB1N,OAAO,2BAH7B0N,EAAkB7E,OAAO,EAAG,MAlO/C,4BAwOI,SAAuB/G,GAEnB,OAAOA,EAAKmH,QAAQ,KAAM,SA1OlC,GAA0C2mB,ICH7B4D,IAAb,cASI,WAAoBC,EAAkC9uB,GAAiC,yBAAnE8uB,mBAAkE,KAAhC9uB,iBAAgC,KAPtF7C,KAAe,GAOuE,KAN7EsqB,YAAc,GAM+D,KAL7EF,QAAU3K,GAAkBmS,QAKiD,qCAT1F,yCAMI,WACwB,OAAO53B,KAAK63B,WAPxC,kBAYI,SAAKtK,EAAqCxjB,GAA0C,IAAD,OAEzES,EAAG,2BAAuBxK,KAAK23B,iBAA5B,iCAAqE33B,KAAKgG,KAA1E,MACT,OAAOhG,KAAK6I,eAAe4B,KAAK,OAAQD,GAAKE,MAAK,SAAAC,GAEzCZ,EAAYa,cAEb,EAAKitB,SAAWltB,UAnBhC,0CAMKxG,MANL,+GAwBKC,MAxBL,kECOa0zB,IAAb,qDAiHI,WAAoBH,EACRjd,EACA7R,EACAC,GAA+D,IAAD,uBACtE,gBAJgB6uB,mBAGsD,EAF9Djd,4BAE8D,EAD9D7R,iBAC8D,EAA9DC,gBAA8D,2hCAsXlEivB,uBAtXkE,IAuXlE/uB,oBAA8B,EAvXoC,EAwXzDC,UAAY,IArXzB,IAAMiT,EAAoB,EAAKpT,cAAc7F,QAAQ,eAC/CiZ,IACF,EAAKC,aAAeC,OAAOF,IAG/B,IAAMG,EAAiB,EAAKvT,cAAc7F,QAAQ,YARoB,OAShEoZ,IACF,EAAKE,UAAYH,OAAOC,IAV0C,EApH9E,0CAGI,WACyB,OAAOrc,KAAKuc,WAJzC,IAKI,SAAapZ,GAELnD,KAAKuc,YAAcpZ,IAIvBnD,KAAKuc,UAAYpZ,EACjBnD,KAAK8I,cAAc1F,QAAQ,WAAYD,EAAI4B,YAErC/E,KAAKmwB,YAEPnwB,KAAKg4B,gBAEGh4B,KAAKi4B,SAASp0B,QAEtB7D,KAAK0uB,iBApBjB,uBAwBI,WACI,OAAQ1uB,KAAKuc,UAAmBvc,KAAK4a,WAAW5a,KAAKuc,UAAY,GAAxC,OAzBjC,mBA4BI,WAC4C,OAAOvc,KAAKk4B,WA7B5D,mBA+BI,WACgC,OAAOl4B,KAAKi4B,WAhChD,6BAkCI,WACkC,OAAOj4B,KAAKm4B,qBAnClD,2BAqCI,WACgC,OAAOn4B,KAAK23B,mBAtChD,0BAwCI,WACgC,OAAO33B,KAAKwc,aAAaC,aAAezc,KAAKwc,aAAa5R,cAzC9F,sBA2CI,WAC4B,OAAO5K,KAAKo4B,aAAep4B,KAAKgwB,iBA5ChE,uBA8CI,WAC4B,OAAOhwB,KAAKmc,cA/C5C,IAgDI,SAAgBhZ,GACZnD,KAAKmc,aAAehZ,EACpBnD,KAAK8I,cAAc1F,QAAQ,cAAepD,KAAKmc,aAAapX,YAC5D/E,KAAK+vB,gBAnDb,gCAsDI,WACsC,OAAO/vB,KAAKq4B,uBAvDtD,IAwDI,SAAyBl1B,GACrBnD,KAAKq4B,sBAAwBl1B,EAC7BnD,KAAKktB,UAAY,GACjBltB,KAAKotB,UAAY,KA3DzB,qCA8DI,WAC2C,OAAOptB,KAAKs4B,4BA/D3D,IAgEI,SAA8Bn1B,GAC1BnD,KAAKs4B,2BAA6Bn1B,EAClCnD,KAAKmuB,gBAAoBnuB,KAAKk4B,SAAS5xB,aAAeoS,KAAKC,UAAU3Y,KAAKk4B,SAAS5xB,cAAgB,KAlE3G,6BAqEI,WACmC,OAAOtG,KAAKu4B,oBAtEnD,IAuEI,SAAsBp1B,GAClBnD,KAAKu4B,mBAAqBp1B,EAC1BnD,KAAKsuB,0BAA2B,IAzExC,+BA4EI,WAGI,OAAKtuB,KAAKk4B,SAAS5xB,aAIZtG,KAAKmuB,kBAAoBzV,KAAKC,UAAU3Y,KAAKk4B,SAAS5xB,gBAHhDtG,KAAKmuB,kBAhF1B,yBAsFI,WAC+C,OAAOnuB,KAAKw4B,eAvF/D,qBA4GI,WACqC,OAAOx4B,KAAK4a,aA7GrD,yBA+GI,WAAsC,OAAO5a,KAAK6I,iBA/GtD,oBAkII,WAAU,IAAD,OACL7I,KAAK8tB,wBAAyB,EAE9B,IAAMtjB,EAAG,2BAAuBxK,KAAK23B,iBAA5B,aACT33B,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,OAAQD,GAAKE,MAAK,WACvC,EAAK0tB,aAAc,EACnB,EAAKrI,iBACN,SAAA7iB,GACC,EAAKkrB,aAAc,EACnB,EAAKz2B,aAAL,4BAAyCuL,EAAI1F,QAA7C,YAA2D0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAA9F,UA7IZ,uBAiJI,WAAa,IAAD,OACRtL,KAAK+tB,2BAA4B,EAEjC,IAAMvjB,EAAG,2BAAuBxK,KAAK23B,iBAA5B,gBACT33B,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,OAAQD,GAAKE,MAAK,WACvC,EAAK0tB,aAAc,EACnB,EAAKrI,iBACN,SAAA7iB,GACC,EAAKkrB,aAAc,EACnB,EAAKz2B,aAAL,+BAA4CuL,EAAI1F,QAAhD,YAA8D0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAjG,UA5JZ,mBAgKI,WAAS,IAAD,OACJtL,KAAK8sB,uBAAwB,EAE7B,IAAMtiB,EAAG,2BAAuBxK,KAAK23B,iBAA5B,YACT33B,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,OAAQD,GAAKE,MAAK,WACvC,EAAK0tB,aAAc,EACnB,EAAKH,SAAW,GAChB,EAAKC,SAAW,IAAIpyB,GACpB,EAAK8U,WAAa,MACnB,SAAA1N,GACC,EAAKkrB,aAAc,EACnB,EAAKz2B,aAAL,2BAAwCuL,EAAI1F,QAA5C,YAA0D0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAA7F,UA7KZ,qBAiLI,WAAW,IAAD,OACNtL,KAAK6tB,mBAAoB,EAEzB,IAAMrjB,EAAG,2BAAuBxK,KAAK23B,iBAA5B,cACHc,EAAc,CAAEnK,yBAA0BtuB,KAAKsuB,0BAErDtuB,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,OAAQD,EAAKiuB,GAAa/tB,MAAK,WACpD,EAAK0tB,aAAc,EACnB,EAAKrI,iBACN,SAAA7iB,GACC,EAAKkrB,aAAc,EACnB,EAAKz2B,aAAL,6BAA0CuL,EAAI1F,QAA9C,YAA4D0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAA/F,UA9LZ,wBAkMI,WAAc,IAAD,OAEHd,EAAG,2BAAuBxK,KAAK23B,iBAA5B,kBACHc,EAAc,CAAEzyB,KAAMhG,KAAKktB,UAAW5hB,KAAM,MAElD,IACImtB,EAAYntB,KAAOoN,KAAKgB,MAAM1Z,KAAKotB,WACrC,MAAOlgB,GAEL,YADAlN,KAAK2B,aAAL,sCAAmDuL,EAAI1F,UAH3D,QAMIxH,KAAK+sB,sBAAuB,EAGhC/sB,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,OAAQD,EAAKiuB,GAAa/tB,MAAK,WACpD,EAAK0tB,aAAc,EACnB,EAAKrI,iBACN,SAAA7iB,GACC,EAAKkrB,aAAc,EACnB,EAAKz2B,aAAL,oCAAiDuL,EAAI1F,QAArD,YAAmE0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAtG,UAvNZ,6BA2NI,WAAmB,IAAD,OAERd,EAAG,2BAAuBxK,KAAK23B,iBAA5B,wBACLc,EAAc,KAElB,IAEUz4B,KAAKmuB,kBACPsK,EAAc/f,KAAKgB,MAAM1Z,KAAKmuB,kBAGpC,MAAOjhB,GAEL,YADAlN,KAAK2B,aAAL,yCAAsDuL,EAAI1F,UAP9D,QAUIxH,KAAKguB,2BAA4B,EAGrChuB,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,OAAQD,EAAKiuB,GAAa/tB,MAAK,WACpD,EAAK0tB,aAAc,EACnB,EAAKrI,iBACN,SAAA7iB,GACC,EAAKkrB,aAAc,EACnB,EAAKz2B,aAAL,uCAAoDuL,EAAI1F,QAAxD,YAAsE0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAzG,UApPZ,yBAwPI,WAAe,IAAD,OAEV,IAAMtL,KAAKyc,WAAX,CAMAzc,KAAKo4B,aAAc,EACnBp4B,KAAKgJ,oBAAqB,EAErBhJ,KAAKmc,cAAkBnc,KAAKmwB,cAE7BnwB,KAAKi4B,SAAW,GAChBj4B,KAAKm4B,mBAAqB,GAG9B,IAAMO,EAAuB14B,KAAK0a,0BAA4B1a,KAAK6I,eAAe4B,KAAK,MAAzB,iBAAmDR,QAAQvK,QAAQ,MAE3H8K,EAAG,2BAAuBxK,KAAK23B,iBAA5B,MACT,OAAO1tB,QAAQiqB,IAAI,CAACl0B,KAAK6I,eAAe4B,KAAK,MAAOD,GAAMkuB,IAAqBhuB,MAAK,SAAAiuB,GAEhF,EAAKT,SAAWS,EAAU,GAC1B,IAAMvD,EAAkBuD,EAAU,GAGlC,EAAKC,iBAEL,IAAIC,EAAgB,EAapB,GAViC,kBAA7B,EAAKX,SAAS/xB,aAEV,EAAKyU,WAAW/W,QAAUg1B,IAC1B,EAAKje,WAAWjR,KAAK,IAAIsqB,IAAwB,SAAC6E,GAAD,OAAY,EAAKC,eAAeD,OACjF,EAAKle,WAAWjR,KAAK,IAAI8rB,IAAqB,SAACqD,GAAD,OAAY,EAAKC,eAAeD,QAElFD,GAAiB,GAIfzD,EAAiB,CAEnB,EAAKoD,aAAepD,EAAgBjhB,UAEpC,IAAML,EAAehO,GAA2BwL,gBAAgB,EAAK4mB,UAG1Cz4B,OAAOD,KAAK41B,EAAgBjhB,WAAWrV,KAAI,SAAAk6B,GAAE,OAAIA,EAAGxtB,iBAGxDD,SAASuI,EAAatI,iBAErC,EAAKoP,WAAW/W,QAAUg1B,GAC1B,EAAKje,WAAWjR,KAAK,IAAIwrB,GAAsB,EAAKtsB,eAAgBusB,GAAiB,SAAC0D,GAAD,OAAY,EAAKC,eAAeD,OAEzHD,KAKR,GAAM,EAAKX,SAASvxB,iBAAkB,CAAC,IAAD,iBACT,EAAKuxB,SAASvxB,kBADL,IAClC,2BAAyD,CAAC,IAAjDsyB,EAAgD,QAEjD,EAAKre,WAAW/W,QAAUg1B,GAC1B,EAAKje,WAAWjR,KAAK,IAAI+tB,GAAqB,EAAKC,iBAAkB,EAAK9uB,iBAE9E,EAAK+R,WAAWie,GAAe7yB,KAAOizB,EACtCJ,KAP8B,gCAYlC,EAAKtc,UAAY,GAAK,EAAKA,UAAY,EAAK3B,WAAW/W,UACvD,EAAK0Y,UAAY,GAGrB,EAAK6b,aAAc,EAEd,EAAKjI,YAMN,EAAK6H,gBAJL,EAAKtJ,cAAc,EAAKvS,iBAO7B,SAAAjP,GACC,EAAKkrB,aAAc,EAGnB,EAAKjc,aAAe,EAEpB,EAAKxa,aAAL,uBAAoCuL,EAAI1F,QAAxC,YAAsD0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAzF,QA1FAtL,KAAK44B,mBA5PjB,oBA0VI,WACI54B,KAAKwc,aAAa5R,aAAc,EAChC5K,KAAKwc,aAAe,IAAI7T,KA5VhC,yBA+VI,WAAmD,IAAD,OAAtCqB,EAAsC,wDAE9C,KAAMhK,KAAKyc,YAAgBzc,KAAKmwB,aAAiBnwB,KAAKgJ,oBAAtD,CAIA,IAAMe,EAAc/J,KAAKwc,aACzBzS,EAAY0S,YAAa,EAGzB,IAAMrS,EAAOJ,EAAgB,EAAIhK,KAAKi4B,SAASp0B,OAEzC2G,EAAG,2BAAuBxK,KAAK23B,iBAA5B,2BAA+D33B,KAAKiJ,UAApE,kBAAuFmB,GAEhGpK,KAAK6I,eAAe4B,KAAK,MAAOD,GAAKE,MAAK,SAAAC,GAU9B,IAAD,EARHZ,EAAYa,cAIhB,EAAKutB,mBAAqBxtB,EAASuuB,WAE/BlvB,EACA,EAAKiuB,SAAWttB,EAAS4P,UAEzB,IAAK0d,UAAStuB,KAAd,qBAAsBgB,EAAS4P,UAE3B5P,EAAS4P,QAAQ1W,OAAS,EAAKoF,YAG/B,EAAKD,oBAAqB,QAGnC,SAAAkE,GAGC,EAAKiP,aAAe,EAEfpS,EAAYa,cACb,EAAKjJ,aAAL,kCAA+CuL,EAAI1F,QAAnD,YAAiE0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAApG,SAGLgT,SAAQ,WACPvU,EAAY0S,YAAa,QA1YrC,8BA8YI,SAAiB3I,GAEb,GAAI9T,KAAK+T,cAAc/C,SAEnBhR,KAAK+T,cAActJ,KAAK,mBAAoBqJ,GAAcpJ,MAAK,eAAU,SAAAwC,GACrEU,QAAQC,IAAR,wCAA6CX,EAAI1F,iBAGlD,CAEH,IAAIuO,EAAO/V,KAAKw4B,aAAa1kB,GAEvBiC,GAAUA,EAAK3B,UACjB5H,OAAOrL,KAAK4U,EAAK3B,aA3ZjC,gCAgaI,WAEIpU,KAAK+T,cAActJ,KAAK,6BAA8B,IAAIC,MAAK,eAAU,SAAAwC,GACrEU,QAAQC,IAAR,0CAA+CX,EAAI1F,eAna/D,2BAuaI,WAA+B,IAAD,OAE1B,IAAMxH,KAAKyc,WAAX,CAIA,IAAM1S,EAAc/J,KAAKwc,aACzBzS,EAAY0S,YAAa,EAEzBzc,KAAKmwB,YAAY9R,KAAKre,KAAKk4B,SAAUnuB,GAAaW,MAAK,eAAU,SAAAwC,GAG7D,EAAKiP,aAAe,EAEfpS,EAAYa,cACb,EAAKjJ,aAAL,8BAA2CuL,EAAI1F,QAA/C,YAA6D0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAhG,SAGLgT,SAAQ,WACPvU,EAAY0S,YAAa,QA1brC,4BA8bI,WAAgC,IAAD,OAEtBzc,KAAKmc,eAIJnc,KAAK+3B,mBACPva,aAAaxd,KAAK+3B,mBAEtB/3B,KAAK+3B,kBAAoBta,YAAW,kBAAM,EAAKsS,gBAAmC,IAApB/vB,KAAKmc,iBAvc3E,4BA0cI,SAAuByD,GAEnB,IAAMpV,EAAG,2BAAuBoV,EAAvB,cACT,OAAO5f,KAAK6I,eAAe4B,KAAK,MAAOD,GAAKE,MAAK,SAAAC,GAAQ,OAAIA,EAAS4P,eA7c9E,GAA+C7R,IAA/C,sCAGKvE,MAHL,4GA4BKA,MA5BL,2GA+BKA,MA/BL,qHAkCKA,MAlCL,6HAqCKA,MArCL,0HAwCKA,MAxCL,qHA2CKA,MA3CL,kHA8CKA,MA9CL,4HAsDKA,MAtDL,0IA8DKA,MA9DL,uIAqEKA,MArEL,iIA4EKA,MA5EL,6HAsFKA,MAtFL,mIAyFKC,MAzFL,yEA0FsC,KA1FtC,0DA2FKA,MA3FL,yEA4FyC,KA5FzC,sDA6FKA,MA7FL,yEA8FqC,KA9FrC,0CAgGKA,MAhGL,wGAkGKA,MAlGL,8GAoGKA,MApGL,uHAsGKA,MAtGL,yEAuGwC,KAvGxC,oDAyGKA,MAzGL,wEA0G0B,MA1G1B,uCA4GKD,MA5GL,mHAgdKC,MAhdL,wEAid4C,MAjd5C,yCAmdKA,MAndL,yEAodmD,IAAI0B,MApdvD,yCAqdK1B,MArdL,wEAsduC,MAtdvC,0CAudKA,MAvdL,yEAwdgC,KAxdhC,4CAydKA,MAzdL,yEA0dmC,KA1dnC,6CA2dKA,MA3dL,yEA4dwC,IAAIuE,MA5d5C,sDA6dKvE,MA7dL,yEA8d6C,KA9d7C,2DA+dKA,MA/dL,yEAgekD,KAhelD,mDAieKA,MAjeL,yEAke0C,KAle1C,6CAmeKA,MAneL,yEAoemC,KApenC,mDAqeKA,MAreL,yEAseyC,KAtezC,6CAueKA,MAveL,wEAweyC,MAxezC,ICRa+0B,IAAb,6VAKI,WAC4B,OAAOn5B,KAAKo4B,cAN5C,2BAQI,WACiC,QAASp4B,KAAK6T,mBATnD,2BAWI,WACiC,OAAO7T,KAAKuZ,kBAZjD,IAaI,SAAoBpW,GAChBnD,KAAKuZ,iBAAmBpW,EACxBnD,KAAK6Q,WAfb,yBAkBI,WAC+B,OAAO7Q,KAAKwZ,gBAnB/C,IAoBI,SAAkBrW,GACdnD,KAAKwZ,eAAiBrW,EACtBnD,KAAK6Q,WAtBb,oBAyBI,WAAU,IAAD,OAML,GAJA7Q,KAAKyQ,aAAe,GACpBzQ,KAAKwQ,YAAc,GACnBxQ,KAAK2B,aAAe,GAEf3B,KAAK6T,iBAAV,CAIA7T,KAAKo4B,aAAc,EACnB,IACI,IAAMve,EAAcnE,GAAyB1V,KAAK6T,iBAAiBM,UAAWnU,KAAK6T,iBAAiBK,QAChG,CACI4B,sBAAuB9V,KAAKuZ,iBAC5B/B,oBAAqBxX,KAAKwZ,iBAGlC,IAAKK,EAED,YADA7Z,KAAKo4B,aAAc,GAIvBp4B,KAAKyQ,aAAL,oBAAiCoJ,GAEjCpK,KAAQoB,OAAO,eAAgB7Q,KAAKyQ,cAAc,SAACK,GAE/C,EAAKN,YAAc,EAAKsJ,WAAWhJ,GAEnC,EAAKsnB,aAAc,KAGzB,MAAOlrB,GACLlN,KAAK2B,aAAL,4BAAyCuL,EAAI1F,SAC7CxH,KAAKo4B,aAAc,MA3D/B,kBA+DI,WAAQ,IAAD,OAECp4B,KAAKo4B,cAKTp4B,KAAK0Q,wBAEL1Q,KAAKo4B,aAAc,EACnBp4B,KAAK2B,aAAe,GACpB3B,KAAKyQ,aAAe,GACpBzQ,KAAKwQ,YAAc,GACnBxQ,KAAK6T,iBAAmB,KAExB7T,KAAK6I,eAAe4B,KAAK,MAAO,iBAAiBC,MAAK,SAAAC,GAElD,EAAKkJ,iBAAmBlJ,EACxB,EAAKkG,YAEN,SAAA3D,GACC,EAAKkrB,aAAc,EACnB,EAAKz2B,aAAL,8BAA2CuL,EAAI1F,QAA/C,YAA6D0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAhG,aArFZ,GAAwCsI,IAAxC,6CAEKxP,MAFL,wEAG2B,MAH3B,wCAKKD,MALL,sHAQKA,MARL,2HAWKA,MAXL,yHAkBKA,MAlBL,wHAyFKC,MAzFL,yEA0FmC,KA1FnC,ICEag1B,IAAb,qDA+BI,WAAoBvwB,GAAiC,IAAD,8BAChD,gBADgBA,iBAAgC,+UA/BxD,4CAEI,WAC4B,OAAO7I,KAAKq5B,aAH5C,IAII,SAAex0B,GACX7E,KAAKq5B,YAAcx0B,EAEfA,IAEA7E,KAAKs5B,kBAAoB,KAEzBt5B,KAAKuS,SAAW9O,OAAS0X,SAAS,EAAG,QAAQ3X,MAC7CxD,KAAKwS,SAAW/O,OAASD,MAEzBxD,KAAKu5B,UAAY,IAAIC,IAAmB,CAAC,YAAa,eAEtDx5B,KAAKmG,WAAa,mBAhB9B,4BAoBI,WACwC,OAAOnG,KAAKs5B,oBArBxD,sBAuBI,WAC4B,OAAOt5B,KAAKo4B,cAxB5C,mBA0BI,WAEI,OAAOp4B,KAAKu5B,UAAU9X,KAAO,GAAK/Z,GAAgBgW,cAAc1d,KAAKuS,WAAa7K,GAAgBgW,cAAc1d,KAAKwS,YA5B7H,0BAmCI,WAAgB,IAAD,OAEXxS,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,OAAQ,iBAAkB,CAC/CtE,WAAYnG,KAAKmG,WACjBoM,SAAUvS,KAAKuS,SAAS7O,cACxB8O,SAAUxS,KAAKwS,SAAS9O,cACxB+1B,SAAUvR,MAAMjV,KAAKjT,KAAKu5B,UAAU/d,YACrC9Q,MAAK,SAAAC,GAEJ,EAAK2uB,kBAAoB3uB,EAAS+lB,oBAEnC,SAAAxjB,GACC,EAAKvL,aAAL,gCAA6CuL,EAAI1F,QAAjD,YAA+D0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAlG,QACDgT,SAAQ,WACP,EAAK8Z,aAAc,OAnD/B,+BA+DI,SAAkBhb,GACd,OAAOpd,KAAKu5B,UAAUG,IAAItc,KAhElC,+BAmEI,SAAkBA,EAAuBuc,GACjCA,EACA35B,KAAKu5B,UAAUK,IAAIxc,GAEnBpd,KAAKu5B,UAAUM,OAAOzc,OAvElC,GAA6C1U,IAA7C,wCAEKvE,MAFL,uHAoBKA,MApBL,uHAuBKA,MAvBL,8GA0BKA,MA1BL,+GAuDKC,MAvDL,uGAyDKA,MAzDL,yGA4DKA,MA5DL,wEA6D6B,mBA7D7B,0CA2EKA,MA3EL,yEA4E4C,IAAIo1B,OA5EhD,4CA8EKp1B,MA9EL,yEA+EmC,KA/EnC,4CAiFKA,MAjFL,yEAkFmC,KAlFnC,kDAoFKA,MApFL,yEAqF+C,QArF/C,ICHa01B,IAAb,qDA8BI,WAAoBjxB,GAAiC,IAAD,8BAChD,gBADgBA,iBAAgC,iQA9BxD,4CAEI,WAC4B,OAAO7I,KAAKq5B,aAH5C,IAII,SAAeU,GACX/5B,KAAKq5B,YAAcU,EAEfA,IACA/5B,KAAKg6B,UAAY,KACjBh6B,KAAKixB,qBAAsB,EAC3BjxB,KAAKkxB,sBAAuB,KAVxC,oBAcI,WACoD,OAAOlxB,KAAKg6B,YAfpE,sBAiBI,WAC4B,OAAOh6B,KAAKo4B,cAlB5C,mBAoBI,WAEI,OAAO,IAtBf,mBAkCI,WAAS,IAAD,OAEJp4B,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,OAAQ,wBAAyB,CACtDwmB,oBAAqBjxB,KAAKixB,oBAC1BC,qBAAsBlxB,KAAKkxB,uBAC5BxmB,MAAK,SAAAC,GACJ,EAAKqvB,UAAYrvB,KAClB,SAAAuC,GACC,EAAKvL,aAAL,uCAAoDuL,EAAI1F,QAAxD,YAAsE0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAzG,QACDgT,SAAQ,WACP,EAAK8Z,aAAc,SA9C/B,GAAmD1vB,IAAnD,wCAEKvE,MAFL,+GAcKA,MAdL,+GAiBKA,MAjBL,8GAoBKA,MApBL,0HAyBKC,MAzBL,mHA2BKA,MA3BL,0GAkDKA,MAlDL,yEAmDmC,KAnDnC,4CAqDKA,MArDL,yEAsDmC,KAtDnC,0CAwDKA,MAxDL,yEAyD2D,QAzD3D,ICAa61B,IAAb,qDAyCI,WAAoBpxB,GAAiC,IAAD,8BAChD,gBADgBA,iBAAgC,mPAiC5CqxB,0BAjC4C,IAkC5CC,iBAlC4C,IAzCxD,4CAOI,WAC4B,OAAOn6B,KAAKo4B,cAR5C,sBAUI,WAC4B,OAAOp4B,KAAKo6B,cAX5C,mBAaI,WAEI,OAAQp6B,KAAKwxB,mBAAqBxxB,KAAKk6B,sBAA0Bl6B,KAAKmC,UAAYnC,KAAKm6B,cAf/F,sBAkBI,WAC4B,OAAOn6B,KAAKq5B,aAnB5C,IAoBI,SAAex0B,GAAiB,IAAD,OAC3B7E,KAAKq5B,YAAcx0B,EAEbA,IAEF7E,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,MAAO,sBAAsBC,MAAK,SAAAC,GAEvD,EAAK6mB,iBAAmB,EAAK0I,qBAAuBvvB,EAAS6mB,iBAC7D,EAAKrvB,QAAU,EAAKg4B,YAAcxvB,EAASxI,QAC3C,EAAKi4B,YAAczvB,EAAS0vB,cAE7B,SAAAntB,GACC,EAAKvL,aAAL,uBAAoCuL,EAAI1F,QAAxC,YAAsD0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAzF,QACDgT,SAAQ,WACP,EAAK8Z,aAAc,QApCnC,kCA6CI,WAAwB,IAAD,OAEnBp4B,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,MAAO,qBAAsB,CAClD+mB,iBAAkBxxB,KAAKwxB,mBAAqBxxB,KAAKk6B,qBAAuBl6B,KAAKwxB,iBAAmB,GAChGrvB,QAASnC,KAAKmC,UACfuI,MAAK,WAEJ,EAAK2uB,aAAc,EAEnBiB,MAAM,kKAEP,SAAAptB,GACC,EAAKvL,aAAL,uBAAoCuL,EAAI1F,QAAxC,YAAsD0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAAzF,QACDgT,SAAQ,WACP,EAAK8Z,aAAc,SA7D/B,GAAiD1vB,IAAjD,wCAEKtE,MAFL,+GAIKA,MAJL,sGAOKD,MAPL,iHAUKA,MAVL,8GAaKA,MAbL,8GAkBKA,MAlBL,qHAiEKC,MAjEL,yEAkEmC,KAlEnC,4CAoEKA,MApEL,yEAqEmC,KArEnC,4CAuEKA,MAvEL,yEAwEmC,KAxEnC,ICAam2B,IAAb,qDA4BI,WAAoB1xB,GAAiC,IAAD,8BAChD,gBADgBA,iBAAgC,+SA5BxD,mDASI,WACkC,OAAO7I,KAAKw6B,qBAVlD,sBAYI,WAC4B,OAAOx6B,KAAKo4B,cAb5C,sBAeI,WAC4B,OAAOp4B,KAAKq5B,aAhB5C,IAiBI,SAAex0B,GACX7E,KAAKq5B,YAAcx0B,EAEnB7E,KAAK+F,WAAa,GAClB/F,KAAK6xB,yBAA2B,GAChC7xB,KAAKqG,MAAQ,GACbrG,KAAKw6B,mBAAqB,KAvBlC,yBA0BI,WAAsC,OAAOx6B,KAAK6I,iBA1BtD,8BAgCI,WAAoB,IAAD,OAEX4xB,EAAc,KAClB,GAAMz6B,KAAKqG,MACP,IAEIo0B,EAAc/hB,KAAKgB,MAAM1Z,KAAKqG,OAEhC,MAAO6G,GAGL,YADAlN,KAAK2B,aAAL,iCAA8CuL,EAAI1F,UAK1DxH,KAAKo4B,aAAc,EAEnBp4B,KAAK6I,eAAe4B,KAAK,OAAQ,kBAAmB,CAAExL,GAAIe,KAAK+F,WAAYC,KAAMhG,KAAK6xB,yBAA0BvmB,KAAMmvB,IACrH/vB,MAAK,SAAAC,GAEF,EAAK6vB,mBAAqB7vB,EAAS5E,cAEpC,SAAAmH,GACC,EAAKvL,aAAL,wCAAqDuL,EAAI1F,QAAzD,YAAuE0F,EAAIvC,SAAWuC,EAAIvC,SAASW,KAAO,GAA1G,QACDgT,SAAQ,WACP,EAAK8Z,aAAc,SAzD/B,GAAiD1vB,IAAjD,2CAEKtE,MAFL,uHAIKA,MAJL,oGAMKA,MANL,6GASKD,MATL,wHAYKA,MAZL,iHAeKA,MAfL,qHA6DKC,MA7DL,yEA8DmC,KA9DnC,4CAgEKA,MAhEL,yEAiEmC,KAjEnC,mDAmEKA,MAnEL,kECFas2B,GAAb,WAEI,WAAoBC,GAAkB,yBAAlBA,UAFxB,2CAII,SAAQxwB,EAAqCtF,GAEzC7B,aAAaI,QAAb,UAAwBpD,KAAK26B,QAA7B,aAAyCxwB,GAAatF,GAGtD,IAAMwV,EAAc,IAAIN,GACxBM,EAAYmB,OAAOrR,GAAatF,EAChCwV,EAAYugB,UAXpB,sBAcI,SAASpW,GAGL,IAH6E,EAGvEnK,EAAc,IAAIN,GAHqD,eAK1DyK,GAL0D,IAK7E,2BAA0B,CAAC,IAAhByF,EAAe,QACH,OAAfA,EAAKplB,OAEL7B,aAAa6G,WAAb,UAA2B7J,KAAK26B,QAAhC,aAA4C1Q,EAAK9f,mBAE1CkQ,EAAYmB,OAAOyO,EAAK9f,aAI/BnH,aAAaI,QAAb,UAAwBpD,KAAK26B,QAA7B,aAAyC1Q,EAAK9f,WAAa8f,EAAKplB,OAEhEwV,EAAYmB,OAAOyO,EAAK9f,WAAa8f,EAAKplB,QAhB2B,8BAoB7EwV,EAAYugB,UAlCpB,qBAqCI,SAAQzwB,GAGJ,IAAMkQ,EAAc,IAAIN,GACxB,OAAMM,EAAYmB,OAAOrR,GACdkQ,EAAYmB,OAAOrR,GAGvBnH,aAAaC,QAAb,UAAwBjD,KAAK26B,QAA7B,aAAyCxwB,MA7CxD,wBAgDI,SAAWA,GAEPnH,aAAa6G,WAAb,UAA2B7J,KAAK26B,QAAhC,aAA4CxwB,IAG5C,IAAMkQ,EAAc,IAAIN,UACjBM,EAAYmB,OAAOrR,GAC1BkQ,EAAYugB,YAvDpB,KCAaC,GAAb,WAMI,WAAoBC,GAAkB,IAAD,gCAAjBA,aAAiB,KA0D7BC,UAEJ,GA5DiC,KA8D7BC,UAKJ,GAhEAxuB,OAAOwa,iBAAiB,WAAW,SAAA0F,GAE/B,IAAMllB,EAAUklB,EAAMphB,KAGhB2vB,EAAiB,EAAKF,UAAUvzB,EAAQvI,IAC9C,GAAMg8B,EAEF,IACIA,EAAezzB,EAAQ8D,MACzB,MAAM4B,GACJU,QAAQC,IAAI,0CAA4CX,OALhE,CAYA,IAAMguB,EAAiB,EAAKF,UAAUxzB,EAAQvI,IACzCi8B,IAIC1zB,EAAQ0F,IACVguB,EAAezvB,OAAOjE,EAAQ0F,KAE9BguB,EAAex7B,QAAQ8H,EAAQ8D,aAG5B,EAAK0vB,UAAUxzB,EAAQvI,SAtC1C,0CAEI,WAA0B,OAAO,IAFrC,qCAII,WAA0C,OAAO,OAJrD,kBA0CI,SAAKmM,EAAoCC,EAAaC,GAA2B,IAAD,OAEtE6vB,EAAYjzB,KAAKkzB,SAASr2B,WAKhC,OAFA/E,KAAK86B,WAAWO,YAAY,CAAEp8B,GAAIk8B,EAAW/vB,SAAQC,MAAKC,SAEnD,IAAIrB,SAAa,SAACvK,EAAS+L,GAC9B,EAAKuvB,UAAUG,GAAa,CAAEz7B,UAAS+L,eAlDnD,+BAsDI,SAAkB6vB,EAAiCC,GAE/Cv7B,KAAK+6B,UAAL,aAAiCO,EACjCt7B,KAAK+6B,UAAL,mBAAuCQ,EAIvCv7B,KAAK86B,WAAWO,YAAY,CAAEjwB,OAAQ,iBA7D9C,KCEaowB,GAAb,WAEI,WAAoBb,EAAyBG,GAAkB,yBAA3CH,UAA0C,KAAjBG,aAAiB,KAsC7CW,YAtC6C,EAC1Dz7B,KAAKy7B,OAASC,gBAAgB17B,KAAK26B,SAC9B36B,KAAKy7B,SACNz7B,KAAKy7B,OAAS,IAL1B,2CASI,SAAQtxB,EAAqCtF,GAEzC7E,KAAKy7B,OAAOtxB,GAAatF,EACzB7E,KAAK27B,SAZb,sBAeI,SAASnX,GAAyE,IAAD,iBAE1DA,GAF0D,IAE7E,2BAA0B,CAAC,IAAhByF,EAAe,QAEH,OAAfA,EAAKplB,aACE7E,KAAKy7B,OAAOxR,EAAK9f,WAExBnK,KAAKy7B,OAAOxR,EAAK9f,WAAa8f,EAAKplB,OAPkC,8BAW7E7E,KAAK27B,SA1Bb,qBA6BI,SAAQxxB,GAEJ,OAAOnK,KAAKy7B,OAAOtxB,KA/B3B,wBAkCI,SAAWA,UAEAnK,KAAKy7B,OAAOtxB,GACnBnK,KAAK27B,SArCb,kBA0CI,WACI37B,KAAK86B,WAAWO,YAAY,CAAEjwB,OAAQ,eAAgB9I,IAAKtC,KAAK26B,QAASrvB,KAAMtL,KAAKy7B,aA3C5F,M,SvBmBKjN,O,uCAAAA,I,kCAAAA,Q,KAOE,IAAMoN,IAAb,cAkCI,aAAe,IAAD,gCAhCLzJ,gBAgCK,OA/BLC,mBA+BK,OA9BLC,yBA8BK,OA7BLI,+BA6BK,OA5BL/I,wBA4BK,OA3BLyJ,6BA2BK,OA1BLC,mCA0BK,OAzBLC,iCAyBK,OAxBLC,iCAwBK,2IA8EGzqB,oBA9EH,EAGV,IAAIgzB,OAAiBx6B,EACrB,IACIw6B,EAAYC,mBACd,UAEF,GAAMD,EAAW,CAEb,IAAM9nB,EAAgB,IAAI8mB,GAAoBgB,GAC9C77B,KAAK6I,eAAiBkL,EAEtB/T,KAAKmzB,wBAA0B,IAAIiG,GAAwBrlB,GAC3D/T,KAAKozB,8BAAgC,IAAI0G,GAA8B/lB,GACvE/T,KAAKszB,4BAA8B,IAAIiH,GAA4BxmB,GAE/DgoB,cAAgBvN,GAAgB/B,cAEhCzsB,KAAK0pB,mBAAqB,IAAIyP,GAAmBplB,GAExC/T,KAAK+F,WAEd/F,KAAKyyB,0BAA4B,IAAIqF,GAA0B93B,KAAK+F,WAChEi2B,yBACAjoB,EACA,IAAIynB,GAAmD,4BAA6BK,KAIxF77B,KAAKqyB,oBAAsB,IAAI5X,GAAoBuhB,yBAA0BjoB,EACzE,IAAIynB,GAAmE,sBAAuBK,IAElG9nB,EAAckoB,mBACV,kBAAM,EAAK9I,wBAAwB1C,YAAa,KAChD,kBAAM,EAAK2C,8BAA8B3C,YAAa,UAI3D,CAEHzwB,KAAKmyB,WAAa,IAAIpmB,GAEtB,IAAMgI,EAAgB,IAAI9I,IAAc,kBAAM,EAAKknB,WAAWK,eAAa,kBAAM,EAAKL,WAAWjjB,iCACjGlP,KAAK6I,eAAiBkL,EAEtB/T,KAAKmzB,wBAA0B,IAAIiG,GAAwBrlB,GAC3D/T,KAAKozB,8BAAgC,IAAI0G,GAA8B/lB,GACvE/T,KAAKqzB,4BAA8B,IAAI4G,GAA4BlmB,GACnE/T,KAAKszB,4BAA8B,IAAIiH,GAA4BxmB,GAE7D/T,KAAK+F,WAEP/F,KAAKyyB,0BAA4B,IAAIqF,GAA0B93B,KAAK+F,WAChEi2B,yBACAjoB,EACA,IAAI2mB,GAA6C,+BAIrD16B,KAAKoyB,cAAgB,IAAImB,GAAcxf,EAAe/T,KAAKmzB,wBAAyBnzB,KAAKozB,8BAA+BpzB,KAAKqzB,4BAA6BrzB,KAAKszB,6BAC/JtzB,KAAKqyB,oBAAsB,IAAI5X,GAAoBuhB,yBAA0BjoB,EAAe,IAAI2mB,GAAuC,0BA/FvJ,iDAeI,WAEI,OAAO16B,KAAKk8B,kBAjBpB,IAmBI,SAAoBte,GAChB5d,KAAKk8B,iBAAmBte,EACxB5d,KAAKm8B,sBArBb,uBAwBI,WAEI,OAAOn8B,KAAKo8B,eA1BpB,wBA6BI,WAEI,OAAoC,IAA7Bp8B,KAAKo8B,aAAav4B,QAAgB7D,KAAKo8B,aAAa,KAAOp8B,KAAKk8B,mBA/B/E,kBAqGI,WACI1vB,OAAOrL,KAAP,UAAenB,KAAK6I,eAAeoI,2BAAnC,OAA+DnF,IAA/D,OAA0F9L,KAAKk8B,mBAC/Fl8B,KAAKk8B,iBAAmB,GACxBl8B,KAAKo8B,aAAe,KAxG5B,sBAmHI,WAEI,GAAMC,0BACF,OAAOA,0BAGX,IAAM1vB,EAAMH,OAAOC,SAASC,SAAS3I,YAAY+H,IACjD,OAAIa,EAAM,EACC,GAGJH,OAAOC,SAASC,SAASK,OAAOJ,EAAMb,GAAyBjI,UA9H9E,+BAkII,WAAmC,IAAD,OAE9B,IAAK7D,KAAKk8B,kBAAoBl8B,KAAKk8B,iBAAiBr4B,OAAS,EACzD7D,KAAKo8B,aAAe,OADxB,CAKA,IAAM5xB,EAAG,kCAA8BxK,KAAKk8B,iBAAnC,MACTl8B,KAAK6I,eAAe4B,KAAK,MAAOD,GAAKE,MAAK,SAAAC,GAEjCA,GAAa,EAAKuxB,iBAGnB,EAAKE,aAAezxB,EAFpB,EAAKyxB,aAAe,WA7IpC,uDAYKh4B,MAZL,2GAeKD,MAfL,uHAwBKA,MAxBL,oHA6BKA,MA7BL,wHA2GKC,MA3GL,wEA4GqC,MA5GrC,iDA6GKA,MA7GL,wEA8GuC,MA9GvC,IwBpBAkQ,SAASgoB,KAAK3Z,MAAM9D,gBAAkBJ,GAAME,QAAQS,WAAWC,MAG/D,IAAMkd,GAAW,IAAIX,GAErBY,SACI,gBAACC,EAAA,EAAD,CAAev5B,MAAOub,IAClB,gBAAC,GAAD,CAAM1e,MAAOw8B,MAEjBjoB,SAASC,eAAe,W","file":"static/js/main.e44e4ee7.chunk.js","sourcesContent":["var map = {\n\t\"./locale\": 368,\n\t\"./locale.js\": 368\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 665;","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Box, Button, Container, CircularProgress, Dialog, DialogContent, DialogContentText,\r\n    List, ListItem, Link,\r\n    Menu, MenuItem, Tooltip, Typography, DialogTitle\r\n} from '@material-ui/core';\r\n\r\nimport { AccountCircle, Error } from '@material-ui/icons';\r\n\r\nimport './LoginIcon.css';\r\n\r\nimport { LoginState } from '../states/LoginState';\r\n\r\n// Main Menu view\r\n@observer\r\nexport class LoginIcon extends React.Component<{ state: LoginState }> {\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (\r\n            <div>\r\n                <Button color={state.isLoggedInAnonymously ? \"secondary\" : \"inherit\"}\r\n                    onClick={evt => state.menuAnchorElement = evt.currentTarget}\r\n                >\r\n                    <AccountCircle />\r\n                    <Box width={5} />\r\n                    <Tooltip title={state.isLoggedInAnonymously ? \"Ensure this endpoint is not exposed to the public!\" : \"\"} >\r\n                        <Typography color={state.isLoggedInAnonymously ? \"secondary\" : \"inherit\"} >\r\n                            {state.isLoggedInAnonymously ? \"Anonymous\" : state.userName}\r\n                        </Typography>\r\n                    </Tooltip>\r\n                </Button>\r\n\r\n                {!state.isLoggedInAnonymously && (\r\n                    <Menu\r\n                        anchorEl={state.menuAnchorElement}\r\n                        keepMounted\r\n                        open={!!state.menuAnchorElement}\r\n                        onClose={() => state.menuAnchorElement = undefined}\r\n                    >\r\n                        <MenuItem onClick={() => state.logout()}>Login under a different name</MenuItem>\r\n                    </Menu>\r\n                )}\r\n\r\n                <Dialog open={!state.isLoggedIn}>\r\n                    <DialogContent>\r\n\r\n                        {!state.errorMessage ? (!state.allowedTaskHubNames ? (<>\r\n                            \r\n                            <Container className=\"login-progress\">\r\n                                <CircularProgress />\r\n                            </Container>\r\n                            <DialogContentText>Login in progress...</DialogContentText>\r\n\r\n                        </>) : (<>\r\n                                \r\n                            <DialogTitle>Select your Task Hub</DialogTitle>\r\n                            <List className=\"task-hub-list\">\r\n                                {state.allowedTaskHubNames.map(hubName => (\r\n                                    <ListItem button key={hubName}>\r\n                                        <Link href={state.locationPathName + hubName}>{hubName}</Link>\r\n                                    </ListItem>)\r\n                                )}\r\n                            </List>\r\n                            \r\n                        </>)): (<>\r\n                        \r\n                            <Container className=\"login-progress\">\r\n                                <Error color=\"secondary\" fontSize=\"large\" />\r\n                            </Container>\r\n                            <DialogContentText color=\"secondary\">Login failed. {state.errorMessage}</DialogContentText>\r\n                            \r\n                        </>)}\r\n\r\n                    </DialogContent>\r\n                </Dialog>\r\n            </div>\r\n        );\r\n    }\r\n}","import * as React from 'react';\r\nimport { observable, computed } from 'mobx'\r\nimport moment from 'moment';\r\n\r\n// Config object passed as a global variable via index.html\r\ndeclare const DfmClientConfig: {\r\n    theme: string,\r\n    showTimeAs: string\r\n};\r\n\r\n// Global observable context object with global settings and other cross-cutting concerns in it\r\nexport class DfmContext {\r\n\r\n    get theme(): string { return DfmClientConfig.theme; }\r\n\r\n    @computed\r\n    get showTimeAsLocal(): boolean {\r\n        return this._showTimeAsLocal;\r\n    }\r\n    set showTimeAsLocal(val) {\r\n        localStorage?.setItem('showTimeAs', val ? 'Local' : 'UTC');\r\n        this._showTimeAsLocal = val;\r\n    }\r\n\r\n    constructor() {\r\n        if (DfmClientConfig.showTimeAs !== 'Local') {\r\n            this._showTimeAsLocal = localStorage?.getItem('showTimeAs') === 'Local';\r\n        } else {\r\n            this._showTimeAsLocal = true;\r\n        }\r\n    }\r\n\r\n    // Prepares a moment for visualizing with @material-ui/pickers\r\n    public getMoment(t: moment.Moment): moment.Moment {\r\n\r\n        if (!t || !t.isValid()) {\r\n            return t;\r\n        }\r\n\r\n        // Need to call either .utc() or .local() on moment value, to make it _render_ correctly.\r\n        if (!this._showTimeAsLocal) {\r\n            t.utc();\r\n        } else {\r\n            t.local();\r\n        }\r\n\r\n        return t;\r\n    }\r\n\r\n    // Converts a moment taken from @material-ui/pickers\r\n    public setMoment(t: moment.Moment): moment.Moment {\r\n\r\n        if (!t || !t.isValid() || !!this._showTimeAsLocal) {\r\n            return t;\r\n        }\r\n\r\n        // Need to convert to UTC, because @material-ui/pickers always give us local moments\r\n        return moment(t.toISOString(true).slice(0, 19) + 'Z');\r\n    }\r\n\r\n    public formatDateTimeString(utcString: string): string {\r\n\r\n        if (!this._showTimeAsLocal || !utcString || utcString.length < 11) {\r\n            return utcString;\r\n        }\r\n\r\n        // need to handle milliseconds separately (because it might also be microseconds, and those are omitted by moment)\r\n        const dotPoint = utcString.lastIndexOf('.');\r\n        const milliseconds = (dotPoint >= 0) ? '.' + utcString.substring(dotPoint + 1, utcString.length - 1) : '';\r\n\r\n        return moment(utcString).format(`YYYY-MM-DDTHH:mm:ss`) + milliseconds;\r\n    }\r\n\r\n    @observable\r\n    private _showTimeAsLocal;\r\n}\r\n\r\nexport const DfmContextType = React.createContext<DfmContext>(new DfmContext());\r\nexport const dfmContextInstance = new DfmContext();","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    FormControlLabel, IconButton, Menu, MenuItem, Radio, RadioGroup, Typography\r\n} from '@material-ui/core';\r\n\r\nimport './MainMenu.css';\r\n\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\n\r\nimport { MainMenuState } from '../states/MainMenuState';\r\n\r\nimport { DfmContextType } from '../DfmContext';\r\n\r\n// Main Menu view\r\n@observer\r\nexport class MainMenu extends React.Component<{ state: MainMenuState, doRefresh: () => void }> {\r\n\r\n    static contextType = DfmContextType;\r\n    context!: React.ContextType<typeof DfmContextType>;\r\n\r\n    componentDidMount() {\r\n        // Querying the backend for connection info and displaying it in window title\r\n        this.props.state.setWindowTitle();\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (<>\r\n            <IconButton color=\"inherit\"\r\n                onClick={evt => state.menuAnchorElement = evt.currentTarget}\r\n            >\r\n                <MenuIcon/>\r\n            </IconButton>\r\n\r\n            <Menu\r\n                anchorEl={state.menuAnchorElement}\r\n                keepMounted\r\n                open={!!state.menuAnchorElement}\r\n                onClose={() => state.menuAnchorElement = undefined}\r\n            >\r\n                <RadioGroup row value={this.context.showTimeAsLocal.toString()} onChange={(evt) => {\r\n                    this.context.showTimeAsLocal = (evt.target as HTMLInputElement).value === 'true';\r\n                    state.menuAnchorElement = undefined;\r\n                    this.props.doRefresh();\r\n                }}>\r\n                    <Typography className=\"show-time-as-typography\">Show time as:</Typography>\r\n                    <FormControlLabel control={<Radio color=\"primary\"/>} label=\"UTC\" value={'false'} />\r\n                    <FormControlLabel control={<Radio color=\"primary\"/>} label=\"Local\" value={'true'} />\r\n                </RadioGroup>\r\n\r\n                <MenuItem onClick={() => state.showConnectionParamsDialog()}>Manage Storage Connection Settings...</MenuItem>\r\n                <MenuItem onClick={() => state.showPurgeHistoryDialog()}>Purge Instance History...</MenuItem>\r\n                <MenuItem onClick={() => state.showCleanEntityStorageDialog()}>Clean Entity Storage...</MenuItem>\r\n                <MenuItem onClick={() => state.showStartNewInstanceDialog()}>Start New Orchestration...</MenuItem>\r\n            </Menu>\r\n        </>);\r\n    }\r\n}","\r\n// A DTO used by DurableOrchestrationStatus.historyEvents\r\nexport class HistoryEvent {\r\n    Timestamp: string;\r\n    EventType: string;\r\n    EventId: number;\r\n    Name: string;\r\n    FunctionName: string;\r\n    ScheduledTime: string;\r\n    DurationInMs: number;\r\n    SubOrchestrationId: string;\r\n    Result: any;\r\n    Details: any;\r\n}\r\n\r\n// Could instead just iterate through field names of HistoryEvent, but reflection in TypeScript still looks tricky\r\nexport const HistoryEventFields = [\r\n    'Timestamp',\r\n    'EventType',\r\n    'EventId',\r\n    'Name',\r\n    'ScheduledTime',\r\n    'Result',\r\n    'Details',\r\n];\r\n\r\nexport const RuntimeStatuses = ['Completed', 'Running', 'Failed', 'Pending', 'Terminated', 'Canceled', 'ContinuedAsNew'] as const;\r\nexport type RuntimeStatus = typeof RuntimeStatuses[number];\r\n\r\nexport type EntityType = 'Orchestration' | 'DurableEntity';\r\n\r\nexport class EntityId {\r\n    name: string;\r\n    key: string;\r\n}\r\n\r\n// A DTO returned by DurableOrchestrationClient.getStatusAll()\r\nexport class DurableOrchestrationStatus {\r\n    instanceId: string;\r\n    name: string;\r\n    entityId: EntityId;\r\n    runtimeStatus: RuntimeStatus;\r\n    entityType: EntityType;\r\n    lastEvent: string;\r\n    input: any;\r\n    customStatus: string;\r\n    output: any;\r\n    createdTime: string;\r\n    lastUpdatedTime: string;\r\n    duration: number;\r\n    tabTemplateNames?: string[];\r\n\r\n    static getFunctionName(instance: DurableOrchestrationStatus): string {\r\n        return instance.entityType === 'DurableEntity' ? instance.entityId.name : instance.name;\r\n    }\r\n}\r\n\r\n// Could instead just iterate through field names of DurableOrchestrationStatus, but reflection in TypeScript still looks tricky\r\nexport const DurableOrchestrationStatusFields = [\r\n    'instanceId',\r\n    'name',\r\n    'createdTime',\r\n    'lastUpdatedTime',\r\n    'duration',\r\n    'runtimeStatus',\r\n    'lastEvent',\r\n    'input',\r\n    'output',\r\n    'customStatus'\r\n];","import * as React from 'react';\r\nimport { action } from 'mobx'\r\nimport { observer } from 'mobx-react';\r\n\r\nimport { IconButton, Snackbar, SnackbarContent } from '@material-ui/core';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport ErrorIcon from '@material-ui/icons/Error';\r\n\r\nimport './ErrorMessage.css';\r\n\r\nimport { ErrorMessageState } from '../states/ErrorMessageState';\r\n\r\n// Error Message Snackbar\r\n@observer\r\nexport class ErrorMessage extends React.Component<{ state: ErrorMessageState }> {\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (\r\n\r\n            <Snackbar\r\n                className=\"message-snackbar\"\r\n                anchorOrigin={{ vertical: 'top', horizontal: 'right' }}\r\n                open={!!state.errorMessage}\r\n                autoHideDuration={6000}\r\n                onClose={this.handleClose}\r\n            >\r\n                <SnackbarContent\r\n                    className=\"error-snackbar-content\"\r\n                    message={\r\n                        <span>\r\n                            <ErrorIcon className=\"error-icon\" />\r\n                            {state.errorMessage}\r\n                        </span>\r\n                    }\r\n                    action={[\r\n                        <IconButton\r\n                            key=\"close\"\r\n                            aria-label=\"Close\"\r\n                            color=\"inherit\"\r\n                            onClick={this.handleClose}\r\n                        >\r\n                            <CloseIcon />\r\n                        </IconButton>,\r\n                    ]}\r\n                />\r\n\r\n            </Snackbar>\r\n        );\r\n    }\r\n\r\n    @action.bound\r\n    private handleClose() {\r\n        this.props.state.errorMessage = '';\r\n    }\r\n}","import moment from 'moment';\r\n\r\nexport class DateTimeHelpers\r\n{\r\n    // This is the default range for @material-ui/pickers\r\n    private static MinMoment = moment('1900-01-01');\r\n    private static MaxMoment = moment('2100-01-01');\r\n\r\n    public static isValidMoment(t: moment.Moment): boolean {\r\n        return !!t && t.isValid() && t.isAfter(DateTimeHelpers.MinMoment) && t.isBefore(DateTimeHelpers.MaxMoment);\r\n    }\r\n\r\n    public static formatDuration(durationInMs: number): string {\r\n\r\n        if (isNaN(durationInMs) || (durationInMs < 0)) {\r\n            return '';\r\n        }\r\n\r\n        const days = Math.floor(durationInMs / 86400000);\r\n        var c = 0;\r\n        var result = '';\r\n\r\n        if (days > 0) {\r\n            result += days.toFixed(0) + 'd';\r\n            ++c;\r\n            durationInMs = durationInMs % 86400000;\r\n        }\r\n\r\n        const hours = Math.floor(durationInMs / 3600000);\r\n        if (hours > 0) {\r\n            result += hours.toFixed(0) + 'h';\r\n\r\n            if (++c > 1) {\r\n                return result;\r\n            }\r\n\r\n            durationInMs = durationInMs % 3600000;\r\n        }\r\n\r\n        const minutes = Math.floor(durationInMs / 60000);\r\n        if (minutes > 0) {\r\n            result += minutes.toFixed(0) + 'm';\r\n\r\n            if (++c > 1) {\r\n                return result;\r\n            }\r\n\r\n            durationInMs = durationInMs % 60000;\r\n        }\r\n\r\n        const seconds = Math.floor(durationInMs / 1000);\r\n        if (seconds > 0) {\r\n            result += seconds.toFixed(0) + 's';\r\n\r\n            if (++c > 1) {\r\n                return result;\r\n            }\r\n\r\n            durationInMs = durationInMs % 1000;\r\n        }\r\n\r\n        if (durationInMs > 0) {\r\n            result += durationInMs.toFixed(0) + 'ms';\r\n        }\r\n\r\n        if (!result) {\r\n            result = '0ms';\r\n        }\r\n\r\n        return result;\r\n    }\r\n}","import { observable } from 'mobx'\r\n\r\n// State of Error Message snackbar\r\nexport class ErrorMessageState {\r\n\r\n    @observable\r\n    errorMessage: string = '';\r\n}","import { observable } from 'mobx'\r\n\r\nexport class CancelToken {\r\n    @observable\r\n    inProgress: boolean = false;\r\n    @observable\r\n    isCancelled: boolean = false;\r\n}\r\n","import { observable, computed } from 'mobx'\r\n\r\nimport { DurableOrchestrationStatus } from '../DurableOrchestrationStatus';\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { ITypedLocalStorage } from '../ITypedLocalStorage';\r\nimport { CancelToken } from '../../CancelToken';\r\n\r\n// Represents the state of a tab in the results pane\r\nexport interface IResultsTabState {\r\n\r\n    reset(): void;\r\n\r\n    load(filterClause: string, cancelToken: CancelToken, isAutoRefresh: boolean): Promise<void>;\r\n}\r\n\r\n// Resulting list of orchestrations represented as a plain table\r\nexport class ResultsListTabState implements IResultsTabState {\r\n\r\n    @observable\r\n    longJsonDialogState = {};\r\n    \r\n    @observable\r\n    columnUnderMouse: string;\r\n\r\n    @computed\r\n    get hiddenColumns(): string[] { return this._hiddenColumns; }\r\n\r\n    @computed\r\n    get orchestrations(): DurableOrchestrationStatus[] { return this._orchestrations; }\r\n\r\n    @computed\r\n    get orderByDirection(): ('asc' | 'desc') { return this._orderByDirection; }\r\n\r\n    @computed\r\n    get orderBy(): string { return this._orderBy; }\r\n    set orderBy(val: string) {\r\n\r\n        if (this._orderBy !== val) {\r\n\r\n            this._orderBy = val;\r\n            this._orderByDirection = 'asc';\r\n\r\n        } else if (this._orderByDirection === 'desc') {\r\n\r\n            this.resetOrderBy();\r\n        }\r\n        else {\r\n            this._orderByDirection = 'desc';\r\n        }\r\n\r\n        this._refresh();\r\n    }\r\n\r\n    get backendClient(): IBackendClient { return this._backendClient; }\r\n\r\n    constructor(private _backendClient: IBackendClient,\r\n        private _localStorage: ITypedLocalStorage<ResultsListTabState>, private _refresh: () => void) {\r\n\r\n        const orderByString = this._localStorage.getItem('orderBy');\r\n        if (!!orderByString) {\r\n            this._orderBy = orderByString;\r\n        }\r\n\r\n        const orderByDirectionString = this._localStorage.getItem('orderByDirection');\r\n        if (!!orderByDirectionString) {\r\n            this._orderByDirection = orderByDirectionString as 'asc' | 'desc';\r\n        }\r\n\r\n        const hiddenColumnsString = this._localStorage.getItem('hiddenColumns');\r\n        if (!!hiddenColumnsString) {\r\n            this._hiddenColumns = hiddenColumnsString.split('|');\r\n        }\r\n    }\r\n\r\n    hideColumn(name: string) {\r\n        this._hiddenColumns.push(name);\r\n        this._localStorage.setItem('hiddenColumns', this._hiddenColumns.join('|'));\r\n    }\r\n\r\n    unhide() {\r\n        this._hiddenColumns = [];\r\n        this._localStorage.removeItem('hiddenColumns');\r\n\r\n        this._refresh();\r\n    }\r\n\r\n    resetOrderBy() {\r\n        this._orderBy = '';\r\n        this._orderByDirection = 'asc';\r\n    }\r\n\r\n    reset() {\r\n\r\n        this._orchestrations = [];\r\n        this._noMorePagesToLoad = false;\r\n    }\r\n\r\n    load(filterClause: string, cancelToken: CancelToken, isAutoRefresh: boolean = false): Promise<void> {\r\n\r\n        if (isAutoRefresh) { \r\n\r\n            this._noMorePagesToLoad = false;\r\n\r\n        } else {\r\n\r\n            if (!!this._noMorePagesToLoad) {\r\n                return Promise.resolve();\r\n            }\r\n\r\n            // persisting state as a batch\r\n            this._localStorage.setItems([\r\n                { fieldName: 'orderBy', value: this._orderBy },\r\n                { fieldName: 'orderByDirection', value: this._orderByDirection },\r\n            ]);            \r\n        }\r\n\r\n        // In auto-refresh mode only refreshing the first page\r\n        const skip = isAutoRefresh ? 0 : this._orchestrations.length;\r\n\r\n        const orderByClause = !!this._orderBy ? `&$orderby=${this._orderBy} ${this.orderByDirection}` : '';\r\n        const hiddenColumnsClause = !this._hiddenColumns.length ? '' : `&hidden-columns=${this._hiddenColumns.join('|')}`;\r\n\r\n        const uri = `/orchestrations?$top=${this._pageSize}&$skip=${skip}${filterClause}${orderByClause}${hiddenColumnsClause}`;\r\n\r\n        return this._backendClient.call('GET', uri).then(response => {\r\n\r\n            if (cancelToken.isCancelled) {\r\n                return;\r\n            }\r\n            \r\n            if (isAutoRefresh) {\r\n                this._orchestrations = response;\r\n            } else {\r\n                this._orchestrations.push(...response);\r\n            }\r\n\r\n            if (!response.length) {\r\n\r\n                // Stop the infinite scrolling\r\n                this._noMorePagesToLoad = true;\r\n            }\r\n        });\r\n    }\r\n\r\n    @observable\r\n    private _orchestrations: DurableOrchestrationStatus[] = [];\r\n    @observable\r\n    private _orderByDirection: ('asc' | 'desc') = 'asc';\r\n    @observable\r\n    private _orderBy: string = '';\r\n\r\n    @observable\r\n    private _hiddenColumns: string[] = [];\r\n\r\n    private _noMorePagesToLoad: boolean = false;\r\n    private readonly _pageSize = 50;\r\n}","import axios, { Method } from 'axios';\r\nimport { IBackendClient } from './IBackendClient';\r\n\r\n// DFM-specific route prefix, that is passed to us from the backend via a global static variable\r\ndeclare const DfmRoutePrefix: string;\r\n\r\nconst RoutePrefix = !process.env.REACT_APP_BACKEND_BASE_URI ? (!DfmRoutePrefix ? '/' : `/${DfmRoutePrefix}/`) : process.env.REACT_APP_BACKEND_BASE_URI + '/';\r\nexport const BackendUri = RoutePrefix + process.env.REACT_APP_BACKEND_PATH;\r\n\r\n// Common IBackendClient implementation, sends HTTP requests directly\r\nexport class BackendClient implements IBackendClient {\r\n\r\n    get isVsCode(): boolean { return false; }\r\n\r\n    get routePrefixAndTaskHubName(): string { return RoutePrefix + this._getTaskHubName(); }\r\n\r\n    constructor(private _getTaskHubName: () => string, private _getAuthorizationHeaderAsync: () => Promise<{ Authorization: string }>) {\r\n    }\r\n\r\n    call(method: Method, url: string, data?: any): Promise<any> {\r\n\r\n        // Two-bugs away\r\n        if (!['get', 'post', 'put'].includes(method.toLowerCase())) {\r\n            return Promise.reject(new Error(`Method ${method} not supported`));\r\n        }\r\n\r\n        return new Promise<any>((resolve, reject) => {\r\n\r\n            this._getAuthorizationHeaderAsync().then(headers => {\r\n\r\n                axios.request({\r\n                    url: BackendUri + '/' + this._getTaskHubName() + url,\r\n                    method, data, headers\r\n                }).then(r => { resolve(r.data); }, reject);\r\n            });\r\n        });\r\n    }\r\n}","import { observable, computed } from 'mobx'\r\nimport axios from 'axios';\r\nimport * as Msal from 'msal';\r\n\r\nimport { ErrorMessageState } from './ErrorMessageState';\r\nimport { BackendUri } from '../services/BackendClient';\r\n\r\n// DFM-specific route prefix, that is passed to us from the backend via a global static variable\r\ndeclare const DfmRoutePrefix: string;\r\n\r\nexport const OrchestrationsPathPrefix = `/orchestrations/`;\r\n\r\n// Login State\r\nexport class LoginState extends ErrorMessageState {\r\n\r\n    @computed\r\n    get isLoggedIn(): boolean { return this._isLoggedIn; };\r\n\r\n    @computed\r\n    get isLoggedInAnonymously(): boolean { return !this._userName; };\r\n\r\n    @computed\r\n    get userName(): string { return this._userName; };\r\n\r\n    @computed\r\n    get taskHubName(): string { return this._taskHubName;  }\r\n\r\n    @computed\r\n    get allowedTaskHubNames(): string[] { return this._allowedTaskHubNames; }\r\n\r\n    @observable\r\n    menuAnchorElement?: Element;\r\n\r\n    // Returns window.location.pathname minus DFM's client-side routing\r\n    get locationPathName(): string {\r\n\r\n        var result = window.location.pathname;\r\n\r\n        const pos = result.lastIndexOf(OrchestrationsPathPrefix);\r\n        if (pos >= 0) {\r\n            result = result.substring(0, pos);\r\n        }\r\n\r\n        if (!result.endsWith('/')) {\r\n            result += '/';\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    // Returns the site's root URI (everything _before_ Task Hub name)\r\n    get rootUri(): string {\r\n\r\n        const hubName = this.tryGetTaskHubName();\r\n        if (!!hubName) {\r\n\r\n            const pos = window.location.href.toLowerCase().lastIndexOf('/' + hubName.toLowerCase());\r\n            if (pos >= 0) {\r\n                return window.location.href.substring(0, pos);\r\n            }\r\n        }\r\n\r\n        return window.location.origin +\r\n            (\r\n                window.location.pathname.endsWith('/') ?\r\n                    window.location.pathname.substr(0, window.location.pathname.length - 1) :\r\n                    window.location.pathname\r\n            );\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        // Turning redirects off, as we don't ever need them anyway\r\n        axios.defaults.maxRedirects = 0;\r\n\r\n        this.login();\r\n    }\r\n\r\n    login() {\r\n        const uri = `${BackendUri}/easyauth-config`;\r\n        axios.get(uri).then(response => this.loginWithEasyAuthConfig(response.data), err => {\r\n            this.errorMessage = `${err.message}.${(!!err.response ? err.response.data : '')}`;\r\n        });\r\n    }\r\n\r\n    logout() {\r\n        this.menuAnchorElement = undefined;\r\n\r\n        if (!this._aadApp) {\r\n\r\n            window.location.replace('/.auth/logout');\r\n\r\n        } else {\r\n            \r\n            this._aadApp.logout();\r\n        }\r\n    }\r\n\r\n    getAuthorizationHeaderAsync() {\r\n\r\n        // Let's think we're on localhost and proceed with no auth\r\n        if (!this._aadApp) {\r\n            return new Promise<undefined>((resolve, reject) => resolve(undefined));\r\n        }\r\n\r\n        return new Promise<{ Authorization: string }>((resolve, reject) => {\r\n            // Obtaining a token to access our own AAD app\r\n            const authParams: Msal.AuthenticationParameters = {\r\n                scopes: [this._aadApp.getCurrentConfiguration().auth.clientId]\r\n            };\r\n\r\n            this._aadApp.acquireTokenSilent(authParams)\r\n                .then((authResponse) => {\r\n\r\n                    var accessToken = authResponse.accessToken;\r\n                    if (!accessToken) {\r\n                        // https://github.com/AzureAD/microsoft-authentication-library-for-js/issues/736\r\n                        // accessToken might randomly be returned as null, in which case we can probably use id_token\r\n                        // (which is supposed to be the same)\r\n                        console.log('DFM: accessToken is null, so using idToken.rawIdToken instead');\r\n                        accessToken = authResponse.idToken.rawIdToken;\r\n                    }\r\n\r\n                    resolve({ Authorization: `Bearer ${accessToken}` });\r\n\r\n                }, err => {\r\n                    // If silent token aquiring failed, then just redirecting the user back to AAD, \r\n                    // so that the page is reloaded anyway.\r\n                    // This is supposed to happen very rarely, as default refresh token lifetime is quite long.  \r\n                    console.log(`DFM: acquireTokenSilent() failed (${err}), so calling acquireTokenRedirect()...`);\r\n                    this._aadApp.acquireTokenRedirect(authParams);\r\n                });\r\n        });\r\n    }\r\n\r\n    @observable\r\n    private _isLoggedIn: boolean = false;\r\n\r\n    @observable\r\n    private _userName: string;\r\n\r\n    @observable\r\n    private _taskHubName: string;\r\n\r\n    @observable\r\n    private _allowedTaskHubNames: string[];\r\n\r\n    private _aadApp: Msal.UserAgentApplication;\r\n\r\n    private loginWithEasyAuthConfig(config: {userName: string, clientId: string, authority: string}) {\r\n\r\n        if (!config.clientId) {\r\n            // Let's think we're on localhost or using server-directed login flow\r\n            // and proceed with no client-side auth\r\n            \r\n            this._userName = config.userName;\r\n\r\n            // Reloading the page upon cookie expiration\r\n            axios.interceptors.response.use(response => response, err => {\r\n\r\n                // Couldn't find a better way to detect this\r\n                if (err.message === 'Network Error') {\r\n                    window.location.reload(true);\r\n                }\r\n\r\n                return Promise.reject(err);\r\n            });\r\n\r\n            this.initializeTaskHubNameAndConfirmLogin();\r\n            return;\r\n        }\r\n\r\n        // Configuring MSAL with values received from backend\r\n        this._aadApp = new Msal.UserAgentApplication({\r\n            auth: {\r\n                clientId: config.clientId,\r\n                authority: config.authority,\r\n                redirectUri: this.rootUri\r\n            }\r\n        })\r\n\r\n        // Checking if it was a redirect from AAD\r\n        this._aadApp.handleRedirectCallback(() => { }, (authErr: Msal.AuthError, accountState: string) => {\r\n\r\n            console.log(`Failed to handle login redirect. name: ${authErr.name}, message: ${authErr.message}, errorCode: ${authErr.errorCode}, errorMessage: ${authErr.errorMessage}, accountState: ${accountState}`);\r\n        });\r\n\r\n        const account = this._aadApp.getAccount();\r\n\r\n        if (!account) {\r\n            // Redirecting user to AAD. Redirect flow is more reliable (doesn't need popups enabled)\r\n            this._aadApp.loginRedirect();\r\n\r\n        } else {\r\n            // We've logged in successfully. Setting user name.\r\n            this._userName = account.userName;\r\n            this.initializeTaskHubNameAndConfirmLogin();\r\n        }\r\n    }\r\n\r\n    private initializeTaskHubNameAndConfirmLogin(): void {\r\n\r\n        const hubName = this.tryGetTaskHubName();\r\n        if (!!hubName) {\r\n\r\n            this._taskHubName = hubName;\r\n            this._isLoggedIn = true;\r\n            return;\r\n        }\r\n\r\n        // Trying to load the list of allowed Task Hubs from the backend\r\n        this.getAuthorizationHeaderAsync().then(headers => {\r\n\r\n            const uri = `${BackendUri}/task-hub-names`;\r\n            axios.get(uri, { headers }).then(response => {\r\n                \r\n                const hubNames: string[] = response.data;\r\n\r\n                if (hubNames.length === 1) {\r\n                    \r\n                    // Redirecting to that Task Hub\r\n                    window.location.pathname = this.locationPathName + hubNames[0];\r\n                } else {\r\n\r\n                    // Asking the user to choose from\r\n                    this._allowedTaskHubNames = hubNames;\r\n                }\r\n\r\n            }, err => {\r\n                this.errorMessage = `${err.message}.${(!!err.response ? err.response.data : '')}`;\r\n            });\r\n        });\r\n    }\r\n\r\n    // Extracts Task Hub name from window.location.href, still honoring client-side routing and subpaths\r\n    private tryGetTaskHubName(): string {\r\n\r\n        const locationPathName = this.locationPathName;\r\n\r\n        // If current path ends with DfmRoutePrefix, then it doesn't actually contain Task Hub name\r\n        if (locationPathName.toLowerCase().endsWith(`/${DfmRoutePrefix.toLowerCase()}/`)) {\r\n            return null;\r\n        }\r\n\r\n        const pathParts = locationPathName.split('/').filter(p => !!p);\r\n        if (pathParts.length < 1) {\r\n            return null;\r\n        }\r\n\r\n        // Consider the last path part to be the Task Hub name.\r\n        // This should work even if we're hosted under some subpath\r\n        return pathParts[pathParts.length - 1];\r\n    }\r\n}","import { observable } from 'mobx';\r\nimport mermaid from 'mermaid';\r\nimport { DateTimeHelpers } from '../DateTimeHelpers';\r\n\r\n// Base class for all mermaid-related states\r\nexport abstract class MermaidDiagramStateBase {\r\n\r\n    @observable\r\n    protected _diagramCode: string;\r\n    @observable\r\n    protected _diagramSvg: string;\r\n\r\n    protected initMermaidWhenNeeded() : void {\r\n\r\n        if (MermaidDiagramStateBase._mermaidInitialized) { \r\n            return;\r\n        }\r\n\r\n        mermaid.initialize({\r\n            startOnLoad: true,\r\n            \r\n            sequence: {\r\n                noteMargin: 0,\r\n                boxMargin: 5,\r\n                boxTextMargin: 5\r\n            },\r\n\r\n            flowchart: {\r\n                curve: 'Basis',\r\n                useMaxWidth: true,\r\n                htmlLabels: false\r\n            }\r\n        });\r\n\r\n        MermaidDiagramStateBase._mermaidInitialized = true;\r\n    }\r\n\r\n    protected escapeTitle(id: string) {\r\n\r\n        return id.replace(/[@:;]/g, ' ');\r\n    }\r\n\r\n    protected formatDuration(durationInMs: number): string {\r\n\r\n        const result = DateTimeHelpers.formatDuration(durationInMs);\r\n        return !result ? '' : `(${result})`;\r\n    }\r\n\r\n    protected formatDurationInSeconds(durationInMs: number): string {\r\n\r\n        return Math.ceil(durationInMs / 1000).toFixed(0) + 's';\r\n    }\r\n\r\n    private static _mermaidInitialized = false;\r\n}","import { computed } from 'mobx'\r\nimport mermaid from 'mermaid';\r\nimport moment from 'moment';\r\n\r\nimport { DurableOrchestrationStatus } from '../DurableOrchestrationStatus';\r\nimport { OrchestrationsPathPrefix } from '../LoginState';\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { CancelToken } from '../../CancelToken';\r\nimport { IResultsTabState } from './ResultsListTabState';\r\nimport { MermaidDiagramStateBase } from '../MermaidDiagramStateBase';\r\nimport { dfmContextInstance } from '../../DfmContext';\r\n\r\n// Resulting list of orchestrations represented as a Gantt chart\r\nexport class ResultsGanttDiagramTabState extends MermaidDiagramStateBase implements IResultsTabState {\r\n\r\n    @computed\r\n    get rawHtml(): string { return this._diagramSvg; }\r\n\r\n    @computed\r\n    get diagramCode(): string { return this._diagramCode; }\r\n\r\n    constructor(private _backendClient: IBackendClient) {\r\n        super();\r\n    }\r\n\r\n    reset() {\r\n\r\n        this._diagramCode = '';\r\n        this._diagramSvg = '';\r\n        this._instances = [];\r\n    }\r\n\r\n    load(filterClause: string, cancelToken: CancelToken, isAutoRefresh: boolean): Promise<void> {\r\n\r\n        this.initMermaidWhenNeeded();\r\n\r\n        return new Promise<void>((resolve, reject) => {\r\n\r\n            const uri = `/orchestrations?$top=500&$orderby=createdTime asc${filterClause}`;\r\n\r\n            this._backendClient.call('GET', uri).then((instances: DurableOrchestrationStatus[]) => {\r\n\r\n                this._instances = instances;\r\n\r\n                if (cancelToken.isCancelled) {\r\n                    resolve();\r\n                    return;\r\n                }\r\n\r\n                this._diagramCode = 'gantt \\n' +\r\n                    `title Gantt Chart (${instances.length} instances shown) \\n` +\r\n                    'dateFormat YYYY-MM-DDTHH:mm:ss \\n' +\r\n                    this.renderDiagram(instances);\r\n\r\n                // Very much unknown, why this line is needed. Without it sometimes the diagrams fail to re-render\r\n                this._diagramSvg = '';\r\n\r\n                try {\r\n\r\n                    mermaid.render('mermaidSvgId', this._diagramCode, (svg) => {\r\n                        this._diagramSvg = svg;\r\n                        resolve();\r\n                    });\r\n\r\n                } catch (err) {\r\n                    reject(err);\r\n                }\r\n\r\n            }, reject);\r\n        });\r\n    }\r\n\r\n    // Opens the selected orchestrationId in a new tab\r\n    goto(oneBasedInstanceIndex: number) {\r\n\r\n        if (!!oneBasedInstanceIndex && oneBasedInstanceIndex <= this._instances.length) {\r\n\r\n            const instanceId = this._instances[oneBasedInstanceIndex - 1].instanceId;\r\n\r\n            if (this._backendClient.isVsCode) {\r\n                this._backendClient.call('OpenInNewWindow', instanceId);\r\n            } else {\r\n                window.open(`${this._backendClient.routePrefixAndTaskHubName}${OrchestrationsPathPrefix}${instanceId}`);\r\n            }            \r\n        }\r\n    }\r\n\r\n    private _instances: DurableOrchestrationStatus[] = [];\r\n\r\n    private renderDiagram(instances: DurableOrchestrationStatus[]): string {\r\n\r\n        var result: string = '';\r\n\r\n        var prevSectionName = '';\r\n        var sectionNr = 0;\r\n        for (const instance of instances) {\r\n\r\n            var nextLine = '';\r\n\r\n            // Grouping instances by their type\r\n            const sectionName = DurableOrchestrationStatus.getFunctionName(instance);\r\n            if (sectionName !== prevSectionName) {\r\n                \r\n                nextLine = `section ${++sectionNr}. ${this.escapeTitle(sectionName)} \\n`;\r\n                prevSectionName = sectionName;\r\n            }\r\n\r\n            const instanceId = instance.entityType === 'DurableEntity' ? instance.entityId.key : instance.instanceId;\r\n            const durationInMs = new Date(instance.lastUpdatedTime).getTime() - new Date(instance.createdTime).getTime();\r\n\r\n            nextLine += `${this.escapeTitle(instanceId)} ${this.formatDuration(durationInMs)}: active, ${this.formatDateTime(instance.createdTime)}, ${this.formatDurationInSeconds(durationInMs)} \\n`;\r\n            \r\n            result += nextLine;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private formatDateTime(utcDateTimeString: string): string {\r\n\r\n        if (!dfmContextInstance.showTimeAsLocal) {\r\n            return utcDateTimeString.substr(0, 19);\r\n        }\r\n\r\n        return moment(utcDateTimeString).format('YYYY-MM-DDTHH:mm:ss')\r\n    }\r\n}","import { observable, computed } from 'mobx'\r\nimport moment from 'moment';\r\n\r\nimport { DurableOrchestrationStatus } from '../DurableOrchestrationStatus';\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { CancelToken } from '../../CancelToken';\r\nimport { IResultsTabState } from './ResultsListTabState';\r\nimport { TimeRangeEnum } from './OrchestrationsState';\r\n\r\ntype HistogramColumn = { x0: number, x: number, y: number };\r\ntype TimeInterval = { timeFrom: moment.Moment, timeTill: moment.Moment, timeRange: TimeRangeEnum };\r\n\r\n// Resulting list of orchestrations represented as a Gantt chart\r\nexport class ResultsHistogramTabState implements IResultsTabState {\r\n\r\n    @computed\r\n    get zoomedIn() { return this._zoomedIn; }\r\n\r\n    @computed\r\n    get histograms() { return this._histograms; }\r\n\r\n    @computed\r\n    get numOfInstancesShown() { return this._numOfInstancesShown; }\r\n\r\n    get counts() { return this._counts; }\r\n\r\n    get timeRangeInMilliseconds(): number {\r\n        return this._timeRangeInMilliseconds;\r\n    }\r\n\r\n    constructor(private _backendClient: IBackendClient,\r\n        private _filterState: TimeInterval & { reloadOrchestrations: () => void, cancel: () => void })\r\n    {\r\n    }\r\n\r\n    reset() {\r\n    }\r\n\r\n    load(filterClause: string, cancelToken: CancelToken, isAutoRefresh: boolean): Promise<void> {\r\n\r\n        if (!this._applyingZoom && !this._zoomedIn) {\r\n\r\n            this._originalTimeInterval = {\r\n                timeFrom: this._filterState.timeFrom,\r\n                timeTill: this._filterState.timeTill,\r\n                timeRange: this._filterState.timeRange\r\n            };\r\n        }\r\n\r\n        this._numOfInstancesShown = 0;\r\n        this._histograms = {};\r\n        this._counts = {};\r\n\r\n        const startTime = this._filterState.timeFrom.valueOf();\r\n        var bucketLength = Math.ceil((this._filterState.timeTill.valueOf() - startTime) / this._numOfIntervals);\r\n        if (bucketLength <= 0) {\r\n            bucketLength = 1;\r\n        }\r\n\r\n        // Need to remember this value, for later time axis rendering\r\n        this._timeRangeInMilliseconds = this._filterState.timeTill.valueOf() - this._filterState.timeFrom.valueOf();\r\n\r\n        return this.loadNextBatch(filterClause, startTime, bucketLength, 0, cancelToken);\r\n    }\r\n\r\n    applyZoom(left: Date, right: Date) {\r\n\r\n        this._numOfInstancesShown = 0;\r\n\r\n        this._filterState.cancel();\r\n        \r\n        // rounding to next second\r\n        const from = Math.floor(left.getTime() / 1000) * 1000;\r\n        const till = Math.ceil(right.getTime() / 1000) * 1000;\r\n\r\n        this._filterState.timeFrom = moment(from);\r\n        this._filterState.timeTill = moment(till);\r\n\r\n        this._applyingZoom = true;\r\n        try {\r\n            this._filterState.reloadOrchestrations();\r\n        } finally {\r\n            this._applyingZoom = false;\r\n        }\r\n\r\n        this._zoomedIn = true;\r\n    }\r\n\r\n    resetZoom() {\r\n\r\n        if (!this._zoomedIn || !this._originalTimeInterval) {\r\n            return;\r\n        }\r\n\r\n        this._zoomedIn = false;\r\n\r\n        this._filterState.cancel();\r\n\r\n        this._filterState.timeFrom = this._originalTimeInterval.timeFrom;\r\n        this._filterState.timeTill = this._originalTimeInterval.timeTill;\r\n        this._filterState.timeRange = this._originalTimeInterval.timeRange;\r\n    }\r\n\r\n    @observable\r\n    private _histograms: { [typeName: string]: HistogramColumn[]; } = {};\r\n\r\n    private _counts: { [typeName: string]: number; } = {};\r\n\r\n    @observable\r\n    private _numOfInstancesShown: number = 0;\r\n\r\n    @observable\r\n    private _zoomedIn = false;\r\n\r\n    private _originalTimeInterval: TimeInterval = null;\r\n    private _applyingZoom = false;\r\n    private _timeRangeInMilliseconds = 0;\r\n\r\n    private readonly _numOfIntervals = 200;\r\n    private readonly _pageSize = 1000;\r\n\r\n    private loadNextBatch(filterClause: string, startTime: number, bucketLength: number, pageNumber: number, cancelToken: CancelToken): Promise<void> {\r\n\r\n        const uri = `/orchestrations?$top=${this._pageSize}&$skip=${this._numOfInstancesShown}${filterClause}`;\r\n\r\n        return this._backendClient.call('GET', uri).then((instances: DurableOrchestrationStatus[]) => {\r\n\r\n            if (cancelToken.isCancelled) {\r\n                return Promise.resolve();\r\n            }\r\n\r\n            for (var instance of instances) {\r\n\r\n                const instanceTypeName = DurableOrchestrationStatus.getFunctionName(instance);\r\n\r\n                if (!this._histograms[instanceTypeName]) {\r\n                    \r\n                    const emptyHistogram = [];\r\n                    for (var i = 0; i < this._numOfIntervals; i++) {\r\n                        emptyHistogram[i] = { x0: startTime + i * bucketLength, x: startTime + (i + 1) * bucketLength, y: 0 };\r\n                    }\r\n                    this._histograms[instanceTypeName] = emptyHistogram;\r\n                }\r\n\r\n                const instanceStartPos = Math.floor((new Date(instance.createdTime).getTime() - startTime) / bucketLength);\r\n                if (instanceStartPos < 0 || instanceStartPos >= this._numOfIntervals) {\r\n                    continue;\r\n                }\r\n\r\n                this._histograms[instanceTypeName][instanceStartPos].y += 1;\r\n\r\n                if (!this._counts[instanceTypeName]) {\r\n                    this._counts[instanceTypeName] = 1;\r\n                } else {\r\n                    this._counts[instanceTypeName] += 1;\r\n                }\r\n            }\r\n\r\n            this._numOfInstancesShown += instances.length;\r\n\r\n            if (instances.length === this._pageSize) {\r\n                \r\n                return this.loadNextBatch(filterClause, startTime, bucketLength, pageNumber + 1, cancelToken);\r\n            }\r\n        });\r\n    }\r\n}","import { observable, computed } from 'mobx';\r\n\r\nimport { IBackendClient } from '../services/IBackendClient';\r\nimport { MermaidDiagramStateBase } from './MermaidDiagramStateBase';\r\nimport { FunctionsMap, ProxiesMap } from './az-func-as-a-graph/FunctionsMap';\r\n\r\nexport type TraversalResult = {\r\n    functions: FunctionsMap;\r\n    proxies: ProxiesMap;\r\n    iconsSvg: string;\r\n};\r\n\r\n// ID of an embedded SVG element containing Azure service icons. Should be present in index.html\r\nconst AllAzureIconsSvgElementId = \"all-azure-icons-svg\";\r\n\r\n// Base class for all Function Graph states\r\nexport class FunctionGraphStateBase extends MermaidDiagramStateBase {\r\n\r\n    @computed\r\n    get diagramCode(): string { return this._diagramCode; };\r\n\r\n    @computed\r\n    get diagramSvg(): string { return this._diagramSvg; };\r\n\r\n    @computed\r\n    get functionsLoaded(): boolean { return !!this._traversalResult; };\r\n\r\n    get backendClient(): IBackendClient { return this._backendClient; }\r\n\r\n    constructor(protected _backendClient: IBackendClient) {\r\n        super();\r\n    }\r\n\r\n    gotoFunctionCode(functionName: string): void {\r\n\r\n        if (this.backendClient.isVsCode) {\r\n            \r\n            this.backendClient.call('GotoFunctionCode', functionName).then(() => { }, err => {\r\n                console.log(`Failed to goto function code: ${err.message}`);\r\n            });\r\n\r\n        } else {\r\n\r\n            var functionOrProxy = null;\r\n\r\n            if (functionName.startsWith('proxy.')) {\r\n                \r\n                functionOrProxy = this._traversalResult.proxies[functionName.substr(6)];\r\n\r\n            } else {\r\n\r\n                functionOrProxy = this._traversalResult.functions[functionName];\r\n            }\r\n\r\n            if (!!functionOrProxy && !!functionOrProxy.filePath) {\r\n                window.open(functionOrProxy.filePath);\r\n            }\r\n        }\r\n    }\r\n\r\n    saveAsJson(): void {\r\n\r\n        this.backendClient.call('SaveFunctionGraphAsJson', '').then(() => { }, err => {\r\n            console.log(`Failed to goto function code: ${err.message}`);\r\n        });\r\n    }\r\n\r\n    @observable\r\n    protected _renderFunctions: boolean = true;\r\n    @observable\r\n    protected _renderProxies: boolean = true;\r\n    @observable\r\n    protected _traversalResult: TraversalResult;\r\n\r\n    protected applyIcons(svg: string): string {\r\n\r\n        const iconsSvgElement = document.getElementById(AllAzureIconsSvgElementId);\r\n        if (!iconsSvgElement) {\r\n            return svg;\r\n        }\r\n\r\n        // Placing icons code into a <defs> block at the top\r\n        svg = svg.replace(`><style>`, `>\\n<defs>\\n${iconsSvgElement.innerHTML}</defs>\\n<style>`);\r\n\r\n        // Adding <use> blocks referencing relevant icons\r\n        svg = svg.replace(/<g class=\"node (\\w+).*?<g class=\"label\" transform=\"translate\\([0-9,.-]+\\)\"><g transform=\"translate\\([0-9,.-]+\\)\">/g,\r\n            `$&<use href=\"#az-icon-$1\" width=\"20px\" height=\"20px\"/>`);\r\n\r\n        return svg;\r\n    }\r\n}","import { FunctionsMap, ProxiesMap } from './FunctionsMap';\r\n\r\nconst space = '#32;';\r\n\r\nfunction getTriggerBindingText(binding: any): string {\r\n\r\n    switch (binding.type) {\r\n        case 'httpTrigger':\r\n            return `${binding.authLevel === 'anonymous' ? '#127760;' : '#128274;'} http${!binding.methods ? '' : ':[' + binding.methods.join(',') + ']'}${!binding.route ? '' : ':' + binding.route}`;\r\n        case 'blobTrigger':\r\n            return `${space}blob:${binding.path ?? ''}`;\r\n        case 'cosmosDBTrigger':\r\n            return `${space}cosmosDB:${binding.databaseName ?? ''}:${binding.collectionName ?? ''}`;\r\n        case 'eventHubTrigger':\r\n            return `${space}eventHub:${binding.eventHubName ?? ''}`;\r\n        case 'serviceBusTrigger':\r\n            return `${space}serviceBus:${!binding.queueName ? (binding.topicName ?? '') : binding.queueName}${!binding.subscriptionName ? '' : ':' + binding.subscriptionName}`;\r\n        case 'queueTrigger':\r\n            return `${space}queue:${binding.queueName ?? ''}`;\r\n        case 'timerTrigger':\r\n            return `${space}timer:${binding.schedule ?? ''}`;\r\n        default:\r\n            return `${space}${binding.type}`;\r\n    }\r\n}\r\n\r\nfunction getBindingText(binding: any): string {\r\n\r\n    switch (binding.type) {\r\n        case 'table':\r\n            return `${space}table:${binding.tableName ?? ''}`;\r\n        case 'blob':\r\n            return `${space}blob:${binding.path ?? ''}`;\r\n        case 'cosmosDB':\r\n            return `${space}cosmosDB:${binding.databaseName ?? ''}:${binding.collectionName ?? ''}`;\r\n        case 'eventHub':\r\n            return `${space}eventHub:${binding.eventHubName ?? ''}`;\r\n        case 'serviceBus':\r\n            return `${space}serviceBus:${!binding.queueName ? (binding.topicName ?? '') : binding.queueName}${!binding.subscriptionName ? '' : ':' + binding.subscriptionName}`;\r\n        case 'queue':\r\n            return `${space}queue:${binding.queueName ?? ''}`;\r\n        default:\r\n            return `${space}${binding.type}`;\r\n    }\r\n}\r\n\r\nexport type GraphSettings = {\r\n    doNotRenderFunctions?: boolean,\r\n    doNotRenderProxies?: boolean,\r\n};\r\n\r\n// Translates functions and their bindings into a Mermaid Flowchart diagram code\r\nexport function buildFunctionDiagramCode(functionsMap: FunctionsMap, proxiesMap: ProxiesMap, settings: GraphSettings = {}): string {\r\n\r\n    var code = '';\r\n\r\n    if (!settings.doNotRenderFunctions) {\r\n        \r\n        const functions = [];\r\n\r\n        // Determine what kind of function this one is\r\n        for (const name in functionsMap) {\r\n            const func = functionsMap[name];\r\n    \r\n            var triggerBinding = undefined, inputBindings = [], outputBindings = [], otherBindings = [];\r\n            var nodeCode = `${name}{{\"${space}${name}\"}}:::function`;\r\n    \r\n            for (const binding of func.bindings) {\r\n    \r\n                if (binding.type === 'orchestrationTrigger') {\r\n                    nodeCode = `${name}[[\"${space}${name}\"]]:::orchestrator`;\r\n                } else if (binding.type === 'activityTrigger') {\r\n                    nodeCode = `${name}[/\"${space}${name}\"/]:::activity`;\r\n                } else if (binding.type === 'entityTrigger') {\r\n                    nodeCode = `${name}[(\"${space}${name}\")]:::entity`;\r\n                }\r\n    \r\n                if (binding.type.endsWith('Trigger')) {\r\n                    triggerBinding = binding;\r\n                } else if (binding.direction === 'in') {\r\n                    inputBindings.push(binding);\r\n                } else if (binding.direction === 'out') {\r\n                    outputBindings.push(binding);\r\n                } else {\r\n                    otherBindings.push(binding);\r\n                }\r\n            }\r\n    \r\n            functions.push({ name, nodeCode, triggerBinding, inputBindings, outputBindings, otherBindings, ...func });\r\n        }\r\n    \r\n        // Sorting by trigger type, then by name. Moving the ones that are being called to the bottom.\r\n        const getFunctionHash = (f) => {\r\n    \r\n            var hash = (!!f.isCalledBy?.length || !f.triggerBinding || !f.triggerBinding.type) ? '' : f.triggerBinding.type;\r\n            hash += '~' + f.name;\r\n            return hash;\r\n        }\r\n        functions.sort((f1, f2) => {\r\n            \r\n            var s1 = getFunctionHash(f1);\r\n            var s2 = getFunctionHash(f2);\r\n    \r\n            return (s1 > s2) ? 1 : ((s2 > s1) ? -1 : 0);\r\n        });\r\n    \r\n        // Rendering\r\n        for (const func of functions) {\r\n    \r\n            code += `${func.nodeCode}\\n`;\r\n            // Making Functions nodes a bit darker\r\n            code += `style ${func.name} fill:#D9D9FF,stroke-width:2px\\n`;\r\n    \r\n            if (!!func.isCalledBy?.length) {\r\n    \r\n                for (const calledBy of func.isCalledBy) {\r\n                    code += `${calledBy} ---> ${func.name}\\n`;\r\n                }\r\n    \r\n            } else if (!!func.triggerBinding) {\r\n    \r\n                code += `${func.name}.${func.triggerBinding.type}>\"${getTriggerBindingText(func.triggerBinding)}\"]:::${func.triggerBinding.type} --> ${func.name}\\n`;\r\n            }\r\n    \r\n            for (var i = 0; i < func.inputBindings.length; i++) {\r\n                const inputBinding = func.inputBindings[i];\r\n                code += `${func.name}.${i}.${inputBinding.type}([\"${getBindingText(inputBinding)}\"]):::${inputBinding.type} -.-> ${func.name}\\n`;\r\n            }\r\n    \r\n            for (var i = 0; i < func.outputBindings.length; i++) {\r\n                const outputBinding = func.outputBindings[i];\r\n                code += `${func.name} -.-> ${func.name}.${i}.${outputBinding.type}([\"${getBindingText(outputBinding)}\"]):::${outputBinding.type}\\n`;\r\n            }\r\n    \r\n            for (var i = 0; i < func.otherBindings.length; i++) {\r\n                const otherBinding = func.otherBindings[i];\r\n                code += `${func.name} -.- ${func.name}.${i}.${otherBinding.type}([\"${getBindingText(otherBinding)}\"]):::${otherBinding.type}\\n`;\r\n            }\r\n    \r\n            if (!!func.isSignalledBy?.length) {\r\n    \r\n                for (const signalledBy of func.isSignalledBy) {\r\n                    code += `${signalledBy.name} -- \"#9889; ${signalledBy.signalName}\" ---> ${func.name}\\n`;\r\n                }\r\n            }\r\n    \r\n            if (!!func.isCalledByItself) {\r\n    \r\n                code += `${func.name} -- \"[ContinueAsNew]\" --> ${func.name}\\n`;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Also proxies\r\n    if (!settings.doNotRenderProxies && (Object.keys(proxiesMap).length > 0)) {\r\n        \r\n        const proxyNodesColor = '#FFE6C8';\r\n\r\n        var nodeTitle = ``;\r\n        var notAddedToCsProjFile = false;\r\n\r\n        for (const name in proxiesMap) {\r\n            const proxy = proxiesMap[name];\r\n            const proxyPurifiedName = name.replace(/ /g, '');\r\n\r\n            notAddedToCsProjFile = proxy.warningNotAddedToCsProjFile;\r\n\r\n            nodeTitle = '';\r\n            if (!!proxy.matchCondition) {\r\n                \r\n                if (!!proxy.matchCondition.methods && !!proxy.matchCondition.methods.length) {\r\n                    nodeTitle += (!!nodeTitle ? ':' : '') + `[${proxy.matchCondition.methods.join(',')}]`;\r\n                }\r\n\r\n                if (!!proxy.matchCondition.route) {\r\n                    nodeTitle += (!!nodeTitle ? ':' : '') + proxy.matchCondition.route;\r\n                }\r\n            }\r\n            if (!nodeTitle) {\r\n                nodeTitle = name;\r\n            }\r\n\r\n            var nodeName = `proxy.${proxyPurifiedName}`;\r\n\r\n            code += `proxies.json -. \"${name}\" .-> ${nodeName}([\"${space}${nodeTitle}\"]):::proxy\\n`;\r\n            code += `style ${nodeName} fill:${proxyNodesColor}\\n`;\r\n\r\n            if (!!proxy.backendUri) {\r\n\r\n                nodeTitle = proxy.backendUri.replace(/'response./g, `'`);\r\n\r\n                const nextNodeName = `proxy.${proxyPurifiedName}.backendUri`;\r\n\r\n                code += `${nodeName} ${getRequestOverridesArrowCode(proxy.requestOverrides)} ${nextNodeName}[\"${space}${nodeTitle}\"]:::http\\n`;\r\n                code += `style ${nextNodeName} fill:${proxyNodesColor}\\n`;\r\n\r\n                nodeName = nextNodeName;\r\n            }\r\n\r\n            const nextNodeName = `proxy.${proxyPurifiedName}.response`;\r\n\r\n            code += `${nodeName} ${getResponseOverridesArrowCode(proxy.responseOverrides)} ${nextNodeName}([\"${space}.\"]):::http\\n`;\r\n            code += `style ${nextNodeName} fill:${proxyNodesColor}\\n`;\r\n        }\r\n\r\n        nodeTitle = `proxies.json`;\r\n        var nodeColor = proxyNodesColor;\r\n        if (notAddedToCsProjFile) {\r\n            nodeTitle += ` #9888; Not added to .CSPROJ file!`;\r\n            nodeColor = `#FF8080`;\r\n        }\r\n\r\n        code += `proxies.json[\"${space}${nodeTitle}\"]\\n`;\r\n        code += `style proxies.json fill:${nodeColor}\\n`;\r\n    }\r\n\r\n    return code;\r\n}\r\n\r\nconst maxSymbolsInTitle = 150;\r\n\r\nfunction getRequestOverridesArrowCode(requestOverrides: any): string {\r\n\r\n    if (!requestOverrides) {\r\n        return `-->`\r\n    }\r\n\r\n    var arrowText = JSON.stringify(requestOverrides)\r\n        .replace(/\"/g, `'`)\r\n        .replace(/'backend.request./g, `'`);\r\n    \r\n    if (arrowText.length > maxSymbolsInTitle) {\r\n        arrowText = arrowText.substr(0, maxSymbolsInTitle) + '...';\r\n    }\r\n\r\n    return `-- \"${arrowText}${space}\" -->`;\r\n}\r\n\r\nfunction getResponseOverridesArrowCode(responseOverrides: any): string {\r\n\r\n    if (!responseOverrides) {\r\n        return `-->`\r\n    }\r\n\r\n    if (!!responseOverrides['response.body']) {\r\n        responseOverrides['response.body'] = '...';\r\n    }\r\n\r\n    var arrowText = JSON.stringify(responseOverrides)\r\n        .replace(/\"/g, `'`)\r\n        .replace(/'response./g, `'`);\r\n    \r\n    if (arrowText.length > maxSymbolsInTitle) {\r\n        arrowText = arrowText.substr(0, maxSymbolsInTitle) + '...';\r\n    }\r\n\r\n    return `-- \"${arrowText}${space}\" -->`;\r\n}","import { computed, observable } from 'mobx'\r\nimport mermaid from 'mermaid';\r\n\r\nimport { DurableOrchestrationStatus } from '../DurableOrchestrationStatus';\r\nimport { CancelToken } from '../../CancelToken';\r\nimport { IResultsTabState } from './ResultsListTabState';\r\nimport { FunctionGraphStateBase } from '../FunctionGraphStateBase';\r\nimport { buildFunctionDiagramCode } from '../az-func-as-a-graph/buildFunctionDiagramCode';\r\n\r\nexport class MetricsItem {\r\n    completed: number = 0;\r\n    running: number = 0;\r\n    failed: number = 0;\r\n    other: number = 0;\r\n    duration: number = 0;\r\n}\r\n\r\nexport type MetricsMap = { [funcName: string]: MetricsItem };\r\n\r\n// Resulting list of orchestrations represented on a Functions Graph\r\nexport class ResultsFunctionGraphTabState extends FunctionGraphStateBase implements IResultsTabState {\r\n\r\n    @computed\r\n    get metrics(): MetricsMap { return this._metrics; }\r\n\r\n    @computed\r\n    get diagramSvg(): string { return this._diagramSvg; }\r\n\r\n    @computed\r\n    get diagramCode(): string { return this._diagramCode; }\r\n\r\n    @computed\r\n    get renderFunctions(): boolean { return this._renderFunctions; };\r\n    set renderFunctions(val: boolean) {\r\n        this._renderFunctions = val;\r\n        this.render();\r\n    };\r\n\r\n    @computed\r\n    get renderProxies(): boolean { return this._renderProxies; };\r\n    set renderProxies(val: boolean) {\r\n        this._renderProxies = val;\r\n        this.render();\r\n    };\r\n\r\n    readonly TotalMetricsName = 'DurableFunctionsMonitor-ResultsFunctionGraphTabState-TotalNumbers';\r\n\r\n    reset() {\r\n\r\n        this._diagramCode = '';\r\n        this._diagramSvg = '';\r\n        this._traversalResult = null;\r\n        this._metrics = {};\r\n        this._numOfInstancesShown = 0;\r\n    }\r\n\r\n    load(filterClause: string, cancelToken: CancelToken, isAutoRefresh: boolean): Promise<void> {\r\n\r\n        this.initMermaidWhenNeeded();\r\n\r\n        this._numOfInstancesShown = 0;\r\n\r\n        const clonedMetrics = !isAutoRefresh ? JSON.parse(JSON.stringify(this._metrics)) : {};\r\n\r\n        return this._backendClient.call('GET', '/function-map').then(response => {\r\n            \r\n            this._traversalResult = response;\r\n        \r\n            return this.render().then(() => {\r\n\r\n                return this.loadNextBatch(filterClause, 0, clonedMetrics, isAutoRefresh, cancelToken).then(metrics => {\r\n\r\n                    // In autorefresh mode updating this observable property at the end, otherwise updating it on-the-fly\r\n                    this._metrics = metrics;\r\n                });\r\n            })\r\n        });\r\n    }\r\n\r\n    @observable\r\n    private _metrics: MetricsMap = {};\r\n\r\n    private _numOfInstancesShown: number = 0;\r\n    private readonly _pageSize = 1000;\r\n\r\n    private loadNextBatch(filterClause: string, pageNumber: number, metrics: MetricsMap, isAutoRefresh: boolean, cancelToken: CancelToken): Promise<MetricsMap> {\r\n\r\n        const uri = `/orchestrations?$top=${this._pageSize}&$skip=${this._numOfInstancesShown}${filterClause}`;\r\n\r\n        return this._backendClient.call('GET', uri).then((instances: DurableOrchestrationStatus[]) => {\r\n\r\n            if (cancelToken.isCancelled) {\r\n                return Promise.resolve(metrics);\r\n            }\r\n\r\n            // updating metrics\r\n            \r\n            if (!metrics[this.TotalMetricsName]) {\r\n                metrics[this.TotalMetricsName] = new MetricsItem();\r\n            }\r\n\r\n            for (var instance of instances) {\r\n\r\n                const funcName = DurableOrchestrationStatus.getFunctionName(instance);\r\n\r\n                if (!metrics[funcName]) {\r\n                    metrics[funcName] = new MetricsItem();\r\n                }\r\n\r\n                switch (instance.runtimeStatus) {\r\n                    case 'Completed':\r\n                        metrics[funcName].completed++;\r\n                        metrics[this.TotalMetricsName].completed++;\r\n                        break;\r\n                    case 'Running':\r\n                    case 'Pending':\r\n                    case 'ContinuedAsNew':\r\n                        metrics[funcName].running++;\r\n                        metrics[this.TotalMetricsName].running++;\r\n                        break;\r\n                    case 'Failed':\r\n                        metrics[funcName].failed++;\r\n                        metrics[this.TotalMetricsName].failed++;\r\n                        break;\r\n                    default:\r\n                        metrics[funcName].other++;\r\n                        metrics[this.TotalMetricsName].other++;\r\n                        break;\r\n                }\r\n            }\r\n\r\n            this._numOfInstancesShown += instances.length;\r\n\r\n            // Making metrics look alive, when not in autorefresh mode\r\n            if (!isAutoRefresh) {\r\n                this._metrics = metrics;\r\n            }\r\n\r\n            if (instances.length === this._pageSize) {\r\n                return this.loadNextBatch(filterClause, pageNumber + 1, metrics, isAutoRefresh, cancelToken);\r\n            }\r\n\r\n            return metrics;\r\n        });\r\n    }\r\n\r\n    private render(): Promise<void> {\r\n\r\n        this._diagramCode = '';\r\n        this._diagramSvg = '';\r\n\r\n        return new Promise<void>((resolve, reject) => {\r\n\r\n            try {\r\n                const diagramCode = buildFunctionDiagramCode(this._traversalResult.functions, this._traversalResult.proxies,\r\n                    {\r\n                        doNotRenderFunctions: !this._renderFunctions,\r\n                        doNotRenderProxies: !this._renderProxies\r\n                    });\r\n    \r\n                if (!diagramCode) {\r\n                    resolve();\r\n                    return;\r\n                }\r\n    \r\n                this._diagramCode = `graph LR\\n${diagramCode}`;\r\n    \r\n                mermaid.render('mermaidSvgId', this._diagramCode, (svg) => {\r\n    \r\n                    this._diagramSvg = this.applyIcons(svg);\r\n\r\n                    resolve();\r\n                });\r\n    \r\n            } catch (err) {\r\n                reject(err);\r\n            }\r\n        });\r\n    }\r\n}","import { observable, computed } from 'mobx'\r\nimport moment from 'moment';\r\n\r\nimport { DateTimeHelpers } from '../../DateTimeHelpers';\r\nimport { ErrorMessageState } from '../ErrorMessageState';\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { ITypedLocalStorage } from '../ITypedLocalStorage';\r\nimport { CancelToken } from '../../CancelToken';\r\nimport { IResultsTabState, ResultsListTabState } from './ResultsListTabState';\r\nimport { ResultsGanttDiagramTabState } from './ResultsGanttDiagramTabState';\r\nimport { ResultsHistogramTabState } from './ResultsHistogramTabState';\r\nimport { ResultsFunctionGraphTabState } from './ResultsFunctionGraphTabState';\r\nimport { RuntimeStatus } from '../DurableOrchestrationStatus';\r\nimport { QueryString } from '../QueryString';\r\n\r\nexport enum FilterOperatorEnum {\r\n    Equals = 0,\r\n    StartsWith,\r\n    Contains,\r\n    NotEquals,\r\n    NotStartsWith,\r\n    NotContains\r\n}\r\n\r\nexport enum ResultsTabEnum {\r\n    List = 0,\r\n    Histogram,\r\n    Gantt,\r\n    FunctionGraph\r\n}\r\n\r\nexport enum TimeRangeEnum {\r\n    Custom = 0,\r\n    LastMinute,\r\n    Last10Minutes,\r\n    LastHour,\r\n    Last24Hours,\r\n    Last7Days,\r\n    Last30Days,\r\n    Last90Days\r\n}\r\n\r\nexport type RuntimeStatusOrDurableEntities = RuntimeStatus | 'DurableEntities';\r\n\r\n// State of Orchestrations view\r\nexport class OrchestrationsState extends ErrorMessageState {\r\n\r\n    // Tab currently selected\r\n    @computed\r\n    get tabIndex(): ResultsTabEnum { return this._tabIndex; }\r\n    set tabIndex(val: ResultsTabEnum) {\r\n\r\n        if (this._tabIndex === val) {\r\n            return;\r\n        }\r\n\r\n        this._tabIndex = val;\r\n        this._localStorage.setItem('tabIndex', val.toString());\r\n\r\n        this.reloadOrchestrations();\r\n    }\r\n\r\n    get selectedTabState(): IResultsTabState {\r\n        return this._tabStates[this._tabIndex];\r\n    }\r\n\r\n    @computed\r\n    get inProgress(): boolean { return this._cancelToken.inProgress && !this._cancelToken.isCancelled; }\r\n\r\n    @computed\r\n    get autoRefresh(): number { return this._autoRefresh; }\r\n    set autoRefresh(val: number) {\r\n        this._autoRefresh = val;\r\n        this._localStorage.setItem('autoRefresh', this._autoRefresh.toString());\r\n        this.loadOrchestrations(true);\r\n    }\r\n\r\n    @computed\r\n    get timeFrom(): moment.Moment {\r\n\r\n        switch (this._timeRange) {\r\n            case TimeRangeEnum.LastMinute:\r\n                return moment().subtract(1, 'minutes');\r\n            case TimeRangeEnum.Last10Minutes:\r\n                return moment().subtract(10, 'minutes');\r\n            case TimeRangeEnum.LastHour:\r\n                return moment().subtract(1, 'hours');\r\n            case TimeRangeEnum.Last24Hours:\r\n                return moment().subtract(1, 'days');\r\n            case TimeRangeEnum.Last7Days:\r\n                return moment().subtract(7, 'days');\r\n            case TimeRangeEnum.Last30Days:\r\n                return moment().subtract(30, 'days');\r\n            case TimeRangeEnum.Last90Days:\r\n                return moment().subtract(90, 'days');\r\n            default:\r\n                return this._timeFrom;\r\n        }\r\n    }\r\n    set timeFrom(val: moment.Moment) {\r\n\r\n        this._timeFrom = val;\r\n        this._timeRange = TimeRangeEnum.Custom;\r\n        this.listState.resetOrderBy();\r\n    }\r\n\r\n    @computed\r\n    get timeTill(): moment.Moment {\r\n        return (!!this._timeRange || !this._timeTill) ? moment() : this._timeTill;\r\n    }\r\n    set timeTill(val: moment.Moment) {\r\n        this._timeTill = val;\r\n        this._timeRange = TimeRangeEnum.Custom;\r\n        this.listState.resetOrderBy();\r\n    }\r\n    \r\n    @computed\r\n    get timeTillEnabled(): boolean { return !!this._timeTill; }\r\n    set timeTillEnabled(val: boolean) {\r\n\r\n        this._timeTill = val ? moment() : null;\r\n\r\n        if (!val) {\r\n            this.listState.resetOrderBy();\r\n            this.reloadOrchestrations();\r\n        }\r\n    }\r\n\r\n    @computed\r\n    get timeRange(): TimeRangeEnum { return this._timeRange; }\r\n    set timeRange(val: TimeRangeEnum) {\r\n\r\n        this.menuAnchorElement = undefined;\r\n        \r\n        this._timeRange = val;\r\n\r\n        this.listState.resetOrderBy();\r\n        this.reloadOrchestrations();\r\n    }\r\n\r\n    @observable\r\n    menuAnchorElement?: Element;\r\n\r\n    @computed\r\n    get filterValue(): string { return this._filterValue; }\r\n    set filterValue(val: string) { this._filterValue = val; }\r\n\r\n    @computed\r\n    get filterOperator(): FilterOperatorEnum { return this._filterOperator; }\r\n    set filterOperator(val: FilterOperatorEnum) {\r\n        \r\n        this._filterOperator = val;\r\n\r\n        if (!!this._filterValue && this._filteredColumn !== '0') {\r\n\r\n            this.reloadOrchestrations();\r\n        }\r\n    }\r\n\r\n    @computed\r\n    get filteredColumn(): string { return this._filteredColumn; }\r\n    set filteredColumn(val: string) {\r\n\r\n        this._filteredColumn = val;\r\n\r\n        if (!this._filterValue) {\r\n            return;\r\n        }\r\n\r\n        if (this._filteredColumn === '0') {\r\n            this._filterValue = '';\r\n        }\r\n\r\n        this.reloadOrchestrations();\r\n    }\r\n\r\n    @computed\r\n    get showStatuses(): RuntimeStatusOrDurableEntities[] { return this._showStatuses; }\r\n    \r\n    isStatusChecked(status?: RuntimeStatusOrDurableEntities): boolean {\r\n\r\n        if (!status) {\r\n            return !this._showStatuses;\r\n        }\r\n\r\n        if (!this._showStatuses) {\r\n            return true;\r\n        }\r\n\r\n        return !!this._showStatuses.includes(status);\r\n    }\r\n\r\n    setStatusChecked(checked: boolean, status?: RuntimeStatusOrDurableEntities): void {\r\n\r\n        if (checked) {\r\n\r\n            if (!status) {\r\n                this._showStatuses = null;\r\n            } else {\r\n                if (!this._showStatuses) {\r\n                    this._showStatuses = [];\r\n                }\r\n                this._showStatuses.push(status);\r\n            }\r\n            \r\n        } else {\r\n\r\n            if (!status) {\r\n                this._showStatuses = [];\r\n            } else {\r\n                if (!this._showStatuses) {\r\n                    this._showStatuses = [];\r\n                }\r\n\r\n                const i = this._showStatuses.indexOf(status);\r\n                if (i >= 0) {\r\n                    this._showStatuses.splice(i, 1);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!!this._refreshToken) {\r\n            clearTimeout(this._refreshToken);\r\n        }\r\n        this._refreshToken = setTimeout(() => this.reloadOrchestrations(), this._delayedRefreshDelay);\r\n    }\r\n\r\n    rescheduleDelayedRefresh() {\r\n        \r\n        if (!!this._refreshToken) {\r\n            clearTimeout(this._refreshToken);\r\n            this._refreshToken = setTimeout(() => this.reloadOrchestrations(), this._delayedRefreshDelay);\r\n        }\r\n    }\r\n\r\n    @computed\r\n    get showLastEventColumn(): boolean {\r\n        // Only showing lastEvent field when being filtered by it (because otherwise it is not populated on the server)\r\n        return this._filteredColumn === 'lastEvent' && (!!this._oldFilterValue);\r\n    }\r\n    \r\n    get backendClient(): IBackendClient { return this._backendClient; }\r\n\r\n    get isFunctionGraphAvailable(): boolean { return this._isFunctionGraphAvailable; }\r\n\r\n    constructor(private _isFunctionGraphAvailable: boolean, private _backendClient: IBackendClient, private _localStorage: ITypedLocalStorage<OrchestrationsState & ResultsListTabState>) {\r\n        super();\r\n        \r\n        this._tabStates = [\r\n            new ResultsListTabState(this._backendClient, this._localStorage, () => this.reloadOrchestrations()),\r\n            new ResultsHistogramTabState(this._backendClient, this),\r\n            new ResultsGanttDiagramTabState(this._backendClient)\r\n        ];\r\n\r\n        if (!!this._isFunctionGraphAvailable) {\r\n            this._tabStates.push(new ResultsFunctionGraphTabState(this._backendClient));\r\n        }\r\n\r\n        var momentFrom: moment.Moment;\r\n        const timeFromString = this._localStorage.getItem('timeFrom');\r\n        if (!!timeFromString) {\r\n            momentFrom = moment(timeFromString);\r\n        } else {\r\n            // By default setting it to 24 hours ago\r\n            momentFrom = moment().subtract(1, 'days');\r\n        }\r\n\r\n        this._timeFrom = momentFrom;\r\n        this._oldTimeFrom = momentFrom;\r\n       \r\n        const timeTillString = this._localStorage.getItem('timeTill');\r\n        if (!!timeTillString) {\r\n            this._timeTill = moment(timeTillString);\r\n            this._oldTimeTill = this._timeTill;\r\n        }\r\n\r\n        const timeRangeString = this._localStorage.getItem('timeRange');\r\n        if (!!timeRangeString) {\r\n\r\n            // timeRange and [timeFrom,timeTill] are mutually exclusive.\r\n            // So when the latter comes from query string, we should not pay attention to the former.\r\n            const queryString = new QueryString();\r\n            if (!queryString.values['timeFrom'] && !queryString.values['timeTill']) {   \r\n                this._timeRange = TimeRangeEnum[timeRangeString];\r\n            }\r\n        }\r\n\r\n        const filteredColumnString = this._localStorage.getItem('filteredColumn');\r\n        if (!!filteredColumnString) {\r\n            this._filteredColumn = filteredColumnString;\r\n        }\r\n\r\n        const filterOperatorString = this._localStorage.getItem('filterOperator');\r\n        if (!!filterOperatorString) {\r\n            this._filterOperator = FilterOperatorEnum[filterOperatorString];\r\n        }\r\n\r\n        const filterValueString = this._localStorage.getItem('filterValue');\r\n        if (!!filterValueString) {\r\n            this._filterValue = filterValueString;\r\n            this._oldFilterValue = filterValueString;\r\n        }\r\n\r\n        const showStatusesString = this._localStorage.getItem('showStatuses');\r\n        if (!!showStatusesString) {\r\n            this._showStatuses = JSON.parse(showStatusesString);\r\n        }\r\n        \r\n        const autoRefreshString = this._localStorage.getItem('autoRefresh');\r\n        if (!!autoRefreshString) {\r\n            this._autoRefresh = Number(autoRefreshString);\r\n        }\r\n\r\n        const tabIndexString = this._localStorage.getItem('tabIndex');\r\n        if (!!tabIndexString) {\r\n            const tabIndex = Number(tabIndexString);\r\n            if (tabIndex >= 0 && tabIndex < this._tabStates.length) {\r\n                this._tabIndex = tabIndex;\r\n            }\r\n        }\r\n    }\r\n\r\n    applyTimeFrom() {\r\n        if (DateTimeHelpers.isValidMoment(this._timeFrom) && this._oldTimeFrom !== this._timeFrom) {\r\n            this.reloadOrchestrations();\r\n        }\r\n    }\r\n\r\n    applyTimeTill() {\r\n        if (DateTimeHelpers.isValidMoment(this._timeTill) && this._oldTimeTill !== this._timeTill) {\r\n            this.reloadOrchestrations();\r\n        }\r\n    }\r\n\r\n    applyFilterValue() {\r\n        if (this._oldFilterValue !== this._filterValue) {\r\n            this.reloadOrchestrations();\r\n        }\r\n    }\r\n\r\n    reloadOrchestrations() {\r\n\r\n        // Canceling delayed refresh, if any\r\n        if (!!this._refreshToken) {\r\n            clearTimeout(this._refreshToken);\r\n            this._refreshToken = null;\r\n        }\r\n\r\n        for (const resultState of this._tabStates) {\r\n            resultState.reset();\r\n        }\r\n\r\n        // If dates are invalid, reverting them to previous valid values\r\n        if (!DateTimeHelpers.isValidMoment(this._timeFrom)) {\r\n            this._timeFrom = this._oldTimeFrom;\r\n        }\r\n        if (!!this._timeTill && !DateTimeHelpers.isValidMoment(this._timeTill)) {\r\n            this._timeTill = this._oldTimeTill;\r\n        }\r\n\r\n        // persisting state as a batch\r\n        this._localStorage.setItems([\r\n            { fieldName: 'timeFrom', value: !this._timeRange ? this._timeFrom.toISOString(): null },\r\n            { fieldName: 'timeTill', value: (!!this._timeTill && !this._timeRange) ? this._timeTill.toISOString() : null },\r\n            { fieldName: 'timeRange', value: !!this._timeRange ? TimeRangeEnum[this._timeRange] : null },\r\n            { fieldName: 'filteredColumn', value: this._filteredColumn },\r\n            { fieldName: 'filterOperator', value: FilterOperatorEnum[this._filterOperator] },\r\n            { fieldName: 'filterValue', value: !!this._filterValue ? this._filterValue : null },\r\n            { fieldName: 'showStatuses', value: !!this._showStatuses ? JSON.stringify(this._showStatuses) : null },\r\n        ]);\r\n\r\n        this.loadOrchestrations();\r\n\r\n        this._oldFilterValue = this._filterValue;\r\n        this._oldTimeFrom = this._timeFrom;\r\n        this._oldTimeTill = this._timeTill;\r\n    }\r\n\r\n    cancel() {\r\n        this._cancelToken.isCancelled = true;\r\n        this._cancelToken = new CancelToken();\r\n    }\r\n\r\n    loadOrchestrations(isAutoRefresh: boolean = false) {\r\n\r\n        const cancelToken = this._cancelToken;\r\n        if (!!cancelToken.inProgress) {\r\n            return;            \r\n        }\r\n        cancelToken.inProgress = true;\r\n        \r\n        var filterClause = `&$filter=createdTime ge '${this.timeFrom.toISOString()}' and createdTime le '${this.timeTill.toISOString()}'`;\r\n        \r\n        if (!!this._showStatuses) {\r\n\r\n            filterClause += ` and runtimeStatus in (${this._showStatuses.map(s => `'${s}'`).join(',')})`;\r\n        }\r\n        \r\n        if (!!this._filterValue && this._filteredColumn !== '0') {\r\n\r\n            filterClause += ' and ';\r\n\r\n            const encodedFilterValue = encodeURIComponent(this._filterValue);\r\n\r\n            switch (this._filterOperator) {\r\n                case FilterOperatorEnum.Equals:\r\n                    filterClause += `${this._filteredColumn} eq '${encodedFilterValue}'`;\r\n                break;\r\n                case FilterOperatorEnum.StartsWith:\r\n                    filterClause += `startswith(${this._filteredColumn}, '${encodedFilterValue}')`;\r\n                break;\r\n                case FilterOperatorEnum.Contains:\r\n                    filterClause += `contains(${this._filteredColumn}, '${encodedFilterValue}')`;\r\n                break;\r\n                case FilterOperatorEnum.NotEquals:\r\n                    filterClause += `${this._filteredColumn} ne '${encodedFilterValue}'`;\r\n                    break;\r\n                case FilterOperatorEnum.NotStartsWith:\r\n                    filterClause += `startswith(${this._filteredColumn}, '${encodedFilterValue}') eq false`;\r\n                    break;\r\n                case FilterOperatorEnum.NotContains:\r\n                    filterClause += `contains(${this._filteredColumn}, '${encodedFilterValue}') eq false`;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        this.selectedTabState.load(filterClause, cancelToken, isAutoRefresh).then(() => {\r\n\r\n            if (!!this._refreshToken) {\r\n                clearTimeout(this._refreshToken);\r\n            }\r\n\r\n            // Doing auto-refresh\r\n            if (!!this._autoRefresh) {\r\n\r\n                this._refreshToken = setTimeout(() => {\r\n\r\n                    this.loadOrchestrations(true);\r\n\r\n                }, this._autoRefresh * 1000);\r\n            }\r\n\r\n        }, err => {\r\n\r\n            // Cancelling auto-refresh just in case\r\n            this._autoRefresh = 0;\r\n\r\n            if (!cancelToken.isCancelled) {\r\n                this.errorMessage = `Load failed: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n            }\r\n                \r\n        }).finally(() => {\r\n            cancelToken.inProgress = false;\r\n        });\r\n    }\r\n\r\n    @observable\r\n    private _tabIndex: ResultsTabEnum = ResultsTabEnum.List;\r\n\r\n    @observable\r\n    private _cancelToken: CancelToken = new CancelToken();\r\n\r\n    @observable\r\n    private _autoRefresh: number = 0;\r\n\r\n    @observable\r\n    private _timeFrom: moment.Moment;\r\n    @observable\r\n    private _timeTill: moment.Moment;\r\n    @observable\r\n    private _timeRange: TimeRangeEnum = TimeRangeEnum.Custom;\r\n\r\n    @observable\r\n    private _filterValue: string = '';\r\n    @observable\r\n    private _filterOperator: FilterOperatorEnum = FilterOperatorEnum.Equals;\r\n    @observable\r\n    private _filteredColumn: string = '0';\r\n\r\n    @observable\r\n    private _showStatuses: RuntimeStatusOrDurableEntities[] = null;\r\n\r\n    private readonly _tabStates: IResultsTabState[];\r\n\r\n    private get listState(): ResultsListTabState { return this._tabStates[0] as ResultsListTabState; }\r\n\r\n    private _refreshToken: NodeJS.Timeout;\r\n    private readonly _delayedRefreshDelay = 2500;\r\n\r\n    private _oldFilterValue: string = '';\r\n\r\n    private _oldTimeFrom: moment.Moment;\r\n    private _oldTimeTill: moment.Moment;\r\n}","\r\n// Helper class for dealing with browser's query string\r\nexport class QueryString {\r\n\r\n    constructor() {\r\n\r\n        const pairs = window.location.search.substr(1).split('&');\r\n        for (var pairString of pairs) {\r\n            const pair = pairString.split('=');\r\n            if (pair.length > 1) {\r\n                this._values[pair[0]] = decodeURIComponent(pair[1]);\r\n            }\r\n        }\r\n    }\r\n\r\n    get values(): { [key: string]: string } { return this._values; }\r\n\r\n    apply(): void {\r\n\r\n        var queryString = '';\r\n\r\n        for (var key in this._values) {\r\n            if (!!queryString) {\r\n                queryString += '&';\r\n            }\r\n            queryString += key + '=' + encodeURIComponent(this._values[key]);\r\n        }\r\n\r\n        window.history.replaceState(null, null, !queryString ? '' : '?' + queryString);\r\n    }\r\n\r\n    private _values: { [key: string]: string } = {};\r\n}","import { createMuiTheme } from '@material-ui/core';\r\n\r\nimport { RuntimeStatus } from './states/DurableOrchestrationStatus';\r\nimport { dfmContextInstance } from './DfmContext';\r\n\r\nconst colorTheme = !process.env.REACT_APP_COLOR_THEME ? dfmContextInstance.theme : process.env.REACT_APP_COLOR_THEME;\r\n\r\nexport const Theme = createMuiTheme({\r\n    palette: { type: colorTheme === 'dark' ? 'dark' : 'light' }\r\n});\r\n\r\nexport const CustomTabStyle = Theme.palette.type === \"dark\" ? {\r\n    backgroundColor: '#aaa'\r\n} : {};\r\n\r\nexport function RuntimeStatusToStyle(status: RuntimeStatus): {} {\r\n\r\n    var backgroundColor: string = null;\r\n\r\n    switch (status) {\r\n        case 'Failed':\r\n            backgroundColor = hexToRGBA(Theme.palette.error.light, 0.2);\r\n            break;\r\n        case 'Completed':\r\n            backgroundColor = hexToRGBA(Theme.palette.success.light, 0.2);\r\n            break;\r\n        case 'Running':\r\n            backgroundColor = hexToRGBA(Theme.palette.warning.light, 0.2);\r\n            break;\r\n        case 'Terminated':\r\n            backgroundColor = hexToRGBA(Theme.palette.background.paper, 0.1);\r\n            break;\r\n    }\r\n\r\n    return !!backgroundColor ? { backgroundColor } : {};\r\n}\r\n\r\nexport function hexToRGBA(hex: string, alpha: number): string {\r\n\r\n    if (hex.length > 4) {\r\n        return `rgba(${parseInt(hex.slice(1, 3), 16)}, ${parseInt(hex.slice(3, 5), 16)}, ${parseInt(hex.slice(5, 7), 16)}, ${alpha.toFixed(1)})`;\r\n    } else {\r\n        return `rgba(${parseInt(hex.slice(1, 2), 16)}, ${parseInt(hex.slice(2, 3), 16)}, ${parseInt(hex.slice(3, 4), 16)}, ${alpha.toFixed(1)})`;\r\n    }\r\n}\r\n\r\nexport function RuntimeStatusToBadgeStyle(status: RuntimeStatus | 'Duration'): {} {\r\n\r\n    var backgroundColor: string = null;\r\n\r\n    if (Theme.palette.type === 'dark') {\r\n        \r\n        switch (status) {\r\n            case 'Failed':\r\n                backgroundColor = 'rgb(103,73,76)';\r\n                break;\r\n            case 'Completed':\r\n                backgroundColor = 'rgb(74,98,80)';\r\n                break;\r\n            case 'Running':\r\n                backgroundColor = 'rgb(105,93,68)';\r\n                break;\r\n            case 'Terminated':\r\n                backgroundColor = 'rgb(66,66,66)';\r\n                break;\r\n            case 'Duration':\r\n                backgroundColor = 'rgb(50,50,50)';\r\n                break;\r\n        }\r\n    } else {\r\n\r\n        switch (status) {\r\n            case 'Failed':\r\n                backgroundColor = 'rgb(250,227,227)';\r\n                break;\r\n            case 'Completed':\r\n                backgroundColor = 'rgb(230,244,230)';\r\n                break;\r\n            case 'Running':\r\n                backgroundColor = 'rgb(255,241,219)';\r\n                break;\r\n            case 'Terminated':\r\n                backgroundColor = 'rgb(231,231,231)';\r\n                break;\r\n            case 'Duration':\r\n                backgroundColor = 'rgb(255,255,255)';\r\n                break;\r\n        }\r\n    }\r\n\r\n    return !!backgroundColor ? { backgroundColor } : {};\r\n}\r\n","import * as React from 'react';\r\nimport { action } from 'mobx'\r\nimport { observer } from 'mobx-react';\r\n\r\nimport { Link } from '@material-ui/core';\r\n\r\nimport { IBackendClient } from '../services/IBackendClient';\r\nimport { OrchestrationsPathPrefix } from '../states/LoginState';\r\nimport { Theme } from '../theme';\r\n\r\n// Renders a link to be opened either in a new browser tab or in a new VsCode WebView\r\n@observer\r\nexport class OrchestrationLink extends React.Component<{ orchestrationId: string, title?: string, backendClient: IBackendClient }> {\r\n\r\n    render(): JSX.Element {\r\n\r\n        if (this.props.backendClient.isVsCode) {\r\n\r\n            return (\r\n                <Link color={Theme.palette.type === 'dark' ? 'inherit' : 'primary'} className=\"link-with-pointer-cursor\" onClick={this.onLinkClicked} >\r\n                    {this.props.title ?? this.props.orchestrationId}\r\n                </Link>\r\n            );            \r\n        } else {\r\n\r\n            return (\r\n                <Link color={Theme.palette.type === 'dark' ? 'inherit' : 'primary'} href={`${this.props.backendClient.routePrefixAndTaskHubName}${OrchestrationsPathPrefix}${this.extraSanitizeHrefComponent(this.props.orchestrationId)}`} target=\"_blank\">\r\n                    {this.props.title ?? this.props.orchestrationId}\r\n                </Link>\r\n            );\r\n        }\r\n    }\r\n\r\n    @action.bound\r\n    private onLinkClicked() {\r\n        this.props.backendClient.call('OpenInNewWindow', this.props.orchestrationId);\r\n    }\r\n\r\n    // Just to be extra sure\r\n    private extraSanitizeHrefComponent(s: string): string{\r\n        return s.replace(/javascript:/gi, '');\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Button, Dialog, DialogActions, DialogContent, DialogTitle, InputBase, Link\r\n} from '@material-ui/core';\r\n\r\nconst MaxJsonLengthToShow = 512;\r\nconst MaxJsonLengthToShowAsLink = 20;\r\n\r\nexport type LongJsonDialogState = { title?: string, jsonString?: string };\r\n\r\n// Dialog to display long JSON strings\r\n@observer\r\nexport class LongJsonDialog extends React.Component<{ state: LongJsonDialogState }> {\r\n    \r\n    public static renderJson(jsonObject: any, dialogTitle: string, dialogState: LongJsonDialogState): JSX.Element {\r\n\r\n        if (!jsonObject) {\r\n            return null;\r\n        }\r\n\r\n        // Converting from a string inside a string\r\n        if (typeof jsonObject === 'string') {\r\n            try {\r\n                jsonObject = JSON.parse(jsonObject);\r\n            } catch {}\r\n        }\r\n\r\n        const jsonString = (typeof jsonObject === 'string' ? jsonObject : JSON.stringify(jsonObject));\r\n \r\n        if (jsonString.length <= MaxJsonLengthToShow) {\r\n\r\n            return (<InputBase\r\n                className=\"long-text-cell-input\"\r\n                multiline fullWidth rowsMax={5} readOnly\r\n                value={jsonString}\r\n            />);\r\n        }\r\n\r\n        const jsonFormattedString = (typeof jsonObject === 'string' ? jsonObject : JSON.stringify(jsonObject, null, 3));\r\n\r\n        return (<Link\r\n            component=\"button\"\r\n            variant=\"inherit\"\r\n            onClick={() => {\r\n                dialogState.title = dialogTitle;\r\n                dialogState.jsonString = jsonFormattedString;\r\n            }}\r\n        >\r\n            {jsonString.substr(0, MaxJsonLengthToShowAsLink)}...\r\n        </Link>)\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (\r\n            <Dialog fullWidth={true} maxWidth=\"md\" open={!!state.jsonString} onClose={() => state.jsonString = ''}>\r\n\r\n                <DialogTitle>{state.title}</DialogTitle>\r\n\r\n                <DialogContent>\r\n                    <InputBase\r\n                        multiline fullWidth readOnly\r\n                        value={state.jsonString}\r\n                    />                    \r\n                </DialogContent>\r\n                \r\n                <DialogActions>\r\n                    <Button onClick={() => state.jsonString = ''} color=\"primary\">\r\n                        Close\r\n                    </Button>\r\n                </DialogActions>\r\n\r\n            </Dialog>\r\n       );\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    FormHelperText, IconButton, Link, Paper, Table, TableBody, TableCell, TableHead, TableRow,\r\n    TableSortLabel, Typography\r\n} from '@material-ui/core';\r\n\r\nimport CloseIcon from '@material-ui/icons/Close';\r\n\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { DurableOrchestrationStatusFields } from '../../states/DurableOrchestrationStatus';\r\nimport { OrchestrationLink } from '../OrchestrationLink';\r\nimport { ResultsListTabState } from '../../states/results-view/ResultsListTabState';\r\nimport { DfmContextType } from '../../DfmContext';\r\nimport { RuntimeStatusToStyle } from '../../theme';\r\nimport { DateTimeHelpers } from '../../DateTimeHelpers';\r\nimport { LongJsonDialog } from '../dialogs/LongJsonDialog';\r\n\r\n// Orchestrations list view\r\n@observer\r\nexport class OrchestrationsList extends React.Component<{ state: ResultsListTabState, showLastEventColumn: boolean, backendClient: IBackendClient }> {\r\n\r\n    static contextType = DfmContextType;\r\n    context!: React.ContextType<typeof DfmContextType>;\r\n\r\n    render(): JSX.Element {\r\n\r\n        const state = this.props.state;\r\n\r\n        return (<>\r\n            \r\n            <FormHelperText className=\"items-count-label\">\r\n                {!!state.orchestrations.length && (<>\r\n                    \r\n                    {`${state.orchestrations.length} items shown`}\r\n\r\n                    {!!state.hiddenColumns.length && (<>\r\n\r\n                        {`, ${state.hiddenColumns.length} columns hidden `}\r\n\r\n                        (<Link className=\"unhide-button\"\r\n                            component=\"button\"\r\n                            variant=\"inherit\"\r\n                            onClick={() => state.unhide()}\r\n                        >\r\n                            unhide\r\n                        </Link>)\r\n\r\n                    </>)}\r\n\r\n                </>)}\r\n            </FormHelperText>\r\n\r\n            <Paper elevation={0}>\r\n                {this.renderTable(state)}\r\n            </Paper>\r\n\r\n            <LongJsonDialog state={state.longJsonDialogState} />\r\n            \r\n        </>);\r\n    }\r\n\r\n    private renderTable(state: ResultsListTabState): JSX.Element {\r\n\r\n        if (!state.orchestrations.length) {\r\n            return (\r\n                <Typography variant=\"h5\" className=\"empty-table-placeholder\" >\r\n                    This list is empty\r\n                </Typography>\r\n            );\r\n        }\r\n\r\n        const visibleColumns = DurableOrchestrationStatusFields\r\n            // hiding artificial 'lastEvent' column, when not used\r\n            .filter(f => this.props.showLastEventColumn ? true : f !== 'lastEvent');\r\n\r\n        return (\r\n            <Table size=\"small\">\r\n                <TableHead>\r\n                    <TableRow>\r\n                        {visibleColumns.map(col => {\r\n\r\n                            const onlyOneVisibleColumnLeft = visibleColumns.length <= state.hiddenColumns.length + 1;\r\n\r\n                            return !state.hiddenColumns.includes(col) && (\r\n                                <TableCell key={col}\r\n                                    onMouseEnter={() => state.columnUnderMouse = col}\r\n                                    onMouseLeave={() => state.columnUnderMouse = ''}\r\n                                >\r\n                                    <TableSortLabel\r\n                                        active={state.orderBy === col}\r\n                                        direction={state.orderByDirection}\r\n                                        onClick={() => state.orderBy = col}\r\n                                    >\r\n                                        {col}\r\n                                    </TableSortLabel>\r\n\r\n                                    {state.columnUnderMouse === col && !onlyOneVisibleColumnLeft && (\r\n                                        <IconButton\r\n                                            color=\"inherit\"\r\n                                            size=\"small\"\r\n                                            className=\"column-hide-button\"\r\n                                            onClick={() => state.hideColumn(col)}\r\n                                        >\r\n                                            <CloseIcon />\r\n                                        </IconButton>\r\n                                    )}\r\n\r\n                                </TableCell>\r\n                            );\r\n                        })}\r\n                    </TableRow>\r\n                </TableHead>\r\n                <TableBody>\r\n                    {state.orchestrations.map(orchestration => {\r\n\r\n                        const rowStyle = RuntimeStatusToStyle(orchestration.runtimeStatus);\r\n                        const cellStyle = { verticalAlign: 'top' };\r\n                        return (\r\n                            <TableRow\r\n                                key={orchestration.instanceId}\r\n                                style={rowStyle}\r\n                            >\r\n                                {!state.hiddenColumns.includes('instanceId') && (\r\n                                    <TableCell className=\"instance-id-cell\" style={cellStyle}>\r\n                                        <OrchestrationLink orchestrationId={orchestration.instanceId} backendClient={this.props.backendClient} />\r\n                                    </TableCell>\r\n                                )}\r\n                                {!state.hiddenColumns.includes('name') && (\r\n                                    <TableCell className=\"name-cell\" style={cellStyle}>\r\n                                        {orchestration.name}\r\n                                    </TableCell>\r\n                                )}\r\n                                {!state.hiddenColumns.includes('createdTime') && (\r\n                                    <TableCell className=\"datetime-cell\" style={cellStyle}>\r\n                                        {this.context.formatDateTimeString(orchestration.createdTime)}\r\n                                    </TableCell>\r\n                                )}\r\n                                {!state.hiddenColumns.includes('lastUpdatedTime') && (\r\n                                    <TableCell className=\"datetime-cell\" style={cellStyle}>\r\n                                        {this.context.formatDateTimeString(orchestration.lastUpdatedTime)}\r\n                                    </TableCell>\r\n                                )}\r\n                                {!state.hiddenColumns.includes('duration') && (\r\n                                    <TableCell style={cellStyle}>\r\n                                        {DateTimeHelpers.formatDuration(orchestration.duration)}\r\n                                    </TableCell>\r\n                                )}\r\n                                {!state.hiddenColumns.includes('runtimeStatus') && (\r\n                                    <TableCell style={cellStyle}>\r\n                                        {orchestration.runtimeStatus}\r\n                                    </TableCell>\r\n                                )}\r\n                                {!state.hiddenColumns.includes('lastEvent') && this.props.showLastEventColumn && (\r\n                                    <TableCell style={cellStyle}>\r\n                                        {orchestration.lastEvent}\r\n                                    </TableCell>\r\n                                )}\r\n                                {!state.hiddenColumns.includes('input') && (\r\n                                    <TableCell className=\"long-text-cell\" style={cellStyle}>\r\n                                        {LongJsonDialog.renderJson(orchestration.input, `${orchestration.instanceId} / input`, state.longJsonDialogState)}\r\n                                    </TableCell>\r\n                                )}\r\n                                {!state.hiddenColumns.includes('output') && (\r\n                                    <TableCell className=\"output-cell\" style={cellStyle}>\r\n                                        {LongJsonDialog.renderJson(orchestration.output, `${orchestration.instanceId} / output`, state.longJsonDialogState)}\r\n                                    </TableCell>\r\n                                )}\r\n                                {!state.hiddenColumns.includes('customStatus') && (\r\n                                    <TableCell className=\"output-cell\" style={cellStyle}>\r\n                                        {LongJsonDialog.renderJson(orchestration.customStatus, `${orchestration.instanceId} / customStatus`, state.longJsonDialogState)}\r\n                                    </TableCell>\r\n                                )}\r\n                            </TableRow>\r\n                        );\r\n                    })}\r\n                </TableBody>\r\n            </Table>\r\n        );\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport moment from 'moment';\r\n\r\nimport { FormHelperText, Link } from '@material-ui/core';\r\n\r\nimport { XYPlot, XAxis, YAxis, DiscreteColorLegend, VerticalRectSeries, Highlight } from 'react-vis';\r\n\r\nimport { ResultsHistogramTabState } from '../../states/results-view/ResultsHistogramTabState';\r\nimport { DfmContextType } from '../../DfmContext';\r\n\r\n// Orchestrations histogram view\r\n@observer\r\nexport class OrchestrationsHistogram extends React.Component<{ state: ResultsHistogramTabState }> {\r\n\r\n    static contextType = DfmContextType;\r\n    context!: React.ContextType<typeof DfmContextType>;\r\n\r\n    render(): JSX.Element {\r\n\r\n        const state = this.props.state;\r\n        const typeNames = Object.keys(state.histograms).sort();\r\n\r\n        return (<>\r\n\r\n            <FormHelperText className=\"items-count-label\">\r\n                {`${state.numOfInstancesShown} items shown`}\r\n\r\n                {state.zoomedIn && (<>\r\n\r\n                    {', '}\r\n                    <Link className=\"unhide-button\"\r\n                        component=\"button\"\r\n                        variant=\"inherit\"\r\n                        onClick={() => state.resetZoom()}\r\n                    >\r\n                        reset zoom (Ctrl+Z)\r\n                        </Link>\r\n                </>)}\r\n\r\n            </FormHelperText>\r\n\r\n            <XYPlot\r\n                width={window.innerWidth - 40} height={window.innerHeight - 400}\r\n                xType=\"time\"\r\n                stackBy=\"y\"\r\n                margin={{ left: 80, right: 10, top: 20 }}\r\n            >\r\n                {!!state.numOfInstancesShown && (\r\n                    <YAxis tickTotal={7} />\r\n                )}\r\n                <XAxis tickTotal={7} tickFormat={t => this.formatTimeTick(t, state.timeRangeInMilliseconds)} />\r\n\r\n                {typeNames.map(typeName => (<VerticalRectSeries\r\n                    key={typeName}\r\n                    stroke=\"white\"\r\n                    color={this.getColorCodeForInstanceType(typeName)}\r\n                    data={state.histograms[typeName]}\r\n                />))}\r\n\r\n                {!!state.numOfInstancesShown && (\r\n\r\n                    <Highlight\r\n                        color=\"#829AE3\"\r\n                        drag\r\n                        enableY={false}\r\n\r\n                        onDragEnd={(area) => {\r\n                            if (!!area) {\r\n                                state.applyZoom(area.left, area.right);\r\n                            }\r\n                        }}\r\n                    />\r\n                )}\r\n\r\n            </XYPlot>\r\n\r\n            <DiscreteColorLegend className=\"histogram-legend\"\r\n                colors={typeNames.map(typeName => this.getColorCodeForInstanceType(typeName))}\r\n                items={typeNames.map(typeName => `${typeName} (${state.counts[typeName]})`)}\r\n                orientation=\"horizontal\"\r\n            />\r\n\r\n        </>);\r\n    }\r\n\r\n    private getColorCodeForInstanceType(instanceType: string): string {\r\n\r\n        // Taking hash out of input string (reversed, to make names like 'func1', 'func2' etc. look different)\r\n        var hashCode = 0;\r\n        for (var i = instanceType.length - 1; i >= 0; i--) {\r\n            hashCode = ((hashCode << 5) - hashCode) + instanceType.charCodeAt(i);\r\n            // Convert to positive 32-bit integer\r\n            hashCode &= 0x7FFFFFFF;\r\n        }\r\n\r\n        // min 6 hex digits\r\n        hashCode |= 0x100000;\r\n\r\n        // Not too white\r\n        hashCode &= 0xFFFFEF;\r\n\r\n        return '#' + hashCode.toString(16);\r\n    }\r\n\r\n    private formatTimeTick(t: Date, timeRange: number) {\r\n\r\n        const m = moment(t);\r\n\r\n        if (!this.context.showTimeAsLocal) {\r\n            m.utc();\r\n        }\r\n\r\n        if (timeRange > 5 * 86400 * 1000) {\r\n            return m.format('YYYY-MM-DD');\r\n        }\r\n\r\n        if (timeRange > 86400 * 1000) {\r\n            return m.format('YYYY-MM-DD HH:mm');\r\n        }\r\n\r\n        if (timeRange > 10000) {\r\n\r\n            return m.second() === 0 ? m.format('HH:mm') : m.format('HH:mm:ss');\r\n        }\r\n\r\n        return (m.millisecond() === 0) ? m.format('HH:mm:ss') : m.format(':SSS');\r\n    }\r\n}","import * as React from 'react';\r\n\r\nimport { Box, Button, Typography } from '@material-ui/core';\r\n\r\nimport SaveIcon from '@material-ui/icons/Save';\r\n\r\nimport { IBackendClient } from '../services/IBackendClient';\r\n\r\n// A button to save something as an .SVG file\r\nexport class SaveAsSvgButton extends React.Component<{ svg: string, fileName: string, inProgress: boolean, backendClient: IBackendClient }> {\r\n\r\n    render(): JSX.Element {\r\n\r\n        if (this.props.backendClient.isVsCode) {\r\n\r\n            return (\r\n                <Button\r\n                    variant=\"outlined\"\r\n                    color=\"default\"\r\n                    disabled={this.props.inProgress}\r\n                    onClick={() => this.props.backendClient.call('SaveAs', this.props.fileName + '.svg', this.props.svg)}\r\n                >\r\n                    <SaveIcon />\r\n                    <Box width={20} />\r\n                    <Typography color=\"inherit\">Save as .SVG</Typography>\r\n                </Button>\r\n            );\r\n\r\n        } else {\r\n\r\n            return (\r\n                <Button\r\n                    variant=\"outlined\"\r\n                    color=\"default\"\r\n                    disabled={this.props.inProgress}\r\n                    href={URL.createObjectURL(new Blob([this.props.svg], { type: 'image/svg+xml' }))}\r\n                    download={this.props.fileName + '.svg'}\r\n                >\r\n                    <SaveIcon />\r\n                    <Box width={20} />\r\n                    <Typography color=\"inherit\">Save as .SVG</Typography>\r\n                </Button>\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\n// Appends some styling to SVG code, so it can also be saved as file\r\nexport function getStyledSvg(svg: string): string {\r\n\r\n    return svg.replace('</style>',\r\n        '.note { stroke: none !important; fill: none !important; } ' +\r\n        '.noteText { font-size: 9px !important; } ' +\r\n        '</style>'\r\n    );\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Box, Button, Toolbar, Typography\r\n} from '@material-ui/core';\r\n\r\nimport FileCopyIcon from '@material-ui/icons/FileCopy';\r\n\r\nimport { ResultsGanttDiagramTabState } from '../../states/results-view/ResultsGanttDiagramTabState';\r\nimport { SaveAsSvgButton, getStyledSvg } from '../SaveAsSvgButton';\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\n\r\nimport { CustomTabStyle } from '../../theme';\r\n\r\n// Orchestrations Gantt chart view\r\n@observer\r\nexport class OrchestrationsGanttChart extends React.Component<{ state: ResultsGanttDiagramTabState, inProgress: boolean, fileName: string, backendClient: IBackendClient }> {\r\n\r\n    componentDidUpdate() {\r\n\r\n        // Mounting click handlers to diagram nodes\r\n        const svgElement = document.getElementById('mermaidSvgId');\r\n\r\n        if (!!svgElement) {\r\n\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('task'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('taskText'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('taskTextOutsideLeft'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('taskTextOutsideRight'));\r\n        }\r\n    }\r\n\r\n    render(): JSX.Element {\r\n\r\n        const state = this.props.state;\r\n\r\n        if (!state.rawHtml) {\r\n            return null;\r\n        }\r\n\r\n        return (<>\r\n\r\n            <div\r\n                className=\"raw-html-div\"\r\n                style={CustomTabStyle}\r\n                dangerouslySetInnerHTML={{ __html: getStyledSvg(state.rawHtml) }}\r\n            />\r\n\r\n            <Toolbar variant=\"dense\">\r\n\r\n                <Typography style={{ flex: 1 }} />\r\n\r\n                <Button\r\n                    variant=\"outlined\"\r\n                    color=\"default\"\r\n                    disabled={this.props.inProgress}\r\n                    onClick={() => window.navigator.clipboard.writeText(state.diagramCode)}\r\n                >\r\n                    <FileCopyIcon />\r\n                    <Box width={10} />\r\n                    <Typography color=\"inherit\">Copy diagram code to Clipboard</Typography>\r\n                </Button>\r\n\r\n                <Box width={20} />\r\n\r\n                <SaveAsSvgButton\r\n                    svg={getStyledSvg(state.rawHtml)}\r\n                    fileName={this.props.fileName}\r\n                    inProgress={this.props.inProgress}\r\n                    backendClient={this.props.backendClient}\r\n                />\r\n\r\n                <Box width={20} />\r\n            </Toolbar>\r\n        </>);\r\n    }\r\n\r\n    private mountClickEventToFunctionNodes(nodes: HTMLCollection): void {\r\n\r\n        const state = this.props.state;\r\n\r\n        for (var i = 0; i < nodes.length; i++) {\r\n            const el = nodes[i] as HTMLElement;\r\n\r\n            const oneBasedInstanceIndex = parseInt(el.id.substr(4));\r\n            el.onclick = () => state.goto(oneBasedInstanceIndex);\r\n            el.style.cursor = 'pointer';\r\n        }\r\n    }\r\n}","import { DurableOrchestrationStatus } from '../DurableOrchestrationStatus';\r\nimport { CancelToken } from '../../CancelToken';\r\n\r\nexport enum CustomTabTypeEnum {\r\n    RawHtml = 0,\r\n    MermaidDiagram,\r\n    FunctionGraph\r\n}\r\n\r\n// Represents states of custom tabs\r\nexport interface ICustomTabState {\r\n\r\n    name: string;\r\n    description: string;\r\n    rawHtml: string;\r\n    tabType: CustomTabTypeEnum;\r\n\r\n    load(details: DurableOrchestrationStatus, cancelToken: CancelToken): Promise<void>;\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Box, Button, Checkbox, Chip, FormGroup, FormControlLabel, FormHelperText, Link, Toolbar, Tooltip, Typography\r\n} from '@material-ui/core';\r\n\r\nimport FileCopyIcon from '@material-ui/icons/FileCopy';\r\n\r\nimport './OrchestrationsFunctionGraph.css';\r\n\r\nimport { ResultsFunctionGraphTabState } from '../../states/results-view/ResultsFunctionGraphTabState';\r\nimport { SaveAsSvgButton, getStyledSvg } from '../SaveAsSvgButton';\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\n\r\nimport { CustomTabStyle, RuntimeStatusToBadgeStyle } from '../../theme';\r\n\r\n// Interactive Function Graph view\r\n@observer\r\nexport class OrchestrationsFunctionGraph extends React.Component<{ state: ResultsFunctionGraphTabState, inProgress: boolean, fileName: string, backendClient: IBackendClient }> {\r\n\r\n    componentDidMount() {\r\n\r\n        window.addEventListener('resize', this.repositionMetricHints);\r\n        this.repositionMetricHints();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n\r\n        window.removeEventListener('resize', this.repositionMetricHints);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n\r\n        this.repositionMetricHints();\r\n\r\n        const svgElement = document.getElementById('mermaidSvgId');\r\n        if (!!svgElement) {\r\n\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('function'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('orchestrator'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('activity'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('entity'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('proxy'));\r\n        }\r\n    }\r\n\r\n    render(): JSX.Element {\r\n\r\n        const state = this.props.state;\r\n\r\n        return (<>\r\n            \r\n            <FormHelperText className=\"link-to-az-func-as-a-graph\" >\r\n                powered by <Link\r\n                    variant=\"inherit\"\r\n                    href=\"https://github.com/scale-tone/az-func-as-a-graph\"\r\n                >\r\n                    az-func-as-a-graph\r\n                </Link>\r\n            </FormHelperText>\r\n\r\n            {!!state.functionsLoaded && (\r\n                <FormGroup row className=\"settings-group\">\r\n\r\n                    <FormControlLabel\r\n                        control={<Checkbox\r\n                            color=\"default\"\r\n                            disabled={this.props.inProgress}\r\n                            checked={state.renderFunctions}\r\n                            onChange={(evt) => state.renderFunctions = evt.target.checked}\r\n                        />}\r\n                        label=\"Show Functions\"\r\n                    />\r\n\r\n                    <FormControlLabel\r\n                        control={<Checkbox\r\n                            color=\"default\"\r\n                            disabled={this.props.inProgress}\r\n                            checked={state.renderProxies}\r\n                            onChange={(evt) => state.renderProxies = evt.target.checked}\r\n                        />}\r\n                        label=\"Show Proxies\"\r\n                    />\r\n\r\n                    {this.renderTotalMetric()}\r\n\r\n                </FormGroup>\r\n            )}\r\n\r\n            {this.renderMetrics()}\r\n\r\n            {!!state.diagramSvg && (<>\r\n                <div\r\n                    className=\"diagram-div\"\r\n                    style={CustomTabStyle}\r\n                    dangerouslySetInnerHTML={{ __html: getStyledSvg(state.diagramSvg) }}\r\n                />\r\n\r\n                <Toolbar variant=\"dense\">\r\n\r\n                    <Typography style={{ flex: 1 }} />\r\n\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        color=\"default\"\r\n                        disabled={this.props.inProgress}\r\n                        onClick={() => window.navigator.clipboard.writeText(state.diagramCode)}\r\n                    >\r\n                        <FileCopyIcon />\r\n                        <Box width={10} />\r\n                        <Typography color=\"inherit\">Copy diagram code to Clipboard</Typography>\r\n                    </Button>\r\n\r\n                    <Box width={20} />\r\n\r\n                    <SaveAsSvgButton\r\n                        svg={getStyledSvg(state.diagramSvg)}\r\n                        fileName={this.props.fileName}\r\n                        inProgress={this.props.inProgress}\r\n                        backendClient={this.props.backendClient}\r\n                    />\r\n\r\n                    <Box width={20} />\r\n                </Toolbar>\r\n            </>)}\r\n        </>);\r\n    }\r\n\r\n    private readonly RunningStyle = RuntimeStatusToBadgeStyle(\"Running\");\r\n    private readonly CompletedStyle = RuntimeStatusToBadgeStyle(\"Completed\");\r\n    private readonly FailedStyle = RuntimeStatusToBadgeStyle(\"Failed\");\r\n    private readonly OtherStyle = RuntimeStatusToBadgeStyle(\"Terminated\");\r\n\r\n    private renderTotalMetric(): JSX.Element {\r\n        \r\n        const state = this.props.state;\r\n        const totalMetric = state.metrics[state.TotalMetricsName];\r\n\r\n        return (!!totalMetric && (!!totalMetric.completed || !!totalMetric.running || !!totalMetric.failed) && (\r\n            <span className=\"total-metrics-span\">\r\n\r\n                <Typography variant=\"body1\">Total instances:</Typography>\r\n\r\n                <Box width={10}/>\r\n                \r\n                {!!totalMetric.completed && (\r\n                    <Chip className=\"metrics-chip\" style={this.CompletedStyle} variant=\"outlined\" size=\"small\" label={`${totalMetric.completed} completed`} />\r\n                )}\r\n                {!!totalMetric.running && (\r\n                    <Chip className=\"metrics-chip\" style={this.RunningStyle} variant=\"outlined\" size=\"small\" label={`${totalMetric.running} running`} />\r\n                )}\r\n                {!!totalMetric.failed && (\r\n                    <Chip className=\"metrics-chip\" style={this.FailedStyle} variant=\"outlined\" size=\"small\" label={`${totalMetric.failed} failed`} />\r\n                )}\r\n                {!!totalMetric.other && (\r\n                    <Chip className=\"metrics-chip\" style={this.OtherStyle} variant=\"outlined\" size=\"small\" label={`${totalMetric.other} other`} />\r\n                )}\r\n                \r\n            </span>)\r\n        );\r\n    }\r\n    \r\n    private renderMetrics(): JSX.Element[] {\r\n        \r\n        const state = this.props.state;\r\n\r\n        return Object.keys(state.metrics).map(functionName => {\r\n\r\n            const metric = state.metrics[functionName];\r\n\r\n            return (<span id={`metrics-hint-${functionName.toLowerCase()}`} key={`metrics-hint-${functionName}`} className=\"metrics-span\">\r\n\r\n                {!!metric.completed && (\r\n                    <Tooltip title=\"Number of completed instances\">\r\n                        <Chip className=\"metrics-chip\" style={this.CompletedStyle} variant=\"outlined\" size=\"small\" label={`${metric.completed}`} />\r\n                    </Tooltip>\r\n                )}\r\n                {!!metric.running && (\r\n                    <Tooltip title=\"Number of running instances\">\r\n                        <Chip className=\"metrics-chip\" style={this.RunningStyle} variant=\"outlined\" size=\"small\" label={`${metric.running}`} />\r\n                    </Tooltip>\r\n                )}\r\n                {!!metric.failed && (\r\n                    <Tooltip title=\"Number of failed instances\">\r\n                        <Chip className=\"metrics-chip\" style={this.FailedStyle} variant=\"outlined\" size=\"small\" label={`${metric.failed}`} />\r\n                    </Tooltip>\r\n                )}\r\n                {!!metric.other && (\r\n                    <Tooltip title=\"Number of terminated/cancelled instances\">\r\n                        <Chip className=\"metrics-chip\" style={this.OtherStyle} variant=\"outlined\" size=\"small\" label={`${metric.other}`} />\r\n                    </Tooltip>\r\n                )}\r\n                \r\n            </span>);\r\n        });\r\n    }\r\n\r\n    private repositionMetricHints() {\r\n\r\n        const allMetricsHintNodes = document.getElementsByClassName('metrics-span');\r\n        for (var i = 0; i < allMetricsHintNodes.length; i++) {\r\n            const metricsHintNode = allMetricsHintNodes[i] as HTMLElement;\r\n            metricsHintNode.style.visibility = 'hidden';\r\n        }\r\n        \r\n        const svgElement = document.getElementById('mermaidSvgId');\r\n        if (!svgElement) {\r\n            return;\r\n        }\r\n\r\n        svgElement.onresize = () => {\r\n            this.repositionMetricHints();\r\n        };\r\n\r\n        const instanceNodes = Array.from(svgElement.getElementsByClassName('entity'))\r\n            .concat(Array.from(svgElement.getElementsByClassName('orchestrator')));\r\n        \r\n        var isHighlightedAttributeName = '';\r\n        \r\n        for (var instanceNode of instanceNodes) {\r\n\r\n            const match = /flowchart-(.+)-/.exec(instanceNode.id);\r\n            if (!!match) {\r\n\r\n                const functionName = match[1];\r\n                const metricsHintNode = document.getElementById(`metrics-hint-${functionName.toLowerCase()}`);\r\n                if (!!metricsHintNode) {\r\n\r\n                    // Mark this graph node as highlighed\r\n                    isHighlightedAttributeName = 'data-is-highlighted';\r\n                    instanceNode.setAttribute(isHighlightedAttributeName, 'true');\r\n\r\n                    const instanceNodeRect = instanceNode.getBoundingClientRect();\r\n                    \r\n                    metricsHintNode.style.visibility = 'visible';\r\n                    metricsHintNode.style.left = `${instanceNodeRect.left + 5}px`;\r\n                    metricsHintNode.style.top = `${instanceNodeRect.top - 17}px`;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Dimming those nodes that are not highlighted\r\n        if (!!isHighlightedAttributeName) {\r\n            for (var node of Array.from(svgElement.getElementsByClassName('node'))) {\r\n\r\n                (node as HTMLElement).style.opacity = !node.getAttribute(isHighlightedAttributeName) ? '0.6' : '1';\r\n            }\r\n        }\r\n    }\r\n\r\n    private mountClickEventToFunctionNodes(nodes: HTMLCollection): void {\r\n\r\n        const state = this.props.state;\r\n\r\n        for (var i = 0; i < nodes.length; i++) {\r\n            const el = nodes[i] as HTMLElement;\r\n\r\n            const match = /flowchart-(.+)-/.exec(el.id);\r\n            if (!!match) {\r\n\r\n                const closuredFunctionName = match[1];\r\n                el.onclick = () => state.gotoFunctionCode(closuredFunctionName);\r\n                el.style.cursor = 'pointer';\r\n            }\r\n        }\r\n    }\r\n}","import * as React from 'react';\r\nimport { action } from 'mobx'\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    AppBar, Box, Button, Checkbox, FormGroup, FormControl, FormControlLabel, Grid,\r\n    InputLabel, LinearProgress, Menu, MenuItem, Select, Tab, Tabs, TextField, Toolbar, Typography\r\n} from '@material-ui/core';\r\n\r\nimport { KeyboardDateTimePicker } from '@material-ui/pickers';\r\n\r\nimport RefreshIcon from '@material-ui/icons/Refresh';\r\nimport CancelOutlinedIcon from '@material-ui/icons/CancelOutlined';\r\nimport ArrowDropDownIcon from '@material-ui/icons/ArrowDropDown';\r\n\r\nimport './Orchestrations.css';\r\n\r\nimport { DurableOrchestrationStatusFields, RuntimeStatuses } from '../../states/DurableOrchestrationStatus';\r\nimport { ErrorMessage } from '../ErrorMessage';\r\nimport { OrchestrationsState, ResultsTabEnum, FilterOperatorEnum, TimeRangeEnum } from '../../states/results-view/OrchestrationsState';\r\nimport { ResultsListTabState } from '../../states/results-view/ResultsListTabState';\r\nimport { ResultsGanttDiagramTabState } from '../../states/results-view/ResultsGanttDiagramTabState';\r\nimport { ResultsHistogramTabState } from '../../states/results-view/ResultsHistogramTabState';\r\nimport { ResultsFunctionGraphTabState } from '../../states/results-view/ResultsFunctionGraphTabState';\r\nimport { OrchestrationsList } from './OrchestrationsList';\r\nimport { OrchestrationsHistogram } from './OrchestrationsHistogram';\r\nimport { OrchestrationsGanttChart } from './OrchestrationsGanttChart';\r\nimport { OrchestrationsFunctionGraph } from './OrchestrationsFunctionGraph';\r\nimport { DfmContextType } from '../../DfmContext';\r\n\r\n// Orchestrations view\r\n@observer\r\nexport class Orchestrations extends React.Component<{ state: OrchestrationsState }> {\r\n\r\n    static contextType = DfmContextType;\r\n    context!: React.ContextType<typeof DfmContextType>;\r\n\r\n    componentDidMount() {\r\n\r\n        // Triggering initial load\r\n        this.props.state.loadOrchestrations();\r\n\r\n        // Doing a simple infinite scroll\r\n        document.addEventListener('scroll', (evt) => {\r\n\r\n            const state = this.props.state;\r\n\r\n            if (state.tabIndex !== ResultsTabEnum.List ) {\r\n                return;\r\n            }\r\n\r\n            const scrollingElement = (evt.target as Document).scrollingElement;\r\n            if (!scrollingElement) { \r\n                return;\r\n            }\r\n\r\n            const scrollPos = scrollingElement.scrollHeight - window.innerHeight - scrollingElement.scrollTop;\r\n            const scrollPosThreshold = 100;\r\n\r\n            if (scrollPos < scrollPosThreshold) {\r\n                state.loadOrchestrations();\r\n            }\r\n        });\r\n\r\n        // Doing zoom reset\r\n        document.addEventListener('keydown', (evt: any) => {\r\n\r\n            const state = this.props.state;\r\n            if (state.tabIndex === ResultsTabEnum.Histogram && !!evt.ctrlKey && evt.keyCode === 90) {\r\n\r\n                const histogramState = state.selectedTabState as ResultsHistogramTabState;\r\n                histogramState.resetZoom();\r\n            }\r\n        });\r\n    }\r\n\r\n    render(): JSX.Element {\r\n\r\n        const state = this.props.state;\r\n        const listState = state.selectedTabState as ResultsListTabState;\r\n        const histogramState = state.selectedTabState as ResultsHistogramTabState;\r\n        const ganttChartState = state.selectedTabState as ResultsGanttDiagramTabState;\r\n        const functionGraphState = state.selectedTabState as ResultsFunctionGraphTabState;\r\n\r\n        const timeZone = !this.context.showTimeAsLocal ? 'UTC' : 'Local';\r\n\r\n        return (<>\r\n\r\n            <Menu\r\n                anchorEl={state.menuAnchorElement}\r\n                keepMounted\r\n                open={!!state.menuAnchorElement}\r\n                onClose={() => state.menuAnchorElement = undefined}\r\n            >\r\n                <MenuItem onClick={() => state.timeRange = TimeRangeEnum.LastMinute}>Last Minute</MenuItem>\r\n                <MenuItem onClick={() => state.timeRange = TimeRangeEnum.Last10Minutes}>Last 10 Minutes</MenuItem>\r\n                <MenuItem onClick={() => state.timeRange = TimeRangeEnum.LastHour}>Last Hour</MenuItem>\r\n                <MenuItem onClick={() => state.timeRange = TimeRangeEnum.Last24Hours}>Last 24 Hours</MenuItem>\r\n                <MenuItem onClick={() => state.timeRange = TimeRangeEnum.Last7Days}>Last 7 Days</MenuItem>\r\n                <MenuItem onClick={() => state.timeRange = TimeRangeEnum.Last30Days}>Last 30 Days</MenuItem>\r\n                <MenuItem onClick={() => state.timeRange = TimeRangeEnum.Last90Days}>Last 90 Days</MenuItem>\r\n                <MenuItem onClick={() => state.timeRange = TimeRangeEnum.Custom}>Custom</MenuItem>\r\n            </Menu>\r\n            \r\n            <AppBar color=\"inherit\" position=\"static\" className=\"top-appbar\">\r\n\r\n                {state.inProgress ? (<LinearProgress />) : (<Box height={4} />)}\r\n\r\n                <Toolbar variant=\"dense\" className=\"top-toolbar\">\r\n\r\n                    <Grid container className=\"toolbar-grid1\">\r\n                        <Grid item xs={12}>\r\n\r\n                            <Button size=\"small\" variant=\"outlined\" className=\"time-period-menu-drop-btn\"\r\n                                onClick={evt => state.menuAnchorElement = evt.currentTarget}\r\n                            >\r\n                                <ArrowDropDownIcon/>\r\n                            </Button>\r\n                            \r\n                            {!!state.timeRange ? (\r\n                                <TextField\r\n                                    className=\"from-input\"\r\n                                    label=\"Time Range\"\r\n                                    InputProps={{ readOnly: true }}\r\n                                    InputLabelProps={{ shrink: true }}\r\n                                    type=\"text\"\r\n                                    value={this.timeRangeToString(state.timeRange)}\r\n                                />\r\n                            ) : (\r\n                                <KeyboardDateTimePicker\r\n                                    className=\"from-input\"\r\n                                    ampm={false}\r\n                                    autoOk={true}\r\n                                    label={`From (${timeZone})`}\r\n                                    invalidDateMessage=\"\"\r\n                                    format={\"YYYY-MM-DD HH:mm:ss\"}\r\n                                    disabled={state.inProgress}\r\n                                    value={this.context.getMoment(state.timeFrom)}\r\n                                    onChange={(t) => state.timeFrom = this.context.setMoment(t)}\r\n                                    onBlur={() => state.applyTimeFrom()}\r\n                                    onAccept={() => state.applyTimeFrom()}\r\n                                    onKeyPress={this.handleKeyPress}\r\n                                />\r\n                            )}\r\n\r\n                        </Grid>\r\n                        <Grid item xs={12} className=\"toolbar-grid1-item2\">\r\n\r\n                            {!state.timeRange && (<>\r\n\r\n                                <FormControl>\r\n                                    <Checkbox\r\n                                        id=\"till-checkbox\"\r\n                                        className=\"till-checkbox\"\r\n                                        disabled={state.inProgress}\r\n                                        checked={state.timeTillEnabled}\r\n                                        onChange={(evt) => state.timeTillEnabled = evt.target.checked}\r\n                                    />\r\n                                </FormControl>\r\n\r\n                                {state.timeTillEnabled ? (\r\n                                    <KeyboardDateTimePicker\r\n                                        className=\"till-input\"\r\n                                        ampm={false}\r\n                                        autoOk={true}\r\n                                        label={`Till (${timeZone})`}\r\n                                        invalidDateMessage=\"\"\r\n                                        format={\"YYYY-MM-DD HH:mm:ss\"}\r\n                                        disabled={state.inProgress}\r\n                                        value={this.context.getMoment(state.timeTill)}\r\n                                        onChange={(t) => state.timeTill = this.context.setMoment(t)}\r\n                                        onBlur={() => state.applyTimeTill()}\r\n                                        onAccept={() => state.applyTimeTill()}\r\n                                        onKeyPress={this.handleKeyPress}\r\n                                    />\r\n                                ) : (\r\n                                    <TextField\r\n                                        className=\"till-input\"\r\n                                        label={`Till (${timeZone})`}\r\n                                        placeholder=\"[Now]\"\r\n                                        InputLabelProps={{ shrink: true }}\r\n                                        type=\"text\"\r\n                                        disabled={true}\r\n                                    />\r\n                                )}\r\n\r\n                            </>)}\r\n                            \r\n                        </Grid>\r\n                    </Grid>\r\n\r\n                    <Grid container className=\"toolbar-grid2\">\r\n                        <Grid item xs={12}>\r\n                            <FormControl>\r\n                                <InputLabel htmlFor=\"filtered-column-select\">Filtered Column</InputLabel>\r\n                                <Select\r\n                                    className=\"toolbar-select filtered-column-input\"\r\n                                    disabled={state.inProgress}\r\n                                    value={state.filteredColumn}\r\n                                    onChange={(evt) => state.filteredColumn = evt.target.value as string}\r\n                                    inputProps={{ id: \"filtered-column-select\" }}>\r\n\r\n                                    <MenuItem value=\"0\">[Not Selected]</MenuItem>\r\n                                    {DurableOrchestrationStatusFields.map(col => {\r\n                                        return (<MenuItem key={col} value={col}>{col}</MenuItem>);\r\n                                    })}\r\n\r\n                                </Select>\r\n                            </FormControl>\r\n                            <FormControl className=\"toolbar-grid2-item1-select\">\r\n                                <InputLabel htmlFor=\"filter-operator-select\">Filter Operator</InputLabel>\r\n                                <Select\r\n                                    className=\"toolbar-select\"\r\n                                    disabled={state.inProgress}\r\n                                    value={state.filterOperator}\r\n                                    onChange={(evt) => state.filterOperator = evt.target.value as number}\r\n                                    inputProps={{ id: \"filter-operator-select\" }}>\r\n                                    <MenuItem value={FilterOperatorEnum.Equals}>Equals</MenuItem>\r\n                                    <MenuItem value={FilterOperatorEnum.StartsWith}>Starts With</MenuItem>\r\n                                    <MenuItem value={FilterOperatorEnum.Contains}>Contains</MenuItem>\r\n                                    <MenuItem value={FilterOperatorEnum.NotEquals}>Not Equals</MenuItem>\r\n                                    <MenuItem value={FilterOperatorEnum.NotStartsWith}>Not Starts With</MenuItem>\r\n                                    <MenuItem value={FilterOperatorEnum.NotContains}>Not Contains</MenuItem>\r\n                                </Select>\r\n                            </FormControl>\r\n                        </Grid>\r\n                        <Grid item xs={12} className=\"toolbar-grid2-item2\">\r\n                            <TextField\r\n                                className=\"filter-value-input\"\r\n                                label=\"Filter Value\"\r\n                                InputLabelProps={{ shrink: true }}\r\n                                placeholder=\"[some text or 'null']\"\r\n                                disabled={state.filteredColumn === '0' || state.inProgress}\r\n                                value={state.filterValue}\r\n                                onChange={(evt) => state.filterValue = evt.target.value as string}\r\n                                onBlur={() => state.applyFilterValue()}\r\n                                onKeyPress={this.handleKeyPress}\r\n                            />\r\n                        </Grid>\r\n                    </Grid>\r\n\r\n                    <FormGroup className=\"toolbar-runtime-status-group\">\r\n\r\n                        <InputLabel className=\"toolbar-runtime-status-group-label\" shrink={true}>Type/Status {!state.showStatuses ? '' : ` (${state.showStatuses.length} selected)`}</InputLabel>\r\n\r\n                        <FormGroup className=\"toolbar-runtime-status-checkbox-group\" onScroll={() => state.rescheduleDelayedRefresh()}>\r\n                            <FormControlLabel\r\n                                control={<Checkbox className=\"status-checkbox\" disabled={state.inProgress} checked={state.isStatusChecked()}\r\n                                    onChange={(evt) => state.setStatusChecked(evt.target.checked)}\r\n                                />}\r\n                                label=\"[All]\"\r\n                            />\r\n\r\n                            {RuntimeStatuses.map(status => (<FormControlLabel key={status}\r\n                                control={<Checkbox className=\"status-checkbox\" disabled={state.inProgress} checked={state.isStatusChecked(status)}\r\n                                    onChange={(evt) => state.setStatusChecked(evt.target.checked, status)}\r\n                                />}\r\n                                label={'Orchestations:' + status}\r\n                            />))}\r\n\r\n                            <FormControlLabel\r\n                                control={<Checkbox className=\"status-checkbox\" disabled={state.inProgress} checked={state.isStatusChecked('DurableEntities')}\r\n                                    onChange={(evt) => state.setStatusChecked(evt.target.checked, 'DurableEntities')}\r\n                                />}\r\n                                label=\"Durable Entities\"\r\n                            />\r\n                        </FormGroup>\r\n\r\n                    </FormGroup>\r\n\r\n                    <Typography style={{ flex: 1 }} />\r\n\r\n                    <Grid container className=\"toolbar-grid3\">\r\n                        <Grid item xs={12}>\r\n                            <FormControl className=\"form-control-float-right\">\r\n                                <InputLabel htmlFor=\"auto-refresh-select\">Auto-refresh</InputLabel>\r\n                                <Select\r\n                                    className=\"autorefresh-select\"\r\n                                    inputProps={{ id: \"auto-refresh-select\" }}\r\n                                    value={state.autoRefresh}\r\n                                    onChange={(evt) => state.autoRefresh = evt.target.value as number}\r\n                                >\r\n                                    <MenuItem value={0}>Never</MenuItem>\r\n                                    <MenuItem value={1}>Every 1 sec.</MenuItem>\r\n                                    <MenuItem value={5}>Every 5 sec.</MenuItem>\r\n                                    <MenuItem value={10}>Every 10 sec.</MenuItem>\r\n                                </Select>\r\n                            </FormControl>\r\n                        </Grid>\r\n                        <Grid item xs={12} className=\"toolbar-grid3-item2\">\r\n                            <Button\r\n                                className=\"refresh-button form-control-float-right\"\r\n                                variant=\"outlined\"\r\n                                color=\"default\"\r\n                                size=\"large\"\r\n                                onClick={() => state.inProgress ? state.cancel() : state.reloadOrchestrations()}\r\n                            >\r\n                                {state.inProgress ? (<CancelOutlinedIcon />) : (<RefreshIcon />)}\r\n                            </Button>\r\n                        </Grid>\r\n                    </Grid>\r\n\r\n                </Toolbar>\r\n            </AppBar>\r\n\r\n            <AppBar color=\"inherit\" position=\"static\">\r\n                <Tabs className=\"tab-buttons\" value={state.tabIndex} onChange={(ev: React.ChangeEvent<{}>, val) => state.tabIndex = val}>\r\n\r\n                    <Tab className=\"tab-buttons\" disabled={state.inProgress} label={<Typography color=\"textPrimary\" variant=\"subtitle2\">List</Typography>} />\r\n                    <Tab className=\"tab-buttons\" disabled={state.inProgress} label={<Typography color=\"textPrimary\" variant=\"subtitle2\">Time Histogram</Typography>} />\r\n                    <Tab className=\"tab-buttons\" disabled={state.inProgress} label={<Typography color=\"textPrimary\" variant=\"subtitle2\">Gantt Chart</Typography>} />\r\n\r\n                    {!!state.isFunctionGraphAvailable && (\r\n                        <Tab className=\"tab-buttons\" disabled={state.inProgress} label={<Typography color=\"textPrimary\" variant=\"subtitle2\">Functions Graph</Typography>} />\r\n                    )}\r\n                    \r\n                </Tabs>\r\n            </AppBar>\r\n\r\n            {state.tabIndex === ResultsTabEnum.List && (<>\r\n\r\n                <OrchestrationsList state={listState} showLastEventColumn={state.showLastEventColumn} backendClient={state.backendClient} />\r\n\r\n                {state.inProgress && !!listState.orchestrations.length ? (<LinearProgress />) : (<Box height={4} />)}\r\n                \r\n            </>)}\r\n\r\n            {state.tabIndex === ResultsTabEnum.Histogram &&\r\n                (<OrchestrationsHistogram state={histogramState} />)\r\n            }\r\n            \r\n            {state.tabIndex === ResultsTabEnum.Gantt &&\r\n                (<OrchestrationsGanttChart\r\n                    state={ganttChartState}\r\n                    inProgress={state.inProgress}\r\n                    fileName={`gantt-chart-${state.timeFrom.format('YYYY-MM-DD-HH-mm-ss')}-${state.timeTill.format('YYYY-MM-DD-HH-mm-ss')}`} \r\n                    backendClient={state.backendClient} \r\n                />)\r\n            }\r\n\r\n            {state.tabIndex === ResultsTabEnum.FunctionGraph &&\r\n                (<OrchestrationsFunctionGraph\r\n                    state={functionGraphState}\r\n                    inProgress={state.inProgress}\r\n                    fileName={`function-graph-${state.timeFrom.format('YYYY-MM-DD-HH-mm-ss')}-${state.timeTill.format('YYYY-MM-DD-HH-mm-ss')}`} \r\n                    backendClient={state.backendClient} \r\n                />)\r\n            }\r\n                \r\n            <Toolbar variant=\"dense\" />\r\n            \r\n            <ErrorMessage state={this.props.state} />\r\n            \r\n        </>);\r\n    }\r\n\r\n    private timeRangeToString(timeRange: TimeRangeEnum): string {\r\n        switch (timeRange) {\r\n            case TimeRangeEnum.LastMinute: return 'Last Minute';\r\n            case TimeRangeEnum.Last10Minutes: return 'Last 10 Minutes';\r\n            case TimeRangeEnum.LastHour: return 'Last Hour';\r\n            case TimeRangeEnum.Last24Hours: return 'Last 24 Hours';\r\n            case TimeRangeEnum.Last7Days: return 'Last 7 Days';\r\n            case TimeRangeEnum.Last30Days: return 'Last 30 Days';\r\n            case TimeRangeEnum.Last90Days: return 'Last 90 Days';\r\n            default: return '';\r\n        }\r\n    }\r\n\r\n    @action.bound\r\n    private handleKeyPress(event: React.KeyboardEvent<HTMLInputElement>) {\r\n        if (event.key === 'Enter') {\r\n            // Otherwise the event will bubble up and the form will be submitted\r\n            event.preventDefault();\r\n\r\n            this.props.state.reloadOrchestrations();\r\n        }\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Box, Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, TextField\r\n} from '@material-ui/core';\r\n\r\nimport { OrchestrationDetailsState } from '../../states/details-view/OrchestrationDetailsState';\r\n\r\n// Buttons for detailed durable entity view\r\n@observer\r\nexport class DurableEntityButtons extends React.Component<{ state: OrchestrationDetailsState, disabled: boolean }> {\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (<>\r\n\r\n            {this.renderDialogs(state)}\r\n\r\n            <Button variant=\"outlined\" color=\"primary\" size=\"medium\" disabled={this.props.disabled} onClick={() => state.purgeConfirmationOpen = true}>\r\n                Purge\r\n            </Button>\r\n            <Box width={10} />\r\n            <Button variant=\"outlined\" color=\"primary\" size=\"medium\" disabled={this.props.disabled} onClick={() => state.raiseEventDialogOpen = true}>\r\n                Send Signal\r\n            </Button>\r\n        </>);\r\n    }\r\n\r\n    private renderDialogs(state: OrchestrationDetailsState): JSX.Element {\r\n        return (<>\r\n\r\n            <Dialog\r\n                open={state.purgeConfirmationOpen}\r\n                onClose={() => state.purgeConfirmationOpen = false}\r\n            >\r\n                <DialogTitle>Confirm Purge</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        You're about to purge entity '{state.orchestrationId}'. This operation drops entity state from the underlying storage and cannot be undone. Are you sure?\r\n                    </DialogContentText>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => state.purgeConfirmationOpen = false} color=\"primary\" autoFocus>\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={() => state.purge()} color=\"secondary\">\r\n                        Yes, purge\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n            <Dialog\r\n                fullWidth={true}\r\n                open={state.raiseEventDialogOpen}\r\n                onClose={() => state.raiseEventDialogOpen = false}\r\n            >\r\n                <DialogTitle>Send Signal</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        Provide signal name and some additional data\r\n                    </DialogContentText>\r\n\r\n                    <TextField\r\n                        autoFocus\r\n                        margin=\"dense\"\r\n                        label=\"Signal Name\"\r\n                        InputLabelProps={{ shrink: true }}\r\n                        fullWidth\r\n                        value={state.eventName}\r\n                        onChange={(evt) => state.eventName = evt.target.value as string}\r\n                    />\r\n\r\n                    <TextField\r\n                        margin=\"dense\"\r\n                        label=\"Signal Data (JSON)\"\r\n                        InputLabelProps={{ shrink: true }}\r\n                        fullWidth\r\n                        multiline\r\n                        rows={7}\r\n                        value={state.eventData}\r\n                        onChange={(evt) => state.eventData = evt.target.value as string}\r\n                    />\r\n\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => state.raiseEventDialogOpen = false} color=\"primary\">\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={() => state.raiseEvent()} disabled={!state.eventName} color=\"secondary\">\r\n                        Send\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n        </>);\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport { Grid, TextField } from '@material-ui/core';\r\n\r\nimport { DurableOrchestrationStatus } from '../../states/DurableOrchestrationStatus';\r\nimport { RuntimeStatusToStyle } from '../../theme';\r\n\r\n// Fields for detailed durable entity view\r\n@observer\r\nexport class DurableEntityFields extends React.Component<{ details: DurableOrchestrationStatus }> {\r\n\r\n    render(): JSX.Element {\r\n        const details = this.props.details;\r\n\r\n        const runtimeStatusStyle = RuntimeStatusToStyle(details.runtimeStatus);\r\n\r\n        return (<>\r\n            <Grid container className=\"grid-container\">\r\n                <Grid item xs={12} sm={12} md={3} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"entityId.name\"\r\n                        value={details.entityId?.name}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n\r\n                <Grid item xs={12} sm={6} md={3} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"entityId.key\"\r\n                        value={details.entityId?.key}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n\r\n                <Grid item xs={12} sm={6} md={2} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"createdTime\"\r\n                        value={details.createdTime}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} sm={6} md={2} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"lastUpdatedTime\"\r\n                        value={details.lastUpdatedTime}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} sm={6} md={2} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"runtimeStatus\"\r\n                        value={details.runtimeStatus}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        style={runtimeStatusStyle}\r\n                    />\r\n                </Grid>\r\n                \r\n                <Grid item xs={12} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"input\"\r\n                        value={JSON.stringify(details.input, null, 3)}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        multiline\r\n                        rowsMax={10}\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"customStatus\"\r\n                        value={JSON.stringify(details.customStatus, null, 3)}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        multiline\r\n                        rowsMax={10}\r\n                    />\r\n                </Grid>\r\n            </Grid>\r\n\r\n        </>);\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Box, Button, Checkbox, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle,\r\n    FormControlLabel, TextField\r\n} from '@material-ui/core';\r\n\r\nimport { OrchestrationDetailsState } from '../../states/details-view/OrchestrationDetailsState';\r\n\r\n// Buttons for detailed orchestration view\r\n@observer\r\nexport class OrchestrationButtons extends React.Component<{ state: OrchestrationDetailsState, disabled: boolean }> {\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (<>\r\n\r\n            {this.renderDialogs(state)}\r\n\r\n            <Button variant=\"outlined\" color=\"primary\" size=\"medium\" disabled={this.props.disabled} onClick={() => state.restartDialogOpen = true}>\r\n                Restart\r\n            </Button>\r\n            <Box width={10} />\r\n            <Button variant=\"outlined\" color=\"primary\" size=\"medium\" disabled={this.props.disabled} onClick={() => state.rewindConfirmationOpen = true}>\r\n                Rewind\r\n            </Button>\r\n            <Box width={10} />\r\n            <Button variant=\"outlined\" color=\"primary\" size=\"medium\" disabled={this.props.disabled} onClick={() => state.terminateConfirmationOpen = true}>\r\n                Terminate\r\n            </Button>\r\n            <Box width={10} />\r\n            <Button variant=\"outlined\" color=\"primary\" size=\"medium\" disabled={this.props.disabled} onClick={() => state.raiseEventDialogOpen = true}>\r\n                Raise Event\r\n            </Button>\r\n            <Box width={10} />\r\n            <Button variant=\"outlined\" color=\"primary\" size=\"medium\" disabled={this.props.disabled} onClick={() => state.setCustomStatusDialogOpen = true}>\r\n                Set Custom Status\r\n            </Button>\r\n            <Box width={10} />\r\n            <Button variant=\"outlined\" color=\"primary\" size=\"medium\" disabled={this.props.disabled} onClick={() => state.purgeConfirmationOpen = true}>\r\n                Purge\r\n            </Button>           \r\n            \r\n        </>);\r\n    }\r\n\r\n    private renderDialogs(state: OrchestrationDetailsState): JSX.Element {\r\n        return (<>\r\n\r\n            <Dialog\r\n                open={state.rewindConfirmationOpen}\r\n                onClose={() => state.rewindConfirmationOpen = false}\r\n            >\r\n                <DialogTitle>Confirm Rewind</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        You're about to rewind orchestration '{state.orchestrationId}'. Are you sure?\r\n                    </DialogContentText>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => state.rewindConfirmationOpen = false} color=\"primary\" autoFocus>\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={() => state.rewind()} color=\"secondary\">\r\n                        Yes, rewind\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n            <Dialog\r\n                open={state.terminateConfirmationOpen}\r\n                onClose={() => state.terminateConfirmationOpen = false}\r\n            >\r\n                <DialogTitle>Confirm Terminate</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        You're about to terminate orchestration '{state.orchestrationId}'. This operation cannot be undone. Are you sure?\r\n                    </DialogContentText>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => state.terminateConfirmationOpen = false} color=\"primary\" autoFocus>\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={() => state.terminate()} color=\"secondary\">\r\n                        Yes, terminate\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n            <Dialog\r\n                fullWidth={true}\r\n                open={state.raiseEventDialogOpen}\r\n                onClose={() => state.raiseEventDialogOpen = false}\r\n            >\r\n                <DialogTitle>Raise Event</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        Provide event name and some additional data\r\n                    </DialogContentText>\r\n\r\n                    <TextField\r\n                        autoFocus\r\n                        margin=\"dense\"\r\n                        label=\"Event Name\"\r\n                        InputLabelProps={{ shrink: true }}\r\n                        fullWidth\r\n                        value={state.eventName}\r\n                        onChange={(evt) => state.eventName = evt.target.value as string}\r\n                    />\r\n\r\n                    <TextField\r\n                        margin=\"dense\"\r\n                        label=\"Event Data (JSON)\"\r\n                        InputLabelProps={{ shrink: true }}\r\n                        fullWidth\r\n                        multiline\r\n                        rows={7}\r\n                        value={state.eventData}\r\n                        onChange={(evt) => state.eventData = evt.target.value as string}\r\n                    />\r\n\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => state.raiseEventDialogOpen = false} color=\"primary\">\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={() => state.raiseEvent()} disabled={!state.eventName} color=\"secondary\">\r\n                        Raise\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n            \r\n            <Dialog\r\n                fullWidth={true}\r\n                open={state.setCustomStatusDialogOpen}\r\n                onClose={() => state.setCustomStatusDialogOpen = false}\r\n            >\r\n                <DialogTitle>Set customStatus</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        customStatus field is a way for external clients to differentiate instances of your orchestration. It does not affect the orchestration workflow itself.\r\n                    </DialogContentText>\r\n\r\n                    <TextField\r\n                        margin=\"dense\"\r\n                        InputLabelProps={{ shrink: true }}\r\n                        label=\"New customStatus (JSON)\"\r\n                        fullWidth\r\n                        multiline\r\n                        rows={10}\r\n                        value={state.newCustomStatus}\r\n                        onChange={(evt) => state.newCustomStatus = evt.target.value as string}\r\n                    />\r\n\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => state.setCustomStatusDialogOpen = false} color=\"primary\">\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={() => state.setCustomStatus()} disabled={!state.isCustomStatusDirty} color=\"secondary\">\r\n                        Apply\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n            <Dialog\r\n                open={state.purgeConfirmationOpen}\r\n                onClose={() => state.purgeConfirmationOpen = false}\r\n            >\r\n                <DialogTitle>Confirm Purge</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        You're about to purge orchestration '{state.orchestrationId}'. This operation drops orchestration state from the underlying storage and cannot be undone. Are you sure?\r\n                    </DialogContentText>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => state.purgeConfirmationOpen = false} color=\"primary\" autoFocus>\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={() => state.purge()} color=\"secondary\">\r\n                        Yes, purge\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n            <Dialog\r\n                open={state.restartDialogOpen}\r\n                onClose={() => state.restartDialogOpen = false}\r\n            >\r\n                <DialogTitle>Confirm Restart</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        You're about to restart orchestration '{state.orchestrationId}'. Are you sure?\r\n                    </DialogContentText>\r\n\r\n                    <FormControlLabel control={<Checkbox\r\n                        checked={state.restartWithNewInstanceId}\r\n                        onChange={(evt) => state.restartWithNewInstanceId = evt.target.checked} />}\r\n                        label=\"Restart with new instanceId\"\r\n                    />\r\n\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => state.restartDialogOpen = false} color=\"primary\" autoFocus>\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={() => state.restart()} color=\"secondary\">\r\n                        Restart\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </>);\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    FormHelperText, Grid, Link, Table, TableBody, TableCell, TableHead, TableRow, TextField\r\n} from '@material-ui/core';\r\n\r\nimport { OrchestrationDetailsState } from '../../states/details-view/OrchestrationDetailsState';\r\nimport { HistoryEventFields, HistoryEvent } from '../../states/DurableOrchestrationStatus';\r\nimport { OrchestrationLink } from '../OrchestrationLink';\r\nimport { DfmContextType } from '../../DfmContext';\r\nimport { RuntimeStatusToStyle } from '../../theme';\r\nimport { Theme } from '../../theme';\r\nimport { LongJsonDialog } from '../dialogs/LongJsonDialog';\r\n\r\n// Fields for detailed orchestration view\r\n@observer\r\nexport class OrchestrationFields extends React.Component<{ state: OrchestrationDetailsState }> {\r\n\r\n    static contextType = DfmContextType;\r\n    context!: React.ContextType<typeof DfmContextType>;\r\n\r\n    componentDidMount() {\r\n\r\n        // Doing a simple infinite scroll\r\n        document.addEventListener('scroll', (evt) => {\r\n\r\n            const scrollingElement = (evt.target as Document).scrollingElement;\r\n            if (!scrollingElement) {\r\n                return;\r\n            }\r\n\r\n            const scrollPos = scrollingElement.scrollHeight - window.innerHeight - scrollingElement.scrollTop;\r\n            const scrollPosThreshold = 50;\r\n\r\n            if (scrollPos < scrollPosThreshold) {\r\n                this.props.state.loadHistory();\r\n            }\r\n        });\r\n    }\r\n\r\n    render(): JSX.Element {\r\n\r\n        const state = this.props.state;\r\n\r\n        const totalItems = state.historyTotalCount;\r\n        const details = state.details;\r\n        const history = state.history;\r\n        const itemsShown = history.length;\r\n\r\n        const runtimeStatusStyle = RuntimeStatusToStyle(details.runtimeStatus);\r\n\r\n        return (<>\r\n            <Grid container className=\"grid-container\">\r\n                <Grid item xs={12} sm={12} md={3} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"instanceId\"\r\n                        value={details.instanceId}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} sm={12} md={3} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"name\"\r\n                        value={details.name}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} sm={4} md={2} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"createdTime\"\r\n                        value={this.context.formatDateTimeString(details.createdTime)}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} sm={4} md={2} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"lastUpdatedTime\"\r\n                        value={this.context.formatDateTimeString(details.lastUpdatedTime)}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} sm={4} md={2} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"runtimeStatus\"\r\n                        value={details.runtimeStatus}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        style={runtimeStatusStyle}\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"input\"\r\n                        value={JSON.stringify(details.input, null, 3)}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        multiline\r\n                        rowsMax={8}\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"output\"\r\n                        value={JSON.stringify(details.output, null, 3)}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        multiline\r\n                        rowsMax={8}\r\n                    />\r\n                </Grid>\r\n                <Grid item xs={12} zeroMinWidth className=\"grid-item\">\r\n                    <TextField\r\n                        label=\"customStatus\"\r\n                        value={JSON.stringify(details.customStatus, null, 3)}\r\n                        margin=\"normal\"\r\n                        InputProps={{ readOnly: true }}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        multiline\r\n                        rowsMax={8}\r\n                    />\r\n                </Grid>\r\n            </Grid>\r\n\r\n            <FormHelperText className=\"history-events-count-label\">\r\n                historyEvents: { (!totalItems || totalItems === itemsShown) ? `${itemsShown} items${!totalItems ? ' shown' : ''}` : `${itemsShown} of ${totalItems} items shown` }\r\n            </FormHelperText>\r\n\r\n            {!!history.length && this.renderTable(history)}\r\n\r\n            <LongJsonDialog state={state.longJsonDialogState} />\r\n\r\n        </>);\r\n    }\r\n\r\n    private getFunctionName(event: HistoryEvent): string {\r\n\r\n        if (!!event.Name) {\r\n            return event.Name;\r\n        }\r\n\r\n        return event.FunctionName ?? '';\r\n    }\r\n\r\n    private renderEventLink(event: HistoryEvent): JSX.Element | string {\r\n\r\n        const state = this.props.state;\r\n        const functionName = this.getFunctionName(event);\r\n\r\n        if (!!event.SubOrchestrationId) {\r\n            return (<OrchestrationLink orchestrationId={event.SubOrchestrationId}\r\n                title={functionName}\r\n                backendClient={state.backendClient}\r\n            />);\r\n        }\r\n\r\n        if (!!state.functionNames[functionName]) {\r\n            \r\n            // Showing link to sources\r\n            return (<Link className=\"link-with-pointer-cursor\"\r\n                color={Theme.palette.type === 'dark' ? 'inherit' : 'primary'}\r\n                onClick={() => { state.gotoFunctionCode(functionName) }}\r\n            >\r\n                {functionName}\r\n            </Link>);\r\n        }\r\n\r\n        return functionName;\r\n    }\r\n\r\n    private renderTable(events: HistoryEvent[]): JSX.Element {\r\n\r\n        return (\r\n            <Table size=\"small\">\r\n                <TableHead>\r\n                    <TableRow>\r\n                        {HistoryEventFields.map(col => {\r\n                            return <TableCell key={col}>{col}</TableCell>;\r\n                        })}\r\n                    </TableRow>\r\n                </TableHead>\r\n                <TableBody>\r\n                    {events.map((event: HistoryEvent, index: number) => {\r\n\r\n                        const cellStyle = { verticalAlign: 'top' };\r\n                        return (\r\n                            <TableRow key={index}>\r\n                                <TableCell style={cellStyle}>\r\n                                    {this.context.formatDateTimeString(event.Timestamp)}\r\n                                </TableCell>\r\n                                <TableCell style={cellStyle}>\r\n                                    {event.EventType}\r\n                                </TableCell>\r\n                                <TableCell style={cellStyle}>\r\n                                    {event.EventId}\r\n                                </TableCell>\r\n                                <TableCell className=\"name-cell\" style={cellStyle}>\r\n                                    {this.renderEventLink(event)}\r\n                                </TableCell>\r\n                                <TableCell style={cellStyle}>\r\n                                    {this.context.formatDateTimeString(event.ScheduledTime)}\r\n                                </TableCell>\r\n                                <TableCell className=\"long-text-cell\" style={cellStyle}>\r\n                                    {LongJsonDialog.renderJson(event.Result, `${event.EventType} / ${this.getFunctionName(event)} / ${HistoryEventFields[5]}`, this.props.state.longJsonDialogState)}\r\n                                </TableCell>\r\n                                <TableCell className=\"long-text-cell\" style={cellStyle}>\r\n                                    {LongJsonDialog.renderJson(event.Details, `${event.EventType} / ${this.getFunctionName(event)} / ${HistoryEventFields[6]}`, this.props.state.longJsonDialogState)}\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        );\r\n                    })}\r\n                </TableBody>\r\n            </Table>\r\n        );\r\n    }\r\n}","import { observable, computed } from 'mobx';\r\n\r\nimport { IBackendClient } from '../services/IBackendClient';\r\nimport { BackendClient } from '../services/BackendClient';\r\nimport { LoginState, OrchestrationsPathPrefix } from './LoginState';\r\nimport { MainMenuState } from './MainMenuState';\r\nimport { OrchestrationsState } from './results-view/OrchestrationsState';\r\nimport { ResultsListTabState } from './results-view/ResultsListTabState';\r\nimport { OrchestrationDetailsState } from './details-view/OrchestrationDetailsState';\r\nimport { FunctionGraphState } from './FunctionGraphState';\r\nimport { PurgeHistoryDialogState } from './dialogs/PurgeHistoryDialogState';\r\nimport { CleanEntityStorageDialogState } from './dialogs/CleanEntityStorageDialogState';\r\nimport { ConnectionParamsDialogState } from './dialogs/ConnectionParamsDialogState';\r\nimport { StartNewInstanceDialogState } from './dialogs/StartNewInstanceDialogState';\r\nimport { TypedLocalStorage } from './TypedLocalStorage';\r\nimport { VsCodeBackendClient } from '../services/VsCodeBackendClient';\r\nimport { VsCodeTypedLocalStorage } from './VsCodeTypedLocalStorage';\r\n\r\n// This method is provided by VsCode, when running inside a WebView\r\ndeclare const acquireVsCodeApi: () => any;\r\n\r\n// Global variables declared in index.html and replaced by VsCode extension\r\ndeclare const OrchestrationIdFromVsCode: string;\r\ndeclare const IsFunctionGraphAvailable: boolean;\r\n\r\nenum DfmViewModeEnum {\r\n    DurableFunctions = 0,\r\n    FunctionGraph\r\n}\r\ndeclare const DfmViewMode: DfmViewModeEnum;\r\n\r\n// Main Application State\r\nexport class MainState  {\r\n    \r\n    readonly loginState?: LoginState;    \r\n    readonly mainMenuState?: MainMenuState;\r\n    readonly orchestrationsState?: OrchestrationsState;\r\n    readonly orchestrationDetailsState?: OrchestrationDetailsState;\r\n    readonly functionGraphState?: FunctionGraphState;\r\n    readonly purgeHistoryDialogState: PurgeHistoryDialogState;\r\n    readonly cleanEntityStorageDialogState: CleanEntityStorageDialogState;\r\n    readonly connectionParamsDialogState: ConnectionParamsDialogState;\r\n    readonly startNewInstanceDialogState: StartNewInstanceDialogState;\r\n\r\n    @observable\r\n    menuAnchorElement?: Element;\r\n\r\n    @computed\r\n    get typedInstanceId(): string {\r\n        return this._typedInstanceId;\r\n    }\r\n    set typedInstanceId(s: string) {\r\n        this._typedInstanceId = s;\r\n        this.reloadSuggestions();\r\n    }\r\n\r\n    @computed\r\n    get suggestions(): string[] {\r\n        return this._suggestions;\r\n    }\r\n\r\n    @computed\r\n    get isExactMatch(): boolean {\r\n        return this._suggestions.length === 1 && this._suggestions[0] === this._typedInstanceId;\r\n    }\r\n    \r\n    constructor() {\r\n\r\n        // checking whether we're inside VsCode\r\n        var vsCodeApi: any = undefined;\r\n        try {\r\n            vsCodeApi = acquireVsCodeApi();\r\n        } catch { }\r\n\r\n        if (!!vsCodeApi) {\r\n\r\n            const backendClient = new VsCodeBackendClient(vsCodeApi);\r\n            this._backendClient = backendClient;\r\n\r\n            this.purgeHistoryDialogState = new PurgeHistoryDialogState(backendClient);\r\n            this.cleanEntityStorageDialogState = new CleanEntityStorageDialogState(backendClient);\r\n            this.startNewInstanceDialogState = new StartNewInstanceDialogState(backendClient);\r\n\r\n            if (DfmViewMode === DfmViewModeEnum.FunctionGraph) {\r\n\r\n                this.functionGraphState = new FunctionGraphState(backendClient);\r\n\r\n            } else if (!!this.instanceId) {\r\n\r\n                this.orchestrationDetailsState = new OrchestrationDetailsState(this.instanceId,\r\n                    IsFunctionGraphAvailable,\r\n                    backendClient,\r\n                    new VsCodeTypedLocalStorage<OrchestrationDetailsState>('OrchestrationDetailsState', vsCodeApi));\r\n                \r\n            } else {\r\n\r\n                this.orchestrationsState = new OrchestrationsState(IsFunctionGraphAvailable, backendClient,\r\n                    new VsCodeTypedLocalStorage<OrchestrationsState & ResultsListTabState>('OrchestrationsState', vsCodeApi));\r\n\r\n                backendClient.setCustomHandlers(\r\n                    () => this.purgeHistoryDialogState.dialogOpen = true,\r\n                    () => this.cleanEntityStorageDialogState.dialogOpen = true\r\n                );\r\n            }\r\n            \r\n        } else {\r\n\r\n            this.loginState = new LoginState();\r\n\r\n            const backendClient = new BackendClient(() => this.loginState.taskHubName, () => this.loginState.getAuthorizationHeaderAsync());\r\n            this._backendClient = backendClient;\r\n\r\n            this.purgeHistoryDialogState = new PurgeHistoryDialogState(backendClient);\r\n            this.cleanEntityStorageDialogState = new CleanEntityStorageDialogState(backendClient);\r\n            this.connectionParamsDialogState = new ConnectionParamsDialogState(backendClient);\r\n            this.startNewInstanceDialogState = new StartNewInstanceDialogState(backendClient);\r\n\r\n            if (!!this.instanceId) {\r\n\r\n                this.orchestrationDetailsState = new OrchestrationDetailsState(this.instanceId,\r\n                    IsFunctionGraphAvailable,\r\n                    backendClient, \r\n                    new TypedLocalStorage<OrchestrationDetailsState>('OrchestrationDetailsState'));\r\n                \r\n            } else {\r\n\r\n                this.mainMenuState = new MainMenuState(backendClient, this.purgeHistoryDialogState, this.cleanEntityStorageDialogState, this.connectionParamsDialogState, this.startNewInstanceDialogState);\r\n                this.orchestrationsState = new OrchestrationsState(IsFunctionGraphAvailable, backendClient, new TypedLocalStorage<OrchestrationsState>('OrchestrationsState'));\r\n            }\r\n        }\r\n    }\r\n\r\n    // Opens the entered orchestrationId in a new tab\r\n    goto() {\r\n        window.open(`${this._backendClient.routePrefixAndTaskHubName}${OrchestrationsPathPrefix}${this._typedInstanceId}`);\r\n        this._typedInstanceId = '';\r\n        this._suggestions = [];\r\n    }\r\n\r\n    @observable\r\n    private _suggestions: string[] = [];\r\n    @observable\r\n    private _typedInstanceId: string = '';\r\n\r\n    private readonly _backendClient: IBackendClient;\r\n\r\n    // Extracts orchestrationId from URL or from VsCode\r\n    private get instanceId(): string {\r\n\r\n        if (!!OrchestrationIdFromVsCode) {\r\n            return OrchestrationIdFromVsCode;\r\n        }\r\n\r\n        const pos = window.location.pathname.lastIndexOf(OrchestrationsPathPrefix);\r\n        if (pos < 0) {\r\n            return '';\r\n        }\r\n\r\n        return window.location.pathname.substr(pos + OrchestrationsPathPrefix.length);\r\n    }\r\n\r\n    // Reloads list of suggested instanceIds\r\n    private reloadSuggestions(): void {\r\n\r\n        if (!this._typedInstanceId || this._typedInstanceId.length < 2) {\r\n            this._suggestions = [];\r\n            return;\r\n        }\r\n\r\n        const uri = `/id-suggestions(prefix='${this._typedInstanceId}')`;\r\n        this._backendClient.call('GET', uri).then(response => {\r\n\r\n            if (!response || !this._typedInstanceId) {\r\n                this._suggestions = [];\r\n            } else {\r\n                this._suggestions = response;\r\n            }\r\n        });\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Box, Button, Checkbox, Chip, FormGroup, FormControlLabel, FormHelperText, Link, Toolbar, Tooltip, Typography\r\n} from '@material-ui/core';\r\n\r\nimport FileCopyIcon from '@material-ui/icons/FileCopy';\r\n\r\nimport { FunctionGraphTabState } from '../../states/details-view/FunctionGraphTabState';\r\nimport { SaveAsSvgButton, getStyledSvg } from '../SaveAsSvgButton';\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { DateTimeHelpers } from '../../DateTimeHelpers';\r\n\r\nimport { CustomTabStyle, RuntimeStatusToBadgeStyle } from '../../theme';\r\n\r\n// Interactive Function Graph view\r\n@observer\r\nexport class OrchestrationDetailsFunctionGraph extends React.Component<{ state: FunctionGraphTabState, inProgress: boolean, fileName: string, backendClient: IBackendClient }> {\r\n\r\n    componentDidMount() {\r\n\r\n        window.addEventListener('resize', this.repositionMetricHints);\r\n        this.repositionMetricHints();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n\r\n        window.removeEventListener('resize', this.repositionMetricHints);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n\r\n        this.repositionMetricHints();\r\n\r\n        const svgElement = document.getElementById('mermaidSvgId');\r\n        if (!!svgElement) {\r\n\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('function'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('orchestrator'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('activity'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('entity'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('proxy'));\r\n        }\r\n    }\r\n\r\n    render(): JSX.Element {\r\n\r\n        const state = this.props.state;\r\n\r\n        return (<>\r\n            \r\n            <FormHelperText className=\"link-to-az-func-as-a-graph\" >\r\n                powered by <Link\r\n                    variant=\"inherit\"\r\n                    href=\"https://github.com/scale-tone/az-func-as-a-graph\"\r\n                >\r\n                    az-func-as-a-graph\r\n                </Link>\r\n            </FormHelperText>\r\n\r\n            {!!state.functionsLoaded && (\r\n                <FormGroup row className=\"settings-group\">\r\n\r\n                    <FormControlLabel\r\n                        control={<Checkbox\r\n                            color=\"default\"\r\n                            disabled={this.props.inProgress}\r\n                            checked={state.renderFunctions}\r\n                            onChange={(evt) => state.renderFunctions = evt.target.checked}\r\n                        />}\r\n                        label=\"Show Functions\"\r\n                    />\r\n\r\n                    <FormControlLabel\r\n                        control={<Checkbox\r\n                            color=\"default\"\r\n                            disabled={this.props.inProgress}\r\n                            checked={state.renderProxies}\r\n                            onChange={(evt) => state.renderProxies = evt.target.checked}\r\n                        />}\r\n                        label=\"Show Proxies\"\r\n                    />\r\n\r\n\r\n                </FormGroup>\r\n            )}\r\n\r\n            {this.renderMetrics()}\r\n\r\n            {!!state.diagramSvg && (<>\r\n                <div\r\n                    className=\"diagram-div\"\r\n                    style={CustomTabStyle}\r\n                    dangerouslySetInnerHTML={{ __html: getStyledSvg(state.diagramSvg) }}\r\n                />\r\n\r\n                <Toolbar variant=\"dense\">\r\n\r\n                    <Typography style={{ flex: 1 }} />\r\n\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        color=\"default\"\r\n                        disabled={this.props.inProgress}\r\n                        onClick={() => window.navigator.clipboard.writeText(state.diagramCode)}\r\n                    >\r\n                        <FileCopyIcon />\r\n                        <Box width={10} />\r\n                        <Typography color=\"inherit\">Copy diagram code to Clipboard</Typography>\r\n                    </Button>\r\n\r\n                    <Box width={20} />\r\n\r\n                    <SaveAsSvgButton\r\n                        svg={getStyledSvg(state.diagramSvg)}\r\n                        fileName={this.props.fileName}\r\n                        inProgress={this.props.inProgress}\r\n                        backendClient={this.props.backendClient}\r\n                    />\r\n\r\n                    <Box width={20} />\r\n                </Toolbar>\r\n            </>)}\r\n        </>);\r\n    }\r\n\r\n    private readonly RunningStyle = RuntimeStatusToBadgeStyle('Running');\r\n    private readonly CompletedStyle = RuntimeStatusToBadgeStyle('Completed');\r\n    private readonly FailedStyle = RuntimeStatusToBadgeStyle('Failed');\r\n    private readonly OtherStyle = RuntimeStatusToBadgeStyle('Terminated');\r\n    private readonly DurationStyle = RuntimeStatusToBadgeStyle('Duration');\r\n\r\n    private renderMetrics(): JSX.Element[] {\r\n        \r\n        const state = this.props.state;\r\n\r\n        return Object.keys(state.metrics).map(functionName => {\r\n\r\n            const metric = state.metrics[functionName];\r\n            const totalInstances = (metric.completed ?? 0) + (metric.running ?? 0) + (metric.failed ?? 0) + (metric.other ?? 0);\r\n\r\n            return (<span id={`metrics-hint-${functionName.toLowerCase()}`} key={`metrics-hint-${functionName}`} className=\"metrics-span\">\r\n\r\n                {!!metric.completed && (\r\n                    <Tooltip title={totalInstances === 1 ? `runtimeStatus` : `Number of completed instances`}>\r\n                        <Chip className=\"metrics-chip\" style={this.CompletedStyle} variant=\"outlined\" size=\"small\"\r\n                            label={totalInstances === 1 ? `completed` : `${metric.completed}`}\r\n                        />\r\n                    </Tooltip>\r\n                )}\r\n                {!!metric.running && (\r\n                    <Tooltip title={totalInstances === 1 ? `runtimeStatus` : `Number of running instances`}>\r\n                        <Chip className=\"metrics-chip\" style={this.RunningStyle} variant=\"outlined\" size=\"small\"\r\n                            label={totalInstances === 1 ? `running` : `${metric.running}`}\r\n                        />\r\n                    </Tooltip>\r\n                )}\r\n                {!!metric.failed && (\r\n                    <Tooltip title={totalInstances === 1 ? `runtimeStatus` : `Number of failed instances`}>\r\n                        <Chip className=\"metrics-chip\" style={this.FailedStyle} variant=\"outlined\" size=\"small\"\r\n                            label={totalInstances === 1 ? `failed` : `${metric.failed}`}\r\n                        />\r\n                    </Tooltip>\r\n                )}\r\n                {!!metric.other && (\r\n                    <Tooltip title={totalInstances === 1 ? `runtimeStatus` : `Number of terminated/cancelled instances`}>\r\n                        <Chip className=\"metrics-chip\" style={this.OtherStyle} variant=\"outlined\" size=\"small\"\r\n                            label={totalInstances === 1 ? `...` : `${metric.other}`}\r\n                        />\r\n                    </Tooltip>\r\n                )}\r\n\r\n                {!!metric.duration && (\r\n                    <Tooltip title={totalInstances === 1 ? `Duration` : `Max Duration`}>\r\n                        <Chip className=\"metrics-chip\" style={this.DurationStyle} variant=\"outlined\" size=\"small\"\r\n                            label={DateTimeHelpers.formatDuration(metric.duration)}\r\n                        />\r\n                    </Tooltip>\r\n                )}\r\n                \r\n            </span>);\r\n        });\r\n    }\r\n    \r\n    private repositionMetricHints() {\r\n\r\n        const allMetricsHintNodes = document.getElementsByClassName('metrics-span');\r\n        for (var i = 0; i < allMetricsHintNodes.length; i++) {\r\n            const metricsHintNode = allMetricsHintNodes[i] as HTMLElement;\r\n            metricsHintNode.style.visibility = 'hidden';\r\n        }\r\n        \r\n        const svgElement = document.getElementById('mermaidSvgId');\r\n        if (!svgElement) {\r\n            return;\r\n        }\r\n\r\n        svgElement.onresize = () => {\r\n            this.repositionMetricHints();\r\n        };\r\n\r\n        const instanceNodes = Array.from(svgElement.getElementsByClassName('entity'))\r\n            .concat(Array.from(svgElement.getElementsByClassName('orchestrator')))\r\n            .concat(Array.from(svgElement.getElementsByClassName('activity')));\r\n        \r\n        var isHighlightedAttributeName = '';\r\n        \r\n        for (var instanceNode of instanceNodes) {\r\n\r\n            const match = /flowchart-(.+)-/.exec(instanceNode.id);\r\n            if (!!match) {\r\n\r\n                const functionName = match[1];\r\n                const metricsHintNode = document.getElementById(`metrics-hint-${functionName.toLowerCase()}`);\r\n                if (!!metricsHintNode) {\r\n\r\n                    // Mark this graph node as highlighed\r\n                    isHighlightedAttributeName = 'data-is-highlighted';\r\n                    instanceNode.setAttribute(isHighlightedAttributeName, 'true');\r\n\r\n                    const instanceNodeRect = instanceNode.getBoundingClientRect();\r\n                    \r\n                    metricsHintNode.style.visibility = 'visible';\r\n                    metricsHintNode.style.left = `${instanceNodeRect.left + 5}px`;\r\n                    metricsHintNode.style.top = `${instanceNodeRect.top - 17}px`;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Dimming those nodes that are not highlighted\r\n        if (!!isHighlightedAttributeName) {\r\n            for (var node of Array.from(svgElement.getElementsByClassName('node'))) {\r\n\r\n                (node as HTMLElement).style.opacity = !node.getAttribute(isHighlightedAttributeName) ? '0.6' : '1';\r\n            }\r\n        }\r\n    }\r\n\r\n    private mountClickEventToFunctionNodes(nodes: HTMLCollection): void {\r\n\r\n        const state = this.props.state;\r\n\r\n        for (var i = 0; i < nodes.length; i++) {\r\n            const el = nodes[i] as HTMLElement;\r\n\r\n            const match = /flowchart-(.+)-/.exec(el.id);\r\n            if (!!match) {\r\n\r\n                const closuredFunctionName = match[1];\r\n                el.onclick = () => state.gotoFunctionCode(closuredFunctionName);\r\n                el.style.cursor = 'pointer';\r\n            }\r\n        }\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    AppBar, Box, Button, FormControl, InputLabel, LinearProgress, MenuItem,\r\n    Select, Tabs, Tab, Toolbar, Typography\r\n} from '@material-ui/core';\r\n\r\nimport RefreshIcon from '@material-ui/icons/Refresh';\r\nimport CancelOutlinedIcon from '@material-ui/icons/CancelOutlined';\r\nimport FileCopyIcon from '@material-ui/icons/FileCopy';\r\n\r\nimport './OrchestrationDetails.css';\r\n\r\nimport { DurableEntityButtons } from './DurableEntityButtons';\r\nimport { DurableEntityFields } from './DurableEntityFields';\r\nimport { ErrorMessage } from '../ErrorMessage';\r\nimport { OrchestrationButtons } from './OrchestrationButtons';\r\nimport { OrchestrationDetailsState } from '../../states/details-view/OrchestrationDetailsState';\r\nimport { FunctionGraphTabState } from '../../states/details-view/FunctionGraphTabState';\r\nimport { CustomTabTypeEnum } from '../../states/details-view/ICustomTabState';\r\nimport { OrchestrationFields } from './OrchestrationFields';\r\nimport { CustomTabStyle } from '../../theme';\r\nimport { SaveAsSvgButton, getStyledSvg } from '../SaveAsSvgButton';\r\nimport { OrchestrationDetailsFunctionGraph } from './OrchestrationDetailsFunctionGraph';\r\n\r\n// Orchestration Details view\r\n@observer\r\nexport class OrchestrationDetails extends React.Component<{ state: OrchestrationDetailsState }> {\r\n\r\n    componentDidMount() {\r\n\r\n        // Triggering initial load\r\n        this.props.state.loadDetails();\r\n    }\r\n\r\n    componentDidUpdate() {\r\n\r\n        // Mounting click handlers to diagram nodes\r\n        const svgElement = document.getElementById('mermaidSvgId');\r\n\r\n        if (!!svgElement) {\r\n\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('actor'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('messageText'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('task'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('taskText'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('taskTextOutsideLeft'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('taskTextOutsideRight'));\r\n        }\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (<>\r\n            <AppBar color=\"inherit\" position=\"static\" className=\"top-appbar\">\r\n\r\n                {state.inProgress ? (<LinearProgress />) : (<Box height={4} />)}\r\n\r\n                <Toolbar variant=\"dense\" className=\"details-top-toolbar\">\r\n\r\n                    {state.details.entityType === \"Orchestration\" && (\r\n                        <OrchestrationButtons state={state} disabled={state.inProgress} />\r\n                    )}\r\n                    {state.details.entityType === \"DurableEntity\" && (\r\n                        <DurableEntityButtons state={state} disabled={state.inProgress} />\r\n                    )}\r\n                    \r\n                    <Box width={20} />\r\n                    <Typography style={{ flex: 1 }} />\r\n\r\n                    <FormControl>\r\n                        <InputLabel htmlFor=\"auto-refresh-select\">Auto-refresh</InputLabel>\r\n                        <Select\r\n                            className=\"toolbar-select\"\r\n                            value={state.autoRefresh}\r\n                            onChange={(evt) => state.autoRefresh = evt.target.value as number}\r\n                            inputProps={{ id: 'auto-refresh-select' }}>\r\n                            <MenuItem value={0}>Never</MenuItem>\r\n                            <MenuItem value={1}>Every 1 sec.</MenuItem>\r\n                            <MenuItem value={5}>Every 5 sec.</MenuItem>\r\n                            <MenuItem value={10}>Every 10 sec.</MenuItem>\r\n                        </Select>\r\n                    </FormControl>\r\n\r\n                    <Box width={20} />\r\n\r\n                    <Button\r\n                        className=\"details-refresh-button\"\r\n                        variant=\"outlined\"\r\n                        color=\"default\"\r\n                        size=\"large\"\r\n                        disabled={state.inProgress && !state.loadInProgress}\r\n                        onClick={() => state.loadInProgress ? state.cancel() : state.loadDetails()}\r\n                    >\r\n                        {state.loadInProgress ? (<CancelOutlinedIcon />) : (<RefreshIcon />)}\r\n                    </Button>\r\n\r\n                </Toolbar>\r\n            </AppBar>\r\n\r\n            {!!state.tabStates.length && (<>\r\n                <AppBar color=\"inherit\" position=\"static\">\r\n                    <Tabs className=\"tab-buttons\" value={state.tabIndex}\r\n                        onChange={(ev: React.ChangeEvent<{}>, val) => {\r\n                            // Link to functions graph should not be selectable\r\n                            if (val !== 'functions-graph-link') {\r\n                                state.tabIndex = val;\r\n                            }\r\n                        }}>\r\n                        \r\n                        <Tab className=\"tab-buttons\" disabled={state.inProgress} \r\n                            label={<Typography color=\"textPrimary\" variant=\"subtitle2\">Details</Typography>}\r\n                        />\r\n                        \r\n                        {state.tabStates.map(tabState => (\r\n                            <Tab className=\"tab-buttons\" key={tabState.name} disabled={state.inProgress} \r\n                                label={<Typography color=\"textPrimary\" variant=\"subtitle2\">{tabState.name}</Typography>}\r\n                            />\r\n                        ))}\r\n\r\n                    </Tabs>\r\n                </AppBar>\r\n            </>)}\r\n\r\n            {!state.tabIndex && state.details.entityType === \"Orchestration\" && (<>\r\n                <OrchestrationFields state={state} />\r\n\r\n                {state.inProgress && !!state.history.length ? (<LinearProgress />) : (<Box height={4} />)}\r\n            </>)}\r\n\r\n            {!state.tabIndex && state.details.entityType === \"DurableEntity\" &&\r\n                <DurableEntityFields details={state.details} />\r\n            }\r\n\r\n            {!!state.selectedTab && state.selectedTab.tabType === CustomTabTypeEnum.FunctionGraph && (\r\n\r\n                <OrchestrationDetailsFunctionGraph\r\n                    state={state.selectedTab as FunctionGraphTabState}\r\n                    inProgress={state.inProgress}\r\n                    fileName={state.orchestrationId}\r\n                    backendClient={state.backendClient}\r\n                />\r\n            )}\r\n\r\n            {!!state.selectedTab && state.selectedTab.tabType !== CustomTabTypeEnum.FunctionGraph && !!state.selectedTab.rawHtml && (<>\r\n\r\n                <div\r\n                    className=\"raw-html-div\"\r\n                    style={CustomTabStyle}\r\n                    dangerouslySetInnerHTML={{ __html: getStyledSvg(state.selectedTab.rawHtml) }}\r\n                />\r\n                \r\n                {state.selectedTab.tabType === CustomTabTypeEnum.MermaidDiagram && (\r\n\r\n                    <Toolbar variant=\"dense\">\r\n                        <Typography style={{ flex: 1 }} />\r\n\r\n                        <Button\r\n                            variant=\"outlined\"\r\n                            color=\"default\"\r\n                            disabled={state.inProgress}\r\n                            onClick={() => window.navigator.clipboard.writeText(state.selectedTab.description)}\r\n                        >\r\n                            <FileCopyIcon />\r\n                            <Box width={10} />\r\n                            <Typography color=\"inherit\">Copy diagram code to Clipboard</Typography>\r\n                        </Button>\r\n\r\n                        <Box width={20} />\r\n\r\n                        <SaveAsSvgButton\r\n                            svg={getStyledSvg(state.selectedTab.rawHtml)}\r\n                            fileName={state.orchestrationId}\r\n                            inProgress={state.inProgress}\r\n                            backendClient={state.backendClient}\r\n                        />\r\n\r\n                        <Box width={20} />\r\n                    </Toolbar>\r\n                )}\r\n                \r\n            </>)}\r\n\r\n            <ErrorMessage state={this.props.state} />\r\n        </>);\r\n    }\r\n\r\n    private mountClickEventToFunctionNodes(nodes: HTMLCollection): void {\r\n\r\n        const state = this.props.state;\r\n\r\n        for (var i = 0; i < nodes.length; i++) {\r\n            const el = nodes[i] as HTMLElement;\r\n            \r\n            var functionName = el.getAttribute('data-function-name');\r\n            if (!functionName) {\r\n                \r\n                functionName = el.innerHTML;\r\n                const match = />(.+)</.exec(functionName);\r\n                if (!!match) {\r\n                    functionName = match[1];\r\n                }\r\n            }\r\n\r\n            if (!!state.functionNames[functionName]) {\r\n\r\n                const closuredFunctionName = functionName;\r\n                el.onclick = () => state.gotoFunctionCode(closuredFunctionName);\r\n                el.style.cursor = 'pointer';\r\n            }\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport { AppBar, Box, Button, Checkbox, FormControlLabel, FormHelperText, LinearProgress, Link, Toolbar, Typography } from '@material-ui/core';\r\n\r\nimport './FunctionGraph.css';\r\n\r\nimport RefreshIcon from '@material-ui/icons/Refresh';\r\nimport FileCopyIcon from '@material-ui/icons/FileCopy';\r\nimport SaveAltIcon from '@material-ui/icons/SaveAlt';\r\nimport { ErrorMessage } from './ErrorMessage';\r\nimport { FunctionGraphState } from '../states/FunctionGraphState';\r\nimport { CustomTabStyle } from '../theme';\r\nimport { SaveAsSvgButton, getStyledSvg } from './SaveAsSvgButton';\r\n\r\n// Function Graph view\r\n@observer\r\nexport class FunctionGraph extends React.Component<{ state: FunctionGraphState }> {\r\n\r\n    componentDidMount() {\r\n\r\n        // Triggering initial load\r\n        this.props.state.load();\r\n    }\r\n\r\n    componentDidUpdate() {\r\n\r\n        // Mounting click handlers to diagram nodes. Built-in mermaid feature for this doesn't work inside vsCode (no idea why)\r\n        const svgElement = document.getElementById('mermaidSvgId');\r\n\r\n        if (!!svgElement) {\r\n\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('function'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('orchestrator'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('activity'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('entity'));\r\n            this.mountClickEventToFunctionNodes(svgElement.getElementsByClassName('proxy'));\r\n        }\r\n    }\r\n    \r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (<>\r\n            <AppBar color=\"inherit\" position=\"static\" className=\"top-appbar\">\r\n\r\n                {state.inProgress ? (<LinearProgress />) : (<Box height={4} />)}\r\n\r\n                <Toolbar variant=\"dense\">\r\n                    <Box width={20} />\r\n\r\n                    <FormControlLabel\r\n                        control={<Checkbox\r\n                            color=\"default\"\r\n                            disabled={state.inProgress}\r\n                            checked={state.renderFunctions}\r\n                            onChange={(evt) => state.renderFunctions = evt.target.checked}\r\n                        />}\r\n                        label=\"Show Functions\"\r\n                    />\r\n                    <Box width={20} />\r\n\r\n                    <FormControlLabel\r\n                        control={<Checkbox\r\n                            color=\"default\"\r\n                            disabled={state.inProgress}\r\n                            checked={state.renderProxies}\r\n                            onChange={(evt) => state.renderProxies = evt.target.checked}\r\n                        />}\r\n                        label=\"Show Proxies\"\r\n                    />\r\n                    \r\n                    <Box width={20} />\r\n                    <Typography style={{ flex: 1 }} />\r\n\r\n                    <Button\r\n                        className=\"details-refresh-button\"\r\n                        variant=\"outlined\"\r\n                        color=\"default\"\r\n                        size=\"large\"\r\n                        disabled={state.inProgress}\r\n                        onClick={() => state.load()}\r\n                    >\r\n                        <RefreshIcon />\r\n                    </Button>\r\n\r\n                </Toolbar>\r\n            </AppBar>\r\n\r\n            <FormHelperText className=\"link-to-az-func-as-a-graph\" >\r\n                powered by <Link\r\n                    variant=\"inherit\"\r\n                    href=\"https://github.com/scale-tone/az-func-as-a-graph\"\r\n                >\r\n                    az-func-as-a-graph\r\n                </Link>\r\n            </FormHelperText>\r\n\r\n            {!!state.diagramSvg && (<>\r\n\r\n                <div\r\n                    className=\"diagram-div\"\r\n                    style={CustomTabStyle}\r\n                    dangerouslySetInnerHTML={{ __html: getStyledSvg(state.diagramSvg) }}\r\n                />\r\n\r\n                <Toolbar variant=\"dense\">\r\n\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        color=\"default\"\r\n                        disabled={state.inProgress}\r\n                        onClick={() => window.navigator.clipboard.writeText(state.diagramCode)}\r\n                    >\r\n                        <FileCopyIcon />\r\n                        <Box width={10} />\r\n                        <Typography color=\"inherit\">Copy diagram code to Clipboard</Typography>\r\n                    </Button>\r\n\r\n                    <Box width={20} />\r\n\r\n                    <SaveAsSvgButton\r\n                        svg={getStyledSvg(state.diagramSvg)}\r\n                        fileName=\"functions.svg\"\r\n                        inProgress={state.inProgress}\r\n                        backendClient={state.backendClient}\r\n                    />\r\n\r\n                    <Box width={20} />\r\n\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        color=\"default\"\r\n                        disabled={state.inProgress}\r\n                        onClick={() => state.saveAsJson()}\r\n                    >\r\n                        <SaveAltIcon />\r\n                        <Box width={10} />\r\n                        <Typography color=\"inherit\">Save as JSON</Typography>\r\n                    </Button>\r\n                    \r\n                </Toolbar>\r\n\r\n            </>)}\r\n\r\n            <ErrorMessage state={this.props.state} />\r\n        </>);\r\n    }\r\n\r\n    private mountClickEventToFunctionNodes(nodes: HTMLCollection): void {\r\n\r\n        const state = this.props.state;\r\n\r\n        for (var i = 0; i < nodes.length; i++) {\r\n            const el = nodes[i] as HTMLElement;\r\n\r\n            const match = /flowchart-(.+)-/.exec(el.id);\r\n            if (!!match) {\r\n\r\n                const closuredFunctionName = match[1];\r\n                el.onclick = () => state.gotoFunctionCode(closuredFunctionName);\r\n                el.style.cursor = 'pointer';\r\n            }\r\n        }\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Box, Checkbox, Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, FormControl,\r\n    FormControlLabel, FormGroup, FormLabel, LinearProgress, Radio, RadioGroup, Tooltip, Typography\r\n} from '@material-ui/core';\r\n\r\nimport { KeyboardDateTimePicker } from '@material-ui/pickers';\r\n\r\nimport './PurgeHistoryDialog.css';\r\n\r\nimport { ErrorMessage } from '../ErrorMessage';\r\nimport { EntityType, RuntimeStatus } from '../../states/DurableOrchestrationStatus';\r\nimport { PurgeHistoryDialogState } from '../../states/dialogs/PurgeHistoryDialogState';\r\nimport { DfmContextType } from '../../DfmContext';\r\n\r\n// Dialog with parameters for purging orchestration instance history\r\n@observer\r\nexport class PurgeHistoryDialog extends React.Component<{ state: PurgeHistoryDialogState }> {\r\n\r\n    static contextType = DfmContextType;\r\n    context!: React.ContextType<typeof DfmContextType>;\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        const timeZone = !this.context.showTimeAsLocal ? 'UTC' : 'Local';\r\n\r\n        return (\r\n            <Dialog open={state.dialogOpen} onClose={() => { if (!state.inProgress) state.dialogOpen = false; }}>\r\n\r\n                <DialogTitle>Purge Instance History</DialogTitle>\r\n\r\n                {state.instancesDeleted === null && (<>\r\n                    <DialogContent>\r\n\r\n                        {state.inProgress ? (<LinearProgress />) : (<Box height={4} />)}\r\n\r\n                        <DialogContentText>\r\n                            WARNING: this operation drops instance states from the underlying storage and cannot be undone.\r\n\r\n                            {state.entityType === \"DurableEntity\" && (\r\n                                <Typography color=\"error\" >\r\n                                    It might as well remove Durable Entities, that are still active.\r\n                                    Ensure that you specify the correct time frame!\r\n                                    To clean up deleted Entities use the 'Clean Entity Storage' command instead. \r\n                                </Typography>\r\n                            )}\r\n\r\n                        </DialogContentText>\r\n\r\n                        <FormControl className=\"purge-history-apply-to\" disabled={state.inProgress} fullWidth>\r\n                            <FormLabel>Apply to:</FormLabel>\r\n                            <RadioGroup row\r\n                                value={state.entityType}\r\n                                onChange={(evt) => state.entityType = (evt.target as HTMLInputElement).value as EntityType}\r\n                            >\r\n                                <FormControlLabel\r\n                                    disabled={state.inProgress}\r\n                                    value={\"Orchestration\"}\r\n                                    control={<Radio />}\r\n                                    label=\"Orchestrations\"\r\n                                />\r\n                                <FormControlLabel\r\n                                    disabled={state.inProgress}\r\n                                    value={\"DurableEntity\"}\r\n                                    control={<Radio />}\r\n                                    label=\"Durable Entities\"\r\n                                />\r\n                            </RadioGroup>\r\n                        </FormControl>\r\n\r\n                        <KeyboardDateTimePicker\r\n                            className=\"purge-history-from-input\"\r\n                            ampm={false}\r\n                            autoOk={true}\r\n                            label={state.entityType === 'DurableEntity' ? `Last Updated From (${timeZone})` : `From (${timeZone})`}\r\n                            format={\"YYYY-MM-DD HH:mm:ss\"}\r\n                            variant=\"inline\"\r\n                            disabled={state.inProgress}\r\n                            value={this.context.getMoment(state.timeFrom)}\r\n                            onChange={(t) => state.timeFrom = this.context.setMoment(t)}\r\n                        />\r\n\r\n                        <KeyboardDateTimePicker\r\n                            className=\"purge-history-till-input\"\r\n                            ampm={false}\r\n                            autoOk={true}\r\n                            label={state.entityType === 'DurableEntity' ? `Last Updated Till (${timeZone})` : `Till (${timeZone})`}\r\n                            format={\"YYYY-MM-DD HH:mm:ss\"}\r\n                            variant=\"inline\"\r\n                            disabled={state.inProgress}\r\n                            value={this.context.getMoment(state.timeTill)}\r\n                            onChange={(t) => state.timeTill = this.context.setMoment(t)}\r\n                        />\r\n\r\n                        <FormControl disabled={state.inProgress}>\r\n                            <FormLabel>With the following status:</FormLabel>\r\n\r\n                            {state.entityType === 'Orchestration' && (\r\n                                <FormGroup row>\r\n                                    <RuntimeStatusCheckbox state={state} runtimeStatus=\"Completed\" />\r\n                                    <RuntimeStatusCheckbox state={state} runtimeStatus=\"Failed\" />\r\n                                    <RuntimeStatusCheckbox state={state} runtimeStatus=\"Terminated\" />\r\n                                </FormGroup>\r\n                            )}\r\n\r\n                            {state.entityType === 'DurableEntity' && (\r\n                                <FormGroup row>\r\n                                    <Tooltip title=\"Durable Entities are always in 'Running' state\">\r\n                                        <FormControlLabel\r\n                                            control={<Checkbox\r\n                                                checked={true} />}\r\n                                            label=\"Running\"\r\n                                            disabled={true}\r\n                                        />\r\n                                    </Tooltip>\r\n                                </FormGroup>\r\n                            )}\r\n                        </FormControl>\r\n\r\n                        <ErrorMessage state={state} />\r\n\r\n                    </DialogContent>\r\n                    <DialogActions>\r\n                        <Button onClick={() => state.dialogOpen = false} disabled={state.inProgress} color=\"primary\">\r\n                            Cancel\r\n                        </Button>\r\n                        <Button onClick={() => state.purgeHistory()} disabled={!state.isValid || state.inProgress} color=\"secondary\">\r\n                            Purge\r\n                        </Button>\r\n                    </DialogActions>\r\n\r\n                </>)}\r\n\r\n                {state.instancesDeleted !== null && (<>\r\n                    <DialogContent>\r\n                        <DialogContentText className=\"success-message\">\r\n                            {state.instancesDeleted} instances were deleted.\r\n                        </DialogContentText>\r\n                    </DialogContent>\r\n                    <DialogActions>\r\n                        <Button onClick={() => state.dialogOpen = false} color=\"primary\">\r\n                            Close\r\n                        </Button>\r\n                    </DialogActions>\r\n                </>)}\r\n\r\n            </Dialog>\r\n        );\r\n    }\r\n}\r\n\r\n@observer\r\nclass RuntimeStatusCheckbox extends React.Component<{ state: PurgeHistoryDialogState, runtimeStatus: RuntimeStatus }> {\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n        const runtimeStatus = this.props.runtimeStatus;\r\n\r\n        return (\r\n            <FormControlLabel\r\n                control={<Checkbox\r\n                    checked={state.getStatusIncluded(runtimeStatus)}\r\n                    onChange={(evt) => state.setStatusIncluded(runtimeStatus, evt.target.checked)} />}\r\n                label={runtimeStatus}\r\n            />\r\n        );\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Box, Checkbox, Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, FormControl,\r\n    FormControlLabel, FormGroup, LinearProgress, \r\n} from '@material-ui/core';\r\n\r\nimport './CleanEntityStorageDialog.css';\r\n\r\nimport { ErrorMessage } from '../ErrorMessage';\r\nimport { CleanEntityStorageDialogState } from '../../states/dialogs/CleanEntityStorageDialogState';\r\n\r\n// Dialog with parameters for cleaning entity storage\r\n@observer\r\nexport class CleanEntityStorageDialog extends React.Component<{ state: CleanEntityStorageDialogState }> {\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (\r\n            <Dialog open={state.dialogOpen} onClose={() => { if (!state.inProgress) state.dialogOpen = false; }}>\r\n\r\n                <DialogTitle>Clean Entity Storage</DialogTitle>\r\n\r\n                {!state.response && (<>\r\n                    <DialogContent>\r\n\r\n                        {state.inProgress ? (<LinearProgress />) : (<Box height={4} />)}\r\n\r\n                        <DialogContentText>\r\n                            An entity is considered empty, and is removed, if it has no state, is not locked, and has been idle for more than <strong>EntityMessageReorderWindowInMinutes</strong>. Locks are considered orphaned, and are released, if the orchestration that holds them is not in <strong>Running</strong> state.\r\n                        </DialogContentText>\r\n\r\n                        <FormControl className=\"purge-history-statuses\" disabled={state.inProgress}>\r\n                            <FormGroup row>\r\n\r\n                                <FormControlLabel control={<Checkbox\r\n                                    checked={state.removeEmptyEntities}\r\n                                    onChange={(evt) => state.removeEmptyEntities = evt.target.checked} />}\r\n                                    label=\"Remove Empty Entities\"\r\n                                />\r\n\r\n                                <FormControlLabel control={<Checkbox\r\n                                    checked={state.releaseOrphanedLocks}\r\n                                    onChange={(evt) => state.releaseOrphanedLocks = evt.target.checked} />}\r\n                                    label=\"Release Orphaned Locks\"\r\n                                />\r\n                                \r\n                            </FormGroup>\r\n                        </FormControl>\r\n\r\n                        <ErrorMessage state={state} />\r\n\r\n                    </DialogContent>\r\n\r\n                    <DialogActions>\r\n                        <Button onClick={() => state.dialogOpen = false} disabled={state.inProgress} color=\"primary\">\r\n                            Cancel\r\n                        </Button>\r\n                        <Button onClick={() => state.clean()} disabled={!state.isValid || state.inProgress} color=\"secondary\">\r\n                            Clean\r\n                        </Button>\r\n                    </DialogActions>\r\n                </>)}\r\n\r\n                {!!state.response && (<>\r\n                    <DialogContent>\r\n                        <DialogContentText className=\"success-message\">\r\n                            {state.response.numberOfEmptyEntitiesRemoved} empty entities removed. \r\n                        </DialogContentText>\r\n                        <DialogContentText className=\"success-message\">\r\n                            {state.response.numberOfOrphanedLocksRemoved} orphaned locks removed.\r\n                        </DialogContentText>\r\n                    </DialogContent>\r\n                    <DialogActions>\r\n                        <Button onClick={() => state.dialogOpen = false} color=\"primary\">\r\n                            Close\r\n                        </Button>\r\n                    </DialogActions>\r\n                </>)}\r\n\r\n            </Dialog>\r\n        );\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Box, Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, LinearProgress, TextField\r\n} from '@material-ui/core';\r\n\r\n\r\nimport { ErrorMessage } from '../ErrorMessage';\r\nimport { ConnectionParamsDialogState } from '../../states/dialogs/ConnectionParamsDialogState';\r\n\r\n// Dialog for showing connection string and task hub name\r\n@observer\r\nexport class ConnectionParamsDialog extends React.Component<{ state: ConnectionParamsDialogState }> {\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (<Dialog open={state.dialogOpen} onClose={() => state.dialogOpen = false}>\r\n            \r\n            <DialogTitle>Manage Storage Connection Settings</DialogTitle>\r\n            <DialogContent>\r\n\r\n                {state.inProgress ? (<LinearProgress />) : (<Box height={4} />)}\r\n                \r\n                <DialogContentText>\r\n                    {\r\n                        state.isReadonly ?\r\n                            \"Change the below values via your application settings ('DFM_HUB_NAME' and 'AzureWebJobsStorage' respectively)\" :\r\n                            \"The below values will be saved to local.settings.json file.\"\r\n                    }\r\n                </DialogContentText>\r\n\r\n                <TextField\r\n                    className=\"dialog-text-field\"\r\n                    autoFocus\r\n                    margin=\"dense\"\r\n                    label=\"Hub Name\"\r\n                    fullWidth\r\n                    disabled={state.inProgress}\r\n                    InputProps={{ readOnly: true }}\r\n                    InputLabelProps={{ shrink: true }}\r\n                    value={state.hubName}\r\n                    onChange={(evt) => state.hubName = evt.target.value as string}\r\n                />\r\n\r\n                <TextField\r\n                    autoFocus\r\n                    margin=\"dense\"\r\n                    label=\"Azure Storage Connection String\"\r\n                    fullWidth\r\n                    disabled={state.inProgress}\r\n                    InputProps={{ readOnly: state.isReadonly }}\r\n                    InputLabelProps={{ shrink: true }}\r\n                    value={state.connectionString}\r\n                    onChange={(evt) => state.connectionString = evt.target.value as string}\r\n                />\r\n\r\n                <ErrorMessage state={state}/>\r\n\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={() => state.dialogOpen = false} color=\"primary\">\r\n                    Cancel\r\n                </Button>\r\n\r\n                {(!state.isReadonly) && (\r\n                    <Button\r\n                        onClick={() => state.saveConnectionParams()}\r\n                        disabled={!state.isDirty || !state.hubName || !state.connectionString || state.inProgress}\r\n                        color=\"secondary\"\r\n                    >\r\n                        Save\r\n                    </Button>\r\n                )}\r\n\r\n            </DialogActions>\r\n                \r\n       </Dialog>);\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport {\r\n    Box, Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, LinearProgress, TextField\r\n} from '@material-ui/core';\r\n\r\nimport './StartNewInstanceDialog.css';\r\n\r\nimport { ErrorMessage } from '../ErrorMessage';\r\nimport { StartNewInstanceDialogState } from '../../states/dialogs/StartNewInstanceDialogState';\r\nimport { OrchestrationLink } from '../OrchestrationLink';\r\n\r\n// Dialog for starting a new orchestration instance\r\n@observer\r\nexport class StartNewInstanceDialog extends React.Component<{ state: StartNewInstanceDialogState }> {\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (<Dialog open={state.dialogOpen} onClose={() => state.dialogOpen = false}>\r\n            \r\n            <DialogTitle>Start New Orchestration Instance</DialogTitle>\r\n\r\n            {!state.startedInstanceId && (<>\r\n            \r\n                <DialogContent>\r\n\r\n                    {state.inProgress ? (<LinearProgress />) : (<Box height={4} />)}\r\n\r\n                    <TextField\r\n                        className=\"dialog-text-field\"\r\n                        margin=\"dense\"\r\n                        label=\"InstanceId (optional)\"\r\n                        fullWidth\r\n                        disabled={state.inProgress}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        value={state.instanceId}\r\n                        onChange={(evt) => state.instanceId = evt.target.value as string}\r\n                    />\r\n\r\n                    <TextField\r\n                        className=\"dialog-text-field\"\r\n                        autoFocus\r\n                        margin=\"dense\"\r\n                        label=\"Orchestrator Function Name\"\r\n                        fullWidth\r\n                        disabled={state.inProgress}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        value={state.orchestratorFunctionName}\r\n                        onChange={(evt) => state.orchestratorFunctionName = evt.target.value as string}\r\n                    />\r\n\r\n                    <TextField\r\n                        margin=\"dense\"\r\n                        disabled={state.inProgress}\r\n                        InputLabelProps={{ shrink: true }}\r\n                        label=\"Input (optional JSON)\"\r\n                        fullWidth\r\n                        multiline\r\n                        rows={10}\r\n                        value={state.input}\r\n                        onChange={(evt) => state.input = evt.target.value as string}\r\n                    />\r\n\r\n                    <ErrorMessage state={state} />\r\n                    \r\n                </DialogContent>\r\n\r\n                <DialogActions>\r\n                    <Button onClick={() => state.dialogOpen = false} color=\"primary\">\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={() => state.startNewInstance()} disabled={!state.orchestratorFunctionName} color=\"secondary\">\r\n                        Start\r\n                    </Button>\r\n                </DialogActions>\r\n            \r\n            </>)}\r\n\r\n            {!!state.startedInstanceId && (<>\r\n            \r\n                <DialogContent>\r\n                    <DialogContentText className=\"success-message\">\r\n\r\n                        Instance <OrchestrationLink orchestrationId={state.startedInstanceId} backendClient={state.backendClient} /> has been started\r\n\r\n                    </DialogContentText>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => state.dialogOpen = false} color=\"primary\">\r\n                        Close\r\n                    </Button>\r\n                </DialogActions>\r\n            \r\n            </>)}\r\n                \r\n       </Dialog>);\r\n    }\r\n}","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\n\r\nimport { AppBar, Breadcrumbs, Box, Link, TextField, Toolbar, Typography } from '@material-ui/core';\r\nimport { MuiPickersUtilsProvider } from '@material-ui/pickers';\r\nimport Autocomplete from '@material-ui/lab/Autocomplete';\r\nimport MomentUtils from '@date-io/moment';\r\n\r\nimport './Main.css';\r\n\r\nimport { LoginIcon } from './LoginIcon';\r\nimport { MainMenu } from './MainMenu';\r\nimport { MainState } from '../states/MainState';\r\nimport { Orchestrations } from './results-view/Orchestrations';\r\nimport { OrchestrationDetails } from './details-view/OrchestrationDetails';\r\nimport { FunctionGraph } from './FunctionGraph';\r\nimport { PurgeHistoryDialog } from './dialogs/PurgeHistoryDialog';\r\nimport { CleanEntityStorageDialog } from './dialogs/CleanEntityStorageDialog';\r\nimport { ConnectionParamsDialog } from './dialogs/ConnectionParamsDialog';\r\nimport { StartNewInstanceDialog } from './dialogs/StartNewInstanceDialog';\r\n\r\nimport { DfmContextType, dfmContextInstance } from '../DfmContext';\r\n\r\n// DFM-specific route prefix, that is passed to us from the backend via a global static variable\r\ndeclare const DfmRoutePrefix: string;\r\n\r\n// The main application view\r\n@observer\r\nexport class Main extends React.Component<{ state: MainState }> {\r\n\r\n    render(): JSX.Element {\r\n        const state = this.props.state;\r\n\r\n        return (\r\n            <MuiPickersUtilsProvider utils={MomentUtils}><DfmContextType.Provider value={dfmContextInstance}>\r\n\r\n                {!state.loginState && (\r\n                    <Box height={20}/>\r\n                )}\r\n                \r\n                {!!state.loginState && (\r\n                    <AppBar position=\"static\" color=\"default\" className=\"app-bar\">\r\n                        <Toolbar>\r\n\r\n                            {state.loginState.isLoggedIn && !!state.mainMenuState && (\r\n                                <MainMenu state={state.mainMenuState} doRefresh={() => state.orchestrationsState.reloadOrchestrations()} />\r\n                            )}\r\n\r\n                            <img src={`${!DfmRoutePrefix ? '' : '/'}${DfmRoutePrefix}/logo.svg`} width=\"30px\"></img>\r\n                            <Box width={5} />\r\n\r\n                            <Typography variant=\"h6\" color=\"inherit\" className=\"title-typography\">\r\n                                <Link color=\"inherit\" href={state.loginState.rootUri}>\r\n                                    Durable Functions Monitor\r\n                                </Link>\r\n                            </Typography>\r\n\r\n                            <Breadcrumbs color=\"inherit\">\r\n                                <Link color=\"inherit\" href={state.loginState.locationPathName}>\r\n                                    / {state.loginState.taskHubName}\r\n                                </Link>\r\n\r\n                                {!state.orchestrationDetailsState ?\r\n                                    (\r\n                                        <Autocomplete\r\n                                            className=\"instance-id-input\"\r\n                                            freeSolo\r\n                                            options={state.isExactMatch ? [] : state.suggestions}\r\n                                            value={state.typedInstanceId}\r\n                                            onChange={(evt, newValue) => {\r\n                                                state.typedInstanceId = newValue ?? '';\r\n                                                if (!!newValue) {\r\n                                                    state.goto();\r\n                                                }\r\n                                            }}\r\n                                            renderInput={(params) => (\r\n                                                <TextField\r\n                                                    {...params}\r\n                                                    className={state.isExactMatch ? 'instance-id-valid' : null}\r\n                                                    size=\"small\"\r\n                                                    label=\"instanceId to go to...\"\r\n                                                    variant=\"outlined\"\r\n                                                    onChange={(evt) => state.typedInstanceId = evt.target.value as string}\r\n                                                    onKeyPress={(evt) => this.handleKeyPress(evt)}\r\n                                                />\r\n                                            )}\r\n                                        />\r\n                                    )\r\n                                    :\r\n                                    (<Typography color=\"inherit\">\r\n                                        <Link color=\"inherit\" href={window.location.pathname}>\r\n                                            {state.orchestrationDetailsState.orchestrationId}\r\n                                        </Link>\r\n                                    </Typography>)\r\n                                }\r\n\r\n                            </Breadcrumbs>\r\n\r\n                            <Typography style={{ flex: 1 }} />\r\n\r\n                            <LoginIcon state={state.loginState} />\r\n                        </Toolbar>\r\n                    </AppBar>\r\n                )}\r\n\r\n                {!!state.orchestrationsState && (!state.loginState || state.loginState.isLoggedIn) && (\r\n                    <Orchestrations state={state.orchestrationsState} />\r\n                )}\r\n\r\n                {!!state.orchestrationDetailsState && (!state.loginState || state.loginState.isLoggedIn) && (\r\n                    <OrchestrationDetails state={state.orchestrationDetailsState} />\r\n                )}\r\n\r\n                {!!state.functionGraphState && (!state.loginState || state.loginState.isLoggedIn) && (\r\n                    <FunctionGraph state={state.functionGraphState} />\r\n                )}\r\n\r\n                <PurgeHistoryDialog state={state.purgeHistoryDialogState}/>\r\n                <CleanEntityStorageDialog state={state.cleanEntityStorageDialogState} />\r\n                <ConnectionParamsDialog state={state.connectionParamsDialogState} />\r\n                <StartNewInstanceDialog state={state.startNewInstanceDialogState} />\r\n\r\n            </DfmContextType.Provider></MuiPickersUtilsProvider>\r\n        );\r\n    }\r\n\r\n    private handleKeyPress(event: React.KeyboardEvent<HTMLDivElement>) {\r\n        if (event.key === 'Enter') {\r\n            // Otherwise the event will bubble up and the form will be submitted\r\n            event.preventDefault();\r\n\r\n            this.props.state.goto();\r\n        }\r\n    }\r\n}","import { observable } from 'mobx'\r\n\r\nimport { IBackendClient } from '../services/IBackendClient';\r\nimport { PurgeHistoryDialogState } from './dialogs/PurgeHistoryDialogState';\r\nimport { CleanEntityStorageDialogState } from './dialogs/CleanEntityStorageDialogState';\r\nimport { ConnectionParamsDialogState } from './dialogs/ConnectionParamsDialogState';\r\nimport { StartNewInstanceDialogState } from './dialogs/StartNewInstanceDialogState';\r\n\r\n// State of Main Menu component\r\nexport class MainMenuState {\r\n\r\n    @observable\r\n    menuAnchorElement?: Element;\r\n\r\n    constructor(private _backendClient: IBackendClient,\r\n        private _purgeHistoryDialogState: PurgeHistoryDialogState,\r\n        private _cleanEntityStorageDialogState: CleanEntityStorageDialogState,\r\n        private _connectionParamsDialogState: ConnectionParamsDialogState,\r\n        private _startNewInstanceDialogState: StartNewInstanceDialogState) {\r\n    }\r\n    \r\n    showConnectionParamsDialog() {\r\n        this.menuAnchorElement = undefined;\r\n\r\n        this._connectionParamsDialogState.dialogOpen = true;\r\n    }\r\n\r\n    showPurgeHistoryDialog() {\r\n        this.menuAnchorElement = undefined;\r\n        \r\n        this._purgeHistoryDialogState.dialogOpen = true;\r\n    }\r\n\r\n    showCleanEntityStorageDialog() {\r\n        this.menuAnchorElement = undefined;\r\n\r\n        this._cleanEntityStorageDialogState.dialogOpen = true;\r\n    }\r\n\r\n    showStartNewInstanceDialog() {\r\n        this.menuAnchorElement = undefined;\r\n\r\n        this._startNewInstanceDialogState.dialogOpen = true;\r\n    }\r\n\r\n    setWindowTitle() {\r\n        \r\n        this._backendClient.call('GET', '/about').then(response => {\r\n            document.title = `Durable Functions Monitor (${response.accountName}/${response.hubName}) v${response.version}`;\r\n        });\r\n    }\r\n}","import { computed } from 'mobx';\r\n\r\nimport { ICustomTabState, CustomTabTypeEnum } from './ICustomTabState';\r\nimport { DurableOrchestrationStatus, HistoryEvent } from '../DurableOrchestrationStatus';\r\nimport { MermaidDiagramStateBase } from '../MermaidDiagramStateBase';\r\nimport { CancelToken } from '../../CancelToken';\r\n\r\n// Base class for all mermaid diagram tab states\r\nexport abstract class MermaidDiagramTabState extends MermaidDiagramStateBase implements ICustomTabState {\r\n\r\n    readonly name: string = \"Diagram\";\r\n    readonly tabType = CustomTabTypeEnum.MermaidDiagram;\r\n\r\n    @computed\r\n    get description(): string { return this._diagramCode; };\r\n\r\n    @computed\r\n    get rawHtml(): string { return this._diagramSvg; };\r\n\r\n    constructor(protected _loadHistory: (orchestrationId: string) => Promise<HistoryEvent[]>) {\r\n        super();\r\n    }\r\n\r\n    load(details: DurableOrchestrationStatus, cancelToken: CancelToken): Promise<void> {\r\n        \r\n        // Only doing this on demand, just in case\r\n        this.initMermaidWhenNeeded();\r\n\r\n        return this._loadHistory(details.instanceId).then(history => {\r\n\r\n            if (!history.length || cancelToken.isCancelled) {\r\n                return;\r\n            }\r\n\r\n            return this.buildDiagram(details, history, cancelToken);\r\n        });\r\n    }\r\n\r\n    protected abstract buildDiagram(details: DurableOrchestrationStatus, history: HistoryEvent[], cancelToken: CancelToken): Promise<void>;\r\n}","import mermaid from 'mermaid';\r\nimport moment from 'moment';\r\n\r\nimport { DurableOrchestrationStatus, HistoryEvent } from '../DurableOrchestrationStatus';\r\nimport { MermaidDiagramTabState } from './MermaidDiagramTabState';\r\nimport { CancelToken } from '../../CancelToken';\r\nimport { dfmContextInstance } from '../../DfmContext';\r\n\r\n// State of Sequence Diagram tab on OrchestrationDetails view\r\nexport class SequenceDiagramTabState extends MermaidDiagramTabState {\r\n\r\n    readonly name: string = \"Sequence Diagram\";\r\n\r\n    protected buildDiagram(details: DurableOrchestrationStatus, history: HistoryEvent[], cancelToken: CancelToken) : Promise<void> {\r\n\r\n        return new Promise<void>((resolve, reject) => {\r\n            Promise.all(this.getSequenceForOrchestration(details.name, '.', details.runtimeStatus === 'Failed', history)).then(sequenceLines => {\r\n\r\n                if (cancelToken.isCancelled) {\r\n                    resolve();\r\n                    return;\r\n                }\r\n\r\n                this._diagramCode = 'sequenceDiagram \\n' + sequenceLines.join('');\r\n\r\n                try {\r\n\r\n                    // Very much unknown, why this line is needed. Without it sometimes the diagrams fail to re-render\r\n                    this._diagramSvg = '';\r\n\r\n                    mermaid.render('mermaidSvgId', this._diagramCode, (svg) => {\r\n                        this._diagramSvg = svg;\r\n\r\n                        resolve();\r\n                    });\r\n                    \r\n                } catch (err) {\r\n                    reject(err);\r\n                }\r\n\r\n            }, reject);\r\n        });\r\n    }\r\n\r\n    private getSequenceForOrchestration(orchestrationName: string, parentOrchestrationName: string, isFailed: boolean, historyEvents: HistoryEvent[]): Promise<string>[] {\r\n\r\n        const externalActor = '.'\r\n        const results: Promise<string>[] = [];\r\n        var nextLine: string;\r\n\r\n        var i = 0;\r\n        while (i < historyEvents.length) {\r\n            const event = historyEvents[i];\r\n\r\n            switch (event.EventType) {\r\n                case 'ExecutionStarted':\r\n\r\n                    nextLine =\r\n                        `${parentOrchestrationName}->>+${orchestrationName}:[ExecutionStarted] \\n` +\r\n                        `Note over ${parentOrchestrationName},${orchestrationName}: ${this.formatTimestamp(event.Timestamp)} \\n`;\r\n                                        \r\n                    results.push(Promise.resolve(nextLine));\r\n\r\n                    break;\r\n                case 'SubOrchestrationInstanceCompleted':\r\n                case 'SubOrchestrationInstanceFailed':\r\n\r\n                    const subOrchFailed = event.EventType === 'SubOrchestrationInstanceFailed';\r\n\r\n                    if (!!event.SubOrchestrationId) {\r\n\r\n                        const subOrchestrationId = event.SubOrchestrationId;\r\n                        const subOrchestrationName = event.FunctionName;\r\n\r\n                        results.push(new Promise<string>((resolve, reject) => {\r\n                            this._loadHistory(subOrchestrationId).then(history => {\r\n\r\n                                Promise.all(this.getSequenceForOrchestration(subOrchestrationName, orchestrationName, subOrchFailed, history)).then(sequenceLines => {\r\n\r\n                                    resolve(sequenceLines.join(''));\r\n\r\n                                }, reject);\r\n\r\n                            }, err => {\r\n\r\n                                console.log(`Failed to load ${subOrchestrationName}. ${err.message}`);\r\n                                resolve(`${orchestrationName}-x${subOrchestrationName}:[FailedToLoad] \\n`);\r\n                            });\r\n                        }));\r\n\r\n                    } else if (!!subOrchFailed) {\r\n\r\n                        nextLine = `rect rgba(255,0,0,0.4) \\n` +\r\n                        `${orchestrationName}-x${event.FunctionName}:[SubOrchestrationInstanceFailed] \\n` +\r\n                        'end \\n';\r\n\r\n                        results.push(Promise.resolve(nextLine));\r\n                        \r\n                    } else {\r\n\r\n                        nextLine = `${orchestrationName}->>+${event.FunctionName}:[SubOrchestrationInstanceStarted] \\n`;\r\n\r\n                        results.push(Promise.resolve(nextLine));                        \r\n                    }\r\n\r\n                    break;\r\n                case 'TaskCompleted':\r\n\r\n                    // Trying to aggregate multiple parallel calls\r\n                    var maxDurationInMs = event.DurationInMs;\r\n                    var j = i + 1;\r\n                    for (; j < historyEvents.length &&\r\n                        historyEvents[j].EventType === 'TaskCompleted' &&\r\n                        historyEvents[j].FunctionName === event.FunctionName &&\r\n                        historyEvents[j].ScheduledTime.substr(0, 23) === event.ScheduledTime.substr(0, 23);\r\n                        j++) {\r\n\r\n                        if (maxDurationInMs < historyEvents[j].DurationInMs) {\r\n                            maxDurationInMs = historyEvents[j].DurationInMs;\r\n                        }\r\n                    }\r\n\r\n                    if (j === i + 1) {\r\n\r\n                        const nextLine =\r\n                            `${orchestrationName}->>${orchestrationName}:${event.FunctionName} \\n` +\r\n                            `Note over ${orchestrationName}: ${this.formatDuration(event.DurationInMs)} \\n`;\r\n                        results.push(Promise.resolve(nextLine));\r\n                        \r\n                    } else {\r\n\r\n                        const nextLine =\r\n                            `par ${j - i} calls \\n` +\r\n                            `${orchestrationName}->>${orchestrationName}:${event.FunctionName} \\n` +\r\n                            `Note over ${orchestrationName}: ${this.formatDuration(maxDurationInMs)} \\n` +\r\n                            `end \\n`;\r\n                        results.push(Promise.resolve(nextLine));\r\n\r\n                        i = j - 1;\r\n                    }\r\n\r\n                    break;\r\n                case 'TaskFailed':\r\n\r\n                    nextLine = `rect rgba(255,0,0,0.4) \\n` +\r\n                        `${orchestrationName}-x${orchestrationName}:${event.FunctionName} \\n` + \r\n                        'end \\n';\r\n                    \r\n                    results.push(Promise.resolve(nextLine));\r\n                    break;\r\n                case 'EventRaised':\r\n\r\n                    nextLine =\r\n                        `${externalActor}->>${orchestrationName}:${event.Name} \\n` +\r\n                        `Note over ${externalActor},${orchestrationName}: ${this.formatTimestamp(event.Timestamp)} \\n`;\r\n                    results.push(Promise.resolve(nextLine));\r\n\r\n                    break;\r\n                case 'TimerFired':\r\n\r\n                    nextLine =\r\n                        `${externalActor}->>${orchestrationName}:[TimerFired] \\n` +\r\n                        `Note over ${externalActor},${orchestrationName}: ${this.formatTimestamp(event.Timestamp)} \\n`;\r\n                    results.push(Promise.resolve(nextLine));\r\n\r\n                    break;\r\n                case 'ExecutionTerminated':\r\n\r\n                    nextLine =\r\n                        `${externalActor}->>${orchestrationName}:[ExecutionTerminated] \\n` +\r\n                        `Note over ${externalActor},${orchestrationName}: ${this.formatTimestamp(event.Timestamp)} \\n`;\r\n                    results.push(Promise.resolve(nextLine));\r\n\r\n                    break;\r\n                case 'ExecutionCompleted':\r\n\r\n                    nextLine =\r\n                        `${orchestrationName}-->>-${parentOrchestrationName}:[${!!isFailed ? 'ExecutionFailed' : 'ExecutionCompleted'}] \\n` +\r\n                        `Note over ${orchestrationName},${parentOrchestrationName}: ${this.formatDuration(event.DurationInMs)} \\n`;\r\n\r\n                    if (!!isFailed) {\r\n                    \r\n                        nextLine = `rect rgba(255,0,0,0.4) \\n` + nextLine + 'end \\n';\r\n                    }\r\n                        \r\n                    results.push(Promise.resolve(nextLine));\r\n\r\n                    break;\r\n            }\r\n\r\n            i++;\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    private formatTimestamp(timestamp: string): string {\r\n\r\n        if (timestamp.length <= 11) {\r\n            return timestamp;\r\n        }\r\n\r\n        if (!!dfmContextInstance.showTimeAsLocal) {\r\n            return moment(timestamp).format('(HH:mm:ss.SSS)')\r\n        }\r\n\r\n        return '(' + timestamp.substr(11, 12) + 'Z)';\r\n    }\r\n}","import { observable, computed } from 'mobx';\r\nimport mermaid from 'mermaid';\r\n\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { DurableOrchestrationStatus, HistoryEvent, RuntimeStatus } from '../DurableOrchestrationStatus';\r\nimport { ICustomTabState, CustomTabTypeEnum } from './ICustomTabState';\r\nimport { FunctionGraphStateBase, TraversalResult } from '../FunctionGraphStateBase';\r\nimport { buildFunctionDiagramCode } from '../az-func-as-a-graph/buildFunctionDiagramCode';\r\nimport { CancelToken } from '../../CancelToken';\r\nimport { MetricsMap, MetricsItem } from '../results-view/ResultsFunctionGraphTabState';\r\n\r\n// State of Functions Graph tab on OrchestrationDetails view\r\nexport class FunctionGraphTabState extends FunctionGraphStateBase implements ICustomTabState {\r\n\r\n    readonly name = \"Functions Graph\";\r\n    readonly tabType = CustomTabTypeEnum.FunctionGraph;\r\n\r\n    @computed\r\n    get description(): string { return this._diagramCode; };\r\n\r\n    @computed\r\n    get rawHtml(): string { return this._diagramSvg; };\r\n\r\n    @computed\r\n    get renderFunctions(): boolean { return this._renderFunctions; };\r\n    set renderFunctions(val: boolean) {\r\n        this._renderFunctions = val;\r\n        this.render();\r\n    };\r\n\r\n    @computed\r\n    get renderProxies(): boolean { return this._renderProxies; };\r\n    set renderProxies(val: boolean) {\r\n        this._renderProxies = val;\r\n        this.render();\r\n    };\r\n\r\n    @computed\r\n    get metrics(): MetricsMap { return this._metrics; }\r\n\r\n    constructor(backendClient: IBackendClient, traversalResult: TraversalResult, private _loadHistory: (orchestrationId: string) => Promise<HistoryEvent[]>) {\r\n        super(backendClient);\r\n        this._traversalResult = traversalResult;\r\n    }\r\n\r\n    load(details: DurableOrchestrationStatus, cancelToken: CancelToken): Promise<void> {\r\n\r\n        // Only doing this on demand, just in case\r\n        this.initMermaidWhenNeeded();\r\n\r\n        const metrics: MetricsMap = {};\r\n\r\n        return this.render().then(() => {\r\n\r\n            return this._loadHistory(details.instanceId).then(history => {\r\n\r\n                if (cancelToken.isCancelled) {\r\n                    return;\r\n                }\r\n\r\n                return this.updateMetricsForInstance(metrics, DurableOrchestrationStatus.getFunctionName(details),\r\n                        details.runtimeStatus, new Date(details.lastUpdatedTime).getTime() - new Date(details.createdTime).getTime(),\r\n                        history, cancelToken)\r\n                    .then(() => {\r\n\r\n                        this._metrics = metrics;\r\n                    });\r\n            });\r\n        })\r\n    }\r\n\r\n    @observable\r\n    private _metrics: MetricsMap = {};\r\n\r\n    private updateMetricsForInstance(metrics: MetricsMap,\r\n        funcName: string,\r\n        runtimeStatus: RuntimeStatus,\r\n        durationInMs: number,\r\n        history: HistoryEvent[],\r\n        cancelToken: CancelToken): Promise<void> {\r\n        \r\n        if (!metrics[funcName]) {\r\n            metrics[funcName] = new MetricsItem();\r\n        }\r\n\r\n        switch (runtimeStatus) {\r\n            case 'Completed':\r\n                metrics[funcName].completed++;\r\n                break;\r\n            case 'Running':\r\n            case 'Pending':\r\n            case 'ContinuedAsNew':\r\n                metrics[funcName].running++;\r\n                break;\r\n            case 'Failed':\r\n                metrics[funcName].failed++;\r\n                break;\r\n            default:\r\n                metrics[funcName].other++;\r\n                break;\r\n        }\r\n\r\n        if (metrics[funcName].duration < durationInMs) {\r\n            metrics[funcName].duration = durationInMs;\r\n        }\r\n\r\n        const promises: Promise<void>[] = [];\r\n\r\n        for (var event of history) {\r\n\r\n            const subFuncName = event.FunctionName ?? event.Name;\r\n\r\n            switch (event.EventType) {\r\n                case 'SubOrchestrationInstanceCreated':\r\n\r\n                    if (!!event.SubOrchestrationId) {\r\n\r\n                        promises.push(this._loadHistory(event.SubOrchestrationId).then(subHistory => {\r\n\r\n                            if (!cancelToken.isCancelled) {\r\n                                return this.updateMetricsForInstance(metrics, subFuncName, \"Running\", 0, subHistory, cancelToken);\r\n                            }\r\n                        }));\r\n                    }\r\n\r\n                    break;\r\n                case 'SubOrchestrationInstanceCompleted':\r\n\r\n                    if (!!event.SubOrchestrationId) {\r\n\r\n                        const durationInMs = new Date(event.Timestamp).getTime() - new Date(event.ScheduledTime).getTime();\r\n\r\n                        promises.push(this._loadHistory(event.SubOrchestrationId).then(subHistory => {\r\n\r\n                            if (!cancelToken.isCancelled) {\r\n                                return this.updateMetricsForInstance(metrics, subFuncName, \"Completed\", durationInMs, subHistory, cancelToken);\r\n                            }\r\n                        }));\r\n                    }\r\n                    \r\n                    break;\r\n                case 'SubOrchestrationInstanceFailed':\r\n\r\n                    if (!!event.SubOrchestrationId) {\r\n\r\n                        const durationInMs = new Date(event.Timestamp).getTime() - new Date(event.ScheduledTime).getTime();\r\n\r\n                        promises.push(this._loadHistory(event.SubOrchestrationId).then(subHistory => {\r\n\r\n                            if (!cancelToken.isCancelled) {\r\n                                return this.updateMetricsForInstance(metrics, subFuncName, \"Failed\", durationInMs, subHistory, cancelToken);\r\n                            }\r\n                        }));\r\n                    }\r\n                \r\n                    break;\r\n                case 'TaskCompleted':\r\n\r\n                    if (!metrics[subFuncName]) {\r\n                        metrics[subFuncName] = new MetricsItem();\r\n                    }\r\n\r\n                    metrics[subFuncName].completed++;\r\n\r\n                    if (metrics[subFuncName].duration < event.DurationInMs) {\r\n                        metrics[event.FunctionName].duration = event.DurationInMs;\r\n                    }\r\n                    \r\n                    break;\r\n                case 'TaskFailed':\r\n\r\n                    if (!metrics[subFuncName]) {\r\n                        metrics[subFuncName] = new MetricsItem();\r\n                    }\r\n\r\n                    metrics[subFuncName].failed++;\r\n\r\n                    if (metrics[subFuncName].duration < event.DurationInMs) {\r\n                        metrics[subFuncName].duration = event.DurationInMs;\r\n                    }\r\n                    \r\n                    break;\r\n                case 'TaskScheduled':\r\n\r\n                    if (!metrics[subFuncName]) {\r\n                        metrics[subFuncName] = new MetricsItem();\r\n                    }\r\n\r\n                    metrics[subFuncName].running++;\r\n                    \r\n                    break;\r\n            }                   \r\n        }\r\n\r\n        return Promise.all(promises) as any;\r\n    }\r\n    \r\n    private render(): Promise<void> {\r\n\r\n        this._diagramCode = '';\r\n        this._diagramSvg = '';\r\n\r\n        return new Promise<void>((resolve, reject) => {\r\n\r\n            try {\r\n                const diagramCode = buildFunctionDiagramCode(this._traversalResult.functions, this._traversalResult.proxies,\r\n                    {\r\n                        doNotRenderFunctions: !this._renderFunctions,\r\n                        doNotRenderProxies: !this._renderProxies\r\n                    });\r\n    \r\n                if (!diagramCode) {\r\n                    resolve();\r\n                    return;\r\n                }\r\n    \r\n                this._diagramCode = `graph LR\\n${diagramCode}`;\r\n    \r\n                mermaid.render('mermaidSvgId', this._diagramCode, (svg) => {\r\n    \r\n                    this._diagramSvg = this.applyIcons(svg);\r\n\r\n                    resolve();\r\n                });\r\n    \r\n            } catch (err) {\r\n                reject(err);\r\n            }\r\n        });\r\n    }\r\n}","import mermaid from 'mermaid';\r\nimport moment from 'moment';\r\n\r\nimport { DurableOrchestrationStatus, HistoryEvent } from '../DurableOrchestrationStatus';\r\nimport { MermaidDiagramTabState } from './MermaidDiagramTabState';\r\nimport { CancelToken } from '../../CancelToken';\r\nimport { dfmContextInstance } from '../../DfmContext';\r\n\r\ntype LineTextAndMetadata = { nextLine: string, functionName?: string, instanceId?: string, parentInstanceId?: string, duration?: number, widthPercentage?: number };\r\n\r\n// State of Gantt Diagram tab on OrchestrationDetails view\r\nexport class GanttDiagramTabState extends MermaidDiagramTabState {\r\n\r\n    readonly name: string = \"Gantt Chart\";\r\n\r\n    protected buildDiagram(details: DurableOrchestrationStatus, history: HistoryEvent[], cancelToken: CancelToken): Promise<void> {\r\n\r\n        return new Promise<void>((resolve, reject) => {\r\n            Promise.all(this.renderOrchestration(details.instanceId, details.name, history, true)).then(arrayOfArrays => {\r\n\r\n                if (cancelToken.isCancelled) {\r\n\r\n                    resolve();\r\n                    return;\r\n                }\r\n\r\n                const lines = arrayOfArrays.flat();\r\n                const linesWithMetadata = lines.filter(l => !!l.functionName);\r\n\r\n                this._diagramCode = 'gantt \\n' +\r\n                    `title ${details.name}(${details.instanceId}) \\n` +\r\n                    'dateFormat YYYY-MM-DDTHH:mm:ss.SSS \\n' +\r\n                    lines.map(item => item.nextLine).join('');\r\n\r\n                // Very much unknown, why this line is needed. Without it sometimes the diagrams fail to re-render\r\n                this._diagramSvg = '';\r\n\r\n                try {\r\n\r\n                    mermaid.render('mermaidSvgId', this._diagramCode, (svg) => {\r\n\r\n                        svg = this.injectFunctionNameAttributes(svg, linesWithMetadata);\r\n                        svg = this.adjustIntervalsSmallerThanOneSecond(svg, linesWithMetadata);\r\n\r\n                        this._diagramSvg = svg;\r\n\r\n                        resolve();\r\n                    });\r\n                    \r\n                } catch (err) {\r\n                    reject(err);\r\n                }\r\n\r\n            }, reject);\r\n        });\r\n    }\r\n\r\n    // Adds data-function-name attributes to diagram lines, so that Function names can be further used by rendering\r\n    private injectFunctionNameAttributes(svg: string, linesWithMetadata: LineTextAndMetadata[]): string {\r\n        \r\n        return svg.replace(new RegExp(`<(rect|text) id=\"task([0-9]+)(-text)?\"`, 'gi'), (match, tagName, taskIndex) => {\r\n\r\n            const oneBasedLineIndex = parseInt(taskIndex);\r\n\r\n            if (oneBasedLineIndex <= 0 || oneBasedLineIndex > linesWithMetadata.length) {\r\n                return match;\r\n            }\r\n\r\n            const lineMetadata = linesWithMetadata[oneBasedLineIndex - 1];\r\n            if (!lineMetadata.functionName) {\r\n                return match;\r\n            }\r\n\r\n            return match + ` data-function-name=\"${lineMetadata.functionName}\"`;\r\n        });\r\n    }\r\n\r\n    // Workaround for mermaid being unable to render intervals shorter than 1 second\r\n    private adjustIntervalsSmallerThanOneSecond(svg: string, linesWithMetadata: LineTextAndMetadata[]): string {\r\n\r\n        return svg.replace(new RegExp(`<rect id=\"task([0-9]+)\" [^>]+ width=\"([0-9]+)\"`, 'gi'), (match, taskIndex, activityWidth) => {\r\n\r\n            const oneBasedLineIndex = parseInt(taskIndex);\r\n\r\n            if (oneBasedLineIndex <= 0 || oneBasedLineIndex > linesWithMetadata.length) {\r\n                return match;\r\n            }\r\n\r\n            const activityMetadata = linesWithMetadata[oneBasedLineIndex - 1];\r\n            if (!activityMetadata.parentInstanceId || !activityMetadata.widthPercentage || (activityMetadata.duration > 10000)) {\r\n                return match;\r\n            }\r\n\r\n            // now we need to figure out the width (in pixels) of parent orchestration line\r\n            const orchIndex = linesWithMetadata.findIndex(l => l.instanceId === activityMetadata.parentInstanceId);\r\n            if (orchIndex < 0) {\r\n                return match;\r\n            }\r\n\r\n            const orchMatch = new RegExp(`<rect id=\"task${orchIndex + 1}\" [^>]+ width=\"([0-9]+)\"`, 'i').exec(svg);\r\n            if (!orchMatch) {\r\n                return match;\r\n            }\r\n\r\n            const orchWidth = parseInt(orchMatch[1]);\r\n            const newActivityWidth = activityMetadata.widthPercentage > 1 ? orchWidth : Math.ceil(orchWidth * activityMetadata.widthPercentage);\r\n\r\n            return match.replace(`width=\"${activityWidth}\"`, `width=\"${newActivityWidth.toFixed(0)}\"`)\r\n        });\r\n    }\r\n\r\n    private renderOrchestration(orchestrationId: string, orchestrationName: string, historyEvents: HistoryEvent[], isParentOrchestration: boolean):\r\n        Promise<LineTextAndMetadata[]>[] {\r\n\r\n        const results: Promise<LineTextAndMetadata[]>[] = [];\r\n\r\n        const startedEvent = historyEvents.find(event => event.EventType === 'ExecutionStarted');\r\n        const completedEvent = historyEvents.find(event => event.EventType === 'ExecutionCompleted');\r\n\r\n        var needToAddAxisFormat = isParentOrchestration;\r\n        var nextLine: string;\r\n        var orchDuration = 0;\r\n\r\n        if (!!startedEvent && !!completedEvent) {\r\n\r\n            if (needToAddAxisFormat) {\r\n\r\n                const longerThanADay = completedEvent.DurationInMs > 86400000;\r\n                nextLine = longerThanADay ? 'axisFormat %Y-%m-%d %H:%M \\n' : 'axisFormat %H:%M:%S \\n';\r\n                results.push(Promise.resolve([{ nextLine }]));\r\n                needToAddAxisFormat = false;\r\n            }\r\n            \r\n            nextLine = isParentOrchestration ? '' : `section ${orchestrationName}(${this.escapeTitle(orchestrationId)}) \\n`;\r\n\r\n            var lineName = this.formatDuration(completedEvent.DurationInMs);\r\n            if (!lineName) {\r\n                lineName = this.formatLineName(orchestrationName);\r\n            }\r\n\r\n            nextLine += `${lineName}: ${isParentOrchestration ? '' : 'active,'} ${this.formatDateTime(startedEvent.Timestamp)}, ${this.formatDurationInSeconds(completedEvent.DurationInMs)} \\n`;\r\n            results.push(Promise.resolve([{ nextLine, functionName: orchestrationName, instanceId: orchestrationId }]));\r\n            \r\n            orchDuration = completedEvent.DurationInMs;\r\n        }\r\n\r\n        if (needToAddAxisFormat) {\r\n\r\n            nextLine = 'axisFormat %H:%M:%S \\n';\r\n            results.push(Promise.resolve([{ nextLine }]));\r\n        }\r\n\r\n        for (var event of historyEvents) {\r\n\r\n            var eventTimestamp = event.ScheduledTime;\r\n\r\n            // Sometimes activity timestamp might appear to be earlier than orchestration start (due to machine time difference, I assume),\r\n            // and that breaks the diagram\r\n            if (!!startedEvent && (Date.parse(eventTimestamp) < Date.parse(startedEvent.Timestamp))) {\r\n                eventTimestamp = startedEvent.Timestamp;\r\n            }\r\n        \r\n            switch (event.EventType) {\r\n                case 'SubOrchestrationInstanceCompleted':\r\n                case 'SubOrchestrationInstanceFailed':\r\n\r\n                    if (!!event.SubOrchestrationId) {\r\n\r\n                        const subOrchestrationId = event.SubOrchestrationId;\r\n                        const subOrchestrationName = event.FunctionName;\r\n                        \r\n                        results.push(new Promise<LineTextAndMetadata[]>((resolve, reject) => {\r\n                            this._loadHistory(subOrchestrationId).then(history => {\r\n\r\n                                Promise.all(this.renderOrchestration(subOrchestrationId, subOrchestrationName, history, false)).then(sequenceLines => {\r\n\r\n                                    resolve(sequenceLines.flat());\r\n\r\n                                }, reject);\r\n\r\n                            }, err => {\r\n\r\n                                console.log(`Failed to load ${subOrchestrationName}. ${err.message}`);\r\n                                resolve([{ nextLine: `%% Failed to load ${this.formatLineName(subOrchestrationName)}. ${err.message} \\n` }]);\r\n                            });\r\n                        }));\r\n\r\n                        nextLine = `section ${orchestrationName}(${this.escapeTitle(orchestrationId)}) \\n`;\r\n                        results.push(Promise.resolve([{ nextLine }]));\r\n                    }\r\n\r\n                    break;\r\n                case 'TaskCompleted':\r\n\r\n                    nextLine = `${this.formatLineName(event.FunctionName)} ${this.formatDuration(event.DurationInMs)}: done, ${this.formatDateTime(eventTimestamp)}, ${this.formatDurationInSeconds(event.DurationInMs)} \\n`;\r\n                    results.push(Promise.resolve([{\r\n                        nextLine,\r\n                        functionName: event.FunctionName,\r\n                        parentInstanceId: orchestrationId,\r\n                        duration: event.DurationInMs,\r\n                        widthPercentage: orchDuration ? event.DurationInMs / orchDuration : 0\r\n                    }]));\r\n\r\n                    break;\r\n                case 'TaskFailed':\r\n\r\n                    nextLine = `${this.formatLineName(event.FunctionName)} ${this.formatDuration(event.DurationInMs)}: crit, ${this.formatDateTime(eventTimestamp)}, ${this.formatDurationInSeconds(event.DurationInMs)} \\n`;\r\n                    results.push(Promise.resolve([{\r\n                        nextLine,\r\n                        functionName: event.FunctionName,\r\n                        parentInstanceId: orchestrationId,\r\n                        duration: event.DurationInMs,\r\n                        widthPercentage: orchDuration ? event.DurationInMs / orchDuration : 0\r\n                    }]));\r\n\r\n                    break;\r\n                    case 'TimerFired':\r\n\r\n                        nextLine = `[TimerFired]: done, ${this.formatDateTime(event.Timestamp)}, 1s \\n`;\r\n                        results.push(Promise.resolve([{\r\n                            nextLine,\r\n                            functionName: orchestrationName,\r\n                            parentInstanceId: orchestrationId,\r\n                            duration: 1,\r\n                            widthPercentage: 0.0001\r\n                        }]));\r\n    \r\n                        break;\r\n                }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    private formatDateTime(utcDateTimeString: string): string {\r\n\r\n        if (!dfmContextInstance.showTimeAsLocal) {\r\n            return utcDateTimeString.substr(0, 23);\r\n        }\r\n\r\n        return moment(utcDateTimeString).format('YYYY-MM-DDTHH:mm:ss.SSS')\r\n    }\r\n\r\n    private formatLineName(name: string): string {\r\n\r\n        return name.replace(/:/g, '-');\r\n    }\r\n}","import { observable, computed } from 'mobx';\r\n\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { DurableOrchestrationStatus } from '../DurableOrchestrationStatus';\r\nimport { ICustomTabState, CustomTabTypeEnum } from './ICustomTabState';\r\nimport { CancelToken } from '../../CancelToken';\r\n\r\n// State of a custom liquid markup tab on OrchestrationDetails view\r\nexport class LiquidMarkupTabState implements ICustomTabState {\r\n\r\n    name: string = \"\";\r\n    readonly description = \"\";\r\n    readonly tabType = CustomTabTypeEnum.RawHtml;\r\n\r\n    @computed\r\n    get rawHtml(): string { return this._rawHtml; };\r\n\r\n    constructor(private _orchestrationId: string, private _backendClient: IBackendClient) {\r\n    }\r\n\r\n    load(details: DurableOrchestrationStatus, cancelToken: CancelToken): Promise<void> {\r\n\r\n        const uri = `/orchestrations('${this._orchestrationId}')/custom-tab-markup('${this.name}')`;\r\n        return this._backendClient.call('POST', uri).then(response => {\r\n\r\n            if (!cancelToken.isCancelled) {\r\n               \r\n                this._rawHtml = response;\r\n            }\r\n        });\r\n    }\r\n\r\n    @observable\r\n    private _rawHtml: string;\r\n}","import { observable, computed } from 'mobx';\r\n\r\nimport { DurableOrchestrationStatus, HistoryEvent } from '../DurableOrchestrationStatus';\r\nimport { ErrorMessageState } from '../ErrorMessageState';\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { ITypedLocalStorage } from '../ITypedLocalStorage';\r\nimport { SequenceDiagramTabState } from './SequenceDiagramTabState';\r\nimport { FunctionGraphTabState } from './FunctionGraphTabState';\r\nimport { ICustomTabState } from './ICustomTabState';\r\nimport { GanttDiagramTabState } from './GanttDiagramTabState';\r\nimport { LiquidMarkupTabState } from './LiquidMarkupTabState';\r\nimport { CancelToken } from '../../CancelToken';\r\nimport { FunctionsMap } from '../az-func-as-a-graph/FunctionsMap';\r\n\r\n// State of OrchestrationDetails view\r\nexport class OrchestrationDetailsState extends ErrorMessageState {\r\n\r\n    // Tab currently selected\r\n    @computed\r\n    get tabIndex(): number { return this._tabIndex; }\r\n    set tabIndex(val: number) {\r\n\r\n        if (this._tabIndex === val) {\r\n            return;\r\n        }\r\n\r\n        this._tabIndex = val;\r\n        this._localStorage.setItem('tabIndex', val.toString());\r\n\r\n        if (!!this.selectedTab) {\r\n\r\n            this.loadCustomTab();\r\n\r\n        } else if (!this._history.length) {\r\n\r\n            this.loadHistory();\r\n        }\r\n    }\r\n\r\n    get selectedTab(): ICustomTabState {\r\n        return !this._tabIndex ? null : this._tabStates[this._tabIndex - 1];\r\n    }\r\n\r\n    @computed\r\n    get details(): DurableOrchestrationStatus { return this._details; }\r\n\r\n    @computed\r\n    get history(): HistoryEvent[] { return this._history; }\r\n\r\n    @computed\r\n    get historyTotalCount(): number { return this._historyTotalCount; }\r\n\r\n    @computed\r\n    get orchestrationId(): string { return this._orchestrationId; }\r\n\r\n    @computed\r\n    get loadInProgress(): boolean { return this._cancelToken.inProgress && !this._cancelToken.isCancelled; }\r\n\r\n    @computed\r\n    get inProgress(): boolean { return this._inProgress || this.loadInProgress; };\r\n\r\n    @computed\r\n    get autoRefresh(): number { return this._autoRefresh; }\r\n    set autoRefresh(val: number) {\r\n        this._autoRefresh = val;\r\n        this._localStorage.setItem('autoRefresh', this._autoRefresh.toString());\r\n        this.loadDetails();\r\n    }\r\n\r\n    @computed\r\n    get raiseEventDialogOpen(): boolean { return this._raiseEventDialogOpen; }\r\n    set raiseEventDialogOpen(val: boolean) {\r\n        this._raiseEventDialogOpen = val;\r\n        this.eventName = '';\r\n        this.eventData = '';\r\n    }\r\n\r\n    @computed\r\n    get setCustomStatusDialogOpen(): boolean { return this._setCustomStatusDialogOpen; }\r\n    set setCustomStatusDialogOpen(val: boolean) {\r\n        this._setCustomStatusDialogOpen = val;\r\n        this.newCustomStatus = !!this._details.customStatus ? JSON.stringify(this._details.customStatus) : '';\r\n    }\r\n\r\n    @computed\r\n    get restartDialogOpen(): boolean { return this._restartDialogOpen; }\r\n    set restartDialogOpen(val: boolean) {\r\n        this._restartDialogOpen = val;\r\n        this.restartWithNewInstanceId = true;\r\n    }\r\n\r\n    @computed\r\n    get isCustomStatusDirty(): boolean { \r\n\r\n        if (!this._details.customStatus) {\r\n            return !!this.newCustomStatus;\r\n        }\r\n\r\n        return this.newCustomStatus !== JSON.stringify(this._details.customStatus);\r\n    }\r\n\r\n    @computed\r\n    get functionNames(): { [name: string]: any } { return this._functionMap; };\r\n\r\n    @observable\r\n    rewindConfirmationOpen: boolean = false;\r\n    @observable\r\n    terminateConfirmationOpen: boolean = false;\r\n    @observable\r\n    purgeConfirmationOpen: boolean = false;\r\n\r\n    @observable\r\n    eventName: string;\r\n    @observable\r\n    eventData: string;\r\n    @observable\r\n    newCustomStatus: string;\r\n    @observable\r\n    restartWithNewInstanceId: boolean = true;\r\n\r\n    @observable\r\n    longJsonDialogState = {};\r\n\r\n    @computed\r\n    get tabStates(): ICustomTabState[] { return this._tabStates; }\r\n\r\n    get backendClient(): IBackendClient { return this._backendClient; }\r\n\r\n    constructor(private _orchestrationId: string,\r\n        private _isFunctionGraphAvailable: boolean,\r\n        private _backendClient: IBackendClient,\r\n        private _localStorage: ITypedLocalStorage<OrchestrationDetailsState>) {\r\n        super();\r\n\r\n        const autoRefreshString = this._localStorage.getItem('autoRefresh');\r\n        if (!!autoRefreshString) {\r\n            this._autoRefresh = Number(autoRefreshString);\r\n        }\r\n\r\n        const tabIndexString = this._localStorage.getItem('tabIndex');\r\n        if (!!tabIndexString) {\r\n            this._tabIndex = Number(tabIndexString);\r\n        }\r\n    }\r\n\r\n    rewind() {\r\n        this.rewindConfirmationOpen = false;\r\n\r\n        const uri = `/orchestrations('${this._orchestrationId}')/rewind`;\r\n        this._inProgress = true;\r\n\r\n        this._backendClient.call('POST', uri).then(() => {\r\n            this._inProgress = false;\r\n            this.loadDetails();\r\n        }, err => {\r\n            this._inProgress = false;\r\n            this.errorMessage = `Failed to rewind: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        });\r\n    }\r\n\r\n    terminate() {\r\n        this.terminateConfirmationOpen = false;\r\n\r\n        const uri = `/orchestrations('${this._orchestrationId}')/terminate`;\r\n        this._inProgress = true;\r\n\r\n        this._backendClient.call('POST', uri).then(() => {\r\n            this._inProgress = false;\r\n            this.loadDetails();\r\n        }, err => {\r\n            this._inProgress = false;\r\n            this.errorMessage = `Failed to terminate: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        });\r\n    }\r\n\r\n    purge() {\r\n        this.purgeConfirmationOpen = false;\r\n\r\n        const uri = `/orchestrations('${this._orchestrationId}')/purge`;\r\n        this._inProgress = true;\r\n\r\n        this._backendClient.call('POST', uri).then(() => {\r\n            this._inProgress = false;\r\n            this._history = [];\r\n            this._details = new DurableOrchestrationStatus();\r\n            this._tabStates = [];\r\n        }, err => {\r\n            this._inProgress = false;\r\n            this.errorMessage = `Failed to purge: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        });\r\n    }\r\n\r\n    restart() {\r\n        this.restartDialogOpen = false;\r\n\r\n        const uri = `/orchestrations('${this._orchestrationId}')/restart`;\r\n        const requestBody = { restartWithNewInstanceId: this.restartWithNewInstanceId };\r\n\r\n        this._inProgress = true;\r\n\r\n        this._backendClient.call('POST', uri, requestBody).then(() => {\r\n            this._inProgress = false;\r\n            this.loadDetails();\r\n        }, err => {\r\n            this._inProgress = false;\r\n            this.errorMessage = `Failed to restart: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        });\r\n    }\r\n\r\n    raiseEvent() {\r\n\r\n        const uri = `/orchestrations('${this._orchestrationId}')/raise-event`;\r\n        const requestBody = { name: this.eventName, data: null };\r\n\r\n        try {\r\n            requestBody.data = JSON.parse(this.eventData);\r\n        } catch (err) {\r\n            this.errorMessage = `Failed to parse event data: ${err.message}`;\r\n            return;\r\n        } finally {\r\n            this.raiseEventDialogOpen = false;\r\n        }\r\n\r\n        this._inProgress = true;\r\n\r\n        this._backendClient.call('POST', uri, requestBody).then(() => {\r\n            this._inProgress = false;\r\n            this.loadDetails();\r\n        }, err => {\r\n            this._inProgress = false;\r\n            this.errorMessage = `Failed to raise an event: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        });\r\n    }\r\n\r\n    setCustomStatus() {\r\n\r\n        const uri = `/orchestrations('${this._orchestrationId}')/set-custom-status`;\r\n        var requestBody = null;\r\n\r\n        try {\r\n\r\n            if (!!this.newCustomStatus) {\r\n                requestBody = JSON.parse(this.newCustomStatus);\r\n            }\r\n\r\n        } catch (err) {\r\n            this.errorMessage = `Failed to parse custom status: ${err.message}`;\r\n            return;\r\n        } finally {\r\n            this.setCustomStatusDialogOpen = false;\r\n        }\r\n\r\n        this._inProgress = true;\r\n\r\n        this._backendClient.call('POST', uri, requestBody).then(() => {\r\n            this._inProgress = false;\r\n            this.loadDetails();\r\n        }, err => {\r\n            this._inProgress = false;\r\n            this.errorMessage = `Failed to set custom status: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        });\r\n    }\r\n\r\n    loadDetails() {\r\n\r\n        if (!!this.inProgress) { // We might end up here, if next timer occurs while a custom tab is still loading\r\n            // Doing auto-refresh\r\n            this.setAutoRefresh();\r\n            return;\r\n        }\r\n\r\n        this._inProgress = true;\r\n        this._noMorePagesToLoad = false;\r\n\r\n        if (!this._autoRefresh && (!this.selectedTab)) {\r\n            \r\n            this._history = [];\r\n            this._historyTotalCount = 0;\r\n        }\r\n\r\n        const functionMapPromise = !!this._isFunctionGraphAvailable ? this._backendClient.call('GET', `/function-map`) : Promise.resolve(null);\r\n\r\n        const uri = `/orchestrations('${this._orchestrationId}')`;\r\n        return Promise.all([this._backendClient.call('GET', uri), functionMapPromise]).then(responses => {\r\n        \r\n            this._details = responses[0];\r\n            const traversalResult = responses[1];\r\n\r\n            // Doing auto-refresh\r\n            this.setAutoRefresh();\r\n\r\n            var tabStateIndex = 0;\r\n\r\n            // Loading sequence diagram tab\r\n            if (this._details.entityType === \"Orchestration\") {\r\n               \r\n                if (this._tabStates.length <= tabStateIndex) {\r\n                    this._tabStates.push(new SequenceDiagramTabState((orchId) => this.loadAllHistory(orchId)));\r\n                    this._tabStates.push(new GanttDiagramTabState((orchId) => this.loadAllHistory(orchId)));\r\n                }\r\n                tabStateIndex += 2;\r\n            }\r\n\r\n            // Functions Graph tab\r\n            if (!!traversalResult) {\r\n\r\n                this._functionMap = traversalResult.functions;\r\n\r\n                const functionName = DurableOrchestrationStatus.getFunctionName(this._details);\r\n        \r\n                // Entities have their names lowered, so we need to do a case-insensitive match\r\n                const shownFunctionNames = Object.keys(traversalResult.functions).map(fn => fn.toLowerCase());\r\n                \r\n                // Only showing Functions Graph, if currently opened instance is shown on it\r\n                if (shownFunctionNames.includes(functionName.toLowerCase())) {\r\n                    \r\n                    if (this._tabStates.length <= tabStateIndex) {\r\n                        this._tabStates.push(new FunctionGraphTabState(this._backendClient, traversalResult, (orchId) => this.loadAllHistory(orchId)));\r\n                    }\r\n                    tabStateIndex++;\r\n                }\r\n            }\r\n\r\n            // Loading custom tabs\r\n            if (!!this._details.tabTemplateNames) {\r\n                for (var templateName of this._details.tabTemplateNames) {\r\n\r\n                    if (this._tabStates.length <= tabStateIndex) {\r\n                        this._tabStates.push(new LiquidMarkupTabState(this._orchestrationId, this._backendClient));\r\n                    }\r\n                    this._tabStates[tabStateIndex].name = templateName;\r\n                    tabStateIndex++;\r\n                }                \r\n            }\r\n\r\n            // Ensuring tab index does not go out of sync\r\n            if (this._tabIndex < 0 || this._tabIndex > this._tabStates.length) {\r\n                this._tabIndex = 0;\r\n            }\r\n\r\n            this._inProgress = false;\r\n\r\n            if (!this.selectedTab) {\r\n                \r\n                this.loadHistory(!!this._autoRefresh);\r\n\r\n            } else {\r\n\r\n                this.loadCustomTab();\r\n            }\r\n            \r\n        }, err => {\r\n            this._inProgress = false;\r\n\r\n            // Cancelling auto-refresh just in case\r\n            this._autoRefresh = 0;\r\n\r\n            this.errorMessage = `Load failed: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        });\r\n    }\r\n\r\n    cancel() {\r\n        this._cancelToken.isCancelled = true;\r\n        this._cancelToken = new CancelToken();\r\n    }\r\n\r\n    loadHistory(isAutoRefresh: boolean = false): void {\r\n\r\n        if (!!this.inProgress || !!this.selectedTab || !!this._noMorePagesToLoad) {\r\n            return;\r\n        }\r\n\r\n        const cancelToken = this._cancelToken;\r\n        cancelToken.inProgress = true;\r\n\r\n        // In auto-refresh mode only refreshing the first page\r\n        const skip = isAutoRefresh ? 0 : this._history.length;\r\n\r\n        const uri = `/orchestrations('${this._orchestrationId}')/history?$top=${this._pageSize}&$skip=${skip}`;\r\n\r\n        this._backendClient.call('GET', uri).then(response => {\r\n\r\n            if (cancelToken.isCancelled) {\r\n                return;\r\n            }\r\n\r\n            this._historyTotalCount = response.totalCount;\r\n\r\n            if (isAutoRefresh) {\r\n                this._history = response.history;\r\n            } else {\r\n                this._history.push(...response.history);\r\n\r\n                if (response.history.length < this._pageSize) {\r\n\r\n                    // Stop the infinite scrolling\r\n                    this._noMorePagesToLoad = true;\r\n                }\r\n            }\r\n        }, err => {\r\n\r\n            // Cancelling auto-refresh just in case\r\n            this._autoRefresh = 0;\r\n\r\n            if (!cancelToken.isCancelled) {\r\n                this.errorMessage = `Failed to load history: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n            }\r\n\r\n        }).finally(() => {\r\n            cancelToken.inProgress = false;\r\n        });\r\n    }\r\n\r\n    gotoFunctionCode(functionName: string): void {\r\n\r\n        if (this.backendClient.isVsCode) {\r\n            \r\n            this.backendClient.call('GotoFunctionCode', functionName).then(() => {}, err => {\r\n                console.log(`Failed to goto function code: ${err.message}`);\r\n            });\r\n    \r\n        } else {\r\n\r\n            var func = this._functionMap[functionName];\r\n\r\n            if (!!func && !!func.filePath) {\r\n                window.open(func.filePath);\r\n            }\r\n        }\r\n    }\r\n\r\n    showFunctionsGraph(): void {\r\n\r\n        this.backendClient.call('VisualizeFunctionsAsAGraph', '').then(() => {}, err => {\r\n            console.log(`Failed to goto functions graph: ${err.message}`);\r\n        });\r\n    }\r\n\r\n    private loadCustomTab(): void {\r\n\r\n        if (!!this.inProgress) {\r\n            return;\r\n        }\r\n\r\n        const cancelToken = this._cancelToken;\r\n        cancelToken.inProgress = true;\r\n\r\n        this.selectedTab.load(this._details, cancelToken).then(() => {}, err => { \r\n                \r\n            // Cancelling auto-refresh just in case\r\n            this._autoRefresh = 0;\r\n\r\n            if (!cancelToken.isCancelled) {\r\n                this.errorMessage = `Failed to load tab: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n            }\r\n\r\n        }).finally(() => {\r\n            cancelToken.inProgress = false;\r\n        });\r\n    }\r\n\r\n    private setAutoRefresh(): void {\r\n\r\n        if (!this._autoRefresh) {\r\n            return;\r\n        }\r\n\r\n        if (!!this._autoRefreshToken) {\r\n            clearTimeout(this._autoRefreshToken);\r\n        }\r\n        this._autoRefreshToken = setTimeout(() => this.loadDetails(), this._autoRefresh * 1000);\r\n    }\r\n\r\n    private loadAllHistory(orchestrationId: string): Promise<HistoryEvent[]> {\r\n\r\n        const uri = `/orchestrations('${orchestrationId}')/history`;\r\n        return this._backendClient.call('GET', uri).then(response => response.history);\r\n    }\r\n\r\n    @observable\r\n    private _tabStates: ICustomTabState[] = [];\r\n\r\n    @observable\r\n    private _details: DurableOrchestrationStatus = new DurableOrchestrationStatus();\r\n    @observable\r\n    private _history: HistoryEvent[] = [];\r\n    @observable\r\n    private _tabIndex: number = 0;\r\n    @observable\r\n    private _inProgress: boolean = false;\r\n    @observable\r\n    private _cancelToken: CancelToken = new CancelToken();\r\n    @observable\r\n    private _raiseEventDialogOpen: boolean = false;\r\n    @observable\r\n    private _setCustomStatusDialogOpen: boolean = false;\r\n    @observable\r\n    private _restartDialogOpen: boolean = false;\r\n    @observable\r\n    private _autoRefresh: number = 0;\r\n    @observable\r\n    private _historyTotalCount: number = 0;\r\n    @observable\r\n    private _functionMap: FunctionsMap = {};\r\n\r\n    private _autoRefreshToken: NodeJS.Timeout;\r\n    private _noMorePagesToLoad: boolean = false;\r\n    private readonly _pageSize = 200;\r\n}","import { observable, computed } from 'mobx';\r\nimport mermaid from 'mermaid';\r\n\r\nimport { buildFunctionDiagramCode } from './az-func-as-a-graph/buildFunctionDiagramCode';\r\nimport { FunctionGraphStateBase } from './FunctionGraphStateBase';\r\n\r\n// State of FunctionGraph view\r\nexport class FunctionGraphState extends FunctionGraphStateBase {\r\n\r\n    @observable\r\n    errorMessage: string = '';\r\n\r\n    @computed\r\n    get inProgress(): boolean { return this._inProgress; };\r\n\r\n    @computed\r\n    get functionsLoaded(): boolean { return !!this._traversalResult; };\r\n\r\n    @computed\r\n    get renderFunctions(): boolean { return this._renderFunctions; };\r\n    set renderFunctions(val: boolean) {\r\n        this._renderFunctions = val;\r\n        this.render();\r\n    };\r\n\r\n    @computed\r\n    get renderProxies(): boolean { return this._renderProxies; };\r\n    set renderProxies(val: boolean) {\r\n        this._renderProxies = val;\r\n        this.render();\r\n    };\r\n    \r\n    render() {\r\n        \r\n        this._diagramCode = '';\r\n        this._diagramSvg = '';\r\n        this.errorMessage = '';\r\n\r\n        if (!this._traversalResult) {\r\n            return;\r\n        }\r\n\r\n        this._inProgress = true;\r\n        try {\r\n            const diagramCode = buildFunctionDiagramCode(this._traversalResult.functions, this._traversalResult.proxies,\r\n                {\r\n                    doNotRenderFunctions: !this._renderFunctions,\r\n                    doNotRenderProxies: !this._renderProxies\r\n                });\r\n\r\n            if (!diagramCode) {\r\n                this._inProgress = false;\r\n                return;\r\n            }\r\n\r\n            this._diagramCode = `graph LR\\n${diagramCode}`;\r\n\r\n            mermaid.render('mermaidSvgId', this._diagramCode, (svg) => {\r\n\r\n                this._diagramSvg = this.applyIcons(svg);\r\n\r\n                this._inProgress = false;\r\n            });\r\n\r\n        } catch (err) {\r\n            this.errorMessage = `Failed to render: ${err.message}`;\r\n            this._inProgress = false;\r\n        }\r\n    }\r\n\r\n    load() {\r\n\r\n        if (this._inProgress) {\r\n            return;\r\n        }\r\n\r\n        // Only doing this on demand, just in case\r\n        this.initMermaidWhenNeeded();\r\n\r\n        this._inProgress = true;\r\n        this.errorMessage = '';\r\n        this._diagramCode = '';\r\n        this._diagramSvg = '';\r\n        this._traversalResult = null;\r\n\r\n        this._backendClient.call('GET', '/function-map').then(response => {\r\n\r\n            this._traversalResult = response;\r\n            this.render();\r\n\r\n        }, err => {\r\n            this._inProgress = false;\r\n            this.errorMessage = `Failed to traverse: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        });\r\n    }\r\n\r\n    @observable\r\n    private _inProgress: boolean = false;\r\n}","import { observable, computed } from 'mobx'\r\nimport moment from 'moment';\r\n\r\nimport { DateTimeHelpers } from '../../DateTimeHelpers';\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { RuntimeStatus, EntityType } from '../DurableOrchestrationStatus';\r\nimport { ErrorMessageState } from '../ErrorMessageState';\r\n\r\n// State of Purge History Dialog\r\nexport class PurgeHistoryDialogState extends ErrorMessageState {\r\n\r\n    @computed\r\n    get dialogOpen(): boolean { return this._dialogOpen; };\r\n    set dialogOpen(value: boolean) {\r\n        this._dialogOpen = value;\r\n\r\n        if (value) {\r\n\r\n            this._instancesDeleted = null;\r\n\r\n            this.timeFrom = moment().subtract(1, 'days').utc();\r\n            this.timeTill = moment().utc();\r\n\r\n            this._statuses = new Set<RuntimeStatus>([\"Completed\", \"Terminated\"]);\r\n\r\n            this.entityType = \"Orchestration\";\r\n        }\r\n    }\r\n\r\n    @computed\r\n    get instancesDeleted(): number | null { return this._instancesDeleted; };\r\n\r\n    @computed\r\n    get inProgress(): boolean { return this._inProgress; };\r\n\r\n    @computed\r\n    get isValid(): boolean {\r\n        return this._statuses.size > 0 && DateTimeHelpers.isValidMoment(this.timeFrom) && DateTimeHelpers.isValidMoment(this.timeTill);\r\n    };\r\n\r\n    constructor(private _backendClient: IBackendClient) {\r\n        super();\r\n    }\r\n\r\n    purgeHistory() {\r\n\r\n        this._inProgress = true;\r\n\r\n        this._backendClient.call('POST', '/purge-history', {\r\n            entityType: this.entityType,\r\n            timeFrom: this.timeFrom.toISOString(),\r\n            timeTill: this.timeTill.toISOString(),\r\n            statuses: Array.from(this._statuses.values())\r\n        }).then(response => {\r\n\r\n            this._instancesDeleted = response.instancesDeleted;\r\n\r\n        }, err => {\r\n            this.errorMessage = `Purge history failed: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        }).finally(() => {\r\n            this._inProgress = false;\r\n        });\r\n    }\r\n\r\n    @observable\r\n    timeFrom: moment.Moment;\r\n    @observable\r\n    timeTill: moment.Moment;\r\n\r\n    @observable\r\n    entityType: EntityType = \"Orchestration\";\r\n\r\n    getStatusIncluded(status: RuntimeStatus) {\r\n        return this._statuses.has(status);\r\n    }\r\n\r\n    setStatusIncluded(status: RuntimeStatus, included: boolean) {\r\n        if (included) {\r\n            this._statuses.add(status);\r\n        } else {\r\n            this._statuses.delete(status);\r\n        }\r\n    }\r\n\r\n    @observable\r\n    private _statuses: Set<RuntimeStatus> = new Set<RuntimeStatus>();\r\n\r\n    @observable\r\n    private _dialogOpen: boolean = false;\r\n    \r\n    @observable\r\n    private _inProgress: boolean = false;\r\n\r\n    @observable\r\n    private _instancesDeleted: number | null = null;\r\n}","import { observable, computed } from 'mobx'\r\n\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { ErrorMessageState } from '../ErrorMessageState';\r\n\r\n// State of Clean Entity Storage Dialog\r\nexport class CleanEntityStorageDialogState extends ErrorMessageState {\r\n\r\n    @computed\r\n    get dialogOpen(): boolean { return this._dialogOpen; };\r\n    set dialogOpen(isOpen: boolean) {\r\n        this._dialogOpen = isOpen;\r\n\r\n        if (isOpen) {\r\n            this._response = null;\r\n            this.removeEmptyEntities = true;\r\n            this.releaseOrphanedLocks = true;\r\n        }\r\n    }\r\n\r\n    @computed\r\n    get response(): CleanEntityStorageResponse | null { return this._response; };\r\n\r\n    @computed\r\n    get inProgress(): boolean { return this._inProgress; };\r\n\r\n    @computed\r\n    get isValid(): boolean {\r\n        return true;\r\n    };\r\n\r\n    @observable\r\n    removeEmptyEntities: boolean;\r\n    @observable\r\n    releaseOrphanedLocks: boolean;\r\n    \r\n    constructor(private _backendClient: IBackendClient) {\r\n        super();\r\n    }\r\n\r\n    clean() {\r\n\r\n        this._inProgress = true;\r\n\r\n        this._backendClient.call('POST', '/clean-entity-storage', {\r\n            removeEmptyEntities: this.removeEmptyEntities,\r\n            releaseOrphanedLocks: this.releaseOrphanedLocks\r\n        }).then(response => {\r\n            this._response = response;\r\n        }, err => {\r\n            this.errorMessage = `Clean Entity Storage failed: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        }).finally(() => {\r\n            this._inProgress = false;\r\n        });\r\n    }\r\n\r\n    @observable\r\n    private _dialogOpen: boolean = false;\r\n    \r\n    @observable\r\n    private _inProgress: boolean = false;\r\n\r\n    @observable\r\n    private _response: CleanEntityStorageResponse | null = null;\r\n}\r\n\r\nexport class CleanEntityStorageResponse\r\n{\r\n    numberOfEmptyEntitiesRemoved: number;\r\n    numberOfOrphanedLocksRemoved: number;\r\n}","import { observable, computed } from 'mobx'\r\n\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { ErrorMessageState } from '../ErrorMessageState';\r\n\r\n// State of Connection Params Dialog\r\nexport class ConnectionParamsDialogState extends ErrorMessageState {\r\n\r\n    @observable\r\n    hubName: string;\r\n    @observable\r\n    connectionString: string;\r\n\r\n    @computed\r\n    get inProgress(): boolean { return this._inProgress; }\r\n\r\n    @computed\r\n    get isReadonly(): boolean { return this._isReadOnly; }\r\n\r\n    @computed\r\n    get isDirty(): boolean {\r\n        return (this.connectionString !== this._oldConnectionString) || (this.hubName !== this._oldHubName);\r\n    }\r\n\r\n    @computed\r\n    get dialogOpen(): boolean { return this._dialogOpen; };\r\n    set dialogOpen(value: boolean) {\r\n        this._dialogOpen = value;\r\n\r\n        if (!!value) {\r\n\r\n            this._inProgress = true;\r\n\r\n            this._backendClient.call('GET', '/manage-connection').then(response => {\r\n    \r\n                this.connectionString = this._oldConnectionString = response.connectionString;\r\n                this.hubName = this._oldHubName = response.hubName;\r\n                this._isReadOnly = response.isReadOnly;\r\n    \r\n            }, err => {\r\n                this.errorMessage = `Load failed: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n            }).finally(() => {\r\n                this._inProgress = false;\r\n            });\r\n            }\r\n    }\r\n\r\n    constructor(private _backendClient: IBackendClient) {\r\n        super();\r\n    }\r\n    \r\n    saveConnectionParams() {\r\n\r\n        this._inProgress = true;\r\n\r\n        this._backendClient.call('PUT', '/manage-connection', {\r\n            connectionString: this.connectionString !== this._oldConnectionString ? this.connectionString : '',\r\n            hubName: this.hubName\r\n        }).then(() => {\r\n        \r\n            this._dialogOpen = false;\r\n\r\n            alert(`Your changes were saved to local.settings.json file, but they cannot be picked up automatically. Please, restart the Function Host for them to take effect.`);\r\n\r\n        }, err => {\r\n            this.errorMessage = `Save failed: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        }).finally(() => {\r\n            this._inProgress = false;\r\n        });\r\n    }\r\n\r\n    @observable\r\n    private _dialogOpen: boolean = false;\r\n\r\n    @observable\r\n    private _inProgress: boolean = false;\r\n\r\n    @observable\r\n    private _isReadOnly: boolean = false;\r\n\r\n    private _oldConnectionString: string;\r\n    private _oldHubName: string;\r\n}","import { observable, computed } from 'mobx'\r\n\r\nimport { IBackendClient } from '../../services/IBackendClient';\r\nimport { ErrorMessageState } from '../ErrorMessageState';\r\n\r\n// State of New Orchestration Instance Dialog\r\nexport class StartNewInstanceDialogState extends ErrorMessageState {\r\n\r\n    @observable\r\n    instanceId: string;\r\n    @observable\r\n    orchestratorFunctionName: string;\r\n    @observable\r\n    input: string;\r\n\r\n    @computed\r\n    get startedInstanceId(): string { return this._startedInstanceId; }\r\n\r\n    @computed\r\n    get inProgress(): boolean { return this._inProgress; }\r\n\r\n    @computed\r\n    get dialogOpen(): boolean { return this._dialogOpen; };\r\n    set dialogOpen(value: boolean) {\r\n        this._dialogOpen = value;\r\n\r\n        this.instanceId = '';\r\n        this.orchestratorFunctionName = '';\r\n        this.input = '';\r\n        this._startedInstanceId = '';\r\n    }\r\n\r\n    get backendClient(): IBackendClient { return this._backendClient; }\r\n\r\n    constructor(private _backendClient: IBackendClient) {\r\n        super();\r\n    }\r\n    \r\n    startNewInstance() {\r\n\r\n        var inputObject = null;\r\n        if (!!this.input) {\r\n            try {\r\n\r\n                inputObject = JSON.parse(this.input);\r\n            \r\n            } catch (err) {\r\n    \r\n                this.errorMessage = `Failed to parse input: ${err.message}`;\r\n                return;\r\n            }\r\n        }\r\n\r\n        this._inProgress = true;\r\n\r\n        this._backendClient.call('POST', '/orchestrations', { id: this.instanceId, name: this.orchestratorFunctionName, data: inputObject })\r\n        .then(response => {\r\n\r\n            this._startedInstanceId = response.instanceId;\r\n\r\n        }, err => {\r\n            this.errorMessage = `Failed to start new instance: ${err.message}.${(!!err.response ? err.response.data : '')} `;\r\n        }).finally(() => {\r\n            this._inProgress = false;\r\n        });\r\n    }\r\n\r\n    @observable\r\n    private _dialogOpen: boolean = false;\r\n\r\n    @observable\r\n    private _inProgress: boolean = false;\r\n\r\n    @observable\r\n    private _startedInstanceId: string;\r\n}","import { ITypedLocalStorage } from './ITypedLocalStorage';\r\nimport { QueryString } from './QueryString';\r\n\r\n// Stores field values in a localStorage\r\nexport class TypedLocalStorage<T> implements ITypedLocalStorage<T>\r\n{\r\n    constructor(private _prefix: string) { }\r\n\r\n    setItem(fieldName: Extract<keyof T, string>, value: string) {\r\n\r\n        localStorage.setItem(`${this._prefix}::${fieldName}`, value);\r\n\r\n        // Also placing into query string\r\n        const queryString = new QueryString();\r\n        queryString.values[fieldName] = value;\r\n        queryString.apply();\r\n    }\r\n\r\n    setItems(items: { fieldName: Extract<keyof T, string>, value: string | null }[]) {\r\n\r\n        // Also placing into query string\r\n        const queryString = new QueryString();\r\n\r\n        for (const item of items) {\r\n            if (item.value === null) {\r\n\r\n                localStorage.removeItem(`${this._prefix}::${item.fieldName}`);\r\n\r\n                delete queryString.values[item.fieldName];\r\n\r\n            } else {\r\n\r\n                localStorage.setItem(`${this._prefix}::${item.fieldName}`, item.value);\r\n\r\n                queryString.values[item.fieldName] = item.value;\r\n            }\r\n        }\r\n\r\n        queryString.apply();\r\n    }\r\n\r\n    getItem(fieldName: Extract<keyof T, string>): string | null {\r\n\r\n        // Query string should take precedence\r\n        const queryString = new QueryString();\r\n        if (!!queryString.values[fieldName]) {\r\n            return queryString.values[fieldName];\r\n        }\r\n\r\n        return localStorage.getItem(`${this._prefix}::${fieldName}`);\r\n    }\r\n\r\n    removeItem(fieldName: Extract<keyof T, string>) {\r\n\r\n        localStorage.removeItem(`${this._prefix}::${fieldName}`);\r\n\r\n        // Also dropping from query string\r\n        const queryString = new QueryString();\r\n        delete queryString.values[fieldName];\r\n        queryString.apply();\r\n    }\r\n}\r\n","import { Method } from 'axios';\r\nimport { IBackendClient } from './IBackendClient';\r\n\r\n// IBackendClient implementation for VsCode extension, forwards HTTP requests to VsCode\r\nexport class VsCodeBackendClient implements IBackendClient {\r\n\r\n    get isVsCode(): boolean { return true; }\r\n\r\n    get routePrefixAndTaskHubName(): string { return null; }\r\n\r\n    constructor(private _vsCodeApi: any) {\r\n\r\n        // Handling responses from VsCode\r\n        window.addEventListener('message', event => {\r\n\r\n            const message = event.data;\r\n\r\n            // handling menu commands\r\n            const requestHandler = this._handlers[message.id];\r\n            if (!!requestHandler) {\r\n\r\n                try {\r\n                    requestHandler(message.data);\r\n                } catch(err) {\r\n                    console.log('Failed to handle response from VsCode: ' + err);\r\n                }\r\n\r\n                return;\r\n            }\r\n\r\n            // handling HTTP responses\r\n            const requestPromise = this._requests[message.id];\r\n            if (!requestPromise) {\r\n                return;\r\n            }\r\n\r\n            if (!!message.err) {\r\n                requestPromise.reject(message.err);\r\n            } else {\r\n                requestPromise.resolve(message.data);\r\n            }\r\n\r\n            delete this._requests[message.id];\r\n        });\r\n    }\r\n\r\n    call(method: Method | 'OpenInNewWindow', url: string, data?: any): Promise<any> {\r\n\r\n        const requestId = Math.random().toString();\r\n\r\n        // Sending request to VsCode\r\n        this._vsCodeApi.postMessage({ id: requestId, method, url, data });\r\n\r\n        return new Promise<any>((resolve, reject) => {\r\n            this._requests[requestId] = { resolve, reject };\r\n        });\r\n    }\r\n\r\n    setCustomHandlers(purgeHistoryHandler: () => void, cleanEntityStorageHandler: () => void) {\r\n\r\n        this._handlers['purgeHistory'] = purgeHistoryHandler;\r\n        this._handlers['cleanEntityStorage'] = cleanEntityStorageHandler;\r\n\r\n        // Notifying VsCode that we're ready to process messages\r\n        // Cannot do this in ctor, because VsCodeBackendClient and PurgeHistoryDialogState depend on each other\r\n        this._vsCodeApi.postMessage({ method: 'IAmReady' });\r\n    }\r\n\r\n    private _handlers: {\r\n        [id: string]: (data: any) => void\r\n    } = {};\r\n\r\n    private _requests: {\r\n        [id: string]: {\r\n            resolve: (value?: any) => void,\r\n            reject: (reason?: any) => void\r\n        }\r\n    } = {};\r\n}","import { ITypedLocalStorage } from './ITypedLocalStorage';\r\n\r\n// A global variable declared in index.html and replaced by VsCode extension\r\ndeclare const StateFromVsCode: {};\r\n\r\n// Stores field values in VsCode\r\nexport class VsCodeTypedLocalStorage<T> implements ITypedLocalStorage<T>\r\n{\r\n    constructor(private _prefix: string, private _vsCodeApi: any) { \r\n        this._state = StateFromVsCode[this._prefix];\r\n        if (!this._state) {\r\n            this._state = {};\r\n        }\r\n    }\r\n\r\n    setItem(fieldName: Extract<keyof T, string>, value: string) {\r\n\r\n        this._state[fieldName] = value\r\n        this.save();\r\n    }\r\n\r\n    setItems(items: { fieldName: Extract<keyof T, string>, value: string | null }[]) {\r\n\r\n        for (const item of items) {\r\n\r\n            if (item.value === null) {\r\n                delete this._state[item.fieldName];\r\n            } else {\r\n                this._state[item.fieldName] = item.value;\r\n            }\r\n        }\r\n\r\n        this.save();\r\n    }\r\n\r\n    getItem(fieldName: Extract<keyof T, string>): string | null {\r\n\r\n        return this._state[fieldName];\r\n    }\r\n\r\n    removeItem(fieldName: Extract<keyof T, string>) {\r\n\r\n        delete this._state[fieldName];\r\n        this.save();\r\n    }\r\n\r\n    private readonly _state: any;\r\n\r\n    private save(): void {\r\n        this._vsCodeApi.postMessage({ method: 'PersistState', key: this._prefix, data: this._state });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport * as ReactDOM from 'react-dom';\r\n\r\nimport { ThemeProvider } from \"@material-ui/styles\";\r\n\r\nimport './index.css';\r\nimport '../node_modules/react-vis/dist/style.css';\r\n\r\nimport { Main } from './components/Main';\r\nimport { MainState } from './states/MainState';\r\nimport { Theme } from './theme';\r\n\r\ndocument.body.style.backgroundColor = Theme.palette.background.paper;\r\n\r\n// This is the app's global state. It consists of multiple parts, consumed by multiple nested components\r\nconst appState = new MainState();\r\n\r\nReactDOM.render(\r\n    <ThemeProvider theme={Theme} >\r\n        <Main state={appState} />\r\n    </ThemeProvider>,\r\n    document.getElementById('root') as HTMLElement\r\n);"],"sourceRoot":""}